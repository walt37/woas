<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta woas_permanent="1" http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta woas_permanent="1" http-equiv="X-UA-Compatible" content="IE=edge" />
<script woas_permanent="1" type="text/javascript">
/* <![CDATA[ */

/* aFWplTsKDv-0000004-START */

var woas = {"version": "0.14.0 Beta 1"};

var __marker = "aFWplTsKDv-0000004";

woas["config"] = {
"permit_edits":true,
"dblclick_edit":false,
"save_on_quit":false,
"nav_history":false,
"allow_diff":true,
"key_cache":true,
"safe_mode":false,
"debug_mode":true,
"debug_closed":true,
"main_page":'Main Page',
"wsif_author":'Anonymous',
"wsif_ds":'',
"new_tables_syntax":true,
"store_mts":true,
"folding_style":2,
"import_woas":224,
"import_wsif":248,
"auto_links":true,
"sort_tags":true,
"fixed_header":true,
"fixed_menu":true,
"menu_link":0};

var current = 'Main Page';

var backstack = [
];

var page_titles = [
'Main Page',
'::Menu',
'WoaS::Aliases',
'WoaS::Hotkeys',
'WoaS::CSS::Custom',
'Special::Advanced',
'Special::Import',
'Special::About',
'Special::Search',
'Special::Lock',
'WoaS::Help::Security',
'Special::Options',
'WoaS::Help::Deprecated syntax',
'WoaS::Help::Special::Options',
'Special::Embed',
'WoaS::Plugins',
'Special::Export',
'Special::License',
'Special::ExportWSIF',
'WoaS::Help::WSIF',
'Special::ImportWSIF',
'WoaS::Help::Macros',
'WoaS::Help::Index',
'WoaS::Help::Syntax',
'WoaS::Help::Special::Advanced',
'WoaS::Help::Special::Erase Wiki',
'WoaS::Help::CSS',
'WoaS::Help::Special::Dead Pages',
'WoaS::Help::General use',
'WoaS::Help::Nowiki text',
'WoaS::Template::Info',
'WoaS::Help::Wiki is read-only',
'WoaS::Help::Create a page',
'WoaS::Help::Delete a page',
'WoaS::Help::Editor',
'WoaS::Help::Edit a page',
'WoaS::Help::Erase all pages',
'WoaS::Help::Edit the menu',
'WoaS::Help::Headings',
'WoaS::Help::Rulers',
'WoaS::Help::Include wiki page',
'WoaS::Help::JavaScript',
'WoaS::Help::Join lines of text',
'WoaS::Help::Namespaces',
'WoaS::Help::Text formatting',
'WoaS::Help::Rename a page',
'WoaS::Help::Page scrolling',
'WoaS::Help::Table of Contents',
'WoaS::Help::Tags',
'WoaS::Help::Publish wiki online',
'WoaS::Help::Run wiki on a web server',
'WoaS::Help::Requirements & saving',
'WoaS::Help::Lists',
'WoaS::Help::Tables',
'WoaS::Help::Links',
'WoaS::Help::Images',
'WoaS::Help::Import',
'WoaS::Template::Search',
'WoaS::Help::Export',
'WoaS::Help::Template transclusion::Example',
'WoaS::Help::Template transclusion',
'WoaS::Help::Special::ExportWSIF',
'WoaS::Help::Special::ImportWSIF',
'WoaS::CSS::Core',
'WoaS::CSS::Boot',
'WoaS::Help::Hotkeys',
'WoaS::Help::Plugins',
'WoaS::Help::Aliases',
'WoaS::Template::ImportSettings',
'WoaS::Help::Include web page',
'WoaS::Help::Include text file',
'WoaS::Help::CSS::Core',
'WoaS::Help::CSS::Custom',
'WoaS::Help::Locked',
'WoaS::Help::CSS::Boot',
'WoaS::Help',
'WoaS::Help::Special::Orphaned Pages',
'WoaS::Help::Special::Recent Changes',
'WoaS::Help::Special::Search',
'WoaS::Help::Special::All Pages',
'WoaS::Help::Tagged',
'WoaS::Help::Unlocked',
'WoaS::Help::Untagged',
'WoaS::Help::Special::Export',
'WoaS::Help::Special::Import',
'WoaS::Help::Special::Backlinks',
'WoaS::Help::Menu',
'WoaS::Help::Duplicate a page',
'WoaS::Help::Go to a page',
'WoaS::Help::Files',
'Test-BLOB'
];

/* aFWplTsKDv-0000004-DATA */
var page_attrs = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

var page_mts = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1639523933];

var pages = [
'A blank sheet is a catalyst for ideas',
'[[Main Page]]\n\
[[Special::Options|Options]]\n\
\n\
[[Test-BLOB]]\n\
* [[Special::All Pages|All Pages]]\n\
* [[Special::Recent Changes|Recent Changes]]\n\
* [[Special::Go to|Go to...]]\n\
\n\
* [[Special::Backlinks|Backlinks]]\n\
* [[Special::New Page|New Page]]\n\
* [[Special::Duplicate Page|Duplicate Page]]\n\
* [[Special::Delete Page|Delete Page]]\n\
\n\
\n\
[[Include::WoaS::Template::Search]]',
'Lines that do not start with \'$\' are ignored\n\
\n\
$JS  Javascript',
'$SAVE	s\n\
$EDIT	e\n\
$PRINT	p\n\
$HELP	h\n\
$GOTO	g\n\
$CANCEL	0x1b\n\
$BACK	0x8\n\
',
'/* Your CSS customization goes here */',
'== General\n\
* [[Special::Options]] - WoaS options\n\
* [[Special::Search]] - search all wiki pages\n\
== Lists\n\
* [[File::]], [[Image::]] - pages in the embedded namespaces\n\
* [[Locked::]], [[Unlocked::]] - encrypted/plain pages\n\
* [[Special::All Pages]] - user created pages\n\
* [[Special::Dead Pages]] - nonexistent pages that other pages link to\n\
* [[Special::Orphaned Pages]] - pages that no other page links to\n\
* [[Special::Recent Changes]] - recently modified pages\n\
* [[Tagged::]], [[Untagged::]] - tagged/untagged pages\n\
== Page commands\n\
* [[Special::Delete Page]] - delete a specific page\n\
* [[Special::Duplicate Page]] - duplicate a specific page\n\
* [[Special::Go to]] - go to a specific page\n\
* [[Special::New Page]] - create a new page\n\
== Special features\n\
* [[WoaS::Aliases]] - view/edit page title aliases\n\
* [[WoaS::CSS::Core]], [[WoaS::CSS::Custom]] - view the core CSS and edit the custom CSS\n\
* [[WoaS::Hotkeys]] - view/edit WoaS access keys and default key bindings\n\
* [[WoaS::Plugins]] - enable/disable and view/edit WoaS JavaScript plugins\n\
== Wiki maintenance\n\
* [[Special::Import]] - import wiki from a WoaS html file (including earlier versions)\n\
* [[Special::ImportWSIF]] - import a [[WoaS::Help::WSIF|WSIF]] file containing one or more wiki pages\n\
* [[Special::Export]] - export wiki into multiple linked static XHTML files\n\
* [[Special::ExportWSIF]] - export wiki into multiple or single [[WoaS::Help::WSIF|WSIF]] files\n\
* [[Special::Erase Wiki]] - delete ALL wiki pages and reset with default data\n\
',
'\x3Cdiv class="woas_top"\x3E\x3Cinput id="btn_import" class="woas_button_top" type="button" value="Import" onclick="woas.import_wiki(d$.file(\'filename_\'))" /\x3E\x3C/div\x3E\n\
=Import a wiki from a WoaS /HTML/ file\n\
/The imported WoaS file can be from a current or earlier version./\n\
\x3Cfieldset id="s2213" class="woas_input_wrap"\x3E\x3Clegend\x3ESource\x3C/legend\x3E\\\n\
\x3Clabel class="woas_input_wrap_left"\x3EFile: \x3Cinput class="woas_input_wrap_inline" id="filename_" type="file" /\x3E\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_import_config" onclick="woas.importer.i_config=this.checked"\x3EImport configuration (except WSIF datasource settings)\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_import_content" onclick="woas.ui._import_load_change()"\x3EImport content\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_import_styles" onclick="woas.ui._import_load_change()"\x3EImport custom CSS\x3C/label\x3E\n\
\x3C/fieldset\x3E\\\n\
[[Include::WoaS::Template::ImportSettings]]\\\n\
\x3Cscript type="text/javascript"\x3E\n\
woas.ui._import_load(false);\n\
\x3C/script\x3E\n\
',
'[[Special::TOC]]\n\
[[Include::Beta testing]]\n\
= Welcome to Wiki on a Stick!\n\
Wiki on a Stick (*WoaS*) is a [[http://en.wikipedia.org/wiki/Wiki|wiki]] that lives in *one self-modifying XHTML file*. It\'s perfect for use at home or office, on your laptop or USB pen drive. Woas can be used as a personal notepad, calendar, repository for software documentation, and for many other purposes; it allows full customization and extension by your own macros, scripts, and plugins, and pages can even be protected with [[WoaS::Help::Security|AES encryption]].\n\
== This /Woas/ Version\n\
This version of WoaS is based on v0.12.0 but has been modified by Paul Levey ([[http://pvhl.users.sourceforge.net/|pvhl]]) to fix various bugs present in the official 0.12.0 release and to generally improve the overall look and functionality of WoaS. I call my version /Woas/, and give it a different logo so it can be recognized as different from the official releases. The changes  I have made represent many hundreds of hours of work, including repeatedly cross-checking on many different browsers to achieve the same results across them all (a patch file between the two versions is about 750k!). The improvements range from a greatly improved /Search/ page, to a little padding in the editor textarea. It also uses a new layout system that allows section jumps to appear where they should, and a fixed header that doesn\'t jump around with changing content length. And it stays consistent at all text sizes, an important point for myself. Though I\'ve never seen it on a handheld device, I have tested it on a little 7 inch ASUS and it worked very well, so it ought to be fairly usable on smaller devices.\n\
\n\
This version is well tested, and I use it for all my research -- though we all need to keep backups, right? (An excellent way to use Woas is from a DropBox folder.)\n\
\n\
It is expected that many of these changes will some day make their way into the official code. The latest released version of this file can be found at my [[http://woas.sourceforge.net|Woas development project]], and the \'bleeding-edge\' code is at [[|my GitHub account]] (only recommended for helping with development, or creating your own version). It is a simple matter to import any content you have in other WoaS files using the [[Special::Import|import page]].\n\
\n\
My thanks to [[http://bookonastick.wordpress.com/|Little Girl]] for her extensive work on the Help pages, the majority of whose content was written by her, and for her help with testing, and to various others for encouragement and help with testing.\n\
== Official Versions\n\
Versions 0.9&tilde;0.12.0 by Daniele C. ([[http://sf.net/users/legolas558/|legolas558]])\n\
Original version (v0.01 &tilde; v0.04) by Andr\u00e9 Wagner\n\
== License\n\
While the WoaS project is released under the GNU/GPL license, my /Wiki on a stick/ work is licensed under the more recent, but compatible, [[Special::License|GNU Affrero license]].\n\
= Project Interaction\n\
== Websites\n\
\x3Cspan id="img_logo"\x3E\x3Cimg style="display:inline;position:relative;top:10px" alt="WoaS Logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABNVBMVEUAAADHx8fV1dXU1NQAAAAbGxvIyMjKysrPz8/Q0NC4uLjFxcXW1tbZ2dnT09PR0dHr6+uoqKiurq4ODg4PDw8SEhINDQ0oKCg3Nzc7OzuYmJhXV1dlZWV2dnbX19eLi4vb29vf39/g4ODo6OiioqLs7Ozv7+/Gxsbw8PBDQ0Pn5+cqKiri4uI+Pj7JyclISEgdHR3MzMzExMTY2NiKioorKyvd3d2NjY3p6enq6uo1NTUVFRXu7u6tra0JCQlHR0fOzs7Nzc13d3eVlZV+fn63t7eBgYHBwcExMTE4ODh4eHh5eXmxsbFfX18MDAxqamre3t7S0tJtbW0cHBzCwsJRUVHa2tpTU1OMjIxwcHBxcXF0dHRGRkbj4+OWlpacnJwlJSWjo6OlpaVhYWGrq6tERER8fHyvHo28AAAAAXRSTlMAQObYZgAAAY5JREFUeF6V08WSIzEQBNDKkprRzIzDzDzLzMz4/58wbkeP7e2RD/vOKmUqokRTB23PY/a81iKpfKnzhNvqU0Jni//hLifG+YbdIU09ZwVvGrPMSs1JPicJHmvTWH+Lb3J9wSzCOQHCskxzA4BLkXridt8PTAOGjpFQ1cCCvopY1LMVjYnrakKYmGESUemvzw35VXBpm0d0zLKGRA/PBK+tVZnlvSA4NxBzAN0Zl/iRFy8yJzvcXUKqIO/bQCmX+wnYRantOR0iZOxuSazbH5/g8Ky7UgG+pd//AZ4VUNOcRSKj0qjediuNz2WcptE9QupBVj4FyvnCpe0cEJnb1Z0T0XiXR3QglcOrl7fSEoBdK2rOkKi+mVln67e2ABy+SY8ijsqPP0gbnxY292T0zPbq0q8NDLQakPoelXyUPa2sZHGnKPN3o+XrARhgjvHSvMVcJkWODWCgviNe7xagv4aCoBhD6aJPsaEFBSOkib5QzIc0q6kn85N/K2TMMFXfs7cbxOWaHZrneH+/R//pCr7IKFdYo8O9AAAAAElFTkSuQmCC" /\x3E\x3C/span\x3E The official website for this, my personal version of Woas, is at [[http://woas.sourceforge.net|my Woas project]]. The official WoaS website is [[http://stickwiki.sourceforge.net|here]].\n\
=== /Everything below is from the original 0.12.0 version./ \n\
== Download\n\
Wiki on a Stick can always be downloaded through the official SF.net WoaS project file download service:\n\
\n\
\x3Cbig\x3E[[https://sourceforge.net/projects/stickwiki/files/|Download Wiki on a Stick]]\x3C/big\x3E\n\
== Get support\n\
You can use the [[http://woas.iragan.com/|official WoaS forums]] and the [[http://sf.net/projects/stickwiki/|SF.net WoaS project facilities]].\n\
== Important links\n\
* [[http://sf.net/projects/stickwiki/|SourceForge project home page]] - useful for getting the latest files and contributing to the project.\n\
* [[http://woas.iragan.com/|Official WoaS forums]] - our discussion forums where you can also participate in the decision processes\n\
* [[http://sourceforge.net/tracker/?group_id=155218&atid=794925|SF.net WoaS project bug tracker]] - if you find a bug, post it here\n\
* [[http://sourceforge.net/tracker/?group_id=155218&atid=794928|SF.net WoaS project feature tracker]] - if you have have a suggestion for improvement, post it here\n\
* [[http://www.iragan.com/woas_irc/|Official WoaS IRC Channel]] - #woas room at FreeNode servers\n\
* [[https://lists.sourceforge.net/lists/listinfo/stickwiki-devel|SF.net WoaS Development mailing list]] - for discussion of WoaS development\n\
= Appreciation\n\
This project wouldn\'t be what it is without the help of many people. If you contributed to Wiki on a Stick and your name is not here (or if you do not want it to be listed here), please [[http://sourceforge.net/sendmessage.php?touser=799761|contact the maintainer]].\n\
* *Jeremy Ruston* - the creator of the wonderful [[http://www.tiddlywiki.com/|TiddlyWiki]] that served as inspiration for Wiki on a Stick.\n\
* *Philip O\'Donnel* - the creator of the table syntax and parsing code.\n\
* *Tim Lord*\n\
* *Knut Kohl*\n\
* *Rob Schmersel*\n\
* *Michiel van Everdingen* - [[http://home.versatel.nl/MAvanEverdingen/Code/|original JavaScript implementation]] of AES encryption\n\
* *Cyril Mazard* - search feature\n\
* *jimmac* - author of [[http://jimmac.musichall.cz/i.php?i=gorilla-stock|the icon set]] that we are currently using in WoaS\n\
* *martinellison* - transclusion patch\n\
* *Nilton Castillo* - bug fixes and enhancements (original pluggable macro syntax)\n\
* *Little Girl* - assistance with documentation, overall testing, and various improvements\n\
* [[http://weekendtesting.com/archives/833|Europe Weekend Testing]] - provided a testing session for WoaS\n\
* [[http://testconsultant.blogspot.com/|Jeroen Rosink]] - testing of WoaS releases',
'= Search in Wiki\n\
\x3Cinput id="special_search" type="text" onfocus="woas.ui.search_focus(this)" onblur="woas.ui.blur_textbox()" /\x3E&nbsp;\x3Cinput class="woas_button" type="button" value="Search" onclick="woas.do_search()" /\x3E&nbsp;\x3Cinput class="woas_button" type="button" value="Clear" onclick="woas.ui.clear_search()" /\x3E&nbsp;\x3Cinput class="woas_button" type="button" value="Options" onclick="d$.toggle(\'woas_search_options\');woas.search_options=d$.is_visible(\'woas_search_options\')" /\x3E\n\
\x3Cdiv id="woas_search_options"\x3E\n\
\x3Cp\x3E*Include:* \x3Clabel\x3E\x3Cinput type="checkbox" id="woas_search_cb_help" onclick="woas.search_help=!!(this.checked)" /\x3E&nbsp;Help pages\x3C/label\x3E\x3C/p\x3E\n\
\x3Cp\x3E*Search Type:* \x3Clabel\x3E\x3Cinput type="radio" id="woas_search_cb_words" name="woas_search_cb_type" onclick="d$(\'woas_search_word\',woas.search_word=true)"\x3E&nbsp;Ordered words\x3C/label\x3E &nbsp; \x3Clabel\x3E\x3Cinput type="radio" id="woas_search_cb_phrase" name="woas_search_cb_type" onclick="d$(\'woas_search_word\',woas.search_word=false)"\x3E&nbsp;Phrase\x3C/label\x3E\x3C/p\x3E\n\
\x3Cp\x3E*Match:* \x3Clabel\x3E\x3Cinput type="checkbox" id="woas_search_cb_case" onclick="woas.search_case=!!this.checked"/\x3E&nbsp;Case\x3C/label\x3E &nbsp; \x3Clabel\x3E\x3Cinput type="checkbox" id="woas_search_cb_start" onclick="woas.search_start=!!this.checked"/\x3E&nbsp;Word start\x3C/label\x3E &nbsp; \x3Clabel\x3E\x3Cinput type="checkbox" id="woas_search_cb_end" onclick="woas.search_end=!!this.checked"/\x3E&nbsp;Word end\x3C/label\x3E\x3C/p\x3E\n\
\x3Cdiv id="woas_search_match"\x3E\x3Clabel\x3E\x3Cinput id="woas_search_txt_context" type="text" size="4" value="" onchange="var n=Number(this.value);if (isNaN(n)) this.value=woas._nearby_chars; else woas._nearby_chars=n"/\x3E Maximum context characters\x3C/label\x3E\n\
\x3Cdiv id="woas_search_word"\x3E\n\
\x3Clabel\x3E\x3Cinput id="woas_search_txt_length" type="text" size="4" value="" onchange="var n=Number(this.value);if (isNaN(n)) this.value=woas._match_length; else woas._match_length=n"/\x3E Maximum match characters between words\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_search_cb_inline" onclick="woas.search_inline=!!this.checked"/\x3E&nbsp;Within one line\x3C/label\x3E\n\
\x3C/div\x3E\x3C/div\x3E\n\
\x3C/div\x3E\n\
\x3Cdiv id="woas_search_results"\x3E&nbsp;\x3C/div\x3E\n\
\x3Cscript type="text/javascript"\x3E\n\
woas._search_load();\n\
\x3C/script\x3E\n\
',
'\x3Cdiv\x3E\x3Cinput id="btn_lock" class="woas_button_top" type="button" value="" onclick="lock_page()" /\x3E\x3C/div\x3E\n\
== AES encryption\n\
Read more about the [[WoaS::Help::Security|embedded AES encryption]] used in Wiki On a Stick.\n\
== Password\n\
Enter your password for AES encryption. The more complex your password is, the more difficult it will be to attack the encryption. It is suggested *not* to use passwords whose textbox color is \x3Cspan style="background-color:red"\x3E&nbsp;red&nbsp;\x3C/span\x3E, and to accept passwords only when the textbox color is \x3Cspan style="background-color:lime"\x3E&nbsp;green&nbsp;\x3C/span\x3E. Punctuation and Mixed case characters will exponentially increase the strength of your password.\n\
\x3Cdl\x3E\x3Cdt\x3E\x3Clabel for="pw1"\x3EEnter password:\x3C/label\x3E\x3C/dt\x3E\x3Cdd\x3E\x3Cinput type="password" id="pw1" style="background-color:red" value="" size="50" onfocus="woas.ui.focus_textbox()" onblur="woas.ui.blur_textbox()" onkeyup="pw_quality()" onkeydown="lock_page(event)" /\x3E&nbsp;\x3Cspan id="txtBits"\x3E&nbsp;\x3C/span\x3E\x3C/dd\x3E\x3Cdt\x3E\x3Clabel for="pw2"\x3ERe-enter password:\x3C/label\x3E\x3C/dt\x3E\x3Cdd\x3E\x3Cinput type="password" id="pw2" value="" size="50" onfocus="woas.ui.focus_textbox()" onblur="woas.ui.blur_textbox()" onkeydown="lock_page(event)" /\x3E\x3C/dd\x3E\x3C/dl\x3E\\\n\
\x3Cscript type="text/javascript"\x3E\n\
	_lock_page();\n\
\x3C/script\x3E\n\
',
'== AES encryption\n\
[[http://en.wikipedia.org/wiki/Advanced_Encryption_Standard|AES]] 256-bit high security data encryption standard is supported to protect a single page or groups of them.\n\
\n\
WoaS has two different interfaces for encryption passwords, namely one for encryption (called *Locking*) and one for decryption (called *Unlocking*).\n\
== Encryption\n\
The page encryption interface shows a colored meter for estimated password quality; the encryption password is not stored in your saved files (true AES encryption is used).\n\
\x3C\x3C_note *If you forget the password there is no way to retrieve it or your data.*\x3E\x3E\n\
Click on the /lock/ icon in the navigation bar to encrypt the page being viewed. The page locking interface has two password boxes (the second for verification); the background color of the first box provides a hint about estimated password strength.\n\
\n\
Once you\'ve chosen and typed in your password, click the *Lock* button to encrypt the page.\n\
\n\
When encrypting additional pages during a session, you\'ll be offered to use the same password you used to encrypt the first page. Accept by pressing the *OK* button or decline by pressing the *Cancel* button. If you decline, the password interface will open, allowing you to set a new password for the page. There is no limit to how many passwords you can use.\n\
== Decryption\n\
Click the *Set password* icon in the navigation bar to set the decryption password used for the next page.\n\
\n\
The password for decrypting a page (or pages) is cached so that you only need to enter it once per session. If you close or reload the wiki, you will need to reenter the password to work with the encrypted page(s). To disable the password cache, check the box for *Do not temporarily cache the AES key* in the wiki [[WoaS::Help::Special::Options|Options]]. If you\'ve used more than one password for encrypting your pages, you\'ll need to enter the password to unlock each encrypted page.\n\
== Security level\n\
Security is never absolute. Data encrypted with these pages might be compromised in a variety of ways, including but not limited to the following:\n\
\n\
* User-generated passwords are weak by nature (PBKDF2 will be used in a future version)\n\
* You have not disabled the AES key cache, so when you enter the password for the first time other users (if not you) will be able to see encrypted pages and could possibly get your key\n\
* WoaS uses random numbers generated by the browser itself using local time; if someone was somehow able to gain access to the particular time used they could perhaps discover the key (user-generated entropy will be used in a future version)\n\
* Your Web browser and/or JavaScript interpreter may contain bugs or deliberate security violations which report activity on your computer back to some other Internet site\n\
* Some other applet running on another page in your browser, perhaps without you being aware of its existence, is spying on other windows.\n\
* Some other "spyware" application running on your computer may have compromised your system\'s security and be snooping on your activity.\n\
* The implementation of the encryption may contain a bug that makes its results insecure, Wiki on a Stick is open-source; you can judge for yourself whether the tool merits your confidence.\n\
* Your computer\'s security may have been compromised physically; when\'s the last time you checked that a bug that transmits your keystrokes and/or screen contents to that white van parked down the street wasn\'t lurking inside your computer cabinet?\n\
\n\
Apart from the above, your normal usage of encrypted pages can be considered secure.\n\
',
'\x3Cdiv class="woas_no_option"\x3E\x3Cinput class="woas_button_top" type="button" onclick="this.disable;save_options(this)" value="Save options" /\x3E\x3C/div\x3E\n\
= Options\n\
\x3Cfieldset id="s10406" class="woas_input_wrap"\x3E\x3Clegend\x3EUser Interface\x3C/legend\x3E\\\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_key_cache" onclick="woas.config.key_cache = !d$.checked(\'cb_key_cache\')" /\x3EDo not temporarily cache the AES key\x3C/label\x3E\x3Cbr id="woas_hidden_break" /\x3E\x3Clabel class="woas_no_option"\x3E\x3Cinput type="checkbox" id="cb_dblclick_edit" onclick="woas.config.dblclick_edit = d$.checked(\'cb_dblclick_edit\')" /\x3EDouble click to edit pages/menu\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_debug_mode" onclick="woas.config.debug_mode = d$.checked(\'cb_debug_mode\');woas._set_debug(woas.config.debug_mode,woas.config.debug_closed);d$(\'cb_debug_closed\').disabled=!woas.config.debug_mode" /\x3EEnable debug mode\x3C/label\x3E&nbsp;&nbsp;\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_debug_closed" class="woas_input_wrap_inline" onclick="woas.config.debug_closed = d$.checked(\'cb_debug_closed\')" /\x3EStart with console closed\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_fixed_menu" onclick="var fl=d$.checked(\'cb_fixed_menu\');woas.config.fixed_menu=fl;woas.ui.set_menu(fl)" /\x3EFixed menu\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_fixed_header" onclick="var fl=d$.checked(\'cb_fixed_header\');woas.config.fixed_header=fl;woas.ui.set_header(fl)" /\x3EFixed navigation bar\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_sort_tags" onclick="woas.config.sort_tags = d$.checked(\'cb_sort_tags\')" /\x3ESort tags in tag display\x3C/label\x3E\n\
\x3Clabel class="woas_no_option"\x3E\x3Cselect id="sel_menu_link" onChange="woas.config.menu_link=this.selectedIndex"\x3E\x3Coption\x3EAlways ask\x3C/option\x3E\x3Coption\x3EAlways\x3C/option\x3E \x3Coption\x3ENever\x3C/option\x3E\x3C/select\x3E Create a main menu link to newly created pages\x3C/label\x3E\\\n\
\x3C/fieldset\x3E\\\n\
\x3Cfieldset id="s2324" class="woas_input_wrap"\x3E\x3Clegend\x3ESyntax\x3C/legend\x3E\\\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_auto_links" onclick="woas.config.auto_links = d$.checked(\'cb_auto_links\')" /\x3EAutomatically convert URLs to hyperlinks\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_new_tables_syntax" onclick="woas.config.new_tables_syntax = d$.checked(\'cb_new_tables_syntax\')" /\x3EEnhanced tables syntax\x3C/label\x3E\\\n\
\x3C/fieldset\x3E\\\n\
\x3Cfieldset id="s2219" class="woas_input_wrap woas_no_option"\x3E\x3Clegend\x3ESaving\x3C/legend\x3E\\\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_save_on_quit" onclick="woas.config.save_on_quit = d$.checked(\'cb_save_on_quit\')" /\x3EAutomatically save options before quitting (if changed)\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_safe_mode" onclick="woas.config.safe_mode = d$.checked(\'cb_safe_mode\')" /\x3EEnable safe mode with embedded scripts and plugins not executed (/requires reload/)\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_allow_diff" onclick="woas.config.allow_diff = d$.checked(\'cb_allow_diff\')" /\x3EMake merge/diff of WoaS XHTML/WSIF data source easier\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_store_mts" onclick="var r = woas.config.store_mts = d$.checked(\'cb_store_mts\'); woas.ui.display({no_mts:!r})" /\x3EStore and display last modified timestamp\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="cb_rem_history" onclick="woas.config.nav_history = d$.checked(\'cb_rem_history\')" /\x3EStore current page and navigation history\x3C/label\x3E\\\n\
\x3C/fieldset\x3E\\\n\
\x3Cfieldset id="s9272" class="woas_input_wrap woas_no_option"\x3E\x3Clegend\x3EWSIF settings\x3C/legend\x3E\\\n\
\x3Cdiv class="woas_input_wrap_left"\x3EPages are stored internally if /WSIF data source/ is blank. *Existing internal pages will be deleted if /WSIF data source/ is changed from blank to an external source, and the external source will be overwritten with this wiki\'s content if it already exists!*\n\
\n\
If the /Use multiple files for WSIF data source/ option is being used (creating one WSIF file for each page) then disabling the option will not remove existing WSIF files, though the /WSIF data source/ index file will be overwritten with the full page content.\n\
\n\
The path may be entered in Windows or UNIX format. *Any directories in the path must exist if you are not using a Mozilla browser.*\x3C/div\x3E\n\
\x3Cdiv class="woas_input_wrap_left" style="border: solid 1px #f00; padding:10px; margin-top:10px; margin-bottom:10px"\x3E\n\
\x3Clabel\x3ERelative path to WSIF data source, including filename: \x3Cinput class="woas_input_wrap_inline woas_input_w90" id="txt_wsif_ds" type="text" value="" /\x3E\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput class="woas_input_wrap_no_left" type="checkbox" id="cb_wsif_ds_multi" onclick="woas.ui.wsif_ds_multi = this.checked" /\x3EUse multiple files for WSIF data source\x3C/label\x3E\n\
\n\
\x3Cinput class="woas_button woas_input_wrap_no_left" type="button" onclick="woas.ui.wsif_ds(d$(\'txt_wsif_ds\'), d$(\'cb_wsif_ds_multi\'), true)" value="Change data source" /\x3E&nbsp; /Data source changes will not be used unless confirmed with the /Change data source /button./\n\
\x3C/div\x3E\n\
\x3Clabel class="woas_input_wrap_left"\x3EWSIF author: \x3Cinput class="woas_input_wrap_inline woas_input_w90" id="txt_author" type="text" value="" onchange="woas.config.wsif_author=this.value" /\x3E\x3C/label\x3E\\\n\
\x3C/fieldset\x3E\\\n\
\x3Cdiv class="woas_no_option"\x3E\\\n\
\x3Cfieldset id="s15410" class="woas_input_wrap" style="border-color:#f00"\x3E\x3Clegend\x3EPermanent changes\x3C/legend\x3E\\\n\
\x3Cdiv id="woas_no_help"\x3E\x3Cinput class="woas_button_ro" type="button" onclick="no_help_woas()" value="Remove Help pages" /\x3E&nbsp; /Caution: to re-enable Help system you will need to import this file into a fresh Woas file./\x3C/div\x3E\n\
\n\
\x3Cinput class="woas_button_ro" type="button" onclick="ro_woas()" value="Prevent edits" /\x3E&nbsp; /Caution: to re-enable editing you will have to manually edit this WoaS file./\\\n\
\x3C/fieldset\x3E\\\n\
\x3C/div\x3E\n\
\x3Cstyle\x3E\n\
#woas_hidden_break {\n\
	display: block\n\
}\n\
.woas_ro .woas_no_option, .woas_ro #woas_hidden_break, .woas_no_help #woas_no_help {\n\
	display: none\n\
}\n\
\x3C/style\x3E\n\
\x3Cscript type="text/javascript"\x3E\n\
d$("cb_allow_diff").checked = woas.bool2chk(woas.config.allow_diff);\n\
d$("cb_rem_history").checked = woas.bool2chk(woas.config.nav_history);\n\
d$("cb_store_mts").checked = woas.bool2chk(woas.config.store_mts);\n\
d$("cb_new_tables_syntax").checked = woas.bool2chk(woas.config.new_tables_syntax);\n\
d$("cb_auto_links").checked = woas.bool2chk(woas.config.auto_links);\n\
d$("cb_sort_tags").checked = woas.bool2chk(woas.config.sort_tags);\n\
d$("cb_key_cache").checked = woas.bool2chk(!woas.config.key_cache);\n\
d$("cb_dblclick_edit").checked = woas.bool2chk(woas.config.dblclick_edit);\n\
d$("cb_debug_mode").checked = woas.bool2chk(woas.config.debug_mode);\n\
d$("cb_debug_closed").checked = woas.bool2chk(woas.config.debug_closed);\n\
d$("cb_save_on_quit").checked = woas.bool2chk(woas.config.save_on_quit);\n\
d$("cb_safe_mode").checked = woas.bool2chk(woas.config.safe_mode);\n\
d$("cb_fixed_header").checked = woas.bool2chk(woas.config.fixed_header);\n\
d$("cb_fixed_menu").checked = woas.bool2chk(woas.config.fixed_menu);\n\
d$("sel_menu_link").selectedIndex = woas.config.menu_link;\n\
\n\
if (woas.browser.ie6) d$("cb_fixed_header").disabled =  d$("cb_fixed_menu").disabled = true;\n\
\n\
// multi must be set by WSIF loader; it must not be a config setting\n\
woas.ui.wsif_ds_multi = woas.wsif.ds_multi;\n\
// set datasource and multi checkbox\n\
woas.ui.wsif_ds(d$(\'txt_wsif_ds\'), d$(\'cb_wsif_ds_multi\'));\n\
d$("txt_author").value = woas.config.wsif_author;\n\
\n\
d$("txt_wsif_ds").onfocus = d$("txt_author").onfocus = woas.ui.focus_textbox;\n\
d$("txt_wsif_ds").onblur = d$("txt_author").onblur = woas.ui.blur_textbox;\n\
\x3C/script\x3E\n\
',
'[[Special::TOC]]\n\
A summary of WoaS deprecated syntax; you should not use deprecated syntax because it will be declared /unsupported/ in a future release of WoaS. The red examples demonstrate deprecated syntax and the green examples demonstrate syntax currently accepted by the wiki.\n\
== Headings\n\
Headings using exclamation marks are deprecated:\x3Cdiv class="bad_syntax"\x3E{{{\n\
! Heading level 1\n\
!! Heading level 2\n\
!!! Heading level 3\n\
!!!! Heading level 4\n\
!!!!! Heading level 5\n\
!!!!!! Heading level 6\n\
}}}\x3C/div\x3E\n\
Headings using equal signs are accepted:\x3Cdiv class="good_syntax"\x3E{{{\n\
= Heading level 1\n\
== Heading level 2\n\
=== Heading level 3\n\
==== Heading level 4\n\
===== Heading level 5\n\
====== Heading level 6\n\
}}}\x3C/div\x3E\n\
== Inline scripts\n\
Script tags that do not define a type are the default for HTML5, signifying JavaScript, and are accepted by WoaS. The current parser actually adds the /type/ attribute when creating scripts, and will ignore any other type specified. This also does not affect XHTML compatibility as they are obfuscated in the JavaScript storage, and added to pages generated by [[WoaS::Help::Special::Export|Special::Export]]\n\
\n\
HTML script tags without the *text/javascript* type attribute are best:\x3Cdiv class="good_syntax"\x3E{{{\n\
\x3Cscript\x3E...\x3C/script\x3E\n\
}}}\x3C/div\x3E\n\
HTML script tags with the *text/javascript* type attribute are accepted:\x3Cdiv class="good_syntax"\x3E{{{\n\
\x3Cscript type="text/javascript"\x3E...\x3C/script\x3E\n\
}}}\x3C/div\x3E\n\
== Lists\n\
Unordered lists using plus signs are not supported:\x3Cdiv class="bad_syntax"\x3E{{{\n\
+ unordered list item\n\
+ unordered list item\n\
+ unordered list item\n\
}}}\x3C/div\x3E\n\
Unordered lists using asterisks are accepted:\x3Cdiv class="good_syntax"\x3E{{{\n\
* unordered list item\n\
* unordered list item\n\
* unordered list item\n\
}}}\x3C/div\x3E\n\
== Macros\n\
The use of three angle brackets to mark a macro is now deprecated; two brackets are the Creole standard. The colon (:) after the macro name is also deprecated as unnecessary:\x3Cdiv class="bad_syntax"\x3E{{{\n\
\x3C\x3C\x3Cmacro.name: some text\x3E\x3E\x3E}}}\x3C/div\x3E\n\
Use two brackets as per the Creole 1.0 spec, and drop the colon:\x3Cdiv class="good_syntax"\x3E{{{\n\
\x3C\x3Cmacro.name some text\x3E\x3E\n\
}}}\x3C/div\x3E\n\
== Pre tags\n\
HTML {{{pre}}} tags surrounding raw or preformatted text are now treating like an ordinary {{{pre}}} tag. They will convert the text to the {{{pre}}} style, but any markup within them will still be parsed. For example: {{{\x3Cpre\x3Eraw or */preformatted/* text\x3C/pre\x3E}}} is parsed as \x3Cpre\x3Eraw or */preformatted/* text\x3C/pre\x3E({{{pre}}} is a /block/ tag, creating a separate line) but {{{{{{raw or */preformatted/* text}}}}}} is parsed as {{{raw or */preformatted/* text}}}, preserving the inline syntax used. {{{Pre}}} tags have their uses, but they are no longer treated as special markup by WoaS.\n\
== Rulers\n\
Horizontal rules using 3 hyphens are deprecated:\x3Cdiv class="bad_syntax"\x3E{{{\n\
---\n\
}}}\x3C/div\x3E\n\
Horizontal rules using 4 or more hyphens are accepted:\x3Cdiv class="good_syntax"\x3E{{{\n\
----\n\
}}}\x3C/div\x3E\n\
== Tags\n\
=== Single tags\n\
Tags in the Tag:: and the Tags:: [[WoaS::Help::Namespaces|reserved namespace]] are accepted:\x3Cdiv class="good_syntax"\x3E\n\
{{{\n\
[[Tag::some tag]]\n\
[[Tags::some tag]]\n\
}}}\x3C/div\x3E\n\
=== Multiple tags\n\
Tags separated by pipes in the Tag::, [[Tagged::]], or Tags:: namespace are deprecated:\x3Cdiv class="bad_syntax"\x3E\n\
{{{\n\
[[Tag::some tag|other tag|another tag]]\n\
[[Tagged::some tag|other tag|another tag]]\n\
[[Tags::some tag|other tag|another tag]]\n\
}}}\x3C/div\x3E\n\
Tags separated by commas in the Tag::, [[Tagged::]], and Tags:: namespace are accepted:\x3Cdiv class="good_syntax"\x3E\n\
{{{[[Tag::some tag, other tag, another tag]]\n\
[[Tags::some tag, other tag, another tag]]\n\
[[Tagged::some tag, other tag, another tag]]\n\
}}}\x3C/div\x3E\n\
\x3Cstyle type="text/css"\x3E\n\
.bad_syntax {\n\
  color: #f00; /* red */\n\
  font-weight: bold;\n\
}\n\
.good_syntax {\n\
  color: #008000; /* green */\n\
  font-weight: bold;\n\
}\n\
\x3C/style\x3E\n\
',
'[[Special::TOC]]/The [[Special::Options]] page currently stores all options within the WoaS HTML file when the/ Save options /button is clicked; they are never stored inside an external datasource [[WoaS::Help::WSIF|WSIF]] file. Currently the options will also be saved whenever a page is edited, though this will be changed in a future version./\n\
==User Interface\n\
===Do not temporarily cache the AES key\n\
Clears the [[WoaS::Help::Security|AES key]] immediately after encrypting or decrypting a page to prevent possible unauthorized access. Using this option will require the key to be entered each time you want to read an encrypted page.\n\
===Double-click to edit pages/menu\n\
Opens the editor when the main text area or menu are double-clicked.\n\
===Enable debug mode\n\
Enables display of the debug console at the bottom of the main text area and allows the wiki to log its history. This can be useful if you asking are for help or reporting a problem.\n\
===Start with console closed\n\
Ensures that the debug console will start closed. This option is disabled if /Enable debug mode/ is not selected.\n\
===Fixed menu\n\
Fixes the menu in place while allowing the page to scroll. This option is disabled in IE6.\n\
===Fixed navigation bar\n\
Fixes the navigation bar in place while allowing the page to scroll. This option is disabled in IE6.\n\
===Sort tags in tag display\n\
Sorts the tags in the tag display alphabetically.\n\
===Create a main menu link to newly created pages\n\
WoaS is able to put a link to newly created pages in the main menu. Whether or not it does so depends on the setting of this option. The link will not be created if the new page is cancelled.\n\
* /Always Ask/ prompts for a decision each time a new page is created\n\
* /Always/ creates a link without asking\n\
* /Never/ disables this function\n\
== Syntax\n\
===Automatically convert URLs to hyperlinks\n\
converts URLs to [[WoaS::Help::Links|external links]] when the page content is displayed.\n\
===Enhanced tables syntax\n\
Tables will use the enhanced [[WoaS::Help::Tables|table syntax]].\n\
== Saving\n\
===Automatically save options before quitting (if changed)\n\
Saves changes to options automatically when closing the wiki. This will not happen if you are just reloading the file.\n\
===Enable safe mode with embedded scripts and plugins not executed (/requires reload/)\n\
Prevents the wiki from executing [[WoaS::Help::JavaScript|embedded scripts]] and [[WoaS::Help::Plugins|plugins]].\n\
===Make merge/diff of WoaS XHTML/WSIF data source easier\n\
Adds a [[WoaS::Help::Join lines of text|backslash]] and line-end character (\\\\n) to the end of every line of page text. This breaks the text into multiple lines, instead of it being one page-length line, making it easier for source code revision tools (like SVN or git) and merge tools to mark and show changes efficiently.\n\
===Store and display last modified time-stamp\n\
Allows the wiki to store the last time each page was changed and display it as a time-stamp beneath the main text area.\n\
===Store current page and navigation history\n\
Remembers the most recent back history and automatically opens the most recently saved page whenever you load the wiki into a browser.\n\
== WSIF settings\n\
WoaS is most often used as a single-file wiki, with all of it\'s content inside one self-modifying XHTML file, but it can also be used with external content files, called [[WoaS::Help::WSIF|WSIF]] files. It can use a single WSIF file containing all of the wiki\'s page content, or a single WSIF index file that links to the WSIF files of individual pages. Everything works the same whichever way it is used.\n\
\n\
If you just want to use a WSIF file for backing up or sharing your data with others you should use [[WoaS::Help::Special::ExportWSIF|Special::ExportWSIF]] instead as the WoaS file is then not altered.\n\
===Relative path to WSIF data source, including filename\n\
This is the relative path and name of the file the wiki should use to save and retrieve data. A relative path is one that starts in the same directory the WoaS file is in; {{{temp/file.wsif}}} is a relative path, {{{/temp/file.wsif}}} is not; {{{c:\\temp\\file.wsif}}} and {{{c:temp\\file.wsif}}} are also incorrect. The file name can have any extension or none at all, but the /wsif/ extension will let you know that it\'s a WoaS data source file. The path may be entered in Windows or UNIX format, but will be converted to the correct format upon entry (it is stored in the WoaS file in UNIX format).\n\
\n\
Providing a filename causes the wiki to create a WSIF file by that name and use that file to store and retrieve all page data (configuration options are currently always stored in the WoaS HTML file, not in a WSIF file). If just a filename is entered the file will be created inside the directory the WoaS file is in. The path can additionally specify a directory path relative to the location of the wiki. WoaS will create the specified subdirectory only if you are using a Gecko-based browser like Firefox. If you are using a different browser you must create the subdirectory yourself before saving the file. (As of this writing, the best browser to use with WoaS is *Firefox*; while [[WoaS::Help::Requirements & saving|all major browsers]] can be used to read, edit, and save a WoaS file, other browsers cannot currently import or export binary files, such as image files. This limits some capabilities, like embedding images or exporting them to a binary image file.)\n\
\x3C\x3C_note If you enter the name of an existing file that file will be overwritten when /Change data source/ is clicked; any associated files will also be overwritten if /multiple files/ mode is selected.\x3E\x3E\n\
The data source name will be used as the index page name when using multiple files as a data source.\n\
\n\
The box is blank by default. Leaving the box blank, or deleting an existing filename from the box, causes the wiki to save all the currently loaded data to itself and retrieve all data from itself. Deleting the filename from the box does not delete any files.\n\
===Use multiple files in WSIF data source\n\
Causes the wiki to create individual WSIF files for each page. The pages will be automatically named by page number in their order of creation. An index page with the WSIF data source filename will be created containing a list of the numbered file names and their corresponding wiki page names. WoaS will use this file to load data and save edits to the correct file.\n\
\x3C\x3C_note The two WSIF data source settings described above will *not* be used or saved unless you confirm the change with the /Change data source/ button. WoaS will then describe the impact of the changes you are about to make so you can change your mind if you want to by pressing cancel.\x3E\x3E\n\
===WSIF author\n\
This is the name of the author as displayed in exported WSIF files. Replace the default name with your own to be credited as the author of the file(s). Deleting the contents of the box prevents the author line from being added to WSIF files.\n\
==Permanent changes\n\
===Prevent edits\n\
Clicking this button puts the wiki into read-only mode. The edit icon is removed and all editing is disabled. To re-enable editing, the wiki must be [[WoaS::Help::Wiki is read-only|manually edited]].\n\
\n\
If the file is already in read-only mode the /Prevent Edits/ button is not displayed.\n\
',
'\x3Cinput id="filename_" type="file" /\x3E\n\
\n\
[[Javascript::woas._embed_process(\'%1\', d$.file(\'filename_\'))|Embed %1]]',
'= Installed plugins\n\
\x3Cdiv style="position:absolute;top:0;right:0;margin:0.5em"\x3E\x3Cinput class="woas_button_top" title="Import a plugin" value="Import plugin..." onclick="woas.go_to(\'Special::ImportWSIF\')" type="button" /\x3E\x3Cinput class="woas_button_top" title="Create a new plugin" value="Create plugin..." onclick="_woas_new_plugin()" type="button" /\x3E\x3C/div\x3E',
'\x3Cdiv class="woas_top"\x3E\x3Cinput class="woas_button_top" type="button" value="Export XHTML" onclick="woas.export_wiki()" /\x3E\x3C/div\x3E\n\
= Export content into linked XHTML files\n\
\x3Cfieldset id="s1613" class="woas_input_wrap"\x3E\x3Clegend\x3EPaths\x3C/legend\x3E\\\n\
\x3Cdiv class="woas_input_wrap_left" style="margin-bottom:5px"\x3E*Directory paths must exist if using a non-Mozilla browser. If exported files already exist they will be overwritten.*\x3C/div\x3E\n\
\n\
\x3Clabel class="woas_input_wrap_left"\x3EDirectory for XHTML files: \x3Cinput class="woas_input_wrap_inline woas_input_w90" id="woas_ep_xhtml" type="text" /\x3E\x3C/label\x3E\n\
\x3Clabel for="woas_cb_img_dir"\x3E\x3Cinput type="checkbox" id="woas_cb_img_dir" onchange="d$(\'woas_img_dir\',!this.checked,true)" checked="checked"\x3EEmbed images (instead of linking to external files)\x3C/label\x3E\x3Cdiv id="woas_img_dir" style="display:none"\x3E\x3Cbr /\x3E\x3Cspan class="woas_input_wrap_left"\x3E/Image links point to the above directory for maximum cross-browser and server compatibility./\x3C/span\x3E\x3C/div\x3E\n\
\n\
\n\
\x3Clabel class="woas_input_wrap_left"\x3EExtension for generated XHTML files: \x3Cinput class="woas_input_wrap_inline" id="woas_ep_ext" type="text" size="8" /\x3E\x3C/label\x3E\n\
\x3Clabel for="woas_cb_index_main"\x3E\x3Cinput type="checkbox" id="woas_cb_index_main" checked="checked"\x3EName the main page /index/ (plus file extension above)\x3C/label\x3E\x3C/fieldset\x3E\\\n\
\x3Cfieldset id="s19285" class="woas_input_wrap"\x3E\x3Clegend\x3ECustom page scripts\x3C/legend\x3E\x3Clabel for="woas_cb_js_ign"\x3E\x3Cinput type="radio" id="woas_cb_js_ign" name="woas_cb_js" checked="checked"\x3EDo not export JavaScript\x3C/label\x3E\n\
\x3Clabel for="woas_cb_js_exp"\x3E\x3Cinput type="radio" id="woas_cb_js_exp" name="woas_cb_js"\x3EExport JavaScript as-is\x3C/label\x3E\n\
\x3Clabel for="woas_cb_js_dyn"\x3E\x3Cinput type="radio" id="woas_cb_js_dyn" name="woas_cb_js"\x3ERun before exporting, but do not export the JavaScript\x3C/label\x3E\x3C/fieldset\x3E\\\n\
\x3Cfieldset id="s9592" class="woas_input_wrap"\x3E\x3Clegend\x3EOther options\x3C/legend\x3E\x3Clabel class="woas_input_wrap_left"\x3EMETA author (optional): \x3Cinput class="woas_input_wrap_inline woas_input_w90" id="woas_ep_author" type="text" value="" /\x3E\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_sep_css" checked="checked"\x3EExport CSS into shared file\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_export_menu" checked="checked"\x3EExport menus\x3C/label\x3E\x3C/fieldset\x3E\\\n\
\x3Cscript type="text/javascript"\x3E\n\
var path = woas.ROOT_DIRECTORY + "export" + woas.DIRECTORY_SEPARATOR;\n\
d$(\'woas_ep_xhtml\').value = path;\n\
d$(\'woas_ep_ext\').value = woas.exporter._default_ext;\n\
d$(\'woas_ep_author\').value = woas.config.wsif_author;\n\
d$(\'woas_ep_xhtml\').onfocus = d$(\'woas_ep_author\').onfocus = d$(\'woas_ep_ext\').onfocus = woas.ui.focus_textbox;\n\
d$(\'woas_ep_xhtml\').onblur = d$(\'woas_ep_author\').onblur = d$(\'woas_ep_ext\').onblur = woas.ui.blur_textbox;\n\
\x3C/script\x3E\n\
',
'= Special::License\n\
This version of Woas, adapted by [[https://sourceforge.net/users/pvhl|PVHL]] is released under the GNU AGPL (\'Affero\') license, version 3 or later, to protect its freedom in a networked environment. This license is compatible with WoaS\' older [[http://www.gnu.org/licenses/gpl2.txt|GNU GPL2 license]] in that AGPL can include GPL code within it; the reverse is not the case.\n\
\n\
Retrieved from [[http://www.gnu.org/licenses/agpl.txt]]:\n\
\n\
\x3C!--[if IE 6]\x3E\x3Cfieldset style="border:0"\x3E\x3C![endif]--\x3E\n\
\x3Ciframe id="license" border="0" width="100%" src="http://www.gnu.org/licenses/agpl.txt"\x3E\x3C/iframe\x3E\n\
\x3C!--[if IE 6]\x3E\x3C/fieldset\x3E\x3C![endif]--\x3E\n\
\x3Cscript\x3E\n\
	woas.ui.adjust_height("license", 200);\n\
\x3C/script\x3E\n\
',
'\x3Cdiv class="woas_top"\x3E\x3Cinput class="woas_button_top" type="button" value="Export WSIF" onclick="woas.export_wiki_wsif()" /\x3E\x3C/div\x3E\n\
= Export to [[WoaS::Help::WSIF|WSIF]] format\n\
\x3Cfieldset id="s28565" class="woas_input_wrap"\x3E\x3Clegend\x3EFile generation options\x3C/legend\x3E\x3Cdiv style="margin-bottom:5px" class="woas_input_wrap_left"\x3E*Directory path must exist if using a non-Mozilla browser. If file exists it will be overwritten, along with any associated files if exporting to multiple files.* Filename is the name of the page index file if /Export as multiple WSIF files/ is selected.\x3C/div\x3E\n\
\n\
\x3Clabel class="woas_input_wrap_left"\x3ERelative path for WSIF file, including filename: \x3Cinput class="woas_input_wrap_inline woas_input_w90" id="woas_ep_path" type="text" value="" onblur="woas.ui.wsif_ds(this);woas.ui.blur_textbox()" /\x3E\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_multi_wsif" /\x3EExport as *multiple* WSIF files (instead of saving all pages to a single wsif file)\x3C/label\x3E\n\
\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_all_wsif"\x3EInclude *ALL* pages (instead of only user created pages)\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_no_help"\x3E*NO* WoaS::Help:: pages (smaller file, but no help)\x3C/label\x3E\x3C/fieldset\x3E\\\n\
\x3Cfieldset id="s9592" class="woas_input_wrap"\x3E\x3Clegend\x3EOther options\x3C/legend\x3E\x3Clabel class="woas_input_wrap_left"\x3EAuthor: \x3Cinput class="woas_input_wrap_inline woas_input_w90" id="woas_ep_author" type="text"  value="Anonymous" /\x3E\x3C/label\x3E\n\
\x3Cscript type="text/javascript"\x3E\n\
d$("woas_cb_no_help").checked = woas.config.no_help;\n\
d$(\'woas_ep_path\').value = woas.wsif.defaultPath();\n\
d$(\'woas_ep_author\').onfocus = d$(\'woas_ep_path\').onfocus = woas.ui.focus_textbox;\n\
d$(\'woas_ep_author\').onblur = woas.ui.blur_textbox;\n\
d$(\'woas_ep_author\').value = woas.config.wsif_author;\n\
\x3C/script\x3E\n\
',
'[[Special::TOC]]\n\
*W*iki on a *S*tick *I*nterchange *F*ormat is the preferred format for exporting WoaS content to a single file. This allows you to share it with whomever you like, or to archive your content. This page describes version 1.4.0 of the format.\n\
\\\n\
= Format description\n\
\\\n\
\x3C\x3C_note The WSIF 1.4.0 version introduces some changes, mostly concerned with moving to a /convention over configuration/ pattern:\n\
* removes the ability to have external file content for embedded files ([[WoaS::Help::Images|Image::]] and [[WoaS::Help::Files|File::]] pages), as most browsers can\'t write binary files and the concept breaks the whole idea of the WSIF file as a sharing format; this has also led to the removal of some header names and may lead to further changes in the future (removal of the /mime/ page header);\n\
* adds the ability for WoaS to define page defaults in the WSIF information header, including a default /[[#Inline boundary|boundary]]/ value;\n\
* in partnership with the above change, removes the page headers that define a conventional page, {{{page.attributes:0}}} and {{{page.encoding:8bit/plain}}} (this doesn\'t prevent these defaults from being changed in some future format version);\n\
* removes the first boundary value as superfluous; the blank line after a header block serves as the first boundary for page content; the boundary search routine has also been improved so that a content/boundary conflict can now only occur if the exact boundary string, including dashes, occurs at the start of a content line;\n\
* removes {{{woas.}}} from in front of the {{{page.}}} namespace as unnecessary; WSIF is for WoaS-like Wikis and has /WoaS/ embedded in it\'s acronym; further branding is surely unnecessary and bloated.\n\
These changes haven\'t affected this Woas\' ability to import older format versions.\n\
\x3E\x3E\n\
WSIF format is similar to MIME email attachments format; each line is formatted like an /email header/ definition:\n\
{{{\n\
header.name: header-value\n\
}}}\n\
Header names must be alphanumeric only, plus the namespace \'dot\' ({{{.}}}): they cannot include the underscore character, {{{_}}} (the code transforms header names internally for efficiency, leading to this limitation). The space after the colon and before the {{{header-value}}} is optional but present in all Woas generated files.\n\
\n\
All WSIF content must be ASCII, so {{{header-value}}} must be ECMA-escaped when necessary; this corresponds to escaping slashes (from {{{\\}}} to {{{\\\\}}}) and encoding any UTF-8 sequence to the corresponding {{{\\u0000}}} string, where {{{0000}}} is the lowercase hexadecimal value of the UTF-8 character (as in ECMAScript); this encoding uses the {{{woas.ecma_encode()}}} function in WoaS.\n\
\n\
A WSIF file contains header blocks that describe its contents. Header blocks contain one or more header lines, in any order, followed by a blank line ({{{\\n\\n}}}); the blank line is used to mark the end of both information and page header blocks.\n\
\n\
The /WSIF information/ header block (using the /wsif/ namespace) describes the file itself, and the /WoaS page/ header blocks (using the /page/ namespace) describe the pages contained within it. The file starts with the WSIF information header block, including any optional page header defaults (new in 1.4.0), and ends with a blank line. In a /conventional/ (inline content) WSIF file the information block is followed by one or more page definitions. There are two other WSIF file types (/[[#Index|index]]/ and /[[#Page|page]]/) that use a slightly different format.\n\
\\\n\
== Reserved namespaces\n\
=== /wsif/ namespace\n\
\\\n\
The {{{wsif.}}} namespace defines an information header. The required headers are:\n\
* *wsif.version* - WSIF format version used by the file;\n\
* *wsif.generator* - program/library used to generate WSIF content;\n\
* *wsif.generator.version* - version of generator (usually WoaS) used to produce the WSIF file; this header is currently optional for imported content not generated by a WoaS file, though this is likely to change soon so that WoaS derivatives can also be imported properly.\n\
The optional headers are:\n\
* *wsif.author* - the name of the person generating the WSIF file;\n\
* *wsif.pages* - total count of pages stored inside the WSIF file; this is not used by Woas anymore, but can be handy when looking at the file.\n\
* *wsif.type* - only present for external data source use. *[[#Index|wsif.type: index]]* lets the system know the page is a special /Index/ listing of the content pages and their associated filenames. This type also allows for an optional page description. *[[#Page|wsif.type: page]]* is present when the /Use multiple files for WSIF data source/ option is selected within the /[[WoaS::Help::Special::Options#s9272|WSIF settings]]/ section of the [[Special::Options#s9272|Special::Options]] page.\n\
Version 1.1.0 and above are currently supported.\n\
\x3Cdiv class="pvhl"\x3EPVHL: My Woas will be adding optional /hash/ and /signed/ headers to the /wsif/ namespace in a future Woas and WSIF version, along with the ability to sign individual pages (or, more accurately, to sign their hash value). There will also be /date.created/, /date.modified/, and /description/ headers. Hopefully these changes will also be accepted by the WoaS project.\x3C/div\x3E\n\
\\\n\
=== /page/ namespace\n\
\\\n\
The {{{page.}}} namespace defines general WoaS content properties and specific WoaS pages. The 1.4.0 WSIF version introduces default content headers placed in the information header block and also conventional values (for /attributes/ and /encoding/) that don\'t need to be stated at all. The defaults are for a plain ASCII page that has not been encrypted, escaped, or encoded as base64 content: a normal WoaS page. If a page has the same header values as the default header or conventional values they need not be repeated. This means a conventional page need only have headers for its title and possibly its modification date (currently optional).\n\
\n\
The following are header definitions specific to WoaS pages:\n\
* *page.title* - ECMA-escaped page title;\n\
* *page.attributes* - a positive integer value in decimal format specifying the page attributes; attribute values are binary {{{OR}}}\'d together to form a single decimal value, so an image file has an attribute value of {{{12}}} (embedded file and image), or {{{13}}} if it is read-only; the current attributes are:\n\
** *0* - a conventional page, and so also the conventional value that need not be stated,\n\
** *1* - read only,\n\
** *2* - encrypted,\n\
** *4* - embedded file (/[[WoaS::Help::Images|Image::]]/ and /[[WoaS::Help::Files|File::]]/ namespaces),\n\
** *8* - image;\n\
* *page.date.modified* - a positive integer value in decimal format representing seconds from the UTC epoch to the last modified time; this header is defined only if data is available from WoaS, where it is currently optional;\n\
* *page.encoding* - content encoding format; content and/or header values are encoded in *ecma/plain* format when UTF-8 sequences are found inside the string, otherwise *8bit/plain* is used; *8bit/base64* is instead used for binary files or encrypted pages;\x3C\x3C_note *8bit* is an historical mistake that the official WoaS project has stated it will not be fixing. All the encodings are, in fact, *7bit* text encodings\x3E\x3Ethe *page.encoding* header can contain one of the following values:\n\
** *8bit/plain* - the default for ordinary ASCII text and so also the /conventional/ value that need not be stated; data is ASCII text which can use 7bits to represent characters; only ASCII text should be used and not UTF-8;\n\
** *ecma/plain* - data is ECMA-escaped UTF-8 text;\n\
** *8bit/base64* - data is base64-encoded binary data;\n\
** *text/wsif* - data is WSIF (not used in version 1.4.0, but will be added back once a WSIF file can be transposed within a conventional WSIF file).\n\
* *page.boundary* - string used for inline boundary recognition, without leading dashes (not used by the /index/ and /page/ file types); now usually an information header block default header;\n\
* *page.mime* - mime type of embedded pages that have a defined mime type, such as images.\n\
All headers are mandatory (under their specific state definition branch), except /page.date.modified/ and the (currently) /conventional/ values for /page.attributes/ ({{{0}}}) and /page.encoding/ ({{{8bit/plain}}}).\n\
\x3Cdiv class="pvhl"\x3EPVHL: My Woas will soon be adding /date.created/ (for pages and WSIF files, and also /wsif.date.modified/) and will also be making dates non-optional (/display/ of dates can still be optional though). /page.author/ will also be added in both the /information header block default/ and /page header/ forms. A /description/ header will also be added in both /page/ and /wsif/ forms, as discussed elsewhere.\n\
\n\
I will also be adding several page attributes when the code is refactored. These include attributes such as core, optional, preload, shadow, and help. I also intend to remove the /mime/ header and simply save Woas pages to WSIF files in the same form as they are kept internally: as a data URL complete with mime statement.\x3C/div\x3E\n\
\\\n\
== WSIF file types\n\
=== Inline content: the /conventional/ file type\n\
Version 1.4.0 of the WSIF format begins incorporating the /convention over configuration/ design pattern. The conventional WSIF file type therefore does not need to be flagged as such; it is assumed unless a header states otherwise.\n\
\\\n\
==== Inline boundary\n\
\\\n\
A line starting with two dashes ({{{--}}}) followed by the boundary header value marks the end of the page content; the content does not include the {{{\\n}}} required to create the marker. An example page:\n\
{{{\n\
page.title: Example\n\
...\n\
page.boundary: my-random-id\n\
\n\
this is the inline content\n\
--my-random-id\n\
}}}\n\
{{{--my-random-id}}} must be a (usually random) string that does not appear at the start of any line within the page content. It does not need to be unique within the entire WSIF file, which is read sequentially, page by page (as in a state machine). With the advent of default header values, most pages will not have an individual marker, and a future Woas version won\'t need individual boundary markers at all (for better file creation efficiency); though individual markers will then not be generated by Woas, they will still be allowed by the WSIF format. If a page /does/ need its own marker, Woas generates a random one for that page only.\n\
\\\n\
==== A conventional WSIF file example\n\
\\\n\
{{{\n\
wsif.version: 1.4.0\n\
wsif.generator: woas\n\
wsif.generator.version: 0.13.0 Alpha 0\n\
wsif.author: PVHL\n\
wsif.pages: 8\n\
page.boundary: aGQsCTsKed\n\
\n\
page.title: Main Page\n\
page.date.modified: 1374388808\n\
\n\
= Welcome to my Woas!\n\
...\n\
--aGQsCTsKed\n\
\n\
page.title: ::Menu\n\
\n\
Some menu text\n\
...\n\
--aGQsCTsKed\n\
...\n\
}}}\n\
The blank line between the end-of-page boundary marker and the first page header is optional, but always included by Woas for readability by humans.\n\
\\\n\
=== Index\n\
An /Index/ WSIF type is marked as such:\n\
{{{\n\
wsif.type: index\n\
}}}\n\
A WSIF Index file has different content from a conventional WSIF file; the information header is similar, though, apart from the /type/ header. After the normal information block, terminated by a blank line, a simple listing of page titles and their associated file names is given. The block of names should be a continuous block without blank lines separating the pages.\n\
\n\
The file names are separated from the titles by a doubled delimiter: {{{||}}}. These markers will never exist in a page title, even when we introduce character escaping, as intended, and they will also not be present in the file\'s name. Though the format doesn\'t require spaces either side of the delimiter, Woas always includes them; any space before or after the delimiter is trimmed off, as is any space at the start and end of the line.\n\
\n\
An example index file might look as follows, with associated WSIF page files accompanying it:\n\
{{{\n\
wsif.type: index\n\
wsif.version: 1.4.0\n\
wsif.generator: woas\n\
wsif.generator.version: 0.13.0 Alpha 0\n\
wsif.author: PVHL\n\
wsif.pages: 336\n\
\n\
Main Page || 0.wsif\n\
::Menu || 1.wsif\n\
WoaS::Aliases || 2.wsif\n\
WoaS::Hotkeys || 3.wsif\n\
WoaS::CSS::Custom || 4.wsif\n\
...\n\
Water || 335.wsif\n\
}}}\n\
\x3Cdiv class="pvhl"\x3EPVHL: A future Woas version is likely to change the file name to one similar to the page title, transformed according to an algorithm being developed; at that time a file name will be optional if it is the conventional value and is located in the same directory as the index file\x3C/div\x3E\n\
Although not yet implemented, the format allows a short description to be added after the file name, copied from a future page header, {{{page.description}}}, or the opening paragraph if no such header is available, and using the same delimiter. This would then help with importing, matching a similar capability that will be added to the [[Special::ImportWSIF|WSIF import]] page. It might look like this:\n\
{{{\n\
Water || 335.wsif || Information on the various forms water can take\n\
}}}\n\
The description will have a maximum length and Woas may also format the description to a fixed width using the standard line continuation character, {{{\\}}}.\n\
\\\n\
=== Page\n\
\\\n\
A /Page/ WSIF type is marked as such:\n\
{{{\n\
wsif.type: page\n\
}}}\n\
The difference between a conventional WSIF file and a page WSIF file is that only one page is present, all the page headers are left in the information header (and are therefore the default values), so there is no separate page header, and there is no boundary header or marker. An example page file might look as follows:\n\
{{{\n\
wsif.type: page\n\
wsif.version: 1.4.0\n\
wsif.generator: woas\n\
wsif.generator.version: 0.13.0 Alpha 1\n\
wsif.author: PVHL\n\
page.title: Main Page\n\
page.date.modified: 1374388808\n\
\n\
= Welcome to my Woas!\n\
\n\
/(Yep, ...\n\
}}}\n\
The content continues to the end of the file and so needs no boundary header or marker, and no {{{wsif.pages}}} header.\n\
\\\n\
= Usage notes\n\
\\\n\
WSIF format is pretty straightforward to produce or interpret. A few more thoughts:\n\
* it is safe to embed a WSIF file inside another, with proper boundaries implemented;\n\
* WSIF files can contain custom headers (using a namespace other than the reserved /wsif/ and /page/ namespaces). For example you could define a new namespace for header definitions called /custom/:{{{\n\
custom.x: 100\n\
custom.y: 200\n\
custom.content: Hello world!\n\
}}}It would then be up to you to parse such header-value couplets and give them a proper representation. The JavaScript API to allow this within WoaS is not yet implemented.',
'\x3Cdiv class="woas_top"\x3E\x3Cinput id="btn_import" class="woas_button_top" type="button" value="Import WSIF" onclick="woas.import_wiki_wsif(d$.file(\'filename_\'))" /\x3E\x3C/div\x3E\n\
=Import content in [[WoaS::Help::WSIF|WSIF]] format.\n\
\x3Cfieldset id="s2213" class="woas_input_wrap"\x3E\x3Clegend\x3ESource\x3C/legend\x3E\\\n\
\x3Clabel class="woas_input_wrap_left"\x3EFile: \x3Cinput class="woas_input_wrap_inline" id="filename_" type="file" /\x3E\x3C/label\x3E\\\n\
\x3C/fieldset\x3E\\\n\
[[Include::WoaS::Template::ImportSettings]]\\\n\
\x3Cscript type="text/javascript"\x3E\n\
woas.ui._import_load(true);\n\
\x3C/script\x3E\n\
',
'[[Special::TOC]]\n\
Wiki on a Stick (version 0.10.7 and above) supports wiki macros for pluggable wiki syntax and other custom use. Version 0.13.0 takes everything to a new level while remaining backwardly compatible with older macros (if they don\'t depend on core code that has changed in this version).\n\
\n\
/See the [[WoaS::Help::Deprecated syntax#Macros|deprecated syntax]] page for the old-style markup; it will not be discussed herein./\n\
== Using a defined macro\n\
A macro block is enclosed in double angle brackets. Macros names are a sequence of characters without any whitespace and may be followed immediately by a set of brackets enclosing parameters if the macro code uses them. The name, when not using the optional parameter brackets, is followed by a space or newline. This example will create an info box using one of the built-in default macros, /_note/:\n\
{{{\n\
\x3C\x3C_note *This* is /my/ note\x3E\x3E\n\
}}}\n\
This could also have been written like this:\n\
{{{\n\
\x3C\x3C_note\n\
*This* is /my/ note\n\
\x3E\x3E\n\
}}}\n\
with exactly the same results, because it is defined as a /[[#Defining a macro|block]]/ macro. And here it is in action:\n\
\x3C\x3C_note\n\
*This* is /my/ note\n\
\x3E\x3E\n\
If the macro text block contains [[WoaS::Help::Headings|headings]] they will not be included in the page\'s [[WoaS::Help::Table of Contents|table of contents]].\n\
\\\n\
=== Self-documenting\n\
You can also force the macro call to document itself, in addition to producing its normal output, by placing a \'+\' symbol immediately before the macro name (the \'+\' is removed from the documentation output):\n\
\x3C\x3C+_hl(\'#0f0\') This text is highlighted!\x3E\x3E This can be useful in documentation.\n\
\\\n\
== Default macros\n\
With the exception of the dynamic JavaScript macro, {{{=}}}, default macros have names starting with \'_\'; all such names are reserved for future system use (but see [[#Redefining a macro|Redefining a macro]] below).\n\
\\\n\
=== {{{=}}} /&nbsp; (dynamic JavaScript macro)/\n\
Everything following the \'{{{=}}}\' is evaluated as a JavaScript statement and returned as page content that is reprocessed, so:\n\
{{{\n\
\x3C\x3C= woas.version\x3E\x3E\n\
}}} returns \x3C\x3C= woas.version\x3E\x3E, and\n\
{{{\n\
\x3C\x3C= (new Date()).toString()\x3E\x3E\n\
}}} returns \x3C\x3C= (new Date()).toString()\x3E\x3E.\n\
\n\
When JavaScript is evaluated the last statement encountered is the value returned, so the enclosed code can do all sorts of things before the last statement that will evaluate to the returned string.\n\
\n\
This macro can also use an optional \'{{{quiet}}}\' [[#Macros with arguments|argument]] that stops its output if {{{true}}}; this can be useful for creating commands that create side-effects, but no output; the other way of accomplishing this is to have the last statement evaluate to an empty string, but using the \'{{{quiet}}}\' argument instead can sometimes help with debugging your code. For instance:\n\
\x3C\x3C+=(true) a = 42\x3E\x3E\n\
gives no output, but the value it set can be used by another macro:\n\
\x3C\x3C+= if (a && a === 42) "The \x3C\x3C_hl answer\x3E\\\x3E is *42*"; else "no answer found"\x3E\x3E. This technique can be quite powerful. (OK, showing off here; macros can\'t usually be embedded within another macro as done here unless the code has been [[#Defining a macro|written to allow it]]. This macro allows embedded macros as shown, as does the {{{_note}}} macro.)\n\
\x3C\x3C_note JavaScript [[WoaS::Help::JavaScript|scripts]] are all currently run /after/ the page is parsed, so macros that use JavaScript variables will use the values current /before/ any scripts are run. This will be changed in the future to allow certain scripts to run /before/ macro parsing while the rest run normally.\x3E\x3E \n\
\\\n\
=== /_hl/\n\
Highlights the enclosed text. The simple call highlights the text using the CSS specified by the {{{woas_hl_span}}} class defined in [[WoaS::Help::CSS::Core|WoaS::CSS::Core]], and able to be redefined in [[WoaS::Help::CSS::Custom|WoaS::CSS::Custom]]. You can also pass in optional parameters to change the background (first) and foreground (second) colours.\n\
{{{\n\
The \x3C\x3C_hl default highlight\x3E\x3E, some text with \x3C\x3C_hl(\'#aaf\') a different background\x3E\x3E\n\
We can change both, \x3C\x3C_hl(\'indigo\', \'#f00\') even with a named colour\x3E\x3E, or just the \x3C\x3C_hl(\'\', \'#f00\') text colour\x3E\x3E (using the default background) or \x3C\x3C_hl(\'#fff\', \'#0cc\') using the page colour as background\x3E\x3E.\n\
}}}\n\
The \x3C\x3C_hl default highlight\x3E\x3E, some text with \x3C\x3C_hl(\'#aaf\') a different background\x3E\x3E\n\
We can change both, \x3C\x3C_hl(\'indigo\', \'#f00\') even with a named colour\x3E\x3E, or just the \x3C\x3C_hl(\'\', \'#f00\') text colour\x3E\x3E (using the default background) or \x3C\x3C_hl(\'#fff\', \'#0cc\') using the page colour as background\x3E\x3E.\n\
\n\
It is not as cross-browser safe to use colour names.\n\
\n\
Like [[WoaS::Help::Nowiki text|Nowiki text]] markup, the text will be presented in {{{block}}} mode if the text is on a separate line:\n\
\x3C\x3C+_hl(\'\', \'#f00\')\n\
text colour\n\
\x3E\x3E\n\
\n\
You can force {{{block}}} or {{{inline}}} mode if you need to keep all the text in one line or break it up for some reason by adding {{{true}}} or {{{false}}} respectively as the first parameter:\n\
\x3C\x3C+_hl(true, \'\', \'#f00\') */Text colour/*\x3E\x3E\n\
\x3C\x3C+_hl(false)\n\
*/Text colour/*\n\
\x3E\x3E\n\
\n\
This is usually not needed as either form will work within other block syntax; e.g.: a [[WoaS::Help::Tables|table]]:\n\
{{{\n\
{|\n\
|The first row of text\n\
| \x3C\x3C_hl(\'#000\', \'#fff\')\n\
*/Another row/*\n\
\x3E\x3E\n\
| Last row\n\
|}\n\
}}}\n\
{|\n\
|The first row of text\n\
|\x3C\x3C_hl(\'#000\', \'#fff\')\n\
*/_hl row/*\n\
\x3E\x3E\n\
| Last row\n\
|}\n\
There are other ways to accomplish CSS styling in Woas tables, as described on the [[WoaS::Help::Tables|Tables Help page]].\n\
\\\n\
=== /_include/\n\
Allows a template page to be [[WoaS::Help::Template transclusion#The _include macro|transcluded]] with each new line of text in the macro block forming a transclusion parameter; this allows parameters to be used that would not be possible within a simple link;\n\
\\\n\
=== /_note/\n\
As demonstrated above. This macro can also include macro text if properly encoded; e.g.:\n\
\x3C\x3C+_note\n\
This text is \x3C\x3C_hl highlighted\x3E\\\x3E for absolutely \x3C\x3C_hl("red", "white") no reason!\x3E\\\x3E\n\
\x3E\x3E\n\
\\\n\
== Defining a macro\n\
A macro is defined by using the special \'%\' sign before the macro name. Macro code is passed the macro object which has several standard properties:\n\
* *block* - set to true when the macro doesn\'t want any newline following the macro markup turned into a {{{\x3Cbr /\x3E}}} tag; initially set {{{true}}} if the macro text is on a new line from the macro name, otherwise {{{false}}};\n\
* *name* - set to the macros declared name;\n\
* *dnl* - used to add a newline character ({{{\\n}}}) to the returned macro text that will be removed after parsing;\n\
* *reprocess* - set when the returned text should be re-processed by the parser (default false); allowed values are:\n\
** *true* (or 1) - basic reprocessing that includes most inline and block syntax, including [[WoaS::Help::Include wiki page|transclusion links]], except macros;\n\
** *2* - everything above plus macros (using the special \'{{{\x3E\\\x3E}}}\' embedded end marker);\n\
** *3* - everything above plus the ability to define a CSS \'{{{\x3Cstyle\x3E}}}\' block;\n\
* *text* - the content of the macro block after the colon. Exactly what text is passed to the macro follows some simple rules:\n\
** if there is a newline character before the actual text then it and any other whitespace before the newline will be removed;\n\
** a single whitespace character between the (deprecated) colon or the parameter brackets and the text will be removed;\n\
** if the closing macro block brackets are on a line by themselves then the last newline character will also be removed from the text block;\n\
** the above rules can help readability and make the macro block act in a manner consistent with the [[WoaS::Help::Nowiki text#Multi-line blocks|nowiki block (multi-line)]] syntax.\n\
If macro code sets the *err* property to an error string it is parsed as an error using that string. Macros can also know what page is being set ({{{woas.parse_title}}}; this is the page being set, not the page being parsed, so macros running in menus or pages being transcluded will not see the name of the page hosting them) and if they are running in the [[WoaS::Help|Help system]] ({{{woas.parse_help}}}; rarely if ever needed except, perhaps, by Woas code developers).\n\
\\\n\
\x3C\x3C_note Macros should not return a Boolean value: set the optional {{{macro.err}}} to an error text string instead. A macro that doesn\'t return a macro error string has completed successfully. Old macros that return a {{{false}}} value to indicate failure will still work (for now) and are given a generic error string.\n\
\n\
Macro names no longer need to be followed by a colon (\':\'); the colon is deprecated and will eventually disappear. This older syntax is not discussed here.\n\
\n\
Macros can now be redefined as [[#Redefining a macro|explained below]], and macros defined by menus now exist separately from macros defined by pages.\n\
\x3E\x3E\n\
=== An example\n\
Let\'s define the /sum/ macro:\n\
\x3C\x3C+%my_sum\n\
  var elements = macro.text.split(/[\\s\\n]+/), total = 0;\n\
  for (var i=0,l=elements.length;i\x3Cl;++i) {\n\
    if (!elements[i].length) continue;\n\
    try { total += parseInt(elements[i]); } catch(e) { }\n\
  }\n\
  macro.text = total.toString();\n\
  return true;\n\
\x3E\x3E\n\
Now we call the macro:\n\
\x3C\x3C+my_sum\n\
24\n\
56\n\
89\n\
28\n\
19\n\
33\n\
\x3E\x3E \x3C-- and this is the result.\n\
\\\n\
=== Redefining a macro\n\
A page or a menu can redefine any macro any number of times for the duration of their life, with one exception: pages [[WoaS::Help::Include wiki page|transcluded]] by a menu page cannot redefine macros already defined by the menu. This results in a very powerful system because the menu system always uses the highest [[WoaS::Help::Namespaces#Namespace menu|namespace menu]] page it can find, so menus transcluded from lower menus won\'t overwrite the current menu macros, yet a page within that namespace can decide to redefine a menu macro for its own use.\n\
\n\
Defining macros (or CSS for that matter) in the menu or a namespace menu can be a powerful technique as they are then available to all pages within that namespace.\n\
\n\
There is rarely a need to redefine [[#Global macros|Global macros]] -- those that are always available by being registered with the macro system -- but if the need is there a page and/or a menu is able to do so during their lifetime. There are ways for a local macro to permanently redefine a system macro, but this is a malicious act, and if a [[WoaS::Help::Plugins|plugin]] tricks the system into such a redefinition it should state clearly in its documentation that it does so; only use macros and plugins from people you trust. (I will probably lift the restriction on plugins redefining system macros in a future version, but this should be the purpose of the plugin, and clearly stated in user documentation.)\n\
\\\n\
== Macros with arguments\n\
Starting with WoaS 0.12.0 macros support named arguments.\n\
\n\
Example:\n\
\x3C\x3C+%my_arg_macro(name, color):\n\
    macro.text = "\x3Cstrong\x3E" + name +\n\
	    "\x3C/strong\x3E says: \x3Cspan style=\'color: " +\n\
	    color + "\'\x3E" + macro.text + "\x3C/span\x3E";\n\
    return true;\n\
\x3E\x3E\n\
Which is then called with:\n\
{{{\n\
\x3C\x3Cmy_arg_macro("Simon", "green"):\n\
I have 3 pieces of fruit in my basket\n\
\x3E\x3E\n\
}}}\n\
And the result is:\n\
\n\
\x3C\x3Cmy_arg_macro("Simon", "green"):\n\
I have 3 pieces of fruit in my basket\n\
\x3E\x3E\n\
=== Invalid arguments\n\
The passed arguments must be valid JavaScript expressions. An invalid parameter will create an error message. Here is the undefined JavaScript variable {{{unknown}}} passed to the above macro:\n\
\x3C\x3Cmy_arg_macro(unknown, "green"): I have 3 pieces of fruit in my basket\x3E\x3E\n\
A valid parameter passed to a macro that does not use parameters will be ignored.\n\
== Global macros\n\
Macros can be made available to all pages if they are registered by a plugin. (A future version will provide a {{{WoaS::Macros}}} page, or equivalent, that will allow simple definition of global macros using the macro wiki syntax, in much the same way that the [[WoaS::Help::CSS::Custom|custom CSS]] page allows redefinition of global CSS.\n\
\n\
In order to define a global macro you should create or edit a [[WoaS::Help::Plugins|plugin]] and then add JavaScript code similar to this:\n\
{{{\n\
woas.macro.register(\'my.arg_macro\', function(m, name, color) {\n\
m.text = "\x3Cstrong\x3E"+name+"\x3C/strong\x3E says: \x3Cspan style=\'color: " +\n\
    color + "\'\x3E" + m.text + "\x3C/span\x3E";\n\
});\n\
}}}\n\
\x3C\x3C_note The first parameter to the macro function is the /macro/ object that will be passed in by the parser: it doesn\'t appear in the wiki syntax for the macro call; the variable can, of course, have any name you want.\x3E\x3E\n\
This is equivalent to:\n\
\x3C\x3C+%my.argMacro(name, color):\n\
macro.text = "\x3Cstrong\x3E"+name+"\x3C/strong\x3E says: \x3Cspan style=\'color: "+color+"\'\x3E"+macro.text+"\x3C/span\x3E";\n\
\x3E\x3E\n\
If the above macro was included in a page as {{{\x3C\x3Cmy.argMacro("Paul", "red"): Hi!\x3E\x3E}}} the result would be:\n\
\n\
\x3C\x3Cmy.argMacro("Paul", "red"): Hi!\x3E\x3E\n\
\n\
It is a good idea to use a namespace for all the macros you define; in the example just given {{{my}}} was used. This will allow you to use macros from other authors without naming conflicts.\n\
\n\
The same is true regarding the actual macro functions you use. In the above example an [[http://en.wikibooks.org/wiki/JavaScript/Anonymous_Functions|anonymous function]] was used to declare the macro function, but if the macro were more complex it wouuld be better to define the function within a namespace and register the function name. The {{{woas.custom}}} namespace is provided for this purpose; you can add directly to this namespace or, far better, add your own namespace to the custom namespace and put all your macro code within it.\n\
\n\
*More advanced:* the scope the macro code runs in can also be defined by plugin code: \n\
{{{\n\
var wcp = woas.custom.paul = woas.custom.paul || {};\n\
wcp.my_name = "Paul";\n\
wcp.example = function(m, color) {\n\
    m.text = "\x3Cstrong\x3E"+this.my_name+"\x3C/strong\x3E says: \x3Cspan style=\'color: " +\n\
        color + "\'\x3E" + m.text + "\x3C/span\x3E";\n\
    });\n\
// macro name, function, optional scope (this)\n\
woas.macro.register(\'paul.example\', wcp.example, wcp)\n\
}}}\n\
You can learn more about macros by studying the macros and plugins that come with WoaS.',
'The first time you save a change to Wiki on a Stick, your browser will ask for permission to save data to the disk. This is normal and necessary for the wiki to make changes to itself. You can give permission each time or make the setting permanent.\n\
\n\
You will find the *Help* icon in the navigation bar on every page in this wiki. When you click on it, it will either open this page or a specific help page that explains how to work with the page you currently have open.\n\
\n\
When browsing the pages in this Help pop-up, you will find an *Index* button in the upper left corner that takes you back to this page, a *Back* button in the upper right corner that takes you back one page if you\'ve visited more than one page, or a *Close* button in the upper right corner that closes the pop-up.\n\
== Contents\n\
* *Features*\n\
** [[WoaS::Help::Macros|Macros]]\n\
** [[WoaS::Help::Plugins|Plugins]]\n\
** [[WoaS::Help::Security|Security]]\n\
** [[WoaS::Help::Syntax|Syntax]]\n\
** [[WoaS::Help::WSIF|WSIF]]\n\
* *Interface*\n\
** [[WoaS::Help::Aliases|Aliases]]\n\
** [[WoaS::Help::CSS|CSS]]\n\
** [[WoaS::Help::Edit the menu|Edit the menu]]\n\
** [[WoaS::Help::Editor|Editor]]\n\
** [[WoaS::Help::Export|Export]]\n\
** [[WoaS::Help::General use|General use]]\n\
** [[WoaS::Help::Go to a page|Go to]]\n\
** [[WoaS::Help::Hotkeys|Hotkeys]]\n\
** [[WoaS::Help::Import|Import]]\n\
** [[WoaS::Help::Menu|Menu]]\n\
** [[WoaS::Help::Requirements & saving|Requirements & saving]]\n\
* *Online use*\n\
** [[WoaS::Help::Publish wiki online|Publish wiki online]]\n\
** [[WoaS::Help::Run wiki on a web server|Run wiki on a web server]]\n\
* *Page management*\n\
** [[WoaS::Help::Create a page|Create a page]]\n\
** [[WoaS::Help::Delete a page|Delete a page]]\n\
** [[WoaS::Help::Duplicate a page|Duplicate a page]]\n\
** [[WoaS::Help::Edit a page|Edit a page]]\n\
** [[WoaS::Help::Erase all pages|Erase all pages]]\n\
** [[WoaS::Help::Namespaces|Namespaces]]\n\
** [[WoaS::Help::Page scrolling|Page scrolling]]\n\
** [[WoaS::Help::Rename a page|Rename a page]]\n\
* *Specific Help pages*\n\
** [[WoaS::Help::CSS::Boot|CSS::Boot]]\n\
** [[WoaS::Help::CSS::Core|CSS::Core]]\n\
** [[WoaS::Help::CSS::Custom|CSS::Custom]]\n\
** [[WoaS::Help::Locked|Locked]]\n\
** [[WoaS::Help::Special::Advanced|Special::Advanced]]\n\
** [[WoaS::Help::Special::All Pages|Special::All Pages]]\n\
** [[WoaS::Help::Special::Backlinks|Special::Backlinks]]\n\
** [[WoaS::Help::Special::Dead Pages|Special::Dead Pages]]\n\
** [[WoaS::Help::Special::Erase Wiki|Special::Erase Wiki]]\n\
** [[WoaS::Help::Special::Export|Special::Export]]\n\
** [[WoaS::Help::Special::ExportWSIF|Special::ExportWSIF]]\n\
** [[WoaS::Help::Special::Import|Special::Import]]\n\
** [[WoaS::Help::Special::ImportWSIF|Special::ImportWSIF]]\n\
** [[WoaS::Help::Special::Options|Special::Options]]\n\
** [[WoaS::Help::Special::Orphaned Pages|Special::Orphaned Pages]]\n\
** [[WoaS::Help::Special::Recent Changes|Special::Recent Changes]]\n\
** [[WoaS::Help::Special::Search|Special::Search]]\n\
** [[WoaS::Help::Tagged|Tagged]]\n\
** [[WoaS::Help::Unlocked|Unlocked]]\n\
** [[WoaS::Help::Untagged|Untagged]]\n\
[[Include::WoaS::Help::Syntax]]\n\
* *Troubleshooting*\n\
** [[WoaS::Help::Wiki is read-only|Wiki is read-only]]\n\
',
'* *Syntax*\n\
** [[WoaS::Help::Deprecated syntax|Deprecated syntax]]\n\
** [[WoaS::Help::Headings|Headings]]\n\
** [[WoaS::Help::Images|Images]]\n\
** [[WoaS::Help::Include text file|Include text file]]\n\
** [[WoaS::Help::Include web page|Include web page]]\n\
** [[WoaS::Help::Include wiki page|Include wiki page (transclusion)]]\n\
** [[WoaS::Help::JavaScript|JavaScript]]\n\
** [[WoaS::Help::Join lines of text|Join lines of text]]\n\
** [[WoaS::Help::Links|Links]]\n\
** [[WoaS::Help::Lists|Lists]]\n\
** [[WoaS::Help::Macros|Macros]]\n\
** [[WoaS::Help::Nowiki text|Nowiki text]]\n\
** [[WoaS::Help::Rulers|Rulers]]\n\
** [[WoaS::Help::Table of Contents|Table of Contents]]\n\
** [[WoaS::Help::Tables|Tables]]\n\
** [[WoaS::Help::Tags|Tags]]\n\
** [[WoaS::Help::Template transclusion|Template transclusion]]\n\
** [[WoaS::Help::Text formatting|Text formatting]]',
'The [[Special::Advanced]] page offers some tools for administration of your wiki. The Special links lead to pages that have individual help available, except for the dynamic commands that create a prompt. Below are links to relevant help pages for those /Special::/ commands.\n\
* *Special::Delete Page* - See [[WoaS::Help::Delete a page|Delete a page]]\n\
* *Special::Duplicate Page* - See [[WoaS::Help::Duplicate a page|Duplicate a page]]\n\
* *Special::Erase Wiki* - See [[WoaS::Help::Special::Erase Wiki|Erase Wiki]]\n\
* *Special::Go to* - See [[WoaS::Help::Go to a page|Go to a page]]\n\
* *Special::New Page* - See [[WoaS::Help::Create a page|Create a page]]\n\
',
'The *Special::Erase Wiki* link on the [[Special::Advanced]] page allows you to erase all user-created pages and the original /Main Page/ if it still exists, and all content from the menu. The new file will contain default /Main Page/ and /::Menu/ pages. Global core CSS settings will be preserved, but the [[WoaS::CSS::Custom]], Alias, and Hotkey pages will be reset to default values.\n\
\n\
If you have not given permanent permission to your browser for editing wiki pages, you will receive a security warning when attempting to erase the wiki. If you deny permission to the browser, you will receive a message that saving the file failed. The orginal wiki should then be automatically reloaded from the file..\n\
',
'The look and feel of WoaS can be customized by specifying custom CSS in the [[WoaS::CSS::Custom]] reserved page. You can use the WoaS core CSS definitions available in [[WoaS::CSS::Core]] as a reference when writing your own custom CSS.\n\
\x3C\x3C_note Many CSS tutorials are freely available on the web, like this [[http://htmldog.com/guides/cssbeginner/|CSS beginner tutorial]] from /HTML Dog/ or the [[http://www.csstutorial.net|CSS tutorial videos]] by /Stefan Mischook/. [[http://reference.sitepoint.com/css|Sitepoint]] is an excellent reference resource. CSS is the best way to control the look of your pages and well worth learning.\x3E\x3E\n\
== Customizing CSS\n\
# Access [[WoaS::CSS::Core]] either directly or from [[Special::Advanced]]\n\
# Copy the CSS definitions you want to customize\n\
# Access [[WoaS::CSS::Custom]] either directly or from [[Special::Advanced]]\n\
# Edit the page and paste the classes and ids you copied in previous step\n\
# Define the rules for the CSS classes and ids.\n\
# Save your changes by clicking the *Save* icon in the navigation bar.\n\
\n\
All changes will be visible immediately.\n\
== Restore the default CSS settings\n\
You can always restore WoaS default CSS by deleting the content of [[WoaS::CSS::Custom]].\n\
== Import CSS rules into your wiki\n\
You can import the CSS rules from another copy of WoaS by following the instructions for [[WoaS::Help::Import|importing]] another wiki into the current one and placing a check in the box next to *Import custom CSS.*\n\
\n\
Importing from older versions of WoaS can garble the layout of the wiki if the underlying HTML design has changed. There are two ways to avoid problems:\n\
# Manually transfer the CSS from the older version of WoaS into the [[WoaS::CSS::Custom]] page by copying and pasting it, checking the class and id of each entry against the default CSS rules on the [[WoaS::CSS::Core]] page to verify that it\'s still in use before saving your changes.\n\
# Create a new page with style tags in it and paste your CSS into that page to test it before adding it to the [[WoaS::CSS::Custom]] page.\n\
=== Create a test page for your custom CSS\n\
# Access [[Special::Options]] either directly or from [[Special::Advanced]]\n\
# Make sure that the box is /not/ checked next to *Remember current page and navigation history*. Save the change if you had to uncheck the box.\n\
# Create a [[Special::New Page|new page]]\n\
# Insert this opening tag at the top of the page:\x3Cbr/\x3E{{{\n\
\x3Cstyle\x3E\n\
}}}(A properly-formed style tag will be created by the wiki.)\n\
# Paste your CSS rules beneath the tag.\n\
# Insert this closing tag at the bottom of the page:{{{\n\
\x3C/style\x3E\n\
}}}\n\
# Save your changes\n\
Once you have tested your CSS on a single page you can choose whether to move such CSS definitions to [[WoaS::CSS::Custom]] or not.\n\
\x3C\x3C_note A style tag containing custom CSS can also be added, as explained above, to the main [[WoaS::Help::Menu|menu]] or to a [[WoaS::Help::Namespaces#Namespace sub-menu|namespace sub-menu]]. It will then control the layout of the wiki for all pages using that menu!\x3E\x3E',
'This page displays a list of pages that contain links to nonexistent pages. Both the link and the page it\'s on are shown in each entry.\n\
\n\
Fixing dead pages is a good way to not break end-user browsing experience.\n\
',
'== Cancel any action\n\
Cancel any action by clicking the *Cancel* icon in the navigation bar (while editing a page), clicking the *Cancel* button on any alert that pops up, or pressing the *Esc* key.\n\
== Navigation\n\
Use the *Back* and *Forward* arrow icons in the navigation bar to go back or forward one page, the *Main Page* icon in the navigation bar to return to the {{{[[Main page]]}}}, or click the buttons and links in the menu and wiki pages.\n\
== Pages linking to the current page\n\
Click the *Backlinks* link in the menu to see which pages link to the page you currently have open.\n\
== Print a page\n\
Click the *Print* icon in the navigation bar. A new browser window will open with a printer-friendly version of the main text area. Use the browser\'s print functions to print the page.\n\
== Syntax\n\
The wiki pages can use plain text, [[WoaS::Help::Syntax|WoaS wiki syntax]], and XHTML. The [[WoaS::Help::Editor|editor]] includes helper buttons to aid with markup.\n\
\x3C\x3C_note WoaS syntax is partially compatible with Creole 0.1 syntax.\x3E\x3E',
'[[Special::TOC]]\n\
/Nowiki text/ is a section of text that is not parsed as wiki syntax. Anything you place inside nowiki brackets will be displayed in monospace font exactly as you typed it, including macros and HTML comments. If you want to include nowiki markup within the nowiki brackets, the included closing brackets may need to be [[#Method 2|escaped]].\n\
\n\
There are two types of nowiki markup, one for blocks and one for use within a single line. They can styled separately with [[WoaS::Help::CSS::Custom|custom CSS]].\n\
== Block nowiki\n\
\x3Cspan class="woas_help_text"\x3EUse this markup:\x3C/span\x3E\n\
{{{{{{\n\
This is a nowiki block\n\
made of one\n\
or more lines.\n\
}}}}}}\n\
\x3Cspan class="woas_help_text"\x3ETo create this:\x3C/span\x3E{{{\n\
This is a nowiki block\n\
made of one\n\
or more lines.\n\
}}}\n\
This is the correct way to declare a nowiki block. Opening and closing brackets should not appear on the same line as the enclosed text. Future parsers may require that one or both sets of brackets are on a separate line from the enclosed text (for efficiency reasons).\n\
\n\
The block is styled with the {{{woas_nowiki_multiline}}} class.\n\
\\\n\
== Inline nowiki\n\
A normal sentence can contain inline nowiki: {{{this is inline nowiki text}}}.\n\
\n\
\x3Cspan class="woas_help_text"\x3EUse this markup:\x3C/span\x3E\n\
{{{\n\
this is {{{inline nowiki}}~} text\n\
}}}\n\
\x3Cspan class="woas_help_text"\x3ETo create this:\x3C/span\x3E\x3Cdiv class="woas_help_div"\x3E\n\
this is {{{inline nowiki}}} text\n\
\x3C/div\x3E\n\
Inline nowiki is styled using the {{{woas_nowiki}}} class.\n\
\\\n\
== Including nowiki markup within nowiki markup\n\
The opening nowiki markup brackets (\'{{{{{{}}}\') can always be included anywhere within nowiki text. The closing nowiki markup brackets (\'{{{}}}}}}\') can be included inside of nowiki markup using one of two methods.\n\
\\\n\
=== Method 1\n\
If the enclosed text only contains a single set of closing nowiki brackets then simply use the six brackets together.\n\
\n\
\x3Cspan class="woas_help_text"\x3EUse these markups:\x3C/span\x3E\n\
{{{\n\
{{{This is {{{nowiki text}}~}}~}}\n\
}}}\n\
{{{\n\
{{{{{{\n\
A nowiki block\n\
}}~}}~}}\n\
}}}\n\
\x3Cspan class="woas_help_text"\x3ETo create these:\x3C/span\x3E\x3Cdiv class="woas_help_div"\x3E\n\
{{{This is {{{nowiki text}}}}}}\n\
\x3C/div\x3E\n\
{{{{{{\n\
A nowiki block\n\
}}}}}}\n\
\\\n\
=== Method 2\n\
If the included nowiki closing brackets are somewhere other than at the end of the included text then the /escape character/, a tilde (\'{{{~}}}\'), must be used between two of the closing curly brackets to stop there being three brackets in a row. When the nowiki block is parsed the tilde will be removed from the nowiki content. /This currently only works inside of nowiki markup; as the tilde is the standard Creole escape character, a future parser may implement full wiki markup escaping./\n\
\n\
\x3Cspan class="woas_help_text"\x3EUse these markups:\x3C/span\x3E\n\
{{{\n\
{{{This is {{{nowiki}}~~} text}}~}\n\
}}}\n\
{{{\n\
{{{\n\
{{{\n\
A nowiki block\n\
}}~~}\n\
The above is a nowiki block\n\
}}}}}}\n\
\x3Cspan class="woas_help_text"\x3ETo create these:\x3C/span\x3E\x3Cdiv class="woas_help_div"\x3E\n\
{{{This is {{{nowiki}}~} text}}}\n\
\x3C/div\x3E\n\
{{{\n\
{{{\n\
A nowiki block\n\
}}~}\n\
The above is a nowiki block\n\
}}}\n\
If you have nowiki text that includes two closing curly brackets with a tilde between them (\'{{{}~}}}}\') simply escape the tilde with a tilde.\n\
\n\
\x3Cspan class="woas_help_text"\x3EUse this markup:\x3C/span\x3E\n\
{{{{{{\n\
Strange text: }~~~}\n\
}}}}}}\n\
\x3Cspan class="woas_help_text"\x3ETo create this:\x3C/span\x3E\n\
{{{\n\
Strange text: }~~}\n\
}}}\n\
\\\n\
== Nowiki blocks within [[WoaS::Help::Lists|lists]]\n\
A nowiki block can be added to a list item by inserting the opening curly brackets at the end of the list item.\n\
\n\
\x3Cspan class="woas_help_text"\x3EUse this markup:\x3C/span\x3E\n\
{{{# List item:{{{\n\
This is a nowiki block\n\
}}~}\n\
# {{{\n\
Just a nowiki block\n\
}}}}}}\n\
\x3Cspan class="woas_help_text"\x3ETo create this:\x3C/span\x3E\n\
# List item:{{{\n\
This is a nowiki block\n\
}}}\n\
# {{{\n\
Just a nowiki block\n\
}}}\n\
\x3C\x3C_note Most browsers have problems with the technique used to stop block nowiki continuing behind the [[WoaS::Help::Table of Contents|Table of Contents]] if the block nowiki markup is the first entry in a list item, so the CSS used is disabled for block nowiki within a list item, causing it to be hidden behind the TOC. I haven\'t found a way around this yet. If you won\'t be using nowiki blocks as the first entry in a list item you could override the disabling CSS in your [[WoaS::Help::CSS::Custom|custom CSS]] as follows:\n\
{{{\n\
li pre.woas_nowiki_multiline {\n\
	overflow: hidden\n\
}\n\
}}}\n\
Inline nowiki is not affected.\n\
\x3E\x3E',
'\x3Cdiv style="background-color: #FFFFAA; border: 0.1em solid; padding: 0.2em;"\x3E\x3Cimg src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADtElEQVR42rWWXUxbZRjHBwx0G9go7GJixCXDLQZZjEa9W4yKi04vtnhlsrg4E5Mp2TQu0cyZuESNEmVENseYQNduKx+FApWuUEopLYwPoRvQscGAjrFCP2gpbWkL/HzTxCszOMnYkzwX5+Sc/+99/89z3udsmC/4/pGmpIdEIJLULamkp2ew6fFN/HfvoQAi2Lx5C4c+Pky1qharuQerqZcGdTMFP//BG3veJjExcVXQquK7c3fTaelmKQrhYIQ5r5+Z+27GRhz0dg5hMdr48YdCnnoy/YGQB4rn5LyIY+IerMBCYCGec3N+XDOeOOT6P3a0dW0YdD2cLigjLVUWh0gCbNyYjKHZxHJshXAozPLSMpHFCPPzC7hdXmadbm70j6DXWlCr9DSqLXz+2TfSACI4sP9DAr4wft+8EI4Si8VYDC+K6wAe9xxTDidd5gFamqzUVbVyqVyLvFTL9qzsOGRNQHFRCf65oPDcRyi4QCQSEDuZx+/34xE7uGUfxT50neFBG1cb24V4PVcqmtn/wUdrA0RXiFVpcTm9cTuCQR+RaFBAgoTDogazd5mcvInLNcX09BjXrF2Ul9SjuKDj6JFv1wakpKQIX7U47kyLYrrw+TxEoyFi0QihkJ9AwCNq4cXrnWFi3I6x2UzpGbUA/M2J46ekWVRyRo6tdwTH+LTYhUuIeoWoB4fDztTUbSYnbjI81I/JYEEp/P/zdBVVF5v56ovj0gD5R77G2maj3dBDf+8g43eGRYHd3HXcoq+7lxZdB/U1BhR/ablwto6zhSp0tSbe27tPGmBn9gs0aTrQVBtEr5uw9fcJ7+/hvD9Jl6WLK3IdijItZec08dWryhuplKuRPSFD8of26aF89I3dXKrQInwWfo/g8cwIWA8qRRPni9VCvBJ5iRrz1U727X0f8Z50QFJSEl/mn6RWZabmsp7BG304Jm8zIAAV5zWcK6qhRqnDrO/kk4OHJRwV/4MkkJCQwLvvHKCoQCla14Cl3Sr6vhWVXENDtQZFqZI397wl4bBbJQWErRkZtOgv4nReY2a2g9HRGtqMv/Daq7vi4usyD9pMPxFb6cbtNTJgk1NVeZJt29LIzXllfQDmjkJCi114fe0M2y/ToDnF9ufS2bUzd30ArcbfWcKGP2BhdKwao+FXduzYyvPZOesD6O75jUCwHZfHRIuhmO9OHEQme4yXX3r94QFpaWkkJ2/g6cwMlEoFeXl5CChZWc9KmsmSMzPzGdG68RnMsWNHkfpX8UjzX78dQm6UDc/yAAAAAElFTkSuQmCC" alt="Info" border="0" /\x3E %1\x3C/div\x3E\n\
\x3Cscript\x3E\n\
woas.log("DEPRECATED: WoaS::Template::Info. Use the much more flexible _note macro instead; e.g.:\\n     \x3C\x3C_note My note text\x3E\x3E");\n\
\x3C/script\x3E',
'Read-only protection is by no means a security mechanism (see [[WoaS::Help::Security|Security]]), but rather an invitation to /fair use/ of the content. The author disables the write features assuming they won\'t be useful to the end-user or to indicate their expectation that the content won\'t be edited or copied.\n\
\n\
To re-enable the write features manually:\n\
# Back up your WoaS\n\
# Open it in a text editor\n\
# Do a search for: {{{"permit_edits":false,}}}\n\
# Replace it with: {{{"permit_edits":true,}}}\n\
# Save the file\n\
\n\
*NOTE:* this way of re-enabling WoaS write mode is *unsupported*, i.e. it might not work in future versions of WoaS.\n\
',
'# Access [[Special::New Page]]\n\
# Type the page title. Maximum length is 256 characters, although you might want to use a shorter title to not interfere with the navigation bar. Page titles are case sensitive, all characters are allowed except angled brackets, square brackets, curly braces, and pipe, hash, or double-quote characters ({{{\x3C\x3E[]{}|#"}}})\n\
# Press the *Enter* key or click the *OK* button\n\
# When asked if you\'d like to add a link into the main menu, accept by pressing the *Enter* key or clicking the *OK* button, or refuse by pressing the Escape key or clicking the *Cancel* button\n\
# Edit the contents of the main text area by typing normally. You can freely change the default text (a level one heading with the page name)\n\
# Use the editor\'s buttons to insert wiki syntax to format the text or type the wiki syntax manually (plain text does not need any wiki syntax)\n\
# Save your changes\n\
== Create a missing page\n\
An alternate method of creating a page is to type a new page title inside square brackets and then attempt to access the unexisting page.\n\
\n\
*Example:*\n\
{{{\n\
[[My new page]]\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3EIs rendered as:\x3C/div\x3E\n\
[[My new page]]\n\
= Troubleshooting\n\
There are some issues which could prevent you from creating a page.\n\
\n\
* You didn\'t type a title for the page in the input box that popped up\n\
* There is already a page by that title\n\
* The wiki is being run in [[WoaS::Help::Publish wiki online|read-only mode]], so no changes are allowed. See the [[WoaS::Help::Wiki is read-only|Wiki is read-only]] page for instructions on how to return the wiki to editing mode\n\
* You are trying to use a [[WoaS::Help::Namespaces|namespace]] that is reserved by WoaS. In this case a message will pop up letting you know the namespace is reserved and giving you an opportunity to choose a different title/namespace for the page\n\
',
'= By /Special::Delete Page/ action link/command\n\
# Access [[Special::Delete Page]] from a [[WoaS::Help::Links|link]] (e.g. from the Special::[[WoaS::Help::Special::Advanced|Advanced]] page, default [[WoaS::Help::Menu|menu]], or user page) or by using the Special::[[WoaS::Help::Go to a page|Go to]] command.\n\
# You\'ll be asked for the exact title of the page and then for confirmation\n\
# When the page is deleted, you\'ll be returned to the page you were on before deleting the page.\n\
= By editing\n\
# [[WoaS::Help::Edit a page|Edit]] the page you wish to delete\n\
# Select everything inside the main text area and delete it\n\
# You will be asked to confirm the deletion when you Save the page\n\
= References to deleted pages\n\
Access [[Special::Dead Pages]] either directly or from [[Special::Advanced]] to remove references to the deleted page.\n\
',
'[[Special::TOC]]\n\
== General use\n\
* Cancel all changes by clicking the *Cancel* icon in the navigation bar at any time.\n\
* Change the title of a page by editing the contents of the *Page title* box.\n\
* Save all changes by clicking the *Save* icon in the navigation bar at any time.\n\
* See examples of how tables are built by clicking the *Tables* link.\n\
* Toggle the display of the button rows by clicking the *W | X* links (to the left of /Page title/).\n\
== Wiki buttons\n\
Buttons to ease entering [[WoaS::Help::Syntax|wiki syntax]].\n\
{|\n\
|+ Wiki Code buttons\n\
| *Button* || *What it does*\n\
| Wiki URL || Add a wiki link to a page.\n\
| URL || Add an external link to a page.\n\
| {{{=}}} || Insert wiki syntax for a level one heading. Use this at the beginning of any line.\n\
| {{{==}}} || Insert wiki syntax for a level two heading. Use this at the beginning of any line.\n\
| Img || Include a wiki image in the page.\n\
| *B* || Wrap selected text with bold syntax.\n\
| /i/ || Wrap italic text with bold syntax.\n\
| u || Wrap selected text with underline syntax.\n\
| &#123;&#123;&#123; &#125;&#125;&#125; || Wrap wiki syntax around the selected text to make it nowiki (raw) text.\n\
| * || Insert the wiki syntax for a bulleted list item.\n\
| # || Insert the wiki syntax for a numbered list item.\n\
| @ || Insert the wiki syntax for an alphanumeric list item.\n\
| Ruler || Insert a ruler (horizontal line). Use this at the beginning of any line.\n\
| Tags || Interface for inserting tags in your page to categorize it. Use a comma between multiple tags.\n\
|}\n\
== XHTML buttons\n\
*Note:* it\'s recommended you use [[WoaS::Help::Syntax|wiki syntax]] instead of XHTML syntax. Some reasons are:\n\
* it is generally easier and less error-prone to use wiki markup\n\
* your content will probably be more transferable to other wiki systems; and,\n\
* this is a wiki!\n\
{|\n\
|+ XHTML Code buttons\n\
| *Button* || *What it does*\n\
| *B* || Wrap selected text with bold tags.\n\
| /i/ || Wrap selected text with emphasis tags (italics).\n\
| u || Wrap selected text with underline tags.\n\
| s || Wrap selected text with strike-through tags.\n\
| Sup || Wrap selected text with superscript tags (appearing half a character above the baseline).\n\
| Sub || Wrap selected text with subscript tags (appearing half a character below the baseline).\n\
| Left || Wrap selected text with a left-aligned div.\n\
| Center || Wrap selected text with a center-aligned div.\n\
| Right || Wrap selected text with a right-aligned div.\n\
| Justify || Wrap selected text with a justified div.\n\
| List || Add unordered list tags around the selected text.\n\
| List = || Add ordered list tags around the selected text.\n\
| li[*] || Wrap selected text with list item tags.\n\
| Blockquote || Wrap selected text with blockquote tags, indenting it beneath the current line.\n\
| Image || Include an external image.\n\
| Link || Include an external link URL.\n\
|}',
'All user-created pages (and some which are part of reserved [[WoaS::Help::Namespaces|namespaces]]) can be edited.\n\
\n\
If a page is editable the /Edit/ icon will be available in the navigation bar; you start editing the page by clicking such icon. The user interface will switch to an [[WoaS::Help::Editor|editor-mode set of buttons and edit areas]].\n\
== Editing\n\
In order to edit pages, click the *Edit* icon in the navigation bar. You can find all the user pages by accessing [[Special::All Pages]] directly or either from [[Special::Advanced]].\n\
# Click the *Edit* icon in the navigation bar or double-click on the page if you\'ve enabled that setting in the wiki Options.\x3Cbr\x3E\x3Cbr\x3E\n\
# Edit the contents of the main text area by typing normally.\x3Cbr\x3E\x3Cbr\x3E\n\
# Use the editor\'s buttons to insert code to format the text, or type the code in manually. Note that the use of plain text doesn\'t require any code.\x3Cbr\x3E\x3Cbr\x3E\n\
# Save your changes by clicking on the *Save* icon in the navigation bar.\n\
== Deleting\n\
See [[WoaS::Help::Delete a page|Delete a page]].\n\
',
'To erase all user-created pages in this wiki and start fresh:\n\
# Access [[Special::Erase Wiki]] directly or either from [[Special::Advanced]]\n\
\x3C\x3C_note Make sure you are using a wiki you don\'t mind losing. If not, make a copy and erase the copy.\x3E\x3E\n\
See also the [[WoaS::Help::Special::Erase Wiki|Erase Wiki]] page.\n\
',
'# Click the /Edit/ link at the bottom of the menu\n\
# Edit the contents of the main text area; the menu page is like a normal wiki page\n\
# Save your changes by clicking on the *Save* icon in the top right navigation panel\n\
\n\
You can use various styles for your menu. A detailed explanation of list styles can be found on the [[WoaS::Help::Lists|Lists]] page.\n\
== Using sub-menus\n\
See the [[WoaS::Help::Namespaces#Namespace sub-menu|Namespace sub-menu]] section of the [[WoaS::Help::Namespaces|Namespaces]] page.\n\
',
'Below are examples on how to use wiki markup to create headings in this wiki. There are six levels of supported headings.\n\
{{{\n\
= Heading level 1\n\
}}}\n\
= Heading level 1\n\
{{{\n\
== Heading level 2\n\
}}}\n\
== Heading level 2\n\
{{{\n\
=== Heading level 3\n\
}}}\n\
=== Heading level 3\n\
{{{\n\
==== Heading level 4\n\
}}}\n\
==== Heading level 4\n\
{{{\n\
===== Heading level 5\n\
}}}\n\
===== Heading level 5\n\
{{{\n\
====== Heading level 6\n\
}}}\n\
====== Heading level 6\n\
',
'Rulers (horizontal rules or lines) use the full width of the page by default. They can be styled to a smaller width by surrounding them with HTML &lt;div&gt; tags. Styling can also control their position.\n\
== Standard ruler\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
----\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\x3Cbr\x3E\n\
----\n\
== Custom width ruler aligned left\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing 50% with the width you like:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cdiv style="width:50%";\x3E\n\
----\n\
\x3C/div\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cdiv style="width:50%";\x3E\n\
----\n\
\x3C/div\x3E\n\
== Custom width ruler aligned right\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing 50% with the width you like:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cdiv style="width:50%; float:right;"\x3E\x3Chr\x3E\x3C/div\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cdiv style="width:50%; float:right;"\x3E\x3Chr\x3E\x3C/div\x3E\n\
== Custom width centered ruler\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing 50% with the width you like:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Ccenter\x3E\x3Cdiv style="width:50%";\x3E\n\
----\n\
\x3C/div\x3E\x3C/center\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Ccenter\x3E\x3Cdiv style="width:50%";\x3E\n\
----\n\
\x3C/div\x3E\x3C/center\x3E\n\
',
'Including the contents of one wiki page inside another wiki page is called /transclusion/. To accomplish this use an {{{[[Include::]]}}} tag on a line by itself, inserting the name of the page you\'d like to transclude after the double colons in the tag.\n\
\x3C\x3C_note Page names are case sensitive.\x3E\x3E\n\
\x3Cspan class="woas_help_text"\x3EUse this code in a page, replacing Page Name with the name of the page you wish to include:\x3C/span\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::Page Name]]\x3C/div\x3E\n\
\x3Cspan class="woas_help_text"\x3ETo include the contents of another wiki page in the current page.\x3C/span\x3E\n\
== Example\n\
\x3Cspan class="woas_help_text"\x3EUse this code in a page:\x3C/span\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::WoaS::Aliases]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cspan class="woas_help_text"\x3ETo create this (the [[WoaS::Aliases]] page):\x3C/span\x3E\n\
\n\
\x3Cpre\x3E[[Include::WoaS::Aliases]]\x3C/pre\x3E\n\
== Template transclusion\n\
WoaS can also transclude template pages, allowing you to change the content of a transcluded page by using link parameters; see [[WoaS::Help::Template transclusion|Template transclusion]].\n\
',
'[[Special::TOC]]\n\
== Adding JavaScript to the wiki source\n\
You can add &lt;script&gt; tags to your wiki source and they will be correctly rendered in the document &lt;head&gt; tag each time the page is loaded; external scripts (using the /src/ attribute) will also be parsed and activated. The order of declaration of the &lt;script&gt; tags will be respected.\n\
\x3C\x3C_note Since the JavaScript tags are activated from within the &lt;head&gt; tag, you cannot use document.write() or similar inline JavaScript statements.\x3E\x3E\n\
It is very often better to use a [[WoaS::Help::Macros|macro]] or other JavaScript loaded by a custom [[WoaS::Help::Plugins|plugin]]. The code or macro is then loaded once when the file is first loaded and is available to all your pages.\n\
=== Adding JavaScript to your page\n\
To add JavaScript to your page, you must enclose it inside script tags.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing YOUR_CODE_HERE with your JavaScript code:\x3C/div\x3E\n\
{{{\n\
\x3Cscript\x3E\n\
YOUR_CODE_HERE\n\
\x3C/script\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3ETo add JavaScript to your page.\x3C/div\x3E\n\
=== Using external JavaScript\n\
You can include external JavaScript on a page by placing the script file in the same directory as the WoaS file and then inserting a reference to it in the text of the page.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing SCRIPTNAME.JS with the name of your script:\x3C/div\x3E\n\
{{{\n\
\x3Cscript src="SCRIPTNAME.JS"\x3E\x3C/script\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3ETo include an external JavaScript file in a page.\x3C/div\x3E\n\
== Using the /Javascript::/ namespace in a link\n\
The /Javascript::/ namespace is used in two ways:\n\
* *To run a small piece of JavaScript code* when the link that contains it is clicked.\n\
* *To dynamically create a temporary page* that only exists while it is being displayed and is not stored as a page in the wiki.\n\
Everything following the namespace declaration will be evaluated as a JavaScript expression when the link is activated. You can use /$JS::/ instead of /Javascript::/ if your [[WoaS::Help::Aliases|Aliases]] page still contains the default {{{$JS  Javascript}}} declaration.\n\
\x3C\x3C_note /Javascript::/ links cannot be [[WoaS::Help::Include wiki page|transcluded]] (i.e. {{{[[Include::Javascript::\'Hi\']]}}} is meaningless and not parsed), cannot contain any double-quotes ({{{"}}}) unless escaped ({{{\\"}}}), and do not create history (back/forward entries).\n\
\n\
If you need to include dynamic text in a page use a [[WoaS::Help::Macros|macro]] instead, including the default JavaScript macro [[WoaS::Help::Macros|=]] macro\x3E\x3E\n\
=== Running Code\n\
If the code contained in the link does not evaluate to a string or array then no dynamic page will be created, but the code will still be evaluated. This is useful if the link needs to have a \'side-effect\'. Examples are showing an alert, perhaps containing dynamic values, incrementing a counter in your code, or changing WoaS code settings. It is best to use a label so that the code doesn\'t display as the link.\n\
\n\
The following example will toggle the menu between fixed and scrolling. This might be a useful link to place in a menu if your content sometimes has long [[WoaS::Help::Namespaces#Namespace sub-menu|namespace menus]] and you have the edit menu doubleclick option set, so you can\'t use the default double click action to toggle the menu state.\n\
{{{\n\
[[Javascript::woas.ui.set_menu(!woas.ui.display(\'fix_m\'))|Toggle fixed menu]]\n\
}}}\n\
And here is the link: [[Javascript::woas.ui.set_menu(!woas.ui.display(\'fix_m\'))|Toggle fixed menu]].\n\
=== Creating a dynamic page\n\
If the JavaScript expression evaluates to a non-empty string it will be used as the text of the dynamic page and the link text will be used as the title of the page. If the expression evaluates to an array and that array contains exactly two strings, then the first string will be used as the dynamic page\'s title (with /Javascript::/ added), and the second one will form the content of the page. The content string can be WoaS wiki syntax, HTML, or a combination of both; it is parsed just as a normal page is.\n\
\n\
A simple (but useless) example is:\n\
{{{\n\
[[Javascript::\'=Hi\']]\n\
}}}\n\
This link should create a dynamic page in the main wiki: [[Javascript::\'=hi\']]. Another simple (and equally useless) example:\n\
{{{\n\
[[Javascript::[\'Hello\',\'=Hi\'] ]]\n\
}}}\n\
\x3C\x3C_note Notice the space after the array\'s closing bracket\x3E\x3E\n\
And here\'s the link: [[Javascript::[\'Hello\',\'=Hi\'] ]]. The space isn\'t needed if, as is usual, you are using a label after the page link; for example:\n\
{{{\n\
[[Javascript::[\'Hi\',\'Hello World\']|A dynamic page]]\n\
[[$JS::[\'Hi\',\'Hello World\']|A dynamic page]]\n\
}}}\n\
The first uses /Javascript::/ in the page address, the second /$JS::/. The links will both look the same when hovering over the link if the default /$JS/ Alias is still set; the second link will be broken if the alias is removed): [[Javascript::[\'Hi\',\'Hello World\']|A dynamic page]], [[$JS::[\'Hi\',\'Hello World\']|A dynamic page]].\n\
\n\
These simple examples could even contain a [[WoaS::Help::Links|link]] (note the use of {{{]\\]}}} in the link):\n\
{{{\n\
[[Javascript::[\'Hello world\',\'I am Hello World, not the [[Special::All Pages]\\] page\']|A pointless page]]\n\
}}}\n\
The above example as a [[Javascript::[\'Hello world\',\'I am Hello World, not the [[Special::All Pages]\\] page\']|pointless page link]]. If you choose this link the wiki will display the /All Pages/ listing; if you then click the back button, the previous page -- not the /Javascript::/ page -- will be displayed.\n\
\n\
Here is a slightly more useful example that uses a JavaScript function:\n\
{{{\n\
\x3Cscript type="text/javascript"\x3E\n\
  function rhyme1() {\n\
    return [\'A Rhyme\',\n\
      \'=Hello Lamppost\\nWhat cha knowing?\\n\' +\n\
      \'I\\\'ve come to watch\\n* your flowers\\n* growing.\'];\n\
  }\n\
\x3C/script\x3E\n\
}}}\n\
\x3Cscript type="text/javascript"\x3E\n\
	function rhyme1() {\n\
		return [\'A Rhyme\',\'=Hello Lamppost\\nWhat cha knowing?\\n\' +\n\
		\'I\\\'ve come to watch\\n* your flowers\\n* growing.\'];\n\
	}\n\
\x3C/script\x3E\n\
The link {{{[[Javascript::rhyme1()|Rhymes]]}}} will open this page in the main wiki window: [[Javascript::rhyme1()|Rhymes]]\n\
\n\
The JavaScript function can also be passed dynamic content using one or more function parameters:\n\
{{{\n\
\x3Cscript type="text/javascript"\x3E\n\
  function rhyme2(thing) {\n\
    return [\'A \'+thing+\' Rhyme\',\'=Hello \'+thing+\n\
      \'\\nWhat cha knowing?\\n\' +\n\
      \'I\\\'ve come to watch\\n* your flowers\\n* growing.\'];\n\
  }\n\
\x3C/script\x3E\n\
}}}\n\
\x3Cscript type="text/javascript"\x3E\n\
	function rhyme2(thing) {\n\
		return [\'A \'+thing+\' Rhyme\',\'=Hello \'+thing+\n\
		  \'\\nWhat cha knowing?\\n\' +\n\
		  \'I\\\'ve come to watch\\n* your flowers\\n* growing.\'];\n\
	}\n\
\x3C/script\x3E\n\
The link {{{[[Javascript::rhyme2(\'Lamppost\')|Rhymes]]}}} will open this page in the main wiki window: [[Javascript::rhyme2(\'Lamppost\')|Rhymes]]. This one uses /$JS/:\n\
{{{\n\
[[$JS::rhyme2(\'World\')|Another rhyme]]\n\
}}}\n\
[[$JS::rhyme2(\'World\')|Another rhyme]].\n\
\x3C\x3C_note The above example would be more easily accomplished by [[WoaS::Help::Template transclusion|transcluding]] a template page and passing in replacement parameters; using a template would also allow the rhyme link to be transcluded. Nevertheless, there are times when generating changable, dynamic pages is perfectly suited to the /Javascript::/ namespace technique.\x3E\x3E',
'Lengthy wiki page content can be broken up into shorter lines in the editor (while still being parsed as a single line when the page is viewed) by using a backslash at the *end* of any line; such a line will be joined with the one below it.\n\
\x3C\x3C_note Backslashes *within* a line will be ignored by the wiki parser and will not influence how the text is displayed.\x3E\x3E\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\n\
{{{\n\
Putting a \\ at the end of any line \\\n\
makes it join together \\\n\
with the line below it.\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
Putting a \\ at the end of any line \\\n\
makes it join together \\\n\
with the line below it.\n\
',
'When you create a page with double colons (*::*) as a separator in the page name, you are using a namespace to define parent and child pages. Sub-namespaces are created by adding more than one *::* separator to the page name. Each namespace or sub-namespace can have as many child pages under it as you like (within the resource limits of your hardware). The full path to each page is displayed in the navigation bar with links to its namespace and sub-namespace(s) in the title.\n\
\n\
For example, let\'s say you have these pages:\n\
* {{{[[Recipes::Desserts]]}}}\n\
* {{{[[Recipes::Desserts::Cakes]]}}}\n\
* {{{[[Recipes::Main dishes]]}}}\n\
* {{{[[Recipes::Side dishes]]}}}\n\
* {{{[[Recipes::Soups]]}}}\n\
\n\
*Recipes::* is a namespace. *Desserts::* is a sub-namespace of the *Recipes::* namespace. *Cakes::* is a sub-namespace of the *Desserts::* sub-namespace.\n\
\n\
If you open the {{{[[Recipes::Desserts::Cakes]]}}} page, the title in the navigation bar contains links to *Recipes* and *Desserts*. The *Recipes* link opens a page listing all pages in the *Recipes::* namespace, and the *Desserts* link opens a page listing all pages in the *Desserts::* sub-namespace.\n\
=== Namespace sub-menu\n\
All pages in any namespace can be given a custom sub-menu by creating a *::Menu* page inside the namespace. The sub-menu content will replace the [[WoaS::Help::Menu|::Menu]] content while any pages belonging to that page\'s namespace are open. The sub-menu will vanish as soon as you navigate away from its namespace.\n\
\n\
You can control what the sub-menu displays by editing the page with *::Menu* in its name, or by clicking the menu edit icon (bottom right corner of the menu) while it is being displayed. A menu is just a wiki page that is displayed in the menu area, so anything a normal page can contain a menu page can as well; this includes JavaScript scripts and CSS style sheets, allowing very flexible customization of namespaces. To [[WoaS::Help::Include wiki page|include]] the main menu in a sub-menu use {{{[[Include::::Menu]]}}}.\n\
\n\
For example, if you create the {{{[[Recipes::Menu]]}}} page with *My favorite recipes!* as its content, then whenever you open a page in the {{{Recipes::}}} namespace, a sub-menu will appear with *My favorite recipes!* in it.\n\
=== Sub-namespace sub-menu\n\
All pages in any sub-namespace can be given a custom sub-menu by creating a *::Menu* page inside the sub-namespace. The sub-menu will be displayed beneath the main menu while any pages belonging to that page\'s sub-namespace are open. You can determine what goes into the sub-menu by editing the page with *::Menu* in its name. The sub-menu will vanish as soon as you navigate away from its sub-namespace.\n\
\n\
To include the main menu in a sub-menu use {{{[[Include::::Menu]]}}}. You can also include menus from lower namespaces in the same way.\n\
\n\
For example, if you create the {{{[[Recipes::Desserts::Menu]]}}} page with *My favorite desserts!* as its content, then whenever you open a page in the {{{Recipes::Desserts::}}} sub-namespace, a sub-menu will appear with *My favorite desserts!* in it.\n\
\n\
If a namespace contains namespace and sub-namespace ::Menu pages and you open a page in the sub-namespace, the contents of the sub-namespace ::Menu page will be displayed. If a sub-namespace has no menu but a lower namespace does, then that menu will be used instead.\n\
\x3C\x3C_note Sub-menus work the same way menus do. For more information on menus see the [[WoaS::Help::Edit the menu|Edit the menu]] page.\x3E\x3E\n\
There is no limit to how many sub-namespaces you can have, other than the 256 character limit for title length.\n\
== Reserved namespaces\n\
Some namespaces are reserved by the wiki for its own internal use or for specific use by the user\n\
* *::Menu* is a special reserved namespace used for the [[WoaS::Help::Menu|menu]] and sub-menus\n\
\n\
These are listable namespaces:\n\
* *File::* for embedded files\n\
* *Image::* for embedded images\n\
* *Locked::* for listing encrypted pages\n\
* *Special::* for all the special pages\n\
* *Tagged::* for listing tagged pages\n\
* *Unlocked::* for listing plain (unencrypted) pages\n\
* *Untagged::* for listing untagged pages\n\
* *WoaS::* for core WoaS pages\n\
\n\
Some namespaces cannot be listed but are used inside wiki links to accomplish a task:\n\
* *Include::* for transclusion\n\
* *Javascript::* for direct JavaScript execution\n\
* *Lock::* used internally or in a link to lock (encrypt) a page\n\
* *Tag::* syntax used to tag a page\n\
* *Tags::* alternative syntax used to tag a page\n\
* *Unlock::* used internally or in a link to unlock (decrypt) a page\n\
',
'== Bold\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
*This is bold text.*\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
*This is bold text.*\n\
== Colored\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cspan style="color:#FF00FF"\x3EThis is colored text.\x3C/span\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cspan style="color:#FF00FF"\x3EThis is colored text.\x3C/span\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EOr use this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cspan style="color:fuchsia"\x3EThis is colored text.\x3C/span\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cspan style="color:fuchsia"\x3EThis is colored text.\x3C/span\x3E\n\
== Italic\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
/This is italic text./\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
/This is italic text./\n\
== Plain\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
This is plain text.\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
This is plain text.\n\
== Underlined\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
_This is underlined text._\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
_This is underlined text._\n\
== Underlined Bold Italic\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
_*/This is underlined and bold and italic text./*_\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
_*/This is underlined and bold and italic text./*_\n\
',
'# Click the *Edit* icon in the navigation bar.\n\
# Edit the contents of the text inside the *Page title* area at the top of the page.\n\
# Save your changes by clicking on the *Save* icon in the navigation bar.\n\
= Reference links\n\
Renaming a page will automatically rename also the references to such page in other pages.\n\
',
'By default, this wiki offers two choices for scrolling. You can change these settings by clicking the *Advanced* icon in the navigation bar and then clicking the {{{[[Special::Options]]}}} link.\n\
\n\
The *Fixed menu* and *Fixed navigation bar* options can be enabled and disabled by placing a check mark in the box next to the option. Enabling them locks the navigation bar and/or the menu in place while allowing the rest of the page to scroll. Disabling them allows the entire page to scroll as one connected unit.\n\
',
'You can insert a Table of Contents into your page by using a special wiki tag. It will be automatically populated with all the headings on a page. The placement of the Table of Contents is determined by where you put the tag in the page.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code on a line by itself in a page:\x3C/div\x3E{{{\n\
[[Special::TOC]]\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3ETo add a Table of Contents to the page.\x3C/div\x3E\n\
== Example\n\
If you were to create a page with these contents:\n\
{{{\n\
[[Special::TOC]]\n\
= My level one heading\n\
== My level two heading\n\
=== My level three heading\n\
==== My level four heading\n\
===== My level five heading\n\
====== My level six heading\n\
= My next level one heading\n\
}}}\n\
the displayed page would have a Table of Contents at the top of the page similar to the following:\n\
\n\
\x3Cdiv id="woas_page"\x3E\x3Cdiv id="woas_toc"\x3E\n\
\x3Cdiv id="woas_toc_title"\x3ETable of Contents\x3C/div\x3E\n\
\x3Cdiv class="woas_toc_h1"\x3E\x3Ca class="woas_link"\x3EMy level one heading\x3C/a\x3E\x3C/div\x3E\n\
\x3Cdiv class="woas_toc_h2" style="margin: 0px 1.5em "\x3E\x3Ca class="woas_link"\x3EMy level two heading\x3C/a\x3E\x3C/div\x3E\n\
\x3Cdiv class="woas_toc_h3" style="margin-left: 3em"\x3E\x3Ca class="woas_link"\x3EMy level three heading\x3C/a\x3E\x3C/div\x3E\n\
\x3Cdiv class="woas_toc_h4" style="margin-left: 4.5em"\x3E\x3Ca class="woas_link"\x3EMy level four heading\x3C/a\x3E\x3C/div\x3E\n\
\x3Cdiv class="woas_toc_h5" style="margin-left: 6em"\x3E\x3Ca class="woas_link"\x3EMy level five heading\x3C/a\x3E\x3C/div\x3E\n\
\x3Cdiv class="woas_toc_h6" style="margin-left: 7.5em"\x3E\x3Ca class="woas_link"\x3EMy level six heading\x3C/a\x3E\x3C/div\x3E\n\
\x3Cdiv\x3E\x3Ca class="woas_link"\x3EMy next level one heading\x3C/a\x3E\x3C/div\x3E\n\
\x3C/div\x3E\x3C/div\x3E\n\
The exact look of the TOC is controlled by the current CSS and JavaScript, both of which can be changed. The WoaS default implementation includes the ability to toggle the TOC display by clicking the /Table of Contents/ title text.',
'Tags are used to group pages by categories/features/topics so they can easily be found again.\n\
\n\
Tags can be placed anywhere on a page, but choosing a standard location like the bottom of the page makes them easier to find and edit as your wiki grows.\n\
\n\
Tag a page by using a {{{[[Tag::tag1]]}}} link, adding the tag name or names after the double colons; multiple tags should be separated with commas.\n\
\n\
You can also use the *Tag* button in the editor.\n\
=== Add a tag to a page (method 1)\n\
# Click the *Tags* button in the editor.\x3Cbr\x3E\x3Cbr\x3E\n\
# Type in a name for the tag.\x3Cbr\x3E\x3Cbr\x3E\n\
# Click the *OK* button.\n\
=== Add a tag to a page (method 2)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing EXAMPLE with the name of the tag you\'d like to add:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Tag::EXAMPLE]]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo add a tag to your page.\x3C/div\x3E\n\
=== Add more than one tag to a page (method 1)\n\
# Click the *Tags* button in the editor.\x3Cbr\x3E\x3Cbr\x3E\n\
# Type in names for the tags, separating each from the one before it with a comma. For example:\x3Cbr\x3E\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing EXAMPLE1, EXAMPLE2, and EXAMPLE3 with the names of the tags you\'d like to add:\x3C/div\x3E\x3Cbr\x3E\x3Cdiv class="woas_help_code"\x3E{{{[[Tag::EXAMPLE1, EXAMPLE2, EXAMPLE3]]}}}\x3C/div\x3E\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo add three tags to your page.\x3C/div\x3E\x3Cbr\x3E\n\
# Click the *OK* button.\n\
=== Add more than one tag to a page (method 2)\n\
To use more than one tag on a page, use one tag link and add as many tags as you like, separating each from the one before it with a comma. For example: {{{[[Tag::Recipes, Chocolate, Layered cakes]]}}}.\n\
=== Choosing tag names\n\
Tag names are case sensitive. For example: {{{[[Tag::Recipes]]}}} and {{{[[Tag::recipes]]}}} are two different tags.\n\
\n\
Tag names can be more than one word long with a space between each word. For example: {{{[[Tag::Layered cakes]]}}}.\n\
=== Add a link to tagged pages\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing EXAMPLE with the tag you\'d like to use:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E{{{[[Tagged::EXAMPLE]]}}}\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo create a listing of pages tagged with EXAMPLE.\x3C/div\x3E\n\
=== Add a filtered link to tagged pages\n\
By putting an exclamation mark (*!*) in front of the tag name, you can filter out a specific tag from a tagged pages list:\x3Cbr\x3E\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing EXAMPLE with the tag you\'d like to filter out:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Tagged::!EXAMPLE]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo create a filtered listing of tagged pages that are not tagged with EXAMPLE.\x3C/div\x3E\n\
=== Include a listing of tagged pages\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing EXAMPLE with the tag you\'d like to use:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::Tagged::EXAMPLE]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo display a listing of pages tagged with EXAMPLE inside the current page.\x3C/div\x3E\n\
=== Include a filtered listing of tagged pages\n\
By putting an exclamation mark (*!*) in front of the tag name, you can filter out a specific tag from a tagged pages list:\x3Cbr\x3E\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing EXAMPLE with the tag you\'d like to filter out:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::Tagged::!EXAMPLE]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo display a filtered listing of tagged pages that are not tagged with EXAMPLE inside the current page.\x3C/div\x3E\n\
',
'This wiki can be published online as a single-file, framed web page by making it read-only. The read-only format can also be used for sharing your work with others by email. Most email programs accept .html pages as attachments.\n\
# Make a backup copy of this wiki.\n\
# Click the *Advanced* icon in the navigation bar.\n\
# Scroll to the bottom of the page.\n\
# Click the *Disallow edits* button to make the file read-only.\n\
# Upload the wiki to a web server and publish a link to it.\n\
To enable wiki editing again, see the [[WoaS::Help::Wiki is read-only|Wiki is read-only]] page.\n\
',
'Wiki on a Stick is a client software not designed to be used on a web server; WoaS will anyway recognize that it is being run from a web server and prevent save operations with an appropriate user message informing about the impossibility to save permanent changes.\n\
== Server integration\n\
WoaS 1.0 will offer an API to allow server-side integrations.\n\
',
'[[Special::TOC]]== Supported Browsers\n\
Wiki on a Stick is actively supported on the following browsers:\n\
* Chrome\n\
* Firefox 3.5+ (and probably older versions too)\n\
* Internet Explorer (IE) 6+\n\
* Opera\n\
* Safari (no longer tested much)\n\
/On IE7+ you could rename your WoaS file extension from {{{.html}}} to {{{.hta}}} to enable its trusted privileges. This removes the /Active-x control /and /JavaScript /warnings, but remember to rename its extension to {{{.html}}} before sharing with others for cross-browser support. A recent code fix (0.13.0) allows IE to work to the latest standards when this is done, so modern versions of IE work very well with an {{{.hta}}} extension, removing security warnings and becoming very application-like./\n\
== Limitations\n\
* *Firefox* (and possibly other browsers, too) cannot save to filenames containing UTF8 characters. Use unix-style filenames instead.\n\
* *Internet Explorer*\n\
** IE6 does not allow a fixed menu.\n\
** IE6 and IE7 cannot display embedded images (that\'s why you will not see button icons in these browsers), and IE8 can only show images under a certain size (around 32 Kbytes).\n\
** IE may not allow saving to a network path in the form {{{\\\\machine\\share\\woas.htm}}}. Map the network path to a network drive to use this wiki over a network with IE.\n\
* *Browsers other than Firefox and Internet Explorer* (and those browsers that use their rendering engines) cannot save changes without a Java applet (see /TiddlySaver/ below), therefore you need to *[[http://javatester.org/version.html|ensure that Java is enabled in your browser]]* and that it properly works to save any changes to your WoaS files.\n\
* *Firefox 17+* cannot save changes without either /WoasFox/ (an extension being developed by PVHL), /TiddlyFox/ (an extension by Jeremy Ruston) or the Java applet /TiddlySaver/. /TiddlyFox/ and /TiddlySaver/ do no allow binary saving; this will only affect you if you want to export images or embedded binary files.\n\
== TiddlySaver\n\
\x3C\x3C_note If you can\'t get the latest TiddlySaver included with this project to work, you might try using Internet Explorer (Windows) or Firefox with the TiddlyFox extension (any OS) instead. Both scenarios are simple and work well.\n\
\n\
The following instructions are outdated. We are working on a new signed version of TiddlySaver that will work in current Java installations, and I will update this page as we progress. Oracle has been changing the security requirements of Java quite frequently and arbitrarily, causing many HTML pages that use Java applets to fail.\x3E\x3E\n\
The Java applet /TiddlySaver.jar/, a very small file, must be placed in the same directory as your WoaS file. In order to use it you will need to give it the necessary privileges by editing your .java.policy file.\n\
\n\
For Windows, the policy file, if it exists, will be in your user directory, but its location is dependent on the Windows version. (/I was only able to get the latest Java version to work by editing the system policy file./) Create the file or append the following lines (substituting the directory  as appropriate):\n\
{{{\n\
grant codeBase "file:${user.home}/My Documents/woas-folder/-" {\n\
  permission java.io.FilePermission "${user.home}${/}My Documents${/}woas-folder${/}-", "read,write";\n\
};\n\
}}}\n\
On Mac OS X, the file is found at {{{/Users/your-user-name/.java.policy}}}:\n\
{{{\n\
grant codeBase "file:${user.home}/Documents/woas-folder/-" {\n\
  permission java.io.FilePermission "${user.home}${/}Documents${/}woas-folder${/}-", "read,write";\n\
};\n\
}}}\n\
The grant statements above allow any Java applet to run in the {{{woas-folder}}} directory, and any subdirectories beneath it. This allows Woas to also save WSIF files to subdirectories of the Woas file and also allows you to have separate subdirectories for each Woas file, if you so desire, without creating a new permission for each folder; each Woas file still needs its own /TiddlySaver.jar/ file in the folder with it.\n\
\n\
The grant statement doesn\'t /have/ to use the{{{ ${user.home} }}}macro; you can define whatever directory location you like.\n\
\n\
The TiddlySaver java applet was written by Jeremy Ruston of TiddlyWiki fame.\n\
',
'Simple single-level lists can be created by using the list buttons in the editor.\n\
* The *{{{*}}}* button inserts the wiki syntax for a bulleted list item\n\
* The *{{{#}}}* button inserts the wiki syntax for a numbered list item.\n\
* The *{{{@}}}* button inserts the wiki syntax for an alphanumeric list item.\n\
* The *{{{List}}}* button wraps HTML ul tags around the selected text to create an unordered list.\n\
* The *{{{List =}}}* button wraps HTML ol tags around the selected text to create an ordered list.\n\
* The *{{{li[*]}}}* button wraps HTML li tags around the selected text to create a list item.\n\
If you\'d like to create mixed lists, nested lists, or lists with additional types of list items, the methods below can be used instead.\n\
== Wiki markup lists\n\
Wiki markup lists are created with between one and five specific characters ({{{@}}}, {{{*}}}, or {{{#}}}) at the beginning of a line, followed by a space, and then whatever text you\'d like the list item to have. Each list must begin with a list item with only one character at the beginning of the line, and there can be no blank lines between entries in the list. To create a blank line beneath a list item, you can insert two HTML {{{\x3Cbr\x3E}}} tags at the end of of the list item\'s text. Wiki and HTML markup are accepted in list items.\n\
=== Alphanumeric List\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
@ Test\n\
@ Test\n\
@ Test\n\
@@ Test\n\
@@@ Test\n\
@@@@ Test\n\
@ Test\n\
@ Test\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
@ Test\n\
@ Test\n\
@ Test\n\
@@ Test\n\
@@@ Test\n\
@@@@ Test\n\
@ Test\n\
@ Test\n\
=== Bulleted List\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
* Test\n\
* Test\n\
** Test\n\
*** Test\n\
**** Test\n\
* Test\n\
* Test\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\x3Cbr\x3E\n\
* Test\n\
* Test\n\
** Test\n\
*** Test\n\
**** Test\n\
* Test\n\
* Test\n\
=== Fancy List\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
* ITEM 1 - ITEM 1 SUBTEXT \x3Cblockquote\x3EITEM 1 MORE SUBTEXT\x3C/blockquote\x3E\n\
* ITEM 2 - ITEM 2 SUBTEXT \x3Cblockquote\x3EITEM 2 MORE SUBTEXT\x3C/blockquote\x3E\n\
* ITEM 3 - ITEM 3 SUBTEXT \x3Cblockquote\x3EITEM 3 MORE SUBTEXT\x3C/blockquote\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\x3Cbr\x3E\n\
* ITEM 1 - ITEM 1 SUBTEXT \x3Cblockquote\x3EITEM 1 MORE SUBTEXT\x3C/blockquote\x3E\n\
* ITEM 2 - ITEM 2 SUBTEXT \x3Cblockquote\x3EITEM 2 MORE SUBTEXT\x3C/blockquote\x3E\n\
* ITEM 3 - ITEM 3 SUBTEXT \x3Cblockquote\x3EITEM 3 MORE SUBTEXT\x3C/blockquote\x3E\n\
=== Numbered List\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
# Test\n\
# Test\n\
## Test\n\
### Test\n\
#### Test\n\
# Test\n\
# Test\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\x3Cbr\x3E\n\
# Test\n\
# Test\n\
## Test\n\
### Test\n\
#### Test\n\
# Test\n\
# Test\n\
=== Numbered Fancy List\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
# ITEM 1 - ITEM 1 SUBTEXT \x3Cblockquote\x3EITEM 1 MORE SUBTEXT\x3C/blockquote\x3E\n\
# ITEM 2 - ITEM 2 SUBTEXT \x3Cblockquote\x3EITEM 2 MORE SUBTEXT\x3C/blockquote\x3E\n\
# ITEM 3 - ITEM 3 SUBTEXT \x3Cblockquote\x3EITEM 3 MORE SUBTEXT\x3C/blockquote\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\x3Cbr\x3E\n\
# ITEM 1 - ITEM 1 SUBTEXT \x3Cblockquote\x3EITEM 1 MORE SUBTEXT\x3C/blockquote\x3E\n\
# ITEM 2 - ITEM 2 SUBTEXT \x3Cblockquote\x3EITEM 2 MORE SUBTEXT\x3C/blockquote\x3E\n\
# ITEM 3 - ITEM 3 SUBTEXT \x3Cblockquote\x3EITEM 3 MORE SUBTEXT\x3C/blockquote\x3E\n\
== HTML Lists\n\
HTML lists work the same way as they do in any web page. Specifying the list type can be done in the {{{\x3Col\x3E}}}, {{{\x3Cul\x3E}}}, or {{{\x3Cli\x3E}}} tags, depending on how you need to use them. Wiki markup is accepted in list items.\n\
=== Specifying list type in the &lt;ol&gt; tag\n\
This method is useful when an entire list will use one list item type. This way you only need to specify the type once, and all the list items can be entered normally.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col style="list-style-type:lower-alpha;"\x3E\n\
\x3Cli\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli\x3Elower-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col style="list-style-type:lower-alpha;"\x3E\n\
\x3Cli\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli\x3Elower-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col style="list-style-type:upper-alpha;"\x3E\n\
\x3Cli\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli\x3Eupper-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col style="list-style-type:upper-alpha;"\x3E\n\
\x3Cli\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli\x3Eupper-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col style="list-style-type:decimal;"\x3E\n\
\x3Cli\x3Edecimal\x3C/li\x3E\n\
\x3Cli\x3Edecimal\x3C/li\x3E\n\
\x3Cli\x3Edecimal\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col style="list-style-type:decimal;"\x3E\n\
\x3Cli\x3Edecimal\x3C/li\x3E\n\
\x3Cli\x3Edecimal\x3C/li\x3E\n\
\x3Cli\x3Edecimal\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col style="list-style-type:lower-roman;"\x3E\n\
\x3Cli\x3Elower-roman\x3C/li\x3E\n\
\x3Cli\x3Elower-roman\x3C/li\x3E\n\
\x3Cli\x3Elower-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col style="list-style-type:lower-roman;"\x3E\n\
\x3Cli\x3Elower-roman\x3C/li\x3E\n\
\x3Cli\x3Elower-roman\x3C/li\x3E\n\
\x3Cli\x3Elower-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col style="list-style-type:upper-roman;"\x3E\n\
\x3Cli\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli\x3Eupper-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col style="list-style-type:upper-roman;"\x3E\n\
\x3Cli\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli\x3Eupper-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
=== Specifying list type in the &lt;ul&gt; tag\n\
This method is useful when an entire list will use one list item type. This way you only need to specify the type once, and all the list items can be entered normally.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cul style="list-style-type:circle;"\x3E\n\
\x3Cli\x3Ecircle\x3C/li\x3E\n\
\x3Cli\x3Ecircle\x3C/li\x3E\n\
\x3Cli\x3Ecircle\x3C/li\x3E\n\
\x3C/ul\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cul style="list-style-type:circle;"\x3E\n\
\x3Cli\x3Ecircle\x3C/li\x3E\n\
\x3Cli\x3Ecircle\x3C/li\x3E\n\
\x3Cli\x3Ecircle\x3C/li\x3E\n\
\x3C/ul\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cul style="list-style-type:disc;"\x3E\n\
\x3Cli\x3Edisc\x3C/li\x3E\n\
\x3Cli\x3Edisc\x3C/li\x3E\n\
\x3Cli\x3Edisc\x3C/li\x3E\n\
\x3C/ul\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cul style="list-style-type:disc;"\x3E\n\
\x3Cli\x3Edisc\x3C/li\x3E\n\
\x3Cli\x3Edisc\x3C/li\x3E\n\
\x3Cli\x3Edisc\x3C/li\x3E\n\
\x3C/ul\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cul style="list-style-type:none;"\x3E\n\
\x3Cli\x3Enone\x3C/li\x3E\n\
\x3Cli\x3Enone\x3C/li\x3E\n\
\x3Cli\x3Enone\x3C/li\x3E\n\
\x3C/ul\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cul style="list-style-type:none;"\x3E\n\
\x3Cli\x3Enone\x3C/li\x3E\n\
\x3Cli\x3Enone\x3C/li\x3E\n\
\x3Cli\x3Enone\x3C/li\x3E\n\
\x3C/ul\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cul style="list-style-type:square;"\x3E\n\
\x3Cli\x3Esquare\x3C/li\x3E\n\
\x3Cli\x3Esquare\x3C/li\x3E\n\
\x3Cli\x3Esquare\x3C/li\x3E\n\
\x3C/ul\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Cul style="list-style-type:square;"\x3E\n\
\x3Cli\x3Esquare\x3C/li\x3E\n\
\x3Cli\x3Esquare\x3C/li\x3E\n\
\x3Cli\x3Esquare\x3C/li\x3E\n\
\x3C/ul\x3E\n\
=== Specifying list type in the &lt;li&gt; tag\n\
This method is useful when creating a fancy list with more than one list item type.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
\x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
\x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
\x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
\x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
\x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
\x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
\x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
\x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
\x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
\x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
\x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
\x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
\x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
\x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
\x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
\x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
\x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
\x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
\x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
\x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
\x3C/ol\x3E\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
\x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
\x3C/ol\x3E\n\
=== Mixed HTML list\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
   \x3Col\x3E\n\
   \x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
      \x3Col\x3E\n\
      \x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
         \x3Col\x3E\n\
         \x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
            \x3Col\x3E\n\
            \x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
               \x3Col\x3E\n\
               \x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
                  \x3Col\x3E\n\
                  \x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
                     \x3Col\x3E\n\
                     \x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
                        \x3Col\x3E\n\
                        \x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
                        \x3C/ol\x3E\n\
                     \x3C/ol\x3E\n\
                  \x3C/ol\x3E\n\
               \x3C/ol\x3E\n\
            \x3C/ol\x3E\n\
         \x3C/ol\x3E\n\
      \x3C/ol\x3E\n\
   \x3C/ol\x3E\n\
\x3C/ol\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
\x3Col\x3E\n\
\x3Cli style="list-style-type:lower-alpha;"\x3Elower-alpha\x3C/li\x3E\n\
   \x3Col\x3E\n\
   \x3Cli style="list-style-type:upper-alpha;"\x3Eupper-alpha\x3C/li\x3E\n\
      \x3Col\x3E\n\
      \x3Cli style="list-style-type:circle;"\x3Ecircle\x3C/li\x3E\n\
         \x3Col\x3E\n\
         \x3Cli style="list-style-type:decimal;"\x3Edecimal\x3C/li\x3E\n\
            \x3Col\x3E\n\
            \x3Cli style="list-style-type:disc;"\x3Edisc\x3C/li\x3E\n\
               \x3Col\x3E\n\
               \x3Cli style="list-style-type:lower-roman;"\x3Elower-roman\x3C/li\x3E\n\
                  \x3Col\x3E\n\
                  \x3Cli style="list-style-type:none;"\x3Enone\x3C/li\x3E\n\
                     \x3Col\x3E\n\
                     \x3Cli style="list-style-type:square;"\x3Esquare\x3C/li\x3E\n\
                        \x3Col\x3E\n\
                        \x3Cli style="list-style-type:upper-roman;"\x3Eupper-roman\x3C/li\x3E\n\
                        \x3C/ol\x3E\n\
                     \x3C/ol\x3E\n\
                  \x3C/ol\x3E\n\
               \x3C/ol\x3E\n\
            \x3C/ol\x3E\n\
         \x3C/ol\x3E\n\
      \x3C/ol\x3E\n\
   \x3C/ol\x3E\n\
\x3C/ol\x3E\n\
',
'[[Special::TOC]]\n\
= Table syntax\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
{|\n\
| CELL1 || CELL2\n\
| CELL1 || CELL2\n\
|}\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
{|\n\
| CELL1 || CELL2\n\
| CELL1 || CELL2\n\
|}\n\
\n\
\x3Cdiv class="woas_help_text"\x3EOr use this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
{|\n\
| CELL1 || CELL2\n\
|-\n\
| CELL1 || CELL2\n\
|}\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
{|\n\
| CELL1 || CELL2\n\
|-\n\
| CELL1 || CELL2\n\
|}\n\
\n\
The line that starts with {{{|- }}} is a comment line. You can type some text after it which will only be visible when viewing the source:\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
{|\n\
| CELL1 || CELL2\n\
|- This is a comment.\n\
| CELL1 || CELL2\n\
|}\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
{|\n\
| CELL1 || CELL2\n\
|- This is a comment.\n\
| CELL1 || CELL2\n\
|}\n\
== Header rows\n\
Tables can have a specially formatted header row created by adding a pipe followed by a plus symbol and a space before the title text (example: {{{|+ Title}}}), and can contain internal and external [[WoaS::Help::Links|wiki links]].\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
{|\n\
|+ TITLE\n\
| *HEADER1* || *HEADER2* || *HEADER3*\n\
|-\n\
| CELL1 || CELL2 || CELL3\n\
|-\n\
| CELL1 || CELL2 || CELL3\n\
|-\n\
| CELL1 || CELL2 || CELL3\n\
|-\n\
| CELL1 || || CELL3\n\
|}\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
{|\n\
|+ TITLE\n\
| *HEADER1* || *HEADER2* || *HEADER3*\n\
|-\n\
| CELL1 || CELL2 || CELL3\n\
|-\n\
| CELL1 || CELL2 || CELL3\n\
|-\n\
| CELL1 || CELL2 || CELL3\n\
|-\n\
| CELL1 || || CELL3\n\
|}\n\
\n\
\x3Cdiv class="woas_help_text"\x3EOr use this code in a page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
{|\n\
|+ TITLE\n\
| *HEADER1* || *HEADER2* || *HEADER3*\n\
| CELL1 || CELL2 || CELL3\n\
| CELL1 || CELL2 || CELL3\n\
| CELL1 || CELL2 || CELL3\n\
| CELL1 || || CELL3\n\
|}\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
{|\n\
|+ TITLE\n\
| *HEADER1* || *HEADER2* || *HEADER3*\n\
| CELL1 || CELL2 || CELL3\n\
| CELL1 || CELL2 || CELL3\n\
| CELL1 || CELL2 || CELL3\n\
| CELL1 || || CELL3\n\
|}\n\
= Extended customization of layout\n\
Styling, formatting, and alignment can be used to control the look and behavior of tables. All example tables on this page use table comment lines ( {{{|-}}} ) to make it easier to see what is involved in creating the tables. These lines are not necessary when creating your tables.\n\
== Add some custom CSS rules to the wiki\n\
To create a custom table defined by [[WoaS::Help::CSS|CSS]], add some table rules to the wiki CSS using a class name of your choosing.\n\
* \x3Cdiv class="woas_help_text"\x3EUse these CSS rules in your wiki, replacing CLASS_NAME with the class name you\'d like to use, and CSS_RULES with the rules you\'d like to define for the table, the caption, the headers, the cells, and a [[#Styling table cells|special cell]]:\x3C/div\x3E\x3Cbr\x3E{{{\n\
table.CLASS_NAME {CSS_RULES}\n\
caption.CLASS_NAME {CSS_RULES}\n\
table.CLASS_NAME th {CSS_RULES}\n\
table.CLASS_NAME td {CSS_RULES}\n\
table.CLASS_NAME td.special {CSS_RULES}\n\
}}}\x3Cbr\x3ESee the [[#The CSS rules used by the example tables|custom CSS rules]] used by the examples on this page.\n\
== Assign a class to a table\n\
When custom CSS rules have been added to the wiki, you can replace the default {{{{|}}} table opening line with a custom one to assign the custom class to the table.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EOpen a table with this line of code:\x3C/div\x3E\x3Cbr\x3E{{{\n\
{| class="CLASS_NAME"\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo use a custom class for the table.\x3C/div\x3E\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|} \n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|} \n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|} \n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|} \n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
== Alignment\n\
Tables are aligned to the left by default, but alignment can be controlled by surrounding the cell contents with extra spaces or tabs. Forcing content to the left is not necessary, but it may help to use forced alignment for debugging complex tables.\n\
\n\
{|\n\
| *Alignment* || *Example result* || *Effect*\n\
| {space}text{space} || text || default\n\
| {space}text{space}{space} || text  || text is aligned to the left\n\
| {space}{space}text{space} ||  text || text is aligned to the right\n\
| {space}{space}text{space}{space} ||  text  || text is centered\n\
|}\n\
== Captions\n\
Placement of the caption determines whether it\'s above or below the table.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a table, replacing CAPTION with the caption of the table:\x3C/div\x3E\x3Cbr\x3E{{{\n\
|+ CAPTION\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo add a caption to a table.\x3C/div\x3E\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
|+ caption above\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
|+ caption above\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
|+ caption above\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
|+ caption above\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|+ caption below\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|+ caption below\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|+ caption below\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|+ caption below\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
== Empty cells\n\
Empty cells can be created by inserting just one space after a pipe in your table.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample plain table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| || cell 2 || cell 3\n\
|-\n\
| cell 1 || || cell 3\n\
|-\n\
| cell 1 || cell 2 || \n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| || cell 2 || cell 3\n\
|-\n\
| cell 1 || || cell 3\n\
|-\n\
| cell 1 || cell 2 || \n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample fancy table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| || cell 2 || cell 3\n\
|-\n\
| cell 1 || || cell 3\n\
|-\n\
| cell 1 || cell 2 || \n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| || cell 2 || cell 3\n\
|-\n\
| cell 1 || || cell 3\n\
|-\n\
| cell 1 || cell 2 || \n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
== Headers\n\
In default tables, table header cells ({{{\x3Cth\x3E}}}) are created by surrounding the cell content in asterisks. In custom tables, use a single {{{=}}} symbol before the cell content to change the table data cell ({{{\x3Ctd\x3E}}}) into a table header cell {{{\x3Cth\x3E}}}, which can be styled differently through CSS.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
\n\
Placement of table header cells ({{{\x3Cth\x3E}}}) can be anywhere in a table.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| *cell 1* || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || *cell 3*\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| *cell 1* || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || *cell 3*\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || =cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || =cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
\n\
To get the contents of a cell to start with an equal symbol, use an HTML comment ( {{{\x3C!-- --\x3E}}} ) before the equal symbol:\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| \x3C!-- --\x3E=cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || \x3C!-- --\x3E=cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| \x3C!-- --\x3E=cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || \x3C!-- --\x3E=cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| \x3C!-- --\x3E=cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || \x3C!-- --\x3E=cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| \x3C!-- --\x3E=cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || cell 2 || \x3C!-- --\x3E=cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
== Spans\n\
By removing all contents in a cell you can cause the content in the cell to the left or right of it to span more than one column.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| *cell 1* || cell 2 || cell 3\n\
|-\n\
| *cell 1* || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| *cell 1* || cell 2 || cell 3\n\
|-\n\
| *cell 1* || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || cell 2 || cell 3\n\
|-\n\
| =cell 1 || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || cell 2 || cell 3\n\
|-\n\
| =cell 1 || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| cell 1 || cell 2 || cell 3\n\
|-\n\
| cell 1 || span last 2 columns ||\n\
|-\n\
||| span just last 2 columns ||\n\
|-\n\
| span all columns ||||\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
== Styling table cells\n\
Definitions can be used within tables to style the cells. A definition affects only the cells *following* it. If you wish to apply the definition to the entire table, insert it directly beneath the table opening tag.\n\
=== Method 1 - define styles in the wiki CSS\n\
This method requires that you add a custom "special" [[WoaS::Help::CSS|CSS rule]] to the wiki so that any table cell in the "special" class will use that rule. See the *table td.special* rule in the [[#The CSS rules used by the example tables|custom CSS]] used by this page for an example.\n\
\n\
You can add a "special" class definition by using {{{|$ class="special"}}} in a table. The definition can be used by any row below the definition by adding {{{==}}} before the contents of a cell.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
|$ class="special"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
|$ class="special"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
|$ class="special"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
|$ class="special"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
=== Method 2 - define styles on the fly\n\
You can add a style definition by using {{{|$ style="CSSRULE"}}} in a table. The definition can be used in any row below the definition by adding {{{==}}} before the contents of a cell.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || cell 2 || ==cell 3\n\
|-\n\
| cell 1 || ==cell 2 || cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
\n\
Multiple style definitions can be added to a table. The first definition can be used by adding {{{==}}} before the contents of a cell. The second definition can be used by adding {{{===}}} before the contents of a cell. The third definition can be used by adding {{{====}}} before the contents of any cell. And so on.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:#ff00ff"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:#ff00ff"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:#ff00ff"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:#ff00ff"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
=== Method 3 - combination of method 1 and method 2\n\
These examples use a combination of method 1 and method 2. The first definition can be used by adding {{{==}}} before the contents of a cell. The second definition can be used by adding {{{===}}} before the contents of a cell. The third definition can be used by adding {{{====}}} before the contents of any cell. The fourth definition can be used by adding {{{=====}}} before the contents of any cell. And so on.\n\
\n\
\x3Ctable width="100%"\x3E\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample default table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{|\n\
|-\n\
|$ class="special"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:silver"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{|\n\
|-\n\
|$ class="special"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:silver"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| *cell 1* || *cell 2* || *cell 3*\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\n\
\x3Ctr\x3E\x3Ctd width="40%"\x3E\x3Cdiv class="woas_help_text"\x3EExample custom table:\x3C/div\x3E\x3C/td\x3E\x3Ctd width="60%"\x3E\x3Cdiv class="woas_help_text"\x3EUse this code to create the table:\x3C/div\x3E\x3C/td\x3E\x3C/tr\x3E\x3Ctr\x3E\x3Ctd valign="top"\x3E\n\
{| class="mycustomtable"\n\
|-\n\
|$ class="special"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:silver"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
\x3C/td\x3E\x3Ctd valign="top"\x3E\n\
{{{\n\
{| class="mycustomtable"\n\
|-\n\
|$ class="special"\n\
|-\n\
|$ style="background:springgreen"\n\
|-\n\
|$ style="background:silver"\n\
|-\n\
|$ style="background:cyan"\n\
|-\n\
| =cell 1 || =cell 2 || =cell 3\n\
|-\n\
| ==cell 1 || ===cell 2 || ====cell 3\n\
|-\n\
| ====cell 1 || =====cell 2 || ===cell 3\n\
|-\n\
|}\n\
}}}\n\
\x3C/td\x3E\x3C/tr\x3E\x3C/table\x3E\n\
== The CSS rules used by the example tables\n\
These are the custom CSS rules used by the example tables on this page:\x3Cbr\x3E\x3Cbr\x3E{{{\n\
/* CUSTOM CSS FOR custom tables */\n\
table.mycustomtable {\n\
	color: #404040;\n\
	background-color: #fafafa;\n\
	border-collapse: collapse;\n\
	border-spacing: 0px;\n\
	border: 1px solid #6699CC;\n\
	font-family: Verdana, sans-serif, Arial;\n\
	font-size: 11px;\n\
	font-weight: normal;\n\
	/*UNCOMMENT THE WIDTH LINE BELOW TO CONTROL THE WIDTH OF THE TABLE*/\n\
	/*width: 500px;*/\n\
}\n\
caption.mycustomtable {\n\
	color: #404040;\n\
	border: 1px solid #6699CC;\n\
	text-align: center;\n\
	width: 580px;\n\
}\n\
table.mycustomtable th { \n\
	color: #404040;\n\
	background-color: #BEC8D1;\n\
	border-bottom: 2px solid #6699CC;\n\
	border-left: 1px solid #6699CC;\n\
	font-weight: bold;\n\
	text-indent: 2px;\n\
}\n\
table.mycustomtable td {\n\
	color: #404040;\n\
	border-top: 0px;\n\
	border-right: 0px;\n\
	border-bottom: 1px solid #9CF;\n\
	border-left: 1px solid #9CF;\n\
	text-indent: 2px;\n\
}\n\
table.mycustomtable td.special {\n\
	background-color: #ff00ff;\n\
}\n\
\n\
/* CUSTOM CSS FOR DEFAULT TABLES */\n\
table td.special {\n\
	background-color: #ff00ff;\n\
}\n\
}}}\n\
\x3C!-- NOTE: BELOW ARE CUSTOM CSS RULES EMBEDDED ON THIS PAGE FOR USE BY THIS PAGE. --\x3E\n\
\x3Cstyle type="text/css"\x3E\n\
/* CUSTOM CSS FOR custom tables */\n\
table.mycustomtable {\n\
	color: #404040;\n\
	background-color: #fafafa;\n\
	border-collapse: collapse;\n\
	border-spacing: 0px;\n\
	border: 1px solid #6699CC;\n\
	font-family: Verdana, sans-serif, Arial;\n\
	font-size: 11px;\n\
	font-weight: normal;\n\
	/*UNCOMMENT THE WIDTH LINE BELOW TO CONTROL THE WIDTH OF THE TABLE*/\n\
	/*width: 500px;*/\n\
}\n\
caption.mycustomtable {\n\
	color: #404040;\n\
	border: 1px solid #6699CC;\n\
	text-align: center;\n\
	width: 580px;\n\
}\n\
table.mycustomtable th { \n\
	color: #404040;\n\
	background-color: #BEC8D1;\n\
	border-bottom: 2px solid #6699CC;\n\
	border-left: 1px solid #6699CC;\n\
	font-weight: bold;\n\
	text-indent: 2px;\n\
}\n\
table.mycustomtable td {\n\
	color: #404040;\n\
	border-top: 0px;\n\
	border-right: 0px;\n\
	border-bottom: 1px solid #9CF;\n\
	border-left: 1px solid #9CF;\n\
	text-indent: 2px;\n\
}\n\
table.mycustomtable td.special {\n\
	background-color: #ff00ff;\n\
}\n\
\n\
/* CUSTOM CSS FOR DEFAULT TABLES */\n\
table td.special {\n\
	background-color: #ff00ff;\n\
}\n\
\x3C/style\x3E\n\
',
'[[Special::TOC]]This wiki accepts wiki and HTML links.\n\
== Wiki links\n\
Below are methods for creating links using wiki syntax.\n\
=== Anchor link\n\
You can use a special anchor link to link to a heading on the current page. After clicking an anchor link, use the browser\'s back button to return to where you were on the page.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing HEADING NAME with the name of the heading you\'d like to link to:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[#HEADING NAME]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create an anchor link.\x3C/div\x3E\n\
=== Email link\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing USERNAME with the name of the person, SERVER with the name of their server, and LABEL with the text you\'d like displayed as a link:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[mailto://USERNAME@SERVER|LABEL]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
[[mailto://USERNAME@SERVER|LABEL]]\n\
=== Email link with subject\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing USERNAME with the name of the person, SERVER with the name of their server, SUBJECT with the subject of the email, and LABEL with the text you\'d like displayed as a link:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[mailto://USERNAME@SERVER?subject=SUBJECT|LABEL]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
[[mailto://USERNAME@SERVER?subject=SUBJECT|LABEL]]\n\
=== External link (labeled)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing URL with the address of the web page, and LABEL with the text for the link:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[URL|LABEL]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a labeled external link like this one:\x3C/div\x3E\n\
[[http://www.gnu.org/|Click here for GNU]]\n\
=== External link (plain)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing URL with the address of the web page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[URL]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a plain external link like this one:\x3C/div\x3E\n\
[[http://www.gnu.org/]]\n\
=== Image as link\n\
==== Base64 image as link\n\
See the [[WoaS::Help::Images|Images]] page.\n\
==== Image as link to wiki page\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing IMAGENAME with the name of an embedded image page, and PAGENAME with the name of a page in this wiki:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[I\x3C!-- --\x3Enclude:\x3C!-- --\x3E:Image:\x3C!-- --\x3E:IMAGENAME|style="cursor:pointer" oncl\x3C!-- --\x3Eick="go_\x3C!-- --\x3Eto(\'PA\x3C!-- --\x3EGENAME\')"]]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo create an image that links to a page in this wiki.\x3C/div\x3E\n\
==== Image as link to web page\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing Image::IMAGENAME with the name of an embedded image page, and URL with the address of a web page:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[In\x3C!-- --\x3Eclude:\x3C!-- --\x3E:Image:\x3C!-- --\x3E:IMAGENAME|style="cursor:pointer" border="0" onc\x3C!-- --\x3Elick="win\x3C!-- --\x3Edow.o\x3C!-- --\x3Epen(\'URL\')"]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo create an image that links to a web page.\x3C/div\x3E\n\
=== Include link\n\
You can include the contents of another page of this wiki in the current page by using an include link.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing PAGENAME with the name of the page you\'d like to include:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::PAGENAME]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo include the contents of another page in the current page.\x3C/div\x3E\n\
=== Internal action link (labeled)\n\
These are internal wiki actions in the form of links:\x3Cbr\x3E\x3Cbr\x3E\n\
{|\n\
| *Use this code in a page:* || *To create this:*\n\
| {{{[[Special::All Pages|All pages]]}}} || All pages listing\n\
| {{{[[Special::Backlinks|Backlinks]]}}} || Listing of pages linking to page\n\
| {{{[[Special::Dead Pages|Dead links]]}}} || Pages without any link to them\n\
| {{{[[Special::Delete Page|Delete page]]}}} || Delete page prompt\n\
| {{{[[Special::Duplicate Page|Duplicate page]]}}} || Duplicate page\n\
| {{{[[WoaS::CSS::Custom|Custom CSS]]}}} || Custom CSS\n\
| {{{[[Special::Go to|Go to...]]}}} || Go to page prompt\n\
| {{{[[Locked::|Locked pages]]}}} || Listing of encrypted pages\n\
| {{{[[Special::Main Page|Main page]]}}} || Main Page (whatever title it has)\n\
| {{{[[Special::New Page|New page]]}}} || New page prompt\n\
| {{{[[Special::Orphaned Pages|Orphaned pages]]}}} || Orphaned pages listing\n\
| {{{[[Special::Recent Changes|Recent Changes]]}}} || Recently changed pages listing\n\
| {{{[[Special::Search|Search]]}}} || Search into pages interface\n\
| {{{[[Tagged::Syntax|Syntax pages]]}}} || Pages tagged with \'Syntax\'\n\
| {{{[[Tagged::|Tagged pages]]}}} || Pages which contain tags\n\
| {{{[[Unlocked::|Unlocked pages]]}}} || Listing of pages without encryption\n\
| {{{[[Untagged::|Untagged pages]]}}} || Listing of pages without any tag\n\
|}\n\
=== Internal link (labeled)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing PAGENAME with the page you want to link to and LABEL with the link text:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[PAGENAME|LABEL]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a labeled internal link.\x3C/div\x3E\n\
=== Internal link (plain)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing PAGENAME with the page you want to link to:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[PAGENAME]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a plain internal link.\x3C/div\x3E\n\
== HTML links\n\
Below are methods for creating links using HTML syntax.\n\
=== Alert box link (button)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing MESSAGE with the content for the alert, and BUTTONTEXT with the text for your button:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cscript type="text/javascript"\x3E\n\
function alertme () {alert("MESSAGE");}\n\
\x3C/script\x3E\n\
\x3Cinput type=button value="BUTTONTEXT" onClick="alertme()"\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a button that opens an alert.\x3C/div\x3E\n\
=== Alert box link (labeled)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing MESSAGE with the content for the alert, and LABEL with the text for your link:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Ca href=\'javascript:alert("MESSAGE");\'\x3ELABEL\x3C/a\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a labeled text link that opens an alert.\x3C/div\x3E\n\
=== Anchor links to anywhere on a page\n\
With a combination of HTML and wiki syntax, you can create anchor links to anywhere on a page, rather than just to headings.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing NAME with the name of the anchor:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Ca name="NAME"\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3EUse this code somewhere else on the same page, replacing NAME with the anchor name:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[#NAME]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create an anchor link to anywhere on a page.\x3C/div\x3E\n\
\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3EOr use this code somewhere else on the same page, replacing NAME with the anchor name and LABEL with the text for the link:\x3C/div\x3E\x3Cbr\x3E{{{\n\
[[#NAME|LABEL]]\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a labeled anchor link to anywhere on a page.\x3C/div\x3E\n\
=== Edit page link\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing LABEL with the text for your link:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Ca class="woas_link" onclick="woas.ui.edit()" title="Edit this page"\x3ELABEL\x3C/a\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a link that opens the current page in the editor.\x3C/div\x3E\n\
=== External link (button)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing BUTTONTEXT with the text for your button, and URL with the address of the web page:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cinput type="button" value="BUTTONTEXT" onclick="window.open(\'URL\');"\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a button that opens an external link in another tab or window.\x3C/div\x3E\n\
=== Internal link (button)\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing BUTTONTEXT with the text you want on the button and PAGENAME with the page you want to link to:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cinput value="BUTTONTEXT" onclick="woas.go_to(\'PAGENAME\')" type="submit" /\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo create a button that opens an internal link in another tab or window.\x3C/div\x3E\n\
',
'Wiki on a Stick offers various ways to use images in your pages. You can link to image files located on the Internet, network, or local drive, or embed image files into the wiki.\n\
\n\
The [[Image::]] namespace listing displays an image gallery. Each image is displayed on a green background so that you can tell if it contains transparency: if all you can see is a thin green border around the image (using the default CSS) then it is not transparent; if the green background shows through then it is.\n\
\n\
The image currently highlighted will be opened in its own page if clicked. This page shows it on a normal page background and provides info on the image and its use in the wiki.\n\
\n\
The format of both the image gallery and the images can be controlled using [[WoaS::Help::CSS|custom CSS]].\n\
== Standard WoaS syntax\n\
All supported browsers can display embedded images, except for Internet Explorer 6 & 7; IE 6 & 7 may have this capability added in a future version. If you are using a Gecko-based browser like Firefox you can also embed images. This capability will hopefully be added for other browsers in the future.\n\
\n\
Embedded images allow the wiki to be self-contained within a single file, but means that each image takes up 33% more space than its original file size as it is stored with Base64 encoding. Excessive use of images could affect performance, especially on less capable hardware.\n\
=== Embed an image in the wiki\n\
This wiki provides an interface for embedding images. Each image will be given its own page, which you can use in an include link to insert the image anywhere in this wiki.\n\
\x3C\x3C_note It is recommended that the image file extension be retained in the image name. Image export operations will then preserve the extension when writing out the file and that will help those browsers that infer the mime type of the image from the file extension.\x3E\x3E\n\
\x3Cspan class="woas_help_text"\x3EReplace NAME in these instructions with the name of your image:\x3C/span\x3E\n\
\n\
*From the default menu*\n\
# Click the *New Page* link in the menu.\n\
# Type {{{Image::NAME}}} into the box that comes up. This will bring up the image embedding interface.\n\
# Browse to the image on your computer.\n\
# Click the *Embed* button.\n\
*From any page*\n\
# Create an include link for a new image by typing {{{[[Include::Image::NAME]]}}} into a page, or click the editor\'s *Image* button and type in a name for the image.\n\
# Click the *Save* icon in the navigation bar to save the page.\n\
# Part of the include link you just created will be red, indicating that the image doesn\'t exist yet.\n\
# Click on the red part of the link to launch the embedding interface.\n\
# Browse to the image you\'d like to embed.\n\
# Click the *Embed* button. You\'ll be taken to the *Image::NAME* page with your image embedded in it.\n\
=== Use an embedded image\n\
Once an image is embedded, you can use the same include link you used to add the embedded image to include the image anywhere in the wiki. \n\
# Create a new page or open an existing page in the editor by clicking the *Edit* icon in the navigation bar.\n\
# Create an include link for an already embedded image. There are two ways you can do this:\n\
## Use this code wherever you like in a page: {{{[[Include::Image::NAME]]}}}\n\
## Or click the editor\'s *Image* button and type in the name of the image.\n\
# Click the *Save* icon in the navigation bar to save the page. The image should now be where the include link was.\n\
== Using HTML\n\
=== Add an external image from the internet\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing URL with the full link to the image, to add an external image from the internet:\x3C/div\x3E\n\
{{{\n\
\x3Cimg src="URL" /\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3EExample:\x3C/div\x3E\n\
{{{\n\
\x3Cimg src="http://www.gnu.org/graphics/heckert_gnu.small.png" /\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3EResult:\x3C/div\x3E\n\
\n\
\x3Cimg src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJEAAACMCAAAAABZ%2BxS6AAAACXBIWXMAAAsSAAALEgHS3X78AAAAB3RJTUUH1AkZAiQF53xPugAAGFFJREFUeNrNXH9MVHe2%2F1QmS1OSaTrJmOUdZnYWybDsBJgSUXgID62BpayUEvz1RMKqhfW39Wmrr2qtGik1UnWFwKoLq0RXKWgJ9EHUrU83UOFJkUgDD3iwYKA7E9hlwmxmdoac98e9M8zcucMPq%2B1%2B%2F5mZ7733ez%2F3fM%2F3nM8553vnJcY%2FWVPMfNgyOm6xAAHBUKnUPzSi8QdfP%2B6xeHQE6mLiU4Oe%2FVbO%2FuG%2FjluhfFWp0s3wdC%2FJz9poXWNbgCFaF6IKETq%2BdT4d6Wl%2FGpixW%2FdMcIZr73bZVa8tBEz%2FMNmhjF2yMnweiNrK7ryamh7rK4%2Fh6ivjv94bOG88fYVNuoz4aKVLFwZ6vmnt1GVsDJY7mX1aczal1TuE7476hzZm7j6TueFM8yQz28oiEm7z%2FJrtpDb3kU%2Fv2PW12k0dvmf7IBrKpxT3LRsTiEJX7VlKQjNm7mvksX20aUiAa5sToPsJK5qZebLjwqal%2B%2B472NZ83iQc6d2jFYfyaJJZc5acC9q%2FEcDjyoWBgXfaXP0Bhk4AStUgCg4q2g%2F1rE8PGf%2FqyjXNjHNlDQIwfryuYK%2Bi6UrfU6FTtajTDuXuzcKSenyw%2F%2FiamfRodFtb%2Bgk1AGS0e66y8BMxn5%2Bwbtmi7KqtW1SqQu2VNgSE9fTMvPLOjq5UPLgWfTwMFUcVqZ2DQOo3w%2BKxRTFme%2FJ2wHmqZPUphV89ehipvy58uyrOk757cmhogpmZJyfFk86PMbNtiHdkzjJd9dpQ7YY%2FMvOxVZcn2HFhRT1PHFmXFJeUJgyuHRDOypz0p0f1%2BoRuZp7ovn8jQkTk0qih1ubmIYfnhRMfaJtn02hjvfAMvZIDjrXC6PmCsuozx%2BT1qGGb7jM1cCdP%2BJlqABa9BYw%2BaOnsmwKAgDBDVFSYCrAP999pmCpOn23RN717Imv612DPoBUIMRgAc4oZAJCs%2BXFyNFo3%2FrwqSEaP2leHfKYGnMmDAIDwuwBgqalrgy42epEmwDzc0%2FX1uOvsRb%2FYMgev0rT%2FtfSfAhifGP22a1xl%2BDHsXf2qNzcaTHZ8e%2FYeACi%2FUqIlb1m5wgfReKrzi2AAJYXC78KNgKXkoj02PdVjRZm7vwXwmvqnyrmZRmtTe78TQEiQ%2BmdRgj0cbbzZnnw0DLiXAwAoOAw0bNty2Eez87UdzMzNemGKI23MNUbtnl5%2BAa17q77IwSyYudAhZq6hRqlm11MZM3dkC3gyL4%2BxbQ%2FlDvALao8S0kx8O4WIiOKuM%2FMm%2FYg3ItviVQ5m3iSsyhFmnsx2WYIX0iY3GHuZO3YSEdEx5rHIXG9Ep7W9zMwrBNDM7Mg0dvCLbI53jEPMQ0REtI6Z613ztkBwxhfzwgBAWGZqAAcHq6NnU9vx4eHh0WcmZqWGAjteFSgFgPTET5wejO2ifQcAjNoBAEqg9kZ12Ezjjd5p6RqcAgDoYt9aJuF9zrtffj1sgea1sPhUlX9IbxYeFZbsIAAcSm14y7367XFZhwHg7CkAUJYsty7LOjwDnq7iO4YlP9colYD9ac%2BXLaqNWzysgbP2VEBWjC4QFnNf%2B734LfH%2Bhml%2Fuy56cxMA1MUA2Gypdq%2F%2BW1oTM%2FMxIiJaMcBcZJz0rwFjW0OPeBmFkdMRxlvuX0%2FSjNen%2FY2tJmGDXwuyJ5sdB4iIjB3MfJ%2BG3Jq9KZeZuUZY%2BWPMptAZltkfIzb4cBpbkXaP%2BAwVoflj3ip8OeKCn6FGQjuY84mIIpiZF1cwMysAWO%2BdAoAoQZY98TgfnOV3xioO798tfLM%2F7jEDqpCohQh87638jEs6wLm%2F9j8LAGC0fdAeHGUAoNiYWNB%2FXDbCCM6qisYwAGgAIFVwqcx8Wys8n5GIiM7z2AwiuqCtF%2BnuplCRH1DKBRvzZLa%2Bnh3vUFzFCNtqMoUji4%2BZmJknM99xyI7WEemwaYmI3mdmvq13%2Bf7jbXUAgG11AJBcVXLxK3%2Fk%2FuLx0nQAzsrKQc9u3bkYOLd9kTHYCSBgZVSl2U328nYrAWtOyG9kx1t2KiALAIrXALD8%2FG44sABAT4wYIgAADKjL8AeoQgB0L%2FmoFyAMvl0LxW%2FfrOsE4nOCmk4tWe06Yi9f9jkQVNX5oTyizp8pAeApAChDuiEiWiR4%2B3sAoNk12rXcD6CGo0fTAeu7OYPSI1O7LgKlGev3pra0Ve8Navhql5vwjG8vsCLoD3UlciMa2pW7AeDsAwAI6xH1iJo9iOx%2FcSP5WfoPQ08yc28cybYLQmxyPyJpYmQr6Y8Zpw8lmZgf6e%2FLxSlp7EggIoocYuYDOwUvMopgAM4yAEDiLzAYLE%2Fo%2B7akHgRa04flBXj0%2BKEAAImXBsuCS4ttF%2FOmjWb%2Fm32IKdwuc2HwX6EoAIAJCwD1qDBrTgQAUJQGAsCwE1Z5cmjeuOgc0LTe6s8ulI8qACB%2BYzWwpgqleR5OZ6MZWalb7D7XBA4DdQDwngGASkQEwd8ZjgLAYDUgKyJr9o8uKdCSb%2FfvXESumToKIPE966BHDD2cY0VhgKx2t7QAiCkAgCCLC5Eg3zU6APhE%2Fpb2HEuVCj15U7PnWRRBAJAX1BLr6QoPQVF%2Bs0nmqhIACBDW%2BbgLkRkAhjMGAWDchKcy1737TaUG5nXWmQjBhLi4VAAQFG72siHVN6Ap3C8lL0%2BDEA8AbW%2F3uboWAIANgDWrCwDwa9nI%2BXjduWhYc8wzUp5vhY8oqxkArIvGvY4e7kHWG7ucktUSAiGmsVg9EAnCDqrSAIB6O4KHfSbuWvnhVGB%2F10x4VMHiY2rKD%2FUBj3uy7nkr4jY7PhqVWKX%2BMASuAbDoZrQHomDh4cIblgFQmhCOdqllPLCxACis8w%2FHcKqts2HUJPyIL%2BmEZdf2WonO9XwIZXlpq1dfd6zzbBmg%2Fmw6T7YAQKCgAKrdAPpTS6JUn3sP1bor8ThwzcfoKjWipkRdalofjIWGBpeKZ3Wt%2Bvf1H1dXnYrxPL%2FqBgzHd3vOpaVt5d1TU4D5PADAFCCuj4WCejTtAgB7w%2FbVlf%2Bh9rKMYeUKNB3wHDxgSXKMQQn0tY0G6cTQEOs%2BTRSp8JXi4uXQAQhshyGk06XP%2B9XL1%2FQXXJtmJjcMOuHel%2FARAMu%2FiF4k%2B6SQoxBMfi5PROR7GPpeY5KJ%2BWHotFMwbqpx%2BxmvrNYB%2FWUHM%2FMto4s2DtFOZh6pyRcGj%2Bhl3jrNTCYiG8VohOgWM%2B9MEznkzk3M%2FLdc8Z4HmK%2FTBQ9AxgHmh0Koq82%2FNeDNdE578ckLEQlnupn3nHf36K8KnwNbiYgowcSOd3Jdz7N1FbONiCjz6ggz86p8EVHZYiGou72BiOgMMx8g15hXIxIGmG%2FriYi0B3zo7FXy7po4n0lJ109nuyWXvcf17Vao6HQdW5OamZkdB4xDzJN6F2FjjigSEd2nvwiQVhARFU0yO%2FZR%2FgAz966jXBNzhZaIaJM05h5ZG0nkItUdpyf4PjPz2OWE3D1J3S4cIudkl5yTBpgvaNddbr6QkNTLlzO103mqAWoUEU1oa5iZeYeY%2Blp1nbnGSCnZCWSsYR7LJyIy1nvDKVuXnUBERrd0QkPjSMBs23Tm9CZmnixad5Ivh7ovvC3oUj1z774Vcbm%2FszFHiloUaWLmy9oJV0brzbBzAK4cdFuXJsBa12kLNqwMRO3RcQDJ57xDwcKS4KgmAKs%2FdfXcK38AMSi49iC8%2Fxwsq%2FqBm7FN22pd1u%2BTc4K92p7s4hOvCzY1JyxWBax23nTFa2f0NmbuuHUyQZTS9AJqFnKGJyUT1kgJk%2FeJiFo9Oov2pDEzPyky7otoZT5JRGttzEdS3Asz0xUrdDBz75MxQWoUMSGsy%2BvueE38ziYxeUQdbOplZu4VszcfSDXaSI3cLOYQPEPCDma2%2FW7Ph93MtgiitQ5mHiGTO1nuym%2Fqn3Cvnkg0OFTEzHwkwjadG9mQJgzosjiRWqLzzA9FZpotjW0ekZG5mcgoptp7mzsczMwD%2BzwIKxHVDzEzR0wLst5t0zqSPBhxqInZFHqaXREkkJfXEg88rnazdQCFwSEbBYesPKeQRpGIBwYRXq4Bxq81DauUPbG%2FB6BzDrodVCcQcOPO3w%2Fq8Oq0w09PFz2N2SOtmpcOAGcDt3jmIVNfuQk0dcF5zsNTvCwyhFPrJUW3SFVpPMzvxhco4Lz0ID05GLAmn0gF8PjEJRe9PngFsTeB9hjEF08nI4aX%2BXI%2B9X8rgcF%2FO7xlmh8Bh9o%2BB1L37m3zjHhEQDESQPjy1ep44JWq7QqM1yZXrQ8GEJR6BQCix4%2B7zrIBGQBiYJ%2FwSJxoVkrxpGdoKgB8qMnzYqKJ6SeWK4HKFgSbpA9xUPL7QVWdDiIbV7mLGppaIensJkVB2PUrIQ7WGDyuTpUyW4Fi1951OWBRRjhhPQDg9ZanbVLe%2F4Z3%2Fsf%2Bub1apujntFnGAWDjqItnqpAIy73q6os3yj1PTPa%2Bbr%2B6FQDMR1cnSqqi6hO7EtcjGuiyBOm8uOJeya3fmubSACztw%2F1f9kMzMoWm9QDiU1tFnV2Ee2X3pgAEPvB8goWG6dFDnuJX6QcBOHcGfuTFswEgK%2BdoDwC0aOpygAD3VfGSdKQgQpe%2BFb%2Bec%2FBiPzD8clT8RQsAHG1xGX6U3J0CAPvBG54DrHbLECd0OmVYqRMoaSlX%2BiDC4UV5ZgABDeExwHvu7gJZFuviptVuSl5YXdcHAJoYcdrCFgX8qQAA3gio9rx0jRqAUoOjyoD4gwZArcDnpz6KkatmjSxeJRAXh36fLZQWbyCtlhLkUwCu5HOctugvJhetcrEA16f2SBwRUe%2FJOAmDIaLr1NyYxtwscMUjfqpZT%2FSZQiktd4zXhnbk0wdE5%2BXz46vELxsSJnlCS0S0j1nKVs5rQ4mI%2FsLeaUDOJqJHW5td0Cu0Bxz%2B6rQP9UkDzMxjzOevc3ZKPWnHZBE1u2Q0ZNzk4GNEpH%2FEvT4p%2BVwioiOOh42SUrCeqGLsichidtDpGSrHHcZIkc1MMm%2FoPUm58pN2%2BkP36Gmrmrlm37FudhxzdEtOm4hb1dzdmhD5RNJfQ7RTZAPXjYtvz1jLHkmjrS7hP%2BFsqpFHlFkxnYr9XULmmVvNzVfXPuQyH1lqUyIpdKfP9TsodIKZe88sDT0yMXMtG85zZxUZecKKd4ajUzZPMhpb5xmIDbYPDr8cnq525lVJzywsMSS%2FuaZTmkW0b2vK0nV1jqrXyNQNffAP7NFSSlGzjbmDNsiL6DxNyHUXnfStx6QcY15R79ufRpTy4X25DC7kEt9FSUTalK25VCFf9lkcKbf%2BLlyWucEjbTefXOe7VaGe%2FNXuIN89cHnnCi3RkOzB65Qy96rVgTRuJqMPWBM9mh8iZmbHUqN80TyOsueOaCziqk2fHbpCahq0ZX4uWDBDykzzsmx%2F2fB86miqguP2jNgmZUald3%2F0FX%2FZsRkeLztOtuwbmrQvYR7FxonQottJ7CjTrmr1yhtrEzasG5vfrHGaHKLJFdT8RGubB6QP9A9pgvlJGqVd8ChsNa6NoxvzQzSgTZPp3UofMKfcnweiAe0mGmJmR022loxF04bjDD2ROd3%2FPjbngalE397CuvDDQE5dop%2FNYXXtFqjDohI9bKJuzTWYNYAiK8veXVdetT4%2B%2BBUAPbV1bxvmpUf7KNe3GnFBCNEcv5QtVAzla8mYnZ0ZSUZP92OK9Mj%2BjLzvKk8sPeOY1%2BpvpiTfC4pIzFV1nJStlunPCPsInuyg%2FAlP95Y0ycwD9YL62YaGhoaGxuZrj4roso9Sb6UVLtWsMflesiL04bTeRsR5%2BI5G%2FdI9G4xESU9mVzu%2FiPaISSUPESTQhunJ8jW5j%2Bjk7RUUeUQQ7cg6yp42%2BU%2ByKWLD1asrZt2zNAOiVUkSs39AS%2BSYaagKOqKNKLp%2F%2FoJ7z2CoVMyTmRueGVENbfX82ft%2BKOmJZhzqDBFdFciey51G7pM8w%2FXQWS2Z%2FOq3FpfDHa3au1oaOhG0%2FfWNM%2FuLMAA6wNz8j4AYIUJLX5KzrdTrDgZ796ybP2RXcRJliia%2F%2BViKlogijph4bJZZm4yI1E9wt56IaIe4kib3ZXpR3SF%2FrHRmGdlz%2Bt8UHq1vVycQaFiyLDEQUKnGB2faTBK0vaE6CHesgNJ%2Bs%2FMzNQAEneq6FpzjSURn3foih%2BhG%2F%2FpCBQB05ZgRMPWeK4gMb2mXIrKWjGqiXOmOgm4AMQBif3O6cmeVMLRBYpftsyGSYyNNykJFz5UGc2WWeXtnNFTTitLic%2Bq5mAx3%2FkXx6d%2BB%2BO0BiFF%2BVNpyRe52TxH8LDJqD%2F9ToZAuKDgIj5Ka2lVB88gxpXqqu0IN4OB2uxpI33vpV7LRefizyGiqPac7Jt0ApL83XTMFAPxYemrGJcAyLJaDRAqmVAPA9qB2mT1UleqoZ5HR0XNRB3XAOFQArJ6IfEQeCCCw88ZUeRDQN%2BiZP1Ns7orxMSqbzccVeJbV79mI3Ib%2FtCQe9iBlW5kn3pEYA5%2BUwWQmveOY1WYvmJ0pB06njhr8UOzDX9%2FBjbckxkCaiRvPa8sonV1Ec5CR21%2F26knrx8DdSrD5sKm%2FSSK0SDo2F8q5YB5hRVhP3tQd%2BUNvBZVZpAH5q167bzYX2M8dnstd5oMISIbFz5FtxTPtZ3%2F87r81RdVm4TkhMns6U38bjtM1fo3x4NnUjM6VWGSY42PPNq168iBZk5Tv77zr5IeMTTR3jDDz%2B1Q2t9BlVkRx5JnZCE3wt3wdCQkzrmxHLuVPPhfNVnvOGkIG179bIW9qTwyem9EU%2F%2F7ivW3PRY9C4LlFLBot1Ycvymt9%2BtkZd3HgF6vvmp8HojAMeJrChvK34UcWhaqC8Zk3tMP5PDS7niTpKxuRH658X%2FKehUTDT2vnlHZ6abY36kZj0ebtYGNHdRrd5jDZ%2FaRRpV6%2Bw9TS1j%2FyD7yiekXV%2F3hKPfN%2BZtl3auRa3NMSb49V8bEVSL0kd%2B6VQ0hPjl4kMOKulpZ%2BL5N1Yk7v5M2O6EBVzse%2BKdjkKvkNzoUtADRqmEemAJ1BFwiYx0dHR1GQp5mbgZwd0YP1IV9JncIWU%2FUSfxb6TkvfUztUi6Jfj1%2Fo7i0u%2FkaJ52Sz2RFJ0lz%2BYj%2FlEv%2Btkeb81sDsfk2xGo1SbUc65tdC8Pe5njoHT7sR1ZIeHbrwwtocEOneGLwnKd3iUNv8btMH9XNEhB2QuLItKvPbb5fU9s0d0V1l2FxPnQPvRWzi3S4vcqOpvtjX2QaIoa%2FfZjGZLRYgJHj4Tuqcwb80l7ege1L%2B9Zq0rysVwJu%2F9ePB%2Bga%2FGex7Op1DV36he54yQnjepTvSvQxKAPiiMk%2FGILV1edCF4Kjw4JdfiVc9XxnBujLgrrRGdm10vNai%2FhoQXwoV29k%2FeEVQlSvnvdjmZrbuaz%2BU6b0tZN0ca23eoaOWKKVxcuBqxNzioXmyWnc8%2B0eZUJaWMrNtK4149%2FeeueVgZo7Q214cIs6NGJF2lRGdZMfpCAqVv8REK%2FgFIppMSpuU5uApcoLfF194k8330jO8JDjnCDLoM4tkc%2FUVIEOJmwCGK%2FpqD8kw1uLA48%2FgRuZRAzJ%2BIKkK0C9drwYJ71d6MgZR%2B7pfnIwAXXVTsZcvUePrQ04xZ5Yq4WOjrQCQjgcvwtNOhyXXPvd0cKrKIFRmBcqkHQDgawB4xW%2Be4DllIsI%2Bq%2FbMd0bfCEb7XWGz0og0Bdot7PcLebGIoK5ubfCEdDcdAHbrgHuSXFejAmY8PqRc%2FiI1W6x%2B1EvzVJRiMhKleW2T6NBeHtl0W0%2F1L9AeTVPmL73N4Fqixhryrp09MmoHMiN89iu%2FIEQ85L3QHb%2BktY4EItKeFMU0cUxLS%2BOI9kw8AyB%2B6bv%2FS8zmpqCe1tVTAALLVwKWi8IWu4DS9GcabsF3xeMsb0IUlpQGALBbgTvLioUVH%2FZsgL4zohvxxxF4CEivBICFaN3syo%2F0dP0giB7vHVWtvhsNCBGUBcXTe2D3O38IRP%2BL452f6gBcqxMKMX%2BePta5zfkDIHodQvHDIjj5WqtnLeeLjHY4HwNm5%2FeIKGyvsOX4mgVRAMzv%2FtrzaGdGiO4U%2BioU36dm7xp%2FDAAPsP09APjiE0l5Sbm%2FeP3GeY2o%2BI6IFL9pFWKl%2FaMBUwB6pEFUlvMPwd%2BvPcISAMiCRbNb7uhTZ2n8%2FMYLOPpcEhqhE08SYv%2FPLSCl0%2BUK1JeXf79rzd0%2BUvUpTi2D8CcTUNWJeYLEuiXzHek5yQiICfzRjzL%2F3I31if%2FD%2BNtPihe0TwGa5d0tpp%2FOT1dfer7%2Fx1b5ifXjZdX3Hk%2B9sUP35TfDdvXPlhnmOcRzRoTx2i7N%2BmDnoPnpT5Y82wgv%2FdP9Z92CfzZA%2BH8h6HFxmnJRXwAAAABJRU5ErkJggg%3D%3D" /\x3E\n\
=== Add a local image from your hard drive\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing PATH with the full path to the local file you\'d like to display:\x3C/div\x3E\n\
{{{\n\
\x3Cimg src="file://PATH" /\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3ETo add a local image from your hard drive.\x3C/div\x3E\n\
\n\
* *Linux example using a default Kubuntu image:*{{{\n\
\x3Cimg src="file:///usr/share/icons/default.kde/16x16/actions/stop.png" /\x3E\n\
}}}\n\
* *Windows example using a default Windows 7 image:*{{{\n\
\x3Cimg src="file://localhost/C:/Documents and Settings/All Users/Documents/My Pictures/Sample Pictures/Blue hills.jpg" /\x3E\n\
}}}\n\
=== Use a data:URI image\n\
It is always better and advisable to embed an image instead of using a data:URI image, mostly because embedded images can be reused inside the wiki and do not garble the edit window when editing the page.\n\
\n\
However if you want to use a data:URI image anyway you can do it by directly adding this XHTML snippet:\n\
{{{\n\
\x3Cimg src="data:image/EXTENSION;ENCODING,ENCODED_IMAGE" /\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3EExample:\x3C/div\x3E\n\
{{{\n\
\x3Cimg src="data:image/png;base64,R0lGODlhBgAFAIABAAAAAP///yH5BAEAAAEALAAAAAAGAAUAAAIJDGJ4ic1qgAwFADs=" /\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3EResult:\x3C/div\x3E\n\
\x3Cimg src="data:image/png;base64,R0lGODlhBgAFAIABAAAAAP///yH5BAEAAAEALAAAAAAGAAUAAAIJDGJ4ic1qgAwFADs=" /\x3E\n\
\n\
A famous online service to create such URIs is [[http://software.hixie.ch/utilities/cgi/data/data|The data: URI kitchen]]. The recommended encoding to be used in WoaS is base64.\n\
=== Create a data:URI image button\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing YOUR_MESSAGE with the message to be displayed and DATA_URI_GOES_HERE with the data:URI of your image:\x3C/div\x3E\n\
{{{\n\
\x3Cinput type="image" onclick=\'alert("YOUR_MESSAGE")\' src="DATA_URI_GOES_HERE"\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3EExample:\x3C/div\x3E\n\
{{{\n\
\x3Cinput type="image" onclick=\'alert("Hello world!")\' src="data:image/png;base64,R0lGODlhBgAFAIABAAAAAP///yH5BAEAAAEALAAAAAAGAAUAAAIJDGJ4ic1qgAwFADs=" /\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3EResult:\x3C/div\x3E\n\
\x3Cinput type="image" onclick=\'alert("Hello world!")\' src="data:image/png;base64,R0lGODlhBgAFAIABAAAAAP///yH5BAEAAAEALAAAAAAGAAUAAAIJDGJ4ic1qgAwFADs=" /\x3E\n\
',
'== Importing a WoaS XHTML wiki\n\
Another Wiki on a Stick can be imported into the current wiki by using the Special::[[WoaS::Help::Special::Import|Import]] page. \x3C\x3C_note To import a version 0.9.6B or earlier WoaS file you will need a WoaS 0.11.x release as this WoaS cannot import it.\x3E\x3E\n\
Help pages and the WoaS JavaScript code are not imported so it is always best to import an older wiki into a current one as this will also update the older wiki.\n\
# Access [[Special::Import]] either directly or from [[Special::Advanced#Maintenance]]\n\
# Click the *Browse* button and select the wiki you\'d like to import\n\
# Choose the settings you\'d like to use.\x3C\x3C_note If you are importing WoaS \x3C 0.12.0 it is much better to import CSS manually and not automatically because CSS definitions have changed\x3E\x3E\n\
# Click the *Import* button.\n\
# A warning will pop up letting you know that this will overwrite pages with the same title and asking if you\'re sure.\n\
# Click the *OK* button if you\'re sure. Otherwise, click the *Cancel* button.\n\
== Importing WSIF\n\
This method is used to import pages that have been exported using the WSIF format (see the [[WoaS::Help::WSIF|WSIF]] page for more information). Help pages are not imported so it is always best to import WSIF content into a current WoaS file.\n\
# Access [[Special::ImportWSIF]] either directly or from [[Special::Advanced#Maintenance]]\n\
# Click the *Browse* button and select the .wsif file to import\n\
# Choose the options to use\n\
# Click the *Import WSIF* button\n\
',
'\x3Cinput class="woas_template_search" type="text" size="19" onfocus="woas.ui.search_focus(this, true)" onblur="woas.ui.blur_textbox()" /\x3E&nbsp;\x3Cinput class="woas_button woas_template_search" type="button" value="Search" onclick="woas.do_search()" /\x3E\n\
',
'== Exporting into XHTML static pages\n\
/See: [[WoaS::Help::Special::Export|Special::Export]] for a more detailed explanation./\n\
\n\
Your WoaS pages can be exported into web-compatible XHTML and CSS generated pages that do not use JavaScript for rendering and can be efficiently cached by web servers. Images can be embedded within the page (as Woas normally does) or saved as linked files, though Woas currently can\'t save binary images on most browsers and will only create the links within the page; you can then go to the [[Image::|Image Gallery]] and use your browser\'s image saving capabilities.\n\
# Access [[Special::Export]] either directly or from the [[Special::Advanced#Wiki maintenance|Wiki maintenance section]] of the [[WoaS::Help::Special::Advanced|Special::Advanced]] page (the /Tools/ icon)\n\
# Modify the export directory if necessary\n\
# Uncheck the /Embed Images/ box if you will be using the files from a server or viewing files with an Internet Explorer browser older than version 9 (/if your browser can\'t export binary files you will need to export the images manually/)\n\
# Choose the settings for the export.\x3C\x3C_note The /Run before exporting but do not export the JavaScript/ option means that JavaScript is run and then the XHTML is exported, but the JavaScript source code itself is not. This is useful if you have JavaScript that does custom parsing.\x3E\x3E\n\
# Click the *Export XHTML* button. A confirmation will pop up\n\
== Exporting into WSIF\n\
/See: [[WoaS::Help::Special::ExportWSIF|Special::ExportWSIF]] for a more detailed explanation./\n\
# Access [[Special::ExportWSIF]] either directly or from the [[Special::Advanced#Wiki maintenance|Wiki maintenance section]] of the [[WoaS::Help::Special::Advanced|Special::Advanced]] page (the /Tools/ icon)\n\
# Modify the export directory if necessary\n\
# Choose the settings for the export.\x3C\x3C_note Note that you can export into a single WSIF file or multiple WSIF files. Embedded files are exported as individual files unless you choose not to export them as external file blobs, in which case they\'ll be embedded in the WSIF file(s).\x3E\x3E\n\
# Click the *Export WSIF* button. A confirmation will pop up, telling you how many pages were exported\n\
\n\
The WSIF file(s) in the export directory can now be copied, shared, or stored for backup purposes. See also [[WoaS::Help::WSIF|WSIF]].\n\
',
'\x3Cbig style="color:#0A0"\x3E%1 had a little %2\x3C/big\x3E\n\
',
'[[Special::TOC]]\n\
Transclusion is the name wikis use to describe [[WoaS::Help::Include wiki page|including a wiki page]] inside another wiki page. WoaS can do something much more powerful than simple transclusion: instead of just displaying the contents of the included page as is, you can change how the content is displayed using variables.\n\
\n\
This method requires that you create a page to be used as a template. The template page must contain variables represented by %1, %2, %3, and so on. The examples below use the [[WoaS::Help::Template transclusion::Example]] page which contains two variables. The contents of that page are:\n\
{{{\n\
\x3Cbig style="color:#0A0"\x3E%1 had a little %2\x3C/big\x3E\n\
}}}\n\
You can then create a transclusion link or links to that page by creating a normal include link with the values for the variables added after the page name, or by using the built-in [[#The _include macro|_include macro]].\n\
\\\n\
= The {{{Include::}}} link\n\
Each value must be preceded by a pipe ({{{|value}}}). The values you define in the link will be used from left to right to replace the numbered variables on the page you\'re transcluding.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code, replacing PAGENAME with the name of the page to be included, and VALUE1 and VALUE2 with the values you\'d like the two variables to have when the included page is displayed:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::PAGENAME|VALUE1|VALUE2|VALUE3]\x3C!-- --\x3E]\x3C/div\x3E\n\
== Examples\n\
\x3Cdiv class="woas_help_text"\x3EThis code:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::WoaS::Help::Template transclusion::Example|Mary|lamb]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3EResults in this transclusion:\x3C/div\x3E\n\
[[Include::WoaS::Help::Template transclusion::Example|Mary|lamb]]\n\
\x3Cdiv class="woas_help_text"\x3EWhile this code:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::WoaS::Help::Template transclusion::Example|Fred|snack]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3EResults in this transclusion:\x3C/div\x3E\n\
[[Include::WoaS::Help::Template transclusion::Example|Fred|snack]]\n\
\x3Cdiv class="woas_help_text"\x3EIf an unneeded parameter is supplied:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::WoaS::Help::Template transclusion::Example|Bob|Jane|Jack]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3EThe extra parameter is simply ignored:\x3C/div\x3E\n\
[[Include::WoaS::Help::Template transclusion::Example|Bob|Jane|Jack]]\n\
\x3Cdiv class="woas_help_text"\x3EIf a needed parameter is not supplied:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::WoaS::Help::Template transclusion::Example|Mary]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3EThe missing parameter shows up in the transclusion (note the {{{%2}}}):\x3C/div\x3E\n\
[[Include::WoaS::Help::Template transclusion::Example|Mary]]\n\
\\\n\
== Wiki and HTML code in transclusion\n\
\\\n\
Some wiki code and HTML tags are accepted in the values.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code:\x3C/div\x3E\n\
\x3Cdiv class="woas_help_code"\x3E[\x3C!-- --\x3E[Include::WoaS::Help::Template transclusion::Example|&#042;Mary&#042;|&#042;lamb&#042;.&lt;br&gt;&lt;br&gt;Its &#047;fleece&#047; was white as &#095;snow&#095;.]\x3C!-- --\x3E]\x3C/div\x3E\n\
\x3Cdiv class="woas_help_text"\x3ETo create this:\x3C/div\x3E\n\
[[Include::WoaS::Help::Template transclusion::Example|*Mary*|*lamb*.\x3Cbr\x3E\x3Cbr\x3EIts /fleece/ was white as _snow_.]]\n\
\\\n\
= The {{{_include}}} macro\n\
\\\n\
Woas includes a macro that allows you to use values that are difficult or impossible to use in a transclusion link. This includes strings that contain illegal link characters, such as \'|\' and \']\'\n\
== Example\n\
Everything works as with the {{{Include::}}} link above, except that each transclusion value is on a new line in the macro call. The macro call below generates the output shown below it:\n\
\x3C\x3C+_include WoaS::Help::Template transclusion::Example\n\
Mary [it was her]\n\
lamb | dog | pig (not sure which it was)\n\
\x3E\x3E\n\
The next example will only work if you still have the images included in the Woas project\'s download file (and you\'re not using [[WoaS::Help::Requirements & saving|an ancient version of IE]]):\n\
\x3C\x3C+_include WoaS::Help::Template transclusion::Example\n\
\x3Cspan style="font-size:48px"\x3E[[Include::Image::transparency.png|style="height:48px;width:48px"]]\n\
[[Include::Image::test.png|style="height:48px;width:48px"]]\x3C/span\x3E\n\
\x3E\x3E\n\
\\\n\
= Infinite recursion\n\
\\\n\
Infinite recursion happens when you create an include link to the current page or to another page that that has an include link to the current page. The included page will be repeated multiple times followed by the include link itself being displayed in bold red text surrounded by infinity symbols like this:\n\
\n\
\x3Cfont color="red"\x3E*{{{\u221e [[Include::PAGENAME]] \u221e}}}*\x3C/font\x3E\n\
\n\
You should always prevent infinite recursions from happening.\n\
',
'= Special::ExportWSIF\n\
The [[Special::ExportWSIF]] page allows you to export wiki content into one or more [[WoaS::Help::WSIF|WSIF]] files for backup, sharing with others, or importing into an updated WoaS file.\n\
== File generation options\n\
===Relative path for WSIF file, including filename\n\
The box contains a default path and filename when the page is loaded. This is the relative path and name of the file for the exported WSIF file. A relative path is one that starts in the same directory the WoaS file is in; {{{temp/file.wsif}}} is a relative path, {{{/temp/file.wsif}}} is not; {{{c:\\temp\\file.wsif}}} and {{{c:temp\\file.wsif}}} are also incorrect. The file name can have any extension or none at all, but the /wsif/ extension will let you know that it\'s a WoaS data source file. The path may be entered in Windows or UNIX format, but will be converted to the correct format upon entry.\n\
\n\
If just a filename is entered the file will be created inside the directory the WoaS file is in. The path can additionally specify a directory path relative to the location of the wiki. WoaS will create the specified subdirectory only if you are using a Gecko-based browser like Firefox. If you are using a different browser you must create the subdirectory yourself before saving the file.\n\
\x3C\x3C_note If you enter the name of an existing file that file will be overwritten on the next save; any associated files will also be overwritten if /multiple files/ mode is selected.\x3E\x3E\n\
The filename will be used as the index page name when exporting to multiple files.\n\
===Export as multiple WSIF files (instead of saving all pages to a single wsif file)\n\
If the box is checked, the content of all the user pages will be exported into multiple WSIF files, with each page being exported into its own WSIF file. All the files will be numbered using the wiki\'s page numbering method, and an index.wsif file will be created in the same directory to act as a reference for which page is in which numbered file. If the box is not checked, the content of all the user pages in the wiki will be exported into one WSIF file.\n\
===Include ALL pages from this WoaS (instead of only user created pages)\n\
If the box is checked, all wiki pages will be exported. If the box is not checked, only user-created pages will be exported.\n\
== Other options\n\
===Author\n\
If you type a name into this box, a *woas.author:* line will be added near the top of the WSIF file to display the name you typed as the author of the file. If nothing is in the box, the *woas.author:* line will not be added to the WSIF file.\n\
',
'The [[Special::ImportWSIF]] page allows one to import a [[WoaS::Help::WSIF|WSIF]] file which contains one or more wiki pages; wiki pages imported into the *WoaS::* namespace will offer special features.\n\
== Existing pages\n\
Available options for imported pages whose title collides with existing page titles:\n\
* *Erase all user pages before import process*\n\
* *Ignore* - do not import colliding pages\n\
* *Overwrite* - replace existing page with imported page\n\
* *Ask before overwrite* - ask for each colliding page before replacing\n\
== Security\n\
General JavaScript security options to prevent possibly malicious code from being imported.\n\
* *Comment JavaScript tags*: convert all {{{\x3Cscript ...\x3E...\x3C/script\x3E}}} tags to {{{\x3Cdisabled_script ...\x3E...\x3C/disabled_script\x3E}}}\n\
* *Comment macro definition/call*: comment all macro definitions/calls {{{\x3C\x3C\x3C...\x3E\x3E\x3E}}} so that they are not parsed/called\n\
* *Import pages of the WoaS:: namespace*: allow importing hotkeys, plugins, aliases and custom CSS\n\
\n\
*Note:* if you have enabled some JavaScript code by mistake you should enable *safe mode* in [[Special::Options]]\n\
',
'/******************************\n\
| CRITICAL LAYOUT/DISPLAY CSS |\n\
| IS AT END OF CSS TO PROTECT |\n\
| IT. --KEEP CSS RESET HERE-- |\n\
******************************/\n\
\n\
/* a quick browser CSS reset - consider \'* {\' as better suited */\n\
\n\
body, div, textarea, pre, ul, ol, li {\n\
	margin: 0;\n\
	padding: 0;\n\
	border-width: 0\n\
}\n\
\n\
/****************\n\
| WOAS STYLING  |\n\
| SAFE TO ALTER |\n\
****************/\n\
\n\
/*\n\
	All measures except borders in em because IE6 doesn\'t resize pixel measures properly\n\
	and IE9 giving some border errors with em measures; exception is 0px.\n\
*/\n\
\n\
/* _BROWSER RESET VALUES */\n\
\n\
ul, ol {\n\
	margin: .75em 0 .75em 20px; /* px needed for IE resize; strange */\n\
}\n\
li {\n\
	padding-bottom: .125em\n\
}\n\
li ul, li ol {\n\
	margin: .125em 0 0 1.25em\n\
}\n\
/* could also add values for these reset items if needed\n\
div {\n\
}\n\
\n\
pre {\n\
}\n\
*/\n\
\n\
/* BACKGROUND */\n\
\n\
.woas_background, body {\n\
	background-color: #335; /* no color name */\n\
}\n\
\n\
/* BODY */\n\
\n\
body {\n\
	word-wrap: break-word;\n\
	font-family: Georgia, verdana;\n\
	font-size: 1em; /* for early Opera; much bigger text without */\n\
	text-align: left\n\
}\n\
\n\
/* BUTTONS */\n\
\n\
.woas_button, .woas_button_top, .woas_button_editor,\n\
.woas_button_menu, .woas_button_ro {\n\
	background-color: #F0F0F5; /* matches header */\n\
	border: 1px solid #808080; /* grey */\n\
	color: #00008b; /* darkblue */\n\
	cursor: pointer;\n\
	font-variant: normal;\n\
	margin-top: .438em;\n\
	text-align: center\n\
}\n\
.woas_button:hover, .woas_button_top:hover, .woas_button_editor:hover,\n\
.woas_button_menu:hover, .woas_button_ro:hover {\n\
	background-color: #A9A9A9; /* darkgrey */\n\
}\n\
.woas_button_editor {\n\
	margin: .25em 0px 0px 0px;\n\
	padding-left: .188em;\n\
	padding-right: .188em;\n\
}\n\
.woas_button_top {\n\
	position: relative;\n\
	float: right;\n\
	margin: 0\n\
}\n\
.woas_button_ro {\n\
	margin-left: -1.25em;\n\
	background-color: #FFF0F0\n\
}\n\
.woas_button_menu {\n\
	margin-top: 0.438em;\n\
	width: 100%\n\
}\n\
\n\
/* CONTENT */\n\
\n\
/* sets padding around page/menu/editor/footer */\n\
#woas_content {\n\
	padding: .75em\n\
}\n\
.woas_edit #woas_content {\n\
	padding-top: 0px\n\
}\n\
#woas_edit_content {\n\
padding: .75em .75em 0px\n\
}\n\
\n\
/* DEBUG CONSOLE */\n\
\n\
#woas_debug_log_container {\n\
	border: 1px solid #000; /* black */\n\
	background-color: #F0F0F5; /* matches header */\n\
	margin-top: .375em; /* matches woas_footer padding-bottom */\n\
	padding: .25em 0 0.2em .25em;\n\
	_border: none; /* these 2 fix IE6 */\n\
	_padding: .25em 0px\n\
}\n\
\n\
/* textarea cannot contain padding/margins for cross-browser */\n\
#woas_debug_log {\n\
	width: 100%;\n\
	background-color: #F0F0F5; /* matches header */\n\
	resize: vertical;\n\
	overflow: auto;\n\
	overflow-x: hidden; /* for IE (9+ too?) */\n\
}\n\
#woas_debug_log_clear {\n\
	margin: .375em 0px 0px\n\
}\n\
\n\
/* EDITOR */\n\
\n\
/* no margins/padding/borders/width/height in woas_editor textarea */\n\
#woas_editor {\n\
	font-size: 100%;\n\
	background-color: #fff; /* white */\n\
}\n\
/* no padding in woas_editor_container; other formatting allowed */\n\
#woas_editor_container {\n\
}\n\
#woas_edit_controls {\n\
	margin-bottom: 0.5em;\n\
}\n\
.woas_edit_link, #woas_edit_wrap{\n\
	color: #F0F0F5; /* same as header */\n\
}\n\
\n\
/* EXPORT (at end of CSS) */\n\
\n\
/* FOOTER */\n\
\n\
#woas_footer {\n\
	border: 1px solid #F0F0F5; /* same as header */\n\
	padding: .375em\n\
}\n\
#woas_footer a {\n\
	font-size: .688em;\n\
	font-weight: bold;\n\
	color: #F0F0F5; /* same as header */\n\
}\n\
#woas_footer_panel {\n\
	position: relative;\n\
	width: 100%;\n\
	line-height: 1em\n\
}\n\
#woas_about, #woas_debug, #woas_top {\n\
	position: absolute\n\
}\n\
#woas_about {\n\
	width: 100%;\n\
	text-align: center\n\
}\n\
/* the debug toggle button */\n\
#woas_debug {\n\
	left: 0px\n\
}\n\
#woas_top {\n\
	right: 0px\n\
}\n\
\n\
/* HEADINGS */\n\
\n\
/* (PVHL: do we really need woas_heading style? Not using so x-browser better) */\n\
h1, h2, h3, h4, h5, h6 {\n\
	margin: .75em 0px .325em;\n\
	padding: 0px;\n\
	overflow: hidden\n\
}\n\
/* this misses IE6 */\n\
h1:first-child, #woas_toc + h1, .woas_top + h1, h2:first-child, #woas_toc + h2,\n\
h3:first-child, #woas_toc + h3, h1 + h2, h2 + h3, h3 + h4 {\n\
	margin-top: 0px\n\
}\n\
h1 {\n\
	font-size: 1.438em\n\
}\n\
h2 {\n\
	font-size: 1.25em\n\
}\n\
h3 {\n\
	font-size: 1.063em\n\
}\n\
h4 {\n\
	font-size: 0.875em\n\
}\n\
h5 {\n\
	font-size: 0.75em\n\
}\n\
h6 {\n\
	font-size: 0.625em\n\
}\n\
\n\
/* HELP PAGES */\n\
\n\
/*\n\
next three are for layout; no changes allowed except colors;\n\
wraps cannot contain margins, padding, or borders\n\
*/\n\
.woas_help {\n\
	height: 100%;\n\
	width: 100%;\n\
	overflow: hidden;\n\
	background-color: #fff; /* white */\n\
}\n\
#woas_help_body_wrap {\n\
	position: relative; /* fixes section positioning */\n\
	width: 100%;\n\
	overflow: auto;\n\
	overflow-x: hidden;\n\
}\n\
\n\
/* end of Help layout CSS; rest can be styled */\n\
\n\
#woas_help_body {\n\
	background-color: #FFF; /* white */\n\
	padding: 1em\n\
}\n\
#woas_help_body ol li {\n\
	margin-bottom: .5em\n\
}\n\
#woas_help_top {\n\
	background-color: #335; /* matches wiki background */\n\
	color: #F0F0F5; /* matches wiki header */\n\
	font-family: Arial Black, Gadget, sans-serif;\n\
	font-size: 1.5em;\n\
	padding: .625em .625em 1em\n\
}\n\
.woas_help h3 {\n\
	margin-bottom: .188em\n\
}\n\
/*\n\
explicit margins are needed for IE6/7 otherwise collapsed under certain circumstances.\n\
*/\n\
.woas_help h1 {\n\
	margin: .5em 0px .25em\n\
}\n\
.woas_help_button {\n\
	float: right;\n\
	margin-left: .625em;\n\
	background-color: #F0F0F5; /* matches background */\n\
	border: 1px solid #808080; /* grey */\n\
	color: #00008b; /* darkblue */\n\
	cursor: pointer\n\
}\n\
.woas_help_button:hover {\n\
	background-color: #A9A9A9; /* darkgrey */\n\
}\n\
.woas_help_code {\n\
	font-family: monospace;\n\
	padding: 0.5em\n\
}\n\
.woas_help_text {\n\
	font-family: lucida;\n\
	color: #048db4;\n\
	font-weight: bold\n\
}\n\
.woas_help_div {\n\
	margin: 1em 0;\n\
}\n\
\n\
/* HIGHLIGHT MACRO */\n\
.woas_hl_div {\n\
	background-color: yellow; /* default */\n\
	padding: .25em .325em\n\
}\n\
.woas_hl_span {\n\
	background-color: yellow; /* default */\n\
	padding: 0 1px 1px;\n\
}\n\
\n\
/* IMAGE GALLERY (IE6 does not like multiple styles) */\n\
\n\
a.woas_img_list, .woas_img_list_first, .woas_img_list_last,\n\
.woas_img_list_single, .woas_img_list_error {\n\
	display: block;\n\
	padding-bottom: .75em;\n\
	padding-top: 1em;\n\
	text-decoration: none; /* here for export (simpler) */\n\
}\n\
a.woas_img_list:hover, .woas_img_list_first:hover, .woas_img_list_last:hover,\n\
.woas_img_list_single:hover, .woas_img_list_error {\n\
	background-color: #efe;\n\
	margin-left: -1em; /* all same as woas_page padding */\n\
	margin-right: -1em;\n\
	padding-left: 1em;\n\
	padding-right: 1em;\n\
	text-decoration: none;\n\
}\n\
.woas_img_list_error, .woas_img_list_error:hover {\n\
	background-color: #fee;\n\
}\n\
.woas_img_list_last {\n\
	padding-bottom: 0em;\n\
}\n\
.woas_img_list_last:hover, .woas_img_list_last.woas_img_list_error {\n\
	margin-bottom: -1em; /* all same as woas_page padding */\n\
	padding-bottom: 1em;\n\
}\n\
.woas_img_list_first {\n\
	padding-top: 0em;\n\
}\n\
.woas_img_list_first:hover, .woas_img_list_first.woas_img_list_error {\n\
	margin-top: -1em; /* all same as woas_page padding */\n\
	padding-top: 1em;\n\
}\n\
img.woas_img_list {\n\
	display: block;\n\
	margin-bottom: .625em;\n\
	padding: .5em;\n\
	background-color: #afa\n\
}\n\
\n\
/* INPUT LAYOUT */\n\
\n\
.woas_input_w90 {\n\
	width: 90%;\n\
	border: 1px dotted #99a\n\
}\n\
.woas_input_wrap {\n\
	margin-top: .75em;\n\
	padding: .625em .625em .625em 1.875em;\n\
	border: 1px solid #99a;\n\
	text-align: left\n\
}\n\
.woas_input_wrap legend {\n\
	font-size: 1.188em;\n\
	font-weight: bold\n\
}\n\
.woas_input_wrap label input, .woas_input_wrap label select {\n\
	margin: 0px .434em .313em -1.25em\n\
}\n\
.woas_input_wrap label input {\n\
	vertical-align: -0.063em\n\
}\n\
.woas_input_wrap .woas_input_wrap_inline {\n\
	margin-left: .625em\n\
}\n\
.woas_input_wrap .woas_input_wrap_no_left {\n\
	margin-left: 0px\n\
}\n\
.woas_input_wrap .woas_input_wrap_left {\n\
	margin: 0px 0px .313em -1.25em\n\
}\n\
\n\
/* LAST MODIFIED TIMESTAMP */\n\
\n\
#woas_mts {\n\
	margin-bottom: 0.75em;\n\
	color: #F0F0F5; /* same as header */\n\
	font-size: small;\n\
}\n\
\n\
/* LINKS */\n\
\n\
/* default */\n\
a {\n\
	cursor: pointer\n\
}\n\
a:hover {\n\
	text-decoration: underline\n\
}\n\
/* external */\n\
.woas_world_link {\n\
	color: #006400; /* darkgreen */\n\
	text-decoration: underline\n\
}\n\
/* menu */\n\
.woas_menu_link {\n\
	color: #00f; /* blue */\n\
}\n\
/* menu - missing */\n\
.woas_menu_unlink {\n\
	color: #f00; /* red */\n\
}\n\
/* page */\n\
.woas_link {\n\
	color: #00f; /* blue */\n\
}\n\
/* page - missing */\n\
.woas_unlink {\n\
	color: #f00; /* red */\n\
}\n\
\n\
/* LOCKED PAGE */\n\
\n\
.woas_locked #woas_page {\n\
	/* can contain a border */\n\
	border: 2px solid #f00;\n\
}\n\
\n\
/* MAIN TEXT AREA */\n\
\n\
#woas_page {/* main text area */\n\
	position: relative;\n\
	overflow-x: auto;\n\
	margin-bottom: 0.75em;\n\
	background-color: #fff; /* white */\n\
	padding: 1em\n\
}\n\
\n\
/* MENU */\n\
\n\
/*\n\
Add the following CSS to WoaS::Custom::CSS to allow an image icon for edit\n\
instead of the current text icon. I find the text less distracting.\n\
\n\
.woas_no_img #woas_menu_edit img, #woas_menu_edit span {\n\
	display: none\n\
}\n\
.woas_no_img #woas_menu_edit span, #woas_menu_edit img {\n\
	display: inline\n\
}\n\
\n\
*/\n\
#woas_menu {\n\
	font-size: .75em;\n\
	padding: 1em\n\
}\n\
#woas_menu_edit {\n\
	font-size: .625em;\n\
	float: right;\n\
	margin-right: .4em;\n\
	color: #99b\n\
}\n\
#woas_menu_edit img {\n\
	margin-top: -.5em;\n\
	background-color: none; /* remove temporary IE8 background */\n\
}\n\
#woas_menu_jar { /* container for menu and menu_edit */\n\
	background-color: #fff; /* white */\n\
	padding-bottom: .875em\n\
}\n\
\n\
/* MONOSPACED TEXT (except search) */\n\
\n\
pre, tt {\n\
	white-space: pre-wrap; /* CSS 3 */\n\
}\n\
.woas_core_page {\n\
	background-color: #F0F0F5; /* same as header */\n\
}\n\
.woas_core_page, .woas_embedded {\n\
	overflow: hidden;\n\
	padding: 1.25em\n\
}\n\
.woas_embedded {\n\
	background-color: #ccf\n\
}\n\
.woas_nowiki {\n\
	/* useful when using a background color */\n\
	/* padding: 0px 0.125em; */\n\
}\n\
.woas_nowiki_multiline {\n\
	margin: 1em 0px;\n\
	padding: .5em;\n\
	border: 1px solid #808080; /* grey */\n\
	background-color: #F5F5F5;\n\
	overflow: hidden\n\
}\n\
li pre.woas_nowiki_multiline {\n\
	overflow: inherit\n\
}\n\
\n\
/* NAVIGATION BAR */\n\
\n\
.woas_nav img, /* temporary CSS to fix IE8 icon opacity display */\n\
#woas_header_wrap {\n\
	background-color: #F0F0F5; /* no color name */\n\
}\n\
#woas_header {\n\
	padding: 0.5em 0.75em\n\
}\n\
.woas_edit #woas_header {\n\
	border-width: 0px\n\
}\n\
#woas_title {\n\
	line-height: 1;\n\
	font-size: 1.813em;\n\
	font-weight: bold;\n\
	margin-right: .188em;\n\
	text-shadow: #c7c7c7 0.125em 0.125em 0.065em\n\
}\n\
div.woas_nav { /* navbar icon/text link container */\n\
	float: right;\n\
	margin-top: .188em\n\
}\n\
.woas_nav a { /* navbar links */\n\
}\n\
.woas_nav a span { /* no-image text */\n\
	font-weight: bold;\n\
	font-size: 70%\n\
}\n\
img.woas_nav { /* woas logo */\n\
	float: left;\n\
	margin: -2px .375em 0 0\n\
}\n\
\n\
/* NOTE MACRO & TEMPLATE::INFO */\n\
\n\
.woas_note { /* could be multiples, so use class */\n\
	background: #FFFFAA url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADtElEQVR42rWWXUxbZRjHBwx0G9go7GJixCXDLQZZjEa9W4yKi04vtnhlsrg4E5Mp2TQu0cyZuESNEmVENseYQNduKx+FApWuUEopLYwPoRvQscGAjrFCP2gpbWkL/HzTxCszOMnYkzwX5+Sc/+99/89z3udsmC/4/pGmpIdEIJLULamkp2ew6fFN/HfvoQAi2Lx5C4c+Pky1qharuQerqZcGdTMFP//BG3veJjExcVXQquK7c3fTaelmKQrhYIQ5r5+Z+27GRhz0dg5hMdr48YdCnnoy/YGQB4rn5LyIY+IerMBCYCGec3N+XDOeOOT6P3a0dW0YdD2cLigjLVUWh0gCbNyYjKHZxHJshXAozPLSMpHFCPPzC7hdXmadbm70j6DXWlCr9DSqLXz+2TfSACI4sP9DAr4wft+8EI4Si8VYDC+K6wAe9xxTDidd5gFamqzUVbVyqVyLvFTL9qzsOGRNQHFRCf65oPDcRyi4QCQSEDuZx+/34xE7uGUfxT50neFBG1cb24V4PVcqmtn/wUdrA0RXiFVpcTm9cTuCQR+RaFBAgoTDogazd5mcvInLNcX09BjXrF2Ul9SjuKDj6JFv1wakpKQIX7U47kyLYrrw+TxEoyFi0QihkJ9AwCNq4cXrnWFi3I6x2UzpGbUA/M2J46ekWVRyRo6tdwTH+LTYhUuIeoWoB4fDztTUbSYnbjI81I/JYEEp/P/zdBVVF5v56ovj0gD5R77G2maj3dBDf+8g43eGRYHd3HXcoq+7lxZdB/U1BhR/ablwto6zhSp0tSbe27tPGmBn9gs0aTrQVBtEr5uw9fcJ7+/hvD9Jl6WLK3IdijItZec08dWryhuplKuRPSFD8of26aF89I3dXKrQInwWfo/g8cwIWA8qRRPni9VCvBJ5iRrz1U727X0f8Z50QFJSEl/mn6RWZabmsp7BG304Jm8zIAAV5zWcK6qhRqnDrO/kk4OHJRwV/4MkkJCQwLvvHKCoQCla14Cl3Sr6vhWVXENDtQZFqZI397wl4bBbJQWErRkZtOgv4nReY2a2g9HRGtqMv/Daq7vi4usyD9pMPxFb6cbtNTJgk1NVeZJt29LIzXllfQDmjkJCi114fe0M2y/ToDnF9ufS2bUzd30ArcbfWcKGP2BhdKwao+FXduzYyvPZOesD6O75jUCwHZfHRIuhmO9OHEQme4yXX3r94QFpaWkkJ2/g6cwMlEoFeXl5CChZWc9KmsmSMzPzGdG68RnMsWNHkfpX8UjzX78dQm6UDc/yAAAAAElFTkSuQmCC) no-repeat .5em .5em;\n\
	border: 1px solid #000;\n\
	margin: 1em 1.25em;\n\
	padding: .75em .75em .75em 2.5em;\n\
	overflow: hidden\n\
}\n\
.woas_no_img .woas_note {\n\
	padding-left: .75em\n\
}\n\
.woas_note .woas_nowiki, .woas_note .woas_nowiki_multiline {\n\
    background-color: #FFFFAA;\n\
}\n\
\n\
/* PAGE LISTINGS */\n\
\n\
.woas_list {\n\
	margin: .188em 0px .25em 1.5em\n\
}\n\
.woas_list_heading {\n\
	margin: .375em 0px 0px;\n\
	font-weight: bold\n\
}\n\
.woas_list_link {\n\
	color: #00008b; /* darkblue */\n\
}\n\
.woas_list_link:hover {\n\
	background-color: #FFFFE0; /* LightYellow */\n\
	text-decoration: none\n\
}\n\
\n\
.woas_list_options {\n\
	float: right;\n\
	padding: .188em .375em;\n\
	background-color: #F0F0F5; /* matches header */\n\
	font-size: .8em\n\
}\n\
\n\
/* PASSWORD (see also encryption) */\n\
\n\
#woas_password_desc {\n\
	background-color: #FAFAFB;\n\
	border: 1px solid #000080; /* navy */\n\
	margin: 0px 10%;\n\
	padding: 2em\n\
}\n\
/* mask should not contain borders/padding/margins */\n\
#woas_pwd_mask {\n\
	text-align: center\n\
}\n\
#woas_pwd_query {\n\
	position: relative;\n\
	margin: 0px 10%;\n\
	top: 10%;\n\
	padding-top: 1em;\n\
	background-color: #d6dff7;\n\
	border: 2px solid #666666\n\
}\n\
\n\
/* PRINT  (at end of CSS) */\n\
\n\
/* SEARCH */\n\
\n\
#woas_search_options {\n\
	background-color: #f0f0f5;\n\
	border: 1px solid black;\n\
	margin-top: 1em;\n\
	padding: 0px 1em 1em;\n\
}\n\
#woas_search_match {\n\
	margin: -.5em 0px 0px 1.25em\n\
}\n\
#woas_search_results {\n\
	padding-top: 1.5em\n\
}\n\
.woas_search_results {\n\
	font-family: "Courier New", Courier, monospace;\n\
	background-color: #f9f9f9;\n\
	border: 1px solid #aaa;\n\
	clear: both;\n\
	padding: 0.313em;\n\
	margin: .75em 0px .75em 1em\n\
}\n\
.woas_search_highlight {\n\
	background-color: #ff0; /* yellow */\n\
}\n\
.woas_search_head {\n\
	font-weight: bold;\n\
	font-family: sans-serif\n\
}\n\
.woas_template_search{\n\
	font-size:.75em\n\
}\n\
\n\
/* TABLE OF CONTENTS */\n\
\n\
#woas_toc {\n\
	float: right;\n\
	position:relative; /* stops IE6 invisibility */\n\
	max-width: 40%;\n\
	margin-left: 2em;\n\
	margin-bottom: 1em;\n\
	border: 1px dashed #aaa;\n\
	background-color: #f9f9f9;\n\
	padding: .75em 1em;\n\
	font-size: 80%\n\
}\n\
#woas_toc_title {\n\
	line-height: 1em;\n\
	font-weight: bold;\n\
	text-align: center\n\
}\n\
#woas_toc_content {\n\
	margin-top: .75em\n\
}\n\
.woas_toc_h1, .woas_toc_h2, .woas_toc_h3,\n\
.woas_toc_h4, .woas_toc_h5, .woas_toc_h6 {\n\
	margin-top: .125em;\n\
	margin-bottom: .125em\n\
}\n\
.woas_toc_h2 {\n\
	margin-left: 1.5em\n\
}\n\
.woas_toc_h3 {\n\
	margin-left: 3em\n\
}\n\
.woas_toc_h4 {\n\
	margin-left: 4.5em\n\
}\n\
.woas_toc_h5 {\n\
	margin-left: 6em\n\
}\n\
.woas_toc_h6 {\n\
	margin-left: 7.5em\n\
}\n\
\n\
/* TABLES */\n\
\n\
table {\n\
	margin: .75em 0px;\n\
	border: 1px solid #000; /* black */\n\
	border-spacing: 0px\n\
}\n\
td {\n\
	border: 1px solid;\n\
	padding: .313em\n\
}\n\
caption {\n\
	font-style: italic;\n\
	font-weight: bold\n\
}\n\
\n\
/* TAG */\n\
\n\
/* container */\n\
.woas_taglinks {\n\
	border: 1px solid #aaa;\n\
	margin-top: 1em;\n\
	overflow: auto;\n\
	padding: .5em 1em;\n\
	font-size: 80%;\n\
	text-align: left;\n\
	color: #aaa; /* matches border */\n\
}\n\
\n\
/* links */\n\
.woas_taglinks \x3E a {\n\
	margin: 0px;\n\
	padding: .125em .313em;\n\
	background-color: #fff; /* white */\n\
	color: #000; /* black */\n\
	text-decoration: none\n\
}\n\
.woas_taglinks \x3E a:hover {\n\
	background-color: #808080; /* grey */\n\
	color: #fff; /* white */\n\
	font-weight: normal;\n\
	text-decoration: none\n\
}\n\
\n\
/* TEXT DECORATIONS (used by editor buttons, but generally available) */\n\
\n\
.woas_b {\n\
	font-weight: bold\n\
}\n\
.woas_i {\n\
	font-style: italic\n\
}\n\
.woas_s {\n\
	text-decoration: line-through\n\
}\n\
.woas_u {\n\
	text-decoration: underline\n\
}\n\
\n\
/* WIKI LOADING OVERLAY */\n\
\n\
#loading_overlay {\n\
	position: absolute;\n\
	z-index: 100;\n\
	left: 0px;\n\
	top: 0px;\n\
	width: 100%;\n\
	height: 100%;\n\
	padding-top: 25%;\n\
	color: 	#000080; /* navy */\n\
	font-size: large;\n\
	text-align: center\n\
}\n\
\n\
/*************************************\n\
| WOAS MODIFIER CSS (EXPORT & PRINT) |\n\
|   (needs to be after other CSS)    |\n\
*************************************/\n\
\n\
/* EXPORT (modifier: .woas_export) */\n\
\n\
/* broken_link only used for exporting */\n\
.woas_broken_link {\n\
	color: #000;\n\
	text-decoration: none\n\
}\n\
.woas_export #woas_header_wrap {\n\
    position: static\n\
}\n\
.woas_export #woas_menu_wrap {\n\
	position: relative;\n\
	float: left\n\
}\n\
.woas_export #woas_menu_jar {\n\
	padding-bottom: 0\n\
}\n\
.woas_export .woas_link {\n\
	text-decoration: none\n\
}\n\
.woas_export .woas_link:hover {\n\
	text-decoration: underline\n\
}\n\
.woas_export_no_menu #woas_page_wrap {\n\
    margin-left: 0px\n\
}\n\
\n\
/* PRINT (modifier: .woas_print) */\n\
\n\
#woas_page.woas_print {\n\
	overflow: auto;\n\
	border-width: 0px;\n\
	padding: 0px;\n\
	margin: 0px\n\
}\n\
.woas_print .woas_nowiki_multiline {\n\
	page-break-inside: avoid\n\
}\n\
\n\
\n\
/******************************\n\
| CRITICAL LAYOUT/DISPLAY CSS |\n\
| ALTERATION CAN BREAK LAYOUT |\n\
| EVEN BY CHANGING THE ORDER  |\n\
******************************/\n\
\n\
/* hidden layout */\n\
\n\
.woas_hide, #loading_overlay, #woas_wait_text, #woas_pwd_mask,\n\
#woas_custom_accesskeys {\n\
	display: none\n\
}\n\
\n\
/* general layout design */\n\
\n\
body {\n\
	overflow: auto\n\
}\n\
#woas_pwd_mask {\n\
	position: absolute;\n\
	height: 100%;\n\
	width: 100%;\n\
	z-index: 100\n\
}\n\
#woas_header_wrap {\n\
	top: 0;\n\
	left: 0; /* needed for IE7 old_fix_h */\n\
	width: 100%;\n\
	z-index: 10;\n\
}\n\
/* this stops Chrome making the editor unstable */\n\
body::selection, #woas_header_wrap::selection {\n\
	display:none;\n\
}\n\
#woas_scroll_wrap, #woas_edit_wrap {\n\
	clear: both;\n\
}\n\
#woas_scroll_wrap {\n\
	overflow: auto;\n\
	/*overflow-x: hidden; some IE (7&9?) */\n\
}\n\
#woas_page_wrap, #woas_footer_wrap {\n\
	margin-left: 13em; /* to match menu wrap + gutter */\n\
	overflow: hidden\n\
}\n\
#woas_menu_wrap {\n\
	/* width = page|footer wrap (below) - woas_content padding\n\
	(or desired gutter) */\n\
	width: 12.25em;\n\
	position: absolute;\n\
	_float: left; /* for IE6 */\n\
	overflow: hidden\n\
}\n\
#woas_editor {\n\
/*\n\
 * PVHL: allows padding in 100% width - must be matched in container,\\n *	AND ONLY AT SIDES (could do it, but it is not needed).\n\
 *	From an answer by ShadyKiller@stackoverflow.com\n\
 */\n\
/* only using left for now or Firefox does strange things (will investigate) */\n\
	margin-left: -0.5em;\n\
	padding-left: 0.5em;\n\
	width: 100%;\n\
	resize: none;\n\
	overflow: auto;\n\
	overflow-x: hidden; /* for IE (9+ too?) */\n\
	outline: none; /* Webkit (Chrome, Safari, etc.) */\n\
	vertical-align: bottom; /* fixes space below element in Chrome, etc. */\n\
	display: block;\n\
}\n\
#woas_editor_container {\n\
	padding-left: 0.5em;\n\
	overflow: hidden\n\
}\n\
\n\
/* control display modes */\n\
\n\
.woas_fix_h #woas_header_wrap, .woas_fix_m #woas_menu_wrap {\n\
	position: fixed;\n\
}\n\
.woas_fix_h #woas_scroll_wrap {\n\
	position: absolute;\n\
	width: 100%;\n\
	bottom: 0;\n\
}\n\
/* for IE 7, and others who set it in code */\n\
.woas_old_fix_h #woas_scroll_wrap {\n\
	position: static;\n\
}\n\
.woas_edit #woas_header_wrap {\n\
	position: static\n\
}\n\
.woas_edit #woas_scroll_wrap {\n\
	position: static\n\
}\n\
.woas_edit #woas_footer_wrap {\n\
	margin-left: 0\n\
}\n\
\n\
/* control disabling of navbar icons (or text if no images) */\n\
\n\
.woas_no_back #woas_back, .woas_no_fwd #woas_fwd, .woas_no_home #woas_home,\n\
.woas_no_tools #woas_tools, .woas_no_edit #woas_edit,\n\
.woas_no_lock #woas_lock, .woas_no_lock #woas_unlock,\n\
.woas_no_debug #woas_debug, .woas_no_help #woas_help {\n\
	display: inline-block; /* IE 6-8 needs this for filter to work */\n\
	-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=15)"; /* IE8 */\n\
	*filter: alpha(opacity=15); /* IE 6/7 */\n\
	opacity: .15; /* all others, including IE9 */\n\
	cursor: default;\n\
	*text-decoration: none; /* for ie7 */\n\
}\n\
\n\
/* select images or text for display */\n\
\n\
/* LOOK AT MAKING THESE MORE EFFICIENT by using IDs instead - though dynamic\n\
   creation of controls completely removes need for this ... coming soon */\n\
\n\
.woas_nav a span, .woas_no_img .woas_nav img, .woas_no_img img.woas_nav,\n\
.woas_no_img #img_logo, .woas_no_img #woas_debug img, .woas_no_img #woas_top img,\n\
#woas_menu_edit img, #woas_debug span, #woas_top span {\n\
	display: none\n\
}\n\
.woas_no_img .woas_nav a span, .woas_no_img #woas_debug span,\n\
.woas_no_img #woas_top span, #woas_menu_edit span {\n\
	display: inline\n\
}\n\
\n\
/* control read-only and locks */\n\
\n\
.woas_locked #woas_unlock {\n\
	display: inline\n\
}\n\
.woas_ro #woas_edit, .woas_ro #woas_lock, .woas_ro #woas_unlock,\n\
.woas_ro #woas_menu_edit,\n\
.woas_locked #woas_lock, .woas_unlocked #woas_unlock {\n\
	display: none\n\
}\n\
\n\
/* control overall display */\n\
\n\
.woas_edit #woas_edit_wrap, .woas_view #woas_page_wrap, .woas_view #woas_menu_wrap,\n\
.woas_pswd #woas_pwd_mask, .woas_wait #loading_overlay, #woas_header_wrap {\n\
	display: block\n\
}\n\
.woas_view #woas_edit_mode, .woas_view #woas_edit_wrap,\n\
.woas_edit #woas_view_mode, .woas_edit #woas_page_wrap, .woas_edit #woas_menu_wrap,\n\
.woas_pswd #woas_scroll_wrap, .woas_pswd #woas_header_wrap, .woas_wait #woas_scroll_wrap,\n\
.woas_no_mts #woas_mts, .woas_no_log #woas_debug_console {\n\
	display: none\n\
}',
'/* Initial loading CSS used by erase wiki; no user edit */\n\
body {\n\
	margin: 0px;\n\
	padding: 0px;\n\
	border-width: 0px;\n\
	font-family: Georgia, verdana;\n\
	background-color: #F0F0F5; /* to match layout; no name */\n\
}\n\
#loading_overlay {\n\
	position: absolute;\n\
	z-index: 100;\n\
	left: 0px;\n\
	top: 0px;\n\
	width: 100%;\n\
	height: 100%;\n\
	padding-top: 2em;\n\
	color: 	#000080; /* navy */\n\
	font-size: large;\n\
	text-align: center\n\
}\n\
#woas_debug_console {\n\
	width: 50%;\n\
	margin: 5em auto\n\
}\n\
#woas_debug_log {\n\
	width: 100%\n\
}\n\
#woas_wait_text, #woas_pwd_mask, #woas_header_wrap, #woas_menu_wrap, #woas_page_wrap,\n\
#woas_edit_wrap, #woas_custom_accesskeys, #woas_footer_panel, #woas_debug_log_clear {\n\
	display: none\n\
}',
'You can define key bindings for hotkeys (also called \'access keys\') by editing the [[WoaS::Hotkeys]] page.\n\
\n\
Example:\n\
{{{\n\
$SAVE s\n\
$EDIT e\n\
}}}\n\
The *$SAVE* and *$EDIT* definitions identify a WoaS action, while the /\'s\'/ and /\'e\'/ characters identify the associated hotkey.\n\
\n\
See the Wikipedia [[http://en.wikipedia.org/wiki/Access_key|Access key]] entry for details on how different browsers access these keys.\n\
== Custom hotkeys\n\
You can create a custom hotkey associated with a JavaScript function that will be called when that hotkey is activated.\n\
\n\
Example:\n\
{{{\n\
$CUSTOM(myfunction)     k\n\
}}}\n\
The /myfunction/ JavaScript function will be called (without arguments) when the /\'k\'/ hotkey is activated.\n\
',
'All pages of the [[WoaS::Plugins]] namespace are WoaS plugins; plugins are executed when loading WoaS and remain active for the entire session. The WoaS project has plugin examples available for code syntax highlighting, MathML display, and charting; these are found in the /Plugins/ directory of the download. One powerful use of plugins is to load a [[WoaS::Help::Macros|macro]], or a set of macros, that will be available to all pages. The plugins directory also contains Italian and German translation plugins, though translation support is not yet fully capable in WoaS.\n\
\n\
You can share WoaS plugins as [[WoaS::Help::WSIF|WSIF]] files by exporting them.\n\
== External plugins\n\
A WoaS plugin is just JavaScript code, unless you create a plugin whose name starts with \'@\'. Such plugins are made up of external file references and a specific notation to force the browser into a specific inclusion mode.\n\
\n\
Example:\n\
{{{\n\
path/to/mylib1.js = +*\n\
path/to/mylib2.js = @*\n\
}}}\n\
The first resource, {{{path/to/mylib1.js}}}, will be included as an inline JavaScript (e.g. like source code inside a {{{\x3Cscript \x3E}}} tag), while the second, {{{path/to/mylib2.js}}}, will be included using a {{{\x3Cscript\x3E}}} tag with an external \'src\' attribute.\n\
=== Inclusion operators\n\
There are two inclusion operators which are valid for resource definitions:\n\
* *+* - which leads to inline inclusion\n\
* *@* - which leads to external inclusion\n\
The word which directly follows such inclusion operator can be any of the following supported tokens:\n\
* *{{{*}}}* catch-all, which means any browser/engine\n\
* *ie* Internet Explorer\n\
* *firefox* Mozilla Firefox (-)\n\
* *opera* Opera Internet Explorer\n\
* *safari* Apple Safari (-)\n\
* *chrome* Google Chrome\n\
* *gecko* Gecko engine (Mozilla)\n\
* *webkit* WebKit engine (Safari/Chrome)\n\
* *presto* Presto engine (Opera)\n\
* *trident* Trident engine (Internet Explorer)\n\
*Note: * tokens marked with (-) do not support version matching\n\
\n\
Now let\'s consider a more complex example:\n\
{{{\n\
path/to/mylib1.js = +* @gecko(1.9+)\n\
path/to/mylib2.js = @*\n\
}}}\n\
{{{path/to/mylib1.js}}} will be loaded as inline for all browsers except those which have a Gecko engine with version 1.9 or above (i.e. Firefox 3.6 and above).\n\
',
'Aliases are replaceable shortcuts used in wiki [[WoaS::Help::Links|links]].\n\
==Example\n\
If /$JD/ is defined in [[WoaS::Aliases]] as {{{John Doe}}} then the link {{{[[$JD::Bio]]}}} will be converted to {{{[[John Doe::Bio]]}}} when rendered by WoaS.\n\
\n\
Aliases can turn out to be particularly useful to shorten typing of long page names.\n\
== Add an alias\n\
An alias is added by editing the [[WoaS::Aliases]] reserved page and adding an alias line to the page. For example:\n\
{{{\n\
$JD    John Doe\n\
}}}\n\
*$JD* is the alias, which will be replaced when found in wiki page title references, and /"John Doe"/ is the text which will replace *$JD*. You can specify any part of page titles in aliases, like namespaces or page prefixes/suffixes.\n\
',
'\x3Cfieldset id="s10522" class="woas_input_wrap"\x3E\x3Clegend\x3EExisting pages\x3C/legend\x3E\\\n\
\x3Clabel\x3E\x3Cinput type="radio" id="woas_import_ask" name="woas_import_overwrite" onclick="woas.importer.i_overwrite=3" checked="checked"\x3EAsk before overwrite\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="radio" id="woas_import_erase" name="woas_import_overwrite" onclick="woas.importer.i_overwrite=0"\x3EErase all user pages before import process\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="radio" id="woas_import_ignore" name="woas_import_overwrite" onclick="woas.importer.i_overwrite=1"\x3EIgnore\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="radio" id="woas_import_overwrite" name="woas_import_overwrite" onclick="woas.importer.i_overwrite=2"\x3EOverwrite\x3C/label\x3E\n\
\x3C/fieldset\x3E\\\n\
\x3Cfieldset id="s4030" class="woas_input_wrap"\x3E\x3Clegend\x3ESecurity\x3C/legend\x3E\\\n\
\x3Cdiv class="woas_input_wrap_left"\x3E/If you don\'t trust the pages you are importing you may want to disable imported JavaScript, macros, and special WoaS pages until you can review their content./\x3C/div\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_import_comment_js" onclick="woas.importer.i_comment_js=this.checked"\x3EComment JavaScript tags\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_import_comment_macros" onclick="woas.importer.i_comment_macros=this.checked"\x3EComment macro definition/call\x3C/label\x3E\n\
\x3Clabel\x3E\x3Cinput type="checkbox" id="woas_cb_import_no_woas" onclick="woas.importer.i_no_woas=this.checked"\x3EDo not import [[WoaS::]] namespace pages ([[WoaS::Hotkeys|hotkeys]], [[WoaS::Plugins|plugins]], and [[WoaS::Aliases|aliases]])\x3C/label\x3E\n\
\x3C/fieldset\x3E\n\
',
'Web pages can be included in a page as embedded HTML objects or in HTML iframes.\n\
\x3C\x3C_note Some pages may not render correctly depending on how they\'re coded. Embedding more than one web page in a wiki page will cause the final embedded web page to steal the focus when the page is loaded, so it\'s recommended to have only one per page.\x3E\x3E\n\
== Embed a web page as an object\n\
This method makes the embedded web page become a seamless part of the page.\n\
* *Embed a local HTML file as an object:*\x3Cbr\x3E\x3Cbr\x3E\n\
** \x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing PATH with the full path to the HTML file you wish to include, and changing the width and height to suit your taste:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cobject data="PATH" style="width:100%; height:630px;"\x3EFile not found.\x3C/object\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo embed a local HTML file in a page.\x3C/div\x3E\x3Cbr\x3E\n\
*** For example, this command embeds the {{{/Work/MyProject.html}}} file into a page as an object:\x3Cbr\x3E\x3Cbr\x3E{{{\n\
\x3Cobject data="/Work/MyProject.html" style="width:100%; height:630px;"\x3EFile not found.\x3C/object\x3E\n\
}}}\x3Cbr\x3E\x3Cbr\x3E\n\
* *Embed a remote URL as an object:*\x3Cbr\x3E\x3Cbr\x3E\n\
** \x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing URL with the URL of the page you wish to include, and changing the width and height to suit your taste:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Cobject data="URL" style="width:100%; height:630px;"\x3EURL not found.\x3C/object\x3E\x3C\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo embed an external URL in a page.\x3C/div\x3E\x3Cbr\x3E\n\
*** For example, this command embeds the WoaS official website at {{{http://stickwiki.sf.net/}}} into a page as an object:\x3Cbr\x3E\x3Cbr\x3E{{{\n\
\x3Cobject data="http://stickwiki.sf.net/" style="width:100%; height:630px;"\x3EURL not found.\x3C/object\x3E\n\
}}}\n\
== Embed a web page in an HTML iframe\n\
This method creates a frame around the embedded web page. The code shown below is for a plain frame, but you can style the iframe further by adding a border, changing the border style to dotted, dashed, solid, double, groove, ridge, inset, or outset, changing the border width to whatever thickness you like, and the border color to whatever color you like.\n\
* *Embed a local HTML file in an iframe:*\x3Cbr\x3E\x3Cbr\x3E\n\
** \x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing PATH with the full path to HTML file you wish to include, and changing the width and height to suit your taste:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Ciframe height="400" width="100%" height:630px; src="PATH"\x3E\x3C/iframe\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo include a local HTML file in a wiki page.\x3C/div\x3E\x3Cbr\x3E\n\
*** For example, this command embeds the {{{/Work/MyProject.html}}} file into a page in an iframe:\x3Cbr\x3E\x3Cbr\x3E{{{\n\
\x3Ciframe height="400" width="100%" height:630px; src="/Work/MyProject.html"\x3E\x3C/iframe\x3E\n\
}}}\x3Cbr\x3E\x3Cbr\x3E\n\
* *Embed a remote URL in an iframe:*\x3Cbr\x3E\x3Cbr\x3E\n\
** \x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing URL with the URL of the page you wish to include, and changing the width and height to suit your taste:\x3C/div\x3E\x3Cbr\x3E{{{\n\
\x3Ciframe height="400" width="100%" height:630px; src="URL"\x3E\x3C/iframe\x3E\n\
}}}\x3Cbr\x3E\x3Cdiv class="woas_help_text"\x3ETo include a web page in a wiki page.\x3C/div\x3E\x3Cbr\x3E\n\
*** For example, this command embeds the WoaS official website at {{{http://stickwiki.sf.net/}}} into a page in an iframe:\x3Cbr\x3E\x3Cbr\x3E{{{\n\
\x3Ciframe height="400" width="100%" height:630px; src="http://stickwiki.sf.net/"\x3E\x3C/iframe\x3E\n\
}}}\n\
',
'/See also: [[WoaS::Help::Files|Files]]./\n\
\n\
You can include a text file in a page by placing it inside of an HTML iframe.\n\
\n\
\x3Cdiv class="woas_help_text"\x3EUse this code in a page, replacing PATH with the full path to the file:\x3C/div\x3E\n\
{{{\n\
\x3Ciframe height="400" width="100%" src="file:///PATH"\x3E\x3C/iframe\x3E\n\
}}}\n\
\x3Cdiv class="woas_help_text"\x3ETo include a text file in the page inside an iFrame.\x3C/div\x3E\n\
== Examples\n\
* *Linux example:*\x3Cbr\x3E\x3Cbr\x3E{{{\n\
\x3Ciframe height="400" width="100%" src="file:///home/username/Desktop/file.txt"\x3E\x3C/iframe\x3E\n\
}}}\x3Cbr\x3E\n\
* *Windows example:*\x3Cbr\x3E\x3Cbr\x3E{{{\n\
\x3Ciframe height="400" width="100%" src="file:///C:/Users/Username/Documents/file.txt"\x3E\x3C/iframe\x3E\n\
}}}\n\
',
'The look and feel of the wiki is determined by the default CSS definitions in the [[WoaS::CSS::Core]] page. Although the [[WoaS::CSS::Core]] page cannot be edited, the definitions can be copied and used as a foundation for customizing the wiki in any of the ways described in the [[WoaS::Help::CSS|CSS]] page.\n\
',
'The [[WoaS::CSS::Custom]] page can be used to add new CSS definitions to the wiki or to override the definitions in the [[WoaS::CSS::Core]] page by copying them to the [[WoaS::CSS::Custom]] page and [[WoaS::Help::CSS|customizing them]] to suit your taste.\n\
',
'The [[Locked::]] page lists all [[WoaS::Help::Create a page|user pages]] that have been [[WoaS::Help::Security|encrypted]].\n\
\n\
The [[Unlocked::]] page does the opposite, listing all normal user pages; see [[WoaS::Help::Unlocked|Unlocked]].',
'The [[WoaS::CSS::Boot]] page cannot be edited, and contains the CSS definitions that determine how the wiki will look and feel while it is loading.\n\
',
'The first time you save a change to Wiki on a Stick, your browser will ask for permission to save data to the disk. This is normal and necessary for the wiki to make changes to itself.\n\
\n\
[[Include::WoaS::Template::Help]]',
'The [[Special::Orphaned Pages]] page displays a listing of all pages that no other pages [[WoaS::Help::Links|link to]].\n\
\x3C\x3C_note Only wiki syntax links will be found. If a page is only linked to dynamically, using JavaScript or a macro, it will show up in the listing.\x3E\x3E',
'The [[Special::Recent Changes]] page is an optional wiki feature that keeps track of [[WoaS::Help::Edit a page|changed pages]] when enabled.\n\
* When the feature is not enabled, the page displays a notice stating that the last modified timestamp storage is disabled in Special::Options.\n\
* When the feature is enabled, the page displays a list of links to pages that have been changed followed by the date and time of the most recent change.\n\
== Enable tracking of page changes\n\
# Click the *Advanced* icon in the navigation bar.\n\
# Click the [[Special::Options]] link in the *Advanced features* section of the page.\n\
# Click the box next to the /Store and display last modified timestamp/ option in the *Saving* section of the page to place a check mark in the box.\n\
# Click the *Save options* button to save the change.\n\
',
'This wiki offers two ways to search for content:\n\
* The search box in the menu which uses the [[WoaS::Template::Search]] page as a template.\n\
* The [[Special::Search]] page, which you can get to by clicking the *Advanced* icon in the menu and looking in the *Pages* section.\n\
It is recommended that you do one-word searches to avoid lengthy searches that pop up unresponsive script warnings. Also, type only the exact search term(s) into the box without surrounding the term(s) with quotes or using other characters unless the content you\'re searching for contains them.\n\
\n\
The results display links to pages with the search term in their title followed by links to pages that contain the search term, the number of hits, and the the highlighted search term surrounded by content.\n\
== Add a search box or search link to a page\n\
The search box in the menu can be deleted by editing the menu and removing the {{{[[Include::WoaS::Template::Search]]}}} line. If you would like a search box in another page in the wiki, add the line you removed from the menu where you would like the box to appear in the page. To add a link to the [[Special::Search]] page to any page in the wiki, insert {{{[[Special::Search]]}}} anywhere in the page.\n\
',
'The [[Special::All Pages]] page displays a list of all [[WoaS::Help::Create a page|user-created pages]].\n\
',
'The [[Tagged::]] page displays a list of all pages that have been [[WoaS::Help::Tags|tagged]].\n\
',
'The [[Unlocked::]] page lists all plain [[WoaS::Help::Create a page|user pages]].\n\
\n\
User pages can also be [[WoaS::Help::Security|encrypted]], and these are listed by the [[Locked::]] page; see [[WoaS::Help::Locked]].\n\
\n\
',
'The [[Untagged::]] page displays a list of all pages that have not been [[WoaS::Help::Tags|tagged]].\n\
',
'The [[Special::Export]] page provides an interface for exporting the wiki content into multiple linked XHTML files.\n\
\x3C\x3C_note The /Apply UNIX-style normalization to generated filenames/ option has been removed from this Woas version. All browsers now save to lower-case, normalized file names to avoid potential issues. A future version will do a better job of making non-English titles when needed.\n\
\n\
When present the time-stamp is now presented in universal GMT time format.\n\
\n\
WoaS code generates valid XHTML, but if the WoaS author has included invalid XHTML code within a wiki page, WoaS will not attempt to reform it. /Garbage in, garbage out!/\x3E\x3E\n\
== Paths\n\
=== Directory for XHTML files\n\
The exported XHTML files will by default be placed into the /export/ subdirectory of the directory the Woas file is in. You can specify a different directory. Some browsers may only be able to save to a subdirectory of the Woas file directory.\n\
\n\
The linked images (if any) will be placed into the folder specified for XHTML export. You can no longer specify a different directory for maximum cross-browser and server compatibility.\n\
\x3C\x3C_note The destination directory must exist unless you are using an early Mozilla browser or the /[[https://addons.mozilla.org/en-US/firefox/addon/tiddlyfox/|TiddlyFox]]/ Firefox extension.\x3E\x3E\n\
=== Embed images (instead of linking to external files)\n\
If left checked any images will be embedded within the XHTML file in the same way Woas usually does. Internet Explorer versions earlier than 8 will not be able to see them, and IE8 can only handle images up to about 32K in size. If you intend to put your exported pages on a server it is probably better to uncheck the setting. Now image links will be created to the same location as the XHTML file and Woas will attempt to export the images as binary files.\n\
\n\
If Woas can\'t export binary files from your browser you will have to export them manually. This can be done by going to the [[Image::|Image Gallery]] page and using your browser\'s ability to save images (usually through the context menu; often a /right-click/ on the image). Check each exported /Image::.../ page to see what the files were named; they are usually the same name as the original page but with the /Image::/ namespace removed, though any special characters, including spaces, will be replaced with a marker. Alternatively, if you still have the original images, you can simply copy them to the subdirectory and rename them as necessary.\n\
== Extension for generated XHTML files\n\
The default extension for generated XHTML files is /html/. You can specify a different extension.\n\
=== Name the main page /index/ (plus file extension above)\n\
If this choice is enabled, the main page will be named /index/ with the extension specified above, otherwise it will be named /main_page/, also with the extension specified above.\n\
\n\
For example, if the default extension is used and this option is enabled, the main page would be named /index.html/\n\
== Custom page scripts\n\
===Do not export JavaScript\n\
If selected any scripts embedded in the page to be exported will not be run before exporting the page, nor will they be included in the exported XHTML file.\n\
===Export JavaScript as-is\n\
If selected any scripts embedded in the page to be exported will be included in the parsed, exported XHTML file in the same position they were found in the WoaS page. They will not be run before exporting.\n\
===Run before exporting but do not export the JavaScript\n\
If selected any scripts embedded in the page to be exported will be run before exporting the parsed, exported XHTML file. This is only useful if a script on the page affects the parsed output -- a syntax highlighter, for example -- and it is desired that the exported pages do not require the viewer to have JavaScript enabled in their browser as the scripts themselves will not be exported.\n\
== Other options\n\
===META author (optional)\n\
If a name is in this box it will be used as the content of an HTML author meta tag inserted into each exported HTML page. If the box is empty, the HTML author meta tag will not be inserted into any of the exported HTML pages.\n\
===Export CSS into shared file\n\
If selected a CSS stylesheet will be generated for the entire file set and imported by each exported XHTML file; if not selected the full CSS will be included within each XHTML file.\n\
===Export menus\n\
If selected any menu (including any sub-menu) that would show for a particular WoaS page will also be rendered in the output XHTML file; if not selected only the main page area wil be rendered and exported\n\
',
'The [[Special::Import]] page provides an interface for importing the contents of a current or earlier version of the wiki from an .html source file (back to v0.9.6B). Certain options are only available if the context allows.\n\
== Source\n\
Click the *Browse...* button to select the wiki file to import.\n\
===Import configuration (except WSIF datasource settings)\n\
Imports all the settings from the [[WoaS::Help::Special::Options|Special::Options]] page in the source file into the destination file.\n\
\x3C\x3C_note The settings in the /[[WoaS::Help::Special::Options#WSIF Settings|WSIF settings]]/ section of the /Special::Options/ page will not be imported.\x3E\x3E\n\
===Import content\n\
Imports these pages from the source file:\n\
* Any user-created pages.\n\
* [[Main Page]]\n\
* [[::Menu]]\n\
and also these pages unless /Do not import WoaS:: namespace pages/ is selected:\n\
* [[WoaS::Aliases]]\n\
* [[WoaS::Hotkeys]]\n\
* [[WoaS::Plugins]]\n\
===Import custom CSS\n\
Imports the [[WoaS::CSS::Custom]] page from the source file, overwriting the same page in the destination file. CSS rules from older releases of the wiki may not work properly in the current version; see [[WoaS::Help::CSS#Import CSS rules into your wiki|Import CSS rules]].\n\
\n\
Importing custom CSS and configuration from a current WoaS version, while not importing content, is a good way to copy a custom wiki set-up.\n\
== Existing pages\n\
===Erase all user pages before import process\n\
Erases all user-created pages before importing content into the destination file. The import interface will pop up two confirmation boxes to verify that you\'re sure you want to erase the pages.\n\
===Ignore\n\
Prevents the import interface from overwriting existing pages, allowing only  new pages to be imported into the destination file.\n\
===Overwrite\n\
Gives the import interface blanket permission to overwrite existing pages in the destination file.\n\
===Ask before overwrite\n\
Forces the import interface to ask your permission to overwrite individual pages in the destination file.\n\
== Security\n\
===Comment JavaScript tags\n\
Inserts /disabled_/ into any script tags in the pages that are imported into the destination file so that scripts will not run.\n\
\n\
Example script tag:\n\
{{{\n\
\x3Cscript type="text/javascript"\x3Ealert("This is an example alert!");\x3C/script\x3E\n\
}}}\n\
Example disabled script tag:\n\
{{{\n\
\x3Cdisabled_script type="text/javascript"\x3Ealert("This is an example alert!");\x3C/disabled_script\x3E\n\
}}}\n\
===Comment macro definition/call\n\
Inserts /Macro disabled/ into any macro definitions or macro calls in the pages that are imported into the destination file so that macros will not run. You can remove the \'!\' disable flag, or simply reimport the content after chacking it.\n\
\n\
Example macro call (using the default {{{_include}}} macro:\n\
{{{\n\
\x3C\x3C_include My Page\x3E\x3E\n\
}}}\n\
Example disabled macro call:\n\
\x3C\x3C!_include My Page\x3E\x3E\n\
===Do not import WoaS:: [[WoaS::Help::Namespaces|namespace]] pages ([[WoaS::Help::Aliases|aliases]], [[WoaS::Help::Hotkeys|hotkeys]], and [[WoaS::Help::Plugins|plugins]])\n\
Does not allow import of pages listed.\n\
',
'The [[Special::Backlinks]] page, which is displayed by clicking the [[Special::Backlinks|Backlinks]] link in the menu, displays a list of all pages linking to the current page.\n\
',
'The menu can contain links to pages, wiki interfaces, and shortcuts to custom functions you create. You can [[WoaS::Help::Edit the menu|edit the menu]] and sub-menus by clicking the edit icon located in its bottom right corner. Sub-menus belong to [[WoaS::Help::Namespaces|Namespaces]] and are discussed in the [[WoaS::Help::Namespaces#Namespace sub-menu|sub-menu]] section there.\n\
\n\
If the wiki is erased the menu contents are slightly reduced, with less often used links removed; these links are still accessible from the Special::[[WoaS::Help::Special::Advanced|Advanced]] page. These are the default contents of the menu with the pages linked briefly explained, with links to more detailed help pages, when available:\n\
* /Main Page/ - The main page of the wiki.\n\
* /[[WoaS::Help::Special::Options|Options]]/ - The Options page where basic configuration settings can be set.\n\
* /WoaS History/ - A  page detailing the history of this wiki; this page is deleted if the wiki is erased.\n\
\n\
* /WoaS::Help/ - A page listing all the pages in the WoaS::Help::[[WoaS::Help::Namespaces|namespace]]; opens in the main wiki.\n\
* /[[WoaS::Help::Aliases|WoaS::Aliases]]/ - A page that allows you to create replaceable shortcuts used in wiki links.\n\
* /[[WoaS::Help::Hotkeys|WoaS::Hotkeys]]/ - A page that allows you to create key bindings for hotkeys and access keys.\n\
* /[[WoaS::Help::Plugins|WoaS::Plugins]]/ - A page that allows you to create, import, and manage plug-ins.\n\
\n\
* /[[WoaS::Help::Special::All Pages|Special::All Pages]]/ - A page that displays a list of all user-created pages.\n\
* /[[WoaS::Help::Special::Recent Changes|Recent Changes]]/ - An optional wiki feature that keeps track of changed pages when enabled.\n\
* /[[WoaS::Help::Go to a page|Go to...]]/ - An interface for typing in the title of a page to go to (defaults to the current page).\n\
\n\
* /[[WoaS::Help::Special::Backlinks|Backlinks]]/ - A page that displays a list of pages linking to the current page.\n\
* /[[WoaS::Help::Create a page|New Page]]/ - An interface for creating a new page.\n\
* /[[WoaS::Help::Duplicate a page|Duplicate Page]]/ - An interface for creating a duplicate of a page (defaults to the current page).\n\
* /[[WoaS::Help::Delete a page|Delete Page]]/ - An interface for deleting a page (defaults to the current page).\n\
\n\
* /[[WoaS::Help::Erase all pages|Erase Wiki]]/ - An interface for erasing the wiki and restoring it to its default state.\n\
\n\
* /[[WoaS::Help::Special::Search|Search box]]/ - A direct-entry interface for entering a search term to search all the user-created pages in the wiki.\n\
',
'= By /Special::/ action link/command\n\
# Access [[Special::Duplicate Page]] from a [[WoaS::Help::Links|link]] (e.g. from the Special::[[WoaS::Help::Special::Advanced|Advanced]] page, default [[WoaS::Help::Menu|menu]], or user page) or by using the Special::[[WoaS::Help::Go to a page|Go to]] command.\n\
# You\'ll be offered the title of the current page with /(duplicate)/ added at the end; this can be replaced with the title of your choice.\n\
# Accept by pressing the /OK/ button, or cancel by pressing the /Cancel/ button.\n\
# When the page is duplicated, you\'ll be on the new page you just created.\n\
',
'= By /Special::/ action link/command\n\
# Access [[Special::Go to]] from a [[WoaS::Help::Links|link]] (e.g. from the Special::[[WoaS::Help::Special::Advanced|Advanced]] page, default [[WoaS::Help::Menu|menu]] (Go to...), or user page).\n\
# You\'ll be offered the title of the current page.\n\
# Type in the name of the page you wish to go to.\n\
# Accept by pressing the /OK/ button, or cancel by pressing the /Cancel/ button.\n\
# If the page exists, you\'ll be taken to it. If it doesn\'t exist, and isn\'t in a [[WoaS::Help::Namespaces#Reserved namespaces|reserved namespace]], the [[WoaS::Help::Create a page|page creation interface]] will open and offer to help you to create the page.\n\
',
'This wiki can embed any kind of file within itself. [[WoaS::Help::Images|Images]] can be embedded, but use their own [[Image::]] namespace.\n\
\n\
A file can be embedded by:\n\
* Using the [[WoaS::Help::Go to a page|Special::Go to]] command, usually found as a menu link, by entering the page name you want preceded by the /File::/ namespace. For instance: [[File::Test]].\n\
* Creating a [[WoaS::Help::Links#Wiki links|wiki link]] to the page you want to create and then clicking the link.\n\
Either method brings you to the /Embed file/ page.\n\
\n\
This is very useful for text pages, but make sure your browser supports binary saving if you embed binary files and want to export them later.',
'\n\
[[Special::TOC]]\n\
== Testing BLOB\n\
\n\
* Testing BLOB under WoaS *{{{Vers. 0.14.0.Beta}}}* \n\
** Date: 15.12.2021\n\
\n\
This Test was successful . . .\n\
\n\
\n\
\n\
=== To Do\n\
\n\
More Tests . . .\n\
\n\
---\n\
*[[Main Page]]*\n\
'
];

/* aFWplTsKDv-0000004-END */

/* ]]> */
</script>
<title woas_permanent="1">Main Page</title>
<style type="text/css" woas_permanent="1" woas_core_style="1">
/* Initial loading CSS used by erase wiki; no user edit */
body {
	margin: 0px;
	padding: 0px;
	border-width: 0px;
	font-family: Georgia, verdana;
	background-color: #F0F0F5; /* to match layout; no name */
}
#loading_overlay {
	position: absolute;
	z-index: 100;
	left: 0px;
	top: 0px;
	width: 100%;
	height: 100%;
	padding-top: 2em;
	color: 	#000080; /* navy */
	font-size: large;
	text-align: center
}
#woas_debug_console {
	width: 50%;
	margin: 5em auto
}
#woas_debug_log {
	width: 100%
}
#woas_wait_text, #woas_pwd_mask, #woas_header_wrap, #woas_menu_wrap, #woas_page_wrap,
#woas_edit_wrap, #woas_custom_accesskeys, #woas_footer_panel, #woas_debug_log_clear {
	display: none
}</style>
<script language="javascript" type="text/javascript" woas_permanent="1">
/* <![CDATA[ */
/*** src/aes.js ***/
// AES encryption
// license: GNU/GPLv2
// original code from http://home.versatel.nl/MAvanEverdingen/Code/
// this is a javascript conversion of a C implementation by Mike Scott
// adapted for WoaS by legolas558
// namespace wrapping by pvhl

// namespace wrapper for woas.AES
(function() {
	
var bData = null,
	aes_i = null,
	aes_j = null,
	tot = null,
	key =  [],
	wMax =  0xFFFFFFFF,
	aesNk = null,
	aesNr = null,
	aesPows = null,
	aesLogs = null,
	aesSBox = null,
	aesSBoxInv = null,
	aesRco = null,
	aesFtable = null,
	aesRtable = null,
	aesFi = null,
	aesRi = null,
	aesFkey = null,
	aesRkey = null;

function rotb(b,n){ return ( b<< n | b>>>( 8-n) ) & 0xFF; }
function rotw(w,n){ return ( w<< n | w>>>(32-n) ) & wMax; }
function getW(a,i){ return a[i]|a[i+1]<<8|a[i+2]<<16|a[i+3]<<24; }
function setW(a,i,w){ a.splice(i,4,w&0xFF,(w>>>8)&0xFF,(w>>>16)&0xFF,(w>>>24)&0xFF); }
function setWInv(a,i,w){ a.splice(i,4,(w>>>24)&0xFF,(w>>>16)&0xFF,(w>>>8)&0xFF,w&0xFF); }
function getB(x,n){ return (x>>>(n*8))&0xFF; }

function aesMult(x, y){ return (x&&y) ? aesPows[(aesLogs[x]+aesLogs[y])%255]:0; }

function aesPackBlock() {
	return [ getW(bData,aes_i), getW(bData,aes_i+4),
			getW(bData,aes_i+8), getW(bData,aes_i+12) ];
}

function aesUnpackBlock(packed){
  for ( var mj=0; mj<4; mj++,aes_i+=4) setW( bData, aes_i, packed[mj] );
}

function aesXTime(p){
  p <<= 1;
  return p&0x100 ? p^0x11B : p;
}

function aesSubByte(w){
  return aesSBox[getB(w,0)] | aesSBox[getB(w,1)]<<8 | aesSBox[getB(w,2)]<<16 | aesSBox[getB(w,3)]<<24;
}

function aesProduct(w1,w2){
  return aesMult(getB(w1,0),getB(w2,0)) ^ aesMult(getB(w1,1),getB(w2,1))
       ^ aesMult(getB(w1,2),getB(w2,2)) ^ aesMult(getB(w1,3),getB(w2,3));
}

function aesInvMixCol(x){
  return aesProduct(0x090d0b0e,x)     | aesProduct(0x0d0b0e09,x)<<8 |
         aesProduct(0x0b0e090d,x)<<16 | aesProduct(0x0e090d0b,x)<<24;
}

function aesByteSub(x){
  var y=aesPows[255-aesLogs[x]];
  x=y;  x=rotb(x,1);
  y^=x; x=rotb(x,1);
  y^=x; x=rotb(x,1);
  y^=x; x=rotb(x,1);
  return x^y^0x63;
}

// Generate static tables
(function(){
  var i,j,m,y;
  aesPows = [ 1,3 ];
  aesLogs = [ 0,0,null,1 ];
  aesSBox = new Array(256);
  aesSBoxInv = new Array(256);
  aesFtable = new Array(256);
  aesRtable = new Array(256);
  aesRco = new Array(30);

  for ( i=2; i < 256; i++){
    aesPows[i]=aesPows[i-1]^aesXTime( aesPows[i-1] );
    aesLogs[aesPows[i]]=i;
  }

  aesSBox[0]=0x63;
  aesSBoxInv[0x63]=0;
  for ( i=1; i < 256; i++){
    y=aesByteSub(i);
    aesSBox[i]=y; aesSBoxInv[y]=i;
  }

  for (i=0,y=1; i < 30; i++){ aesRco[i]=y; y=aesXTime(y); }

  for ( i=0; i < 256; i++){
    y = aesSBox[i];
    aesFtable[i] = aesXTime(y) | y<<8 | y<<16 | (y^aesXTime(y))<<24;
    y = aesSBoxInv[i];
    aesRtable[i]= aesMult(14,y) | aesMult(9,y)<<8 |
                  aesMult(13,y)<<16 | aesMult(11,y)<<24;
  }

  aesFi = new Array(12);
  aesRi = new Array(12);

  for (m=j=0;j<4;j++,m+=3){
    aesFi[m]=(j+1)%4;
    aesFi[m+1]=(j+2)%4;
    aesFi[m+2]=(j+3)%4;
    aesRi[m]=(4+j-1)%4;
    aesRi[m+1]=(4+j-2)%4;
    aesRi[m+2]=(4+j-3)%4;
  }

}());

function aesInit(){
  key=key.slice(0,43);
  var i,k;
  var j = 0;
  var l = key.length;

  while ( l!=16 && l!=24 && l!=32 && l!=43) key[l++]=key[j++];

  aesNk = key.length >>> 2;
  aesNr = 6 + aesNk;

  var N=4*(aesNr+1);
  aesFkey = new Array(N);
  aesRkey = new Array(N);

  for (i=j=0;i< aesNk;i++,j+=4) aesFkey[i]=getW(key,j);

  for (k=0,j=aesNk;j < N;j+=aesNk,k++){
    aesFkey[j]=aesFkey[j-aesNk]^aesSubByte(rotw(aesFkey[j-1], 24))^aesRco[k];
    if (aesNk<=6)
      for (i=1;i < aesNk && (i+j) < N;i++) aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];
    else{
      for (i=1;i<4 &&(i+j) < N;i++) aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];
      if ((j+4) < N) aesFkey[j+4]=aesFkey[j+4-aesNk]^aesSubByte(aesFkey[j+3]);
      for (i=5;i < aesNk && (i+j) < N;i++) aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];
    }
  }

  for (j=0;j<4;j++) aesRkey[j+N-4]=aesFkey[j];
  for (i=4;i < N-4;i+=4){
    k=N-4-i;
    for (j=0;j < 4;j++) aesRkey[k+j]=aesInvMixCol(aesFkey[i+j]);
  }
  for (j=N-4;j < N;j++) aesRkey[j-N+4]=aesFkey[j];
}

function aesClose(){
  aesFkey=aesRkey=null;
}

function aesRounds( block, key, table, inc, box ){
  var tmp = new Array( 4 );
  var i,j,m,r;

  for ( r=0; r<4; r++ ) block[r]^=key[r];
  for ( i=1; i < aesNr; i++ ){
    for (j=m=0;j<4;j++,m+=3){
      tmp[j]=key[r++]^table[block[j]&0xFF]^
			rotw(table[(block[inc[m  ]] >>> 8)&0xFF], 8)^
			rotw(table[(block[inc[m+1]] >>>16)&0xFF],16)^
			rotw(table[(block[inc[m+2]] >>>24)&0xFF],24);
    }
    var t=block; block=tmp; tmp=t;
  }

  for (j=m=0;j<4;j++,m+=3)
    tmp[j]=key[r++]^box[block[j]&0xFF]^
           rotw(box[(block[inc[m  ]] >>> 8)&0xFF], 8)^
           rotw(box[(block[inc[m+1]] >>>16)&0xFF],16)^
           rotw(box[(block[inc[m+2]] >>>24)&0xFF],24);
  return tmp;
}

function _encrypt(){
  aesUnpackBlock( aesRounds(aesPackBlock(), aesFkey, aesFtable, aesFi, aesSBox ) );
}

function _decrypt(){
  aesUnpackBlock( aesRounds(aesPackBlock(), aesRkey, aesRtable, aesRi, aesSBoxInv ) );
}

// Blockcipher

function blcEncrypt(enc){
	if (tot === 0){
		if (key.length < 1) return;
		for (aes_i=0; aes_i<16; ++aes_i) bData.unshift( _rand(256) );
		while( bData.length%16 !== 0 ) bData.push(0);
		tot = bData.length;
		aesInit();
	}else{
		for (aes_j=aes_i; aes_j < aes_i+16; aes_j++)
		bData[aes_j] ^= bData[aes_j-16];
		enc();
	}
	if (aes_i >= tot) aesClose();
}

function blcDecrypt(dec){
	// initialize length
	if (tot === 0){
		if (key.length<1) return false;
		aes_i=16;
		tot = bData.length;
		if ( (tot%16) || (tot < aes_i) ) {
			woas.log('AES: Incorrect length (tot='+tot+', aes_i='+aes_i+')'); //log:1
			return false;
		}
		aesInit();
	} else {
		aes_i=tot-aes_i;
		dec();
		for (aes_j=aes_i-16; aes_j < aes_i; aes_j++) bData[aes_j] ^= bData[aes_j-16];
		aes_i = tot+32-aes_i;
	}
	if (aes_i>=tot){
		aesClose();
		bData.splice(0,16);
		// remove 0s added for padding (supposedly!)
		while(bData[bData.length-1] === 0) bData.pop();
	}
	return true;
}

// @module aes
woas.AES = {
	// sets global key to the utf-8 encoded key (byte array)
	setKey: function(sKey) {
		key = woas.utf8.encode_to_array(sKey);
	},
	clearKey: function(){
		key = [];
	},
	// keep 'key' private to this code
	isKeySet: function(){
		return key.length > 0;
	},
	// returns an array of encrypted characters from a string
	encrypt: function(raw_data){
		var rv;
		bData = woas.utf8.encode_to_array(raw_data);
		aes_i = tot = 0;
		do {
			blcEncrypt(_encrypt);
		}
		while (aes_i < tot);
		rv = bData;
		bData = null;
		return rv;
	},
	// returns a base64 string of encrypted characters from a string
	encryptB64: function(raw_data){
		return woas.base64.encode_array(this.encrypt(raw_data));
	},
	// decrypts an array of encrypted characters to a string
	decrypt: function(raw_data){
		var rv;
		bData = raw_data;
		aes_i = tot = 0;
		do {
			if (!blcDecrypt(_decrypt))
				return null;
		}
		while (aes_i < tot);
		rv = woas.utf8.decode_from_array(bData);
		bData = [];
		return rv;
	},
	// decrypts a base64 string of encrypted characters to a string
	decryptB64: function(raw_data){
		return this.decrypt(woas.base64.decode_array(raw_data));
	}
};

}()); // end of AES closure

/*** src/framework.js ***/

// PVHL: a simple log while code is loading; replaced by _set_debug
//	call woas.log() with console open if code crashes before _on_load set-up
woas.temp_log = []
woas.log = function(msg) {
	typeof msg === 'string' ? this.temp_log.push(msg) :
		console.log(this.temp_log.join('\n'));
}
woas.log("*** WoaS v"+woas.version+" started");

// PVHL: need to refactor this code; we don't need to know what "isn't",
//	just what 'is', unless using unnecessary 'if (x === true)'; use 'if (x)'
//
//  This code can be greatly reduced in size and complexity, but user strings
//	are inherently unreliable and should not be used for this purpose;
//	e.g.: http://www.useragentstring.com/pages/Internet%20Explorer/
//
// Note: some attempt has been made to find browser version #, or at least
// recognize browser. So may be '8.0' or 'true'. Number(true) === 1.
// Inconsistent in that IE has an actual number, others a string; will fix later
woas.browser = {
	// browsers - when not 'false' contains the version string if known
	ie: false,
	firefox: false,
	opera: false,
	safari: false,
	chrome: false,

	// versions - used internally, should not be used by external plugins
	ie6: false, ie8: false,
	firefox2: false,
	firefox3: false, firefox_new: false,

	// engines - set to true when present
	// gecko and webkit will (hopefully) contain the engine version
	gecko: false, webkit: false, presto: false, trident: false
};

// using both tests (for IE11 break), in case documentMode disappears in the future
var ie = !!document.documentMode || navigator.userAgent.indexOf("Trident/") !== -1,
	m; // m used to match browser version

if (window.opera || navigator.userAgent.indexOf(' OPR/') !== -1) {
	m = navigator.userAgent.match(/Opera\/(\S+)/);
	woas.browser.opera = m && m[1] || true;
}
else if (navigator.userAgent.indexOf("Chrome") !== -1) {
	// detect version
	m = navigator.userAgent.match(/Chrome\/([^\s]+)/);
	woas.browser.chrome = m && m[1] || true;
}
else if (navigator.userAgent.toLowerCase().indexOf("applewebkit") !== -1) {
	// Safari never publicizes its version
	woas.browser.safari = true;
}
// TODO: FF is only browser we don't try to get version for; inconsistent
else if (navigator.appName == "Netscape" && !ie) {
	// check that it is Gecko first
	woas.browser.firefox = /Gecko\/\d/.test(navigator.userAgent);
	// match also development versions of Firefox "Shiretoko" / "Namoroka"
	if (woas.browser.firefox) {
		// match last word of userAgent
		m = navigator.userAgent.match(/rv:([^\s\)]*)/);
		woas.browser.gecko = m && m[1] || "1"; // "1" because we know it's Gecko
		switch (woas.browser.gecko.substr(0,3)) {
			case "1.8":
				woas.browser.firefox2 = true;
			break;
			case "1.9":
				woas.browser.firefox3 = true;
			break;
			default:
				if (Number(woas.browser.gecko.substr(0,3)) > 1.9) {
					woas.browser.firefox_new = true;
				}
		}
	} // not Gecko
}
// TODO: we are not taking into account the actual mode IE is emulating:
// msdn.microsoft.com/en-us/library/ie/cc196988.aspx
else if (ie || /*@cc_on!@*/0 || (navigator.appName).indexOf("Microsoft") !== -1) {
	m = navigator.userAgent.match(/(?:MSIE\s|rv:)([^.;)]+)/);
	// just need to know which one; we're past 5.5 days
	woas.browser.ie = m && Number(m[1]) || true;
	// PVHL: ie6 & ie8 are misnamed and have no place in a sniff routine -- call
	// them what they are. Needed true IE8 test in code and got fooled by this;
	// ie8 detects 8+, ie6 detects 6 & 7.
	woas.browser.ie8 = document.documentMode ? true : false;
	if (!woas.browser.ie8)
		woas.browser.ie6 = window.XMLHttpRequest ? false : true;
	// used in help resizing; will replace if better detection found; research
	woas.browser.fh_old = woas.browser.ie === 7;
}
else {
	woas.log("NOTE: unknown browser");
}

// engine type - for plugins
if (woas.browser.ie) {
	woas.browser.trident = true;
}
else if (woas.browser.chrome || woas.browser.safari) {
	m = navigator.userAgent.match(/AppleWebKit\/(\S+)/);
	woas.browser.webkit = m && m[1] || true;
}
else if (woas.browser.opera)
	woas.browser.presto = true;
m = ie = undefined;

var is_windows = (navigator.appVersion.toLowerCase().indexOf("windows")!=-1);

// PVHL: is there a reason we don't use document.location.protocol?
woas._server_mode = !/^file:\/\//.test(document.location.toString());

// test for java moved to _on_load

// set correct HTML routines
woas.getHTML = woas.getHTMLDiv = function(elem) {return elem.innerHTML;};
woas.setHTML = woas.setHTMLDiv = function(elem, html) {elem.innerHTML = html;};
// PVHL: is the following warning still true? Take out of onload function
// DO NOT use setHTML for the document.body object in IE browsers
if (woas.browser.ie && woas.browser.ie < 9) {
	woas.setHTML = function(elem, html) {elem.text = html;};
	woas.getHTML = function(elem) {return elem.text;};
}

// returns the DOM element object given its id - logs errors when debugging
// PVHL: have removed try/catch as very slow in JS; also changed alert to
//   log entry - some code uses d$ to check existence of node. Should be
//   refactored as debug_mode can change during session. Should also change
//   others to add error capability; they mostly assume the node exists.
//   This no longer catches reference errors, but these are programming errors
//   and any developer is using a debugger; simply can't see the need.
/*
function d$(id){
	var el = document.getElementById(id);
	if (el === null && woas.config.debug_mode) { // only one test if OK
		woas.log("Invalid reference for d$(id): '"+id+"'");
	}
	return el;
}
*/

// displays id if show is true (optional), otherwise hides id
// sets display to block if type not given or 0 or false, inline if type is 1 or true,
// and inline-block if type is 2.
// (inline-block is not well supported by old browsers; use with care.)
//
// changed to: d$([resize/state], id, [show], [type]).
// If show is -1 (toggle display) or resize is false returns state, otherwise node
// so resize can be omitted, false:return state, true:resize,
// show can be omitted, -1:toggle, 0|false:off, 1|true (evaluates true):on.
// type can be omitted or evaluate false: block, 1: inline, 2: inline-block (not well supported) 
// And now d$ does everything that all the other functions used to do, and
// quickly, and is backward compatible to old d$.
// Examples (the node itself can also be passed instead of id string in all examples):
//	d$('id') returns node
//	d$('id', true) sets id to 'display:block'; returns node
//	d$('id', false) sets id to 'display:none'; returns node
//	d$('id', -1) toggles id between 'display:block' and 'display:none'; returns new display state (true/false)
//	d$('id', -1, true) toggles id between 'display:inline' and 'display:none'; returns new display state
//	d$(true, 'id', -1) toggles id as above (block/none) and resizes display; returns new display state
//	d$(true, 'id', -1, 2) toggles id (block-inline/none) and resizes display; returns new display state
//  d$(false, 'id') returns display state; equivalent to d$.is_visible('id')

d$ = function() {
	var as = Array.prototype.shift,
		id = as.call(arguments),
		r = false, show, id, type;
	if (typeof id === 'boolean') {
		if (id === true) {
			r = true; // optional 'resize' found
		} else {
			show = 2; // optional 'return state' found
		}
		id = as.call(arguments);
	}
	if (typeof id === 'string') {
		type = id;
		id = document.getElementById(id);
	}
	if (!id) {
		if (woas.config.debug_mode) {
			woas.log("Invalid reference for d$(id): '"+(type || id)+"'");
		}
		return null;
	}
	if (show !== undefined) {
		return !!id.clientWidth; // current 'display' status
	}
	show = as.call(arguments);
	if (show !== undefined) {
		type = as.call(arguments);
		if (show === -1) {
			show = !id.clientWidth; // toggle
		}
		if (show) {
			id.style.display = type
				? type === 2 ? 'inline-block' : 'inline'
				: 'block';
		} else {
			id.style.display = 'none';
		}
	}
	if (r) {
		woas.ui._resize();
	}
	return id;
};

d$.RESIZE = true;
d$.STATE = false;
d$.TOGGLE = -1;
d$.ON = true;
d$.OFF = false;
d$.BLOCK = 0;
d$.INLINE = 1;
d$.INLINE_BLOCK = 2;

d$.checked = function(id) {
	//FIXME: configuration should not be changed by reading a property!!
	woas.cfg_changed = true;
	return !!d$(id).checked;
};

// obviated; 'd$' replaces
d$.hide = function(id) {
	d$(id).style.display = 'none';
};

d$.is_visible = function(id) {
	var el = d$(id);
	return !!(el && el.offsetWidth);
};

// obviated; 'd$' replaces
d$.show = function(id, inline) {
	d$(id).style.display = inline ? 'inline' : 'block';
};

// always resizes to be safe
d$.toggle = function(id, inline) {
	var d = d$(id);
	d.style.display = d.offsetWidth ? 'none' : inline ? 'inline' : 'block';
	woas.ui._resize();
};

/*
PVHL: All very transitional

FileList.files contains selected files and has length. It contains (from MDN):
  name: The file's name as a read-only string. This is just the file name, and
    does not include any path information.
  size: The size of the file in bytes as a read-only 64-bit integer.
  type: The MIME type of the file as a read-only string, or "" if the type
    couldn't be determined.
  lastModifiedDate: (not mentioned by MDN) Standard?
Filer code will be rewritten to emulate these members and use them when able,
and add to the object, or a replica, the other information needed, such as
'path'.

get file object from file control on page and create 'file' object
'id' is string or node
'no_id' (optional) creates an object from filename passed in as 'id`.
  If 'no_id' === true, File-like object created from id string
  If 'no_id' === -1, id string checked for validity
  If 'no_id' === -2, id string checked for validity and user alerted if no file
'relative' [optional, and only with 'no_id') converts path to relative
Returns File object containing all available information for file and
reader capabilities if no 'no_id' flag, else returns File-like object with
'name', and parent list set for 'path' (all for DRY/info hide).
Some of this will be updated later with File and FileList factories.
Gets directory information if available (full path not needed if control
can be used to read file, except for wsif multifile import, but useful)
IE (tested to 10) contains full path, FF did up to 3.5; Chrome/Opera and others
now return a fake path
TODO: FF, possibly others, can also use file drop onto control (my tests
  with Chrome gave unexpected results
TODO: ability to pass in file filter for extension/type checking: "Are you
  sure?" Some controls allow a filter to be set, AFAIK
*/
// TODO: will become woas.filer.file
d$.file = function(id, no_id, relative) {
// TODO: will be separate function in filer
	function makeFile(full) {
		if (full && !fn[1])
			return false;
		// a bit of documentation for our File object
		var f = {
			name: fn[2],
			r: null, // for current code; remove after update
			//ndx: 0, not needed in File when length = 1 
			list: {
				length: 1
				// not needed when length = 1 if just using File (so far)
				// [0] = this file object
			}
		};
		if (fn[1])
			f.list.path = fn[1];
		// TODO: object extension here when separate function
		return f;
	}

	var reTest = /^(.*[\/\\])?([^\/\\]+)$/, fn, file;
	if (!no_id) {
		id = id && d$(id);
		// no control found; d$ logged developer error
		if (!id)
			return null;
	}
	fn = woas.trim(no_id ? id : id.value);
	// fn[1]: path, fn[2]: file
	fn = fn.match(reTest);
	if (!fn || !fn[2]) {
		if (!no_id || no_id === -2)
			woas.alert(woas.i18n[no_id ? 'FILE_ENTRY_ERR':'FILE_SELECT_ERR']);
		return false;
	}
	fn[1] = (!fn[1] || fn[1] === 'C:\\fakepath\\') ? '' : fn[1];
	// ensure path is correct for system
	if (fn[1])
		fn[1] = fn[1].replace(/[\\\/]+/g, is_windows ? '\\' : '/')
	// known path gathered; make objects
	if (no_id) {
		// not from a file control
		if (relative && fn[1]) {
			if (fn[1][0] === '\\' || fn[1][0] === '/')
				fn[1] = fn[1].substr(1);
		}
		// just checking a filename
		if (no_id < 0) {
			id = {path: fn[1], name:fn[2]};
			fn = null; // [when] did IE memory leaks from this end?
			return id;
		}
		// returning a File-like object with path, or false
		// (or could add document path to it)
		file = makeFile(true);
	}
	else {
		// returning an augmented File object; maybe no path
		if (id.files) {
			// we have a modernish file control
			file = id.files;
			file.path = fn[1];
			if (window.FileReader)
				file.reader = true;
			// I believe getAs only ever worked for FF 3.0 - 3.5
			if (file[0].getAsText)
				file.getAs = true;
			// convert to File object
			file[0].list = file;
			file = file[0];
			// for present code; will remove after update; should be undefined
			file.r = null;
		}
		else {
			file = makeFile();
		}

		// try to obtain path from firefox
		if (!file.list.path && woas.browser.firefox &&
				!file.list.getAs && !file.list.reader) {
			if (parseFloat(woas.browser.gecko) < 17) {
				try {
					netscape.security.PrivilegeManager.
						enablePrivilege("UniversalXPConnect");
					fn = id.value.match(reTest);
					file.list.path = fn[1] || ''
				}
				catch (e) {
				}
				if (!file.list.path)
					this.file.ffMsg = 1;
			}
			else {
				this.file.ffMsg = 2;
			}
		}
	}
	fn = null;
	return file;
}

// couldn't get path; allows overriding of prompt function
d$.file.path_prompt = function(file) {
	var msg, path;
	if (!this.fnameMsg || this.fnameMsg !== this.ffMsg) {
		if (this.ffMsg === 1)
			msg ='Unable to access local file path information due to ' +
				'browser security settings.\n\nTo fix this upgrade your ' +
				'browser, or use the WoasFox (best) or TiddlyFox extension,' +
				'or follow these steps:\n' +
				'(1) Enter "about:config" in the URL field;\n' +
				'(2) Right click and select New->Boolean;\n' +
				'(3) Enter "signed.applets.codebase_principal_support" ' +
				'    (without the quotes) as a new preference name;\n' +
				'(4) Click OK and try loading the file again.\n\n';
		else if (this.ffMsg === 2)
			msg = 'Unable to access local files due to browser security settings.' +
				'\n\nTo fix this use the WoasFox (best) or TiddlyFox extension.\n\n';
		else
			msg = woas.i18n.ALT_BROWSER_MSG;
	}
	else {
		msg = '';
	}
	this.fnameMsg = this.ffMsg; // stop repeated display of same information
	// get full path and test it
	path = prompt(msg+woas.i18n.ALT_BROWSER_INPUT.sprintf(file.name),
		woas.ROOT_DIRECTORY);
	if (path) {
		// minor checking of path entered; new filename will not be accepted
		if (path.substr(-1) !== woas.DIRECTORY_SEPARATOR)
			path += woas.DIRECTORY_SEPARATOR;
		if (file.list)
			file.list.path = path;
	}
woas.log("d$.file.path_prompt path: "+file.list.path+", name: "+file.name);
	return !!path;
}

// PVHL: shallow object copy; prefer shallow extend, with filter; was d$.clone
woas.clone = function(obj) {
	var nobj = {};
	for (var i in obj) {
		nobj[i] = obj[i];
	}
	return nobj;
};

// fixes the Array prototype for older browsers
if (typeof Array.prototype.push == "undefined") {
  Array.prototype.push = function(str) {
    this[this.length] = str;
  };
}

// the following methods complete the Array object for non-compliant browsers
if (typeof Array.prototype.splice == "undefined") {
  Array.prototype.splice = function(offset, length) {
    var temp = [];
    for (var i = this.length - 1; i >= 0; i--) {
      if (i < offset || i > (offset + length - 1)) {
        temp[temp.length] = this[i];
      }
      this.length--;
    }
    for (i = temp.length - 1; i >= 0; i--) {
      this[this.length] = temp[i];
    }
    return this;
  };
}

if (typeof Array.prototype.indexOf == "undefined") {
	Array.prototype.indexOf = function(val, fromIndex) {
		if (typeof(fromIndex) != 'number') fromIndex = 0;
		for (var index = fromIndex,len = this.length; index < len; index++)
			if (this[index] == val) return index;
		return -1;
	};
}

// implements a custom function which returns an array with unique elements - deprecated
Array.prototype.toUnique = function() {
	var a_o = {}, new_arr = [];
	var l=this.length;
	for(var i=0; i<l;i++) {
		if (a_o[this[i]]===undefined) {
			a_o[this[i]] = true;
			new_arr.push(this[i]);
		}
	}
	if (new_arr.length!=l)
		return new_arr;
	return this;
};

// provide regex escaping
// thanks to S.Willison
RegExp.escape = function(text) {
  if (!arguments.callee.sRE) {
    var specials = ['/', '.', '*', '+', '?', '|', '$', '(', ')', '[', ']', '{', '}', "\\" ];
    arguments.callee.sRE = new RegExp(
      "(\\" + specials.join("|\\") + ')', 'g'
    );
  }
  return text.replace(arguments.callee.sRE, "\\$1");
};

// repeat string s for n times
if (typeof String.prototype.repeat == "undefined") {
	String.prototype.repeat = function(n) {
		var r = "";
		while (--n >= 0) r += this;
		return r;
	};
}

// return a random integer given the maximum value (scale)
function _rand(scale) {
	return Math.floor(Math.random() * scale);
}

// returns a random string of given string_length
function _random_string(string_length) {
	var chars = "ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
	var randomstring = '';
	for (var i=0; i < string_length; i++) {
		var rnum = _rand(chars.length);
		randomstring += chars.charAt(rnum);
	}
	return randomstring;
}

// converts the number of bytes to a human readable form
function _convert_bytes(bytes, p) {
	var U=['bytes','Kb','Mb','Gb','Pb'], n = 0;
	if (typeof p !== 'number') { p = 2; }
	bytes = Math.ceil(bytes);
	while (bytes >= 1024 && n < 4) {
		 ++n;
		 bytes /= 1024;
	}
	return bytes.toFixed(p).replace(/\.0+$/, "") +' '+ U[n];
}
/*
// implement an sprintf() bare function
String.prototype.sprintf = function() {
	// check that arguments are OK
	if (typeof arguments == "undefined") { return null; }
	// next argument to pick
	var i_pos = 0, max_pos = arguments.length - 1;
	var fmt_args = arguments;
	return this.replace(/%[sd]/g, function(str) {
		// replace with the original unparsed token in case of undefined parameter
		if (i_pos > max_pos)
			return str;
		//if (str == '%d')
			//return Number(arguments[i_pos++]);
		//return '%s' string
		return fmt_args[i_pos++];
	});
};
*/
/* PVHL:
- previous version wasn't catching undefined arguments in Firefox
- string can now include a '%': use '100%% correct, %s'. Should drop %d; this isn't sprintf.
- added a log msg if called with no arguments.
- consider change of name; sprintf means nothing to js programmers plus this isn't that. fmt?
- we need to have better i18n support; better to ask for a formatted string by passing
  arguments to an i18n object than add to String prototype; gives better error messages too.
- could have log error message if arguments not as expected. If keeping %d/%s then should
  check if correct.
*/
String.prototype.sprintf = function() {
	// check arguments exist; return original string if not
	if (!arguments || arguments.length === 0) {
		woas.log("ERROR: String.sprintf called with no arguments on '" + this + "'");
		return this;
	}
	var i = 0, a = arguments;
	return this.replace(/%((%)|[sd])/g, function(str, $1, keep) {
		// keep original unparsed token in case of undefined parameter; use %% for a %
		return keep || (i < a.length ? a[i++] : str);
	});
};

// get filename of currently open file in browser
// PVHL: TODO: why isn't window.location.pathname used here?
//	TODO: this will fail if IE permissions don't allow
function _get_this_filename() {
	var filename = unescape(document.location).replace(/[?#].*$/, "");
	if (woas.browser.opera)
		filename = filename.replace(/^file:\/\/[^\/]+/, '');
	else {
		if (filename.indexOf("file://") === 0) // all browsers
			filename = filename.substr(7);
		if (filename.indexOf("///") === 0) // firefox
			filename = filename.substr(1);
	}
	if (is_windows) {
		// convert unix path to windows path
		filename = filename.replace(reFwdSlash, "\\");
		if (filename.substr(0,2) !== "\\\\") {
			// if this is not a network path - true of Firefox for example
			if (/^\\\w:\\/.test(filename))
				// remove leading slash before drive letter
				filename = filename.substr(1);
			if (filename.charAt(1) !== ':' && woas.browser.ie)
					filename = "\\\\"+filename;
		}
	}
	return filename;
}

function ff_fix_focus() {
	//runtime fix for Firefox bug 374786
	if (woas.browser.firefox)
		d$("woas_page").blur();
}

if (is_windows) {
	var reFwdSlash = new RegExp("/", "g");
	woas.fix_path_separators = function(path) {
		return path.replace(reFwdSlash, woas.DIRECTORY_SEPARATOR);
	};
} else { // UNIX or similar, no path change
	woas.fix_path_separators = function(path) {
		return path;
	};
}

woas.base64 = {
	_b64arr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
	reValid: /^[A-Za-z0-9+\/=]+$/
};

// PVHL: btoa apparently doesn't work properly with UTF8 (can translate chars?),
// and my new encode_array was corrupting bytes because fromCharCode does the
// same thing with some chars. Disabled until after further research
if (false/*window.atob*/) {
	woas.base64.encode = function(input) {
		return btoa(input);
	};

	// TODO: not working in IE10 - characters changed by charCodeAt
	// Probably others too.
	woas.base64.encode_array = function(input) {
		var i, l = input.length, arr = [];
		for (i = 0; i < l; i++) {
			arr[i] = String.fromCharCode(input[i]);
		}
		return btoa(arr.join(''));
	};

	woas.base64.decode = function(input, z) {
		if (!z || z > input.length) {
			z = input.length;
		}
		return atob(input.substr(0, z));
	};

	woas.base64.decode_array = function(input, z) {
		var i, l, arr = [];
		if (!z || z > input.length) {
			z = input.length;
		}
		input = atob(input.substr(0, z));
		l = input.length;
		for (i = 0; i < l; i++) {
			arr[i] = input.charCodeAt(i);
		}
		return arr;
	};
} else { //IE < 10

	woas.base64.encode = function(input) {
		var c1, c2, c3, i = 0, left, z, output = [];
		left = input.length % 3;
		z = input.length - left;
		while (i < z) {
			// charCodeAt will change some codes
			c1 = input.charCodeAt(i++);
			c2 = input.charCodeAt(i++);
			c3 = input.charCodeAt(i++);
			output.push(this._b64arr.charAt(c1 >> 2));
			output.push(this._b64arr.charAt(((c1 & 3) << 4) | (c2 >> 4)));
			output.push(this._b64arr.charAt(((c2 & 15) << 2) | (c3 >> 6)));
			output.push(this._b64arr.charAt(c3 & 63));
		}
		if (left) {
			c1 = input.charCodeAt(i++);
			c2 = left === 2 ? input.charCodeAt(i) : Number.NaN;
			output.push(this._b64arr.charAt(c1 >> 2));
			output.push(this._b64arr.charAt(((c1 & 3) << 4) | (c2 >> 4)));
			output.push(isNaN(c2) ? "=" : this._b64arr.charAt(((c2 & 15) << 2)));
			output.push('=');
		}
		return output.join('');
	};

	woas.base64.encode_array = function(input) {
		var c1, c2, c3, i = 0, left, z, output = [];

		left = input.length % 3;
		z = input.length - left;
		while (i < z) {
			c1 = input[i++];
			c2 = input[i++];
			c3 = input[i++];
			output.push(this._b64arr.charAt(c1 >> 2));
			output.push(this._b64arr.charAt(((c1 & 3) << 4) | (c2 >> 4)));
			output.push(this._b64arr.charAt(((c2 & 15) << 2) | (c3 >> 6)));
			output.push(this._b64arr.charAt(c3 & 63));
		}
		if (left) {
			c1 = input[i++];
			c2 = left === 2 ? input[i] : Number.NaN;
			output.push(this._b64arr.charAt(c1 >> 2));
			output.push(this._b64arr.charAt(((c1 & 3) << 4) | (c2 >> 4)));
			output.push(isNaN(c2) ? "=" : this._b64arr.charAt(((c2 & 15) << 2)));
			output.push('=');
		}
		return output.join('');
	};

	woas.base64.decode = function(input, z) {
		var enc1, enc2, enc3, enc4, i = 0, l = input.length, output = [];
		z = !z || z > l ? l - 4 : z - 4;
		if (z >= 0) {
			while (i < z) {
				enc1 = this._b64arr.indexOf(input.charAt(i++));
				enc2 = this._b64arr.indexOf(input.charAt(i++));
				enc3 = this._b64arr.indexOf(input.charAt(i++));
				enc4 = this._b64arr.indexOf(input.charAt(i++));
				output.push(String.fromCharCode((enc1 << 2) | (enc2 >> 4)));
				output.push(String.fromCharCode(((enc2 & 15) << 4) | (enc3 >> 2)));
				output.push(String.fromCharCode(((enc3 & 3) << 6) | enc4));
			}
			enc1 = this._b64arr.indexOf(input.charAt(i++));
			enc2 = this._b64arr.indexOf(input.charAt(i++));
			enc3 = this._b64arr.indexOf(input.charAt(i++));
			enc4 = this._b64arr.indexOf(input.charAt(i));
			output.push(String.fromCharCode((enc1 << 2) | (enc2 >> 4)));
			if (enc3 !== 64) {
				output.push(String.fromCharCode(((enc2 & 15) << 4) | (enc3 >> 2)));
			}
			if (enc4 !== 64) {
				output.push(String.fromCharCode(((enc3 & 3) << 6) | enc4));
			}
		}
		return output.join('');
	};

	woas.base64.decode_array = function(input, z) {
		var enc1, enc2, enc3, enc4, i = 0, l = input.length, output = [];
		z = !z || z > l ? l - 4 : z - 4;
		if (z >= 0) {
			while (i < z) {
				enc1 = this._b64arr.indexOf(input.charAt(i++));
				enc2 = this._b64arr.indexOf(input.charAt(i++));
				enc3 = this._b64arr.indexOf(input.charAt(i++));
				enc4 = this._b64arr.indexOf(input.charAt(i++));
				output.push((enc1 << 2) | (enc2 >> 4));
				output.push(((enc2 & 15) << 4) | (enc3 >> 2));
				output.push(((enc3 & 3) << 6) | enc4);
			}
			enc1 = this._b64arr.indexOf(input.charAt(i++));
			enc2 = this._b64arr.indexOf(input.charAt(i++));
			enc3 = this._b64arr.indexOf(input.charAt(i++));
			enc4 = this._b64arr.indexOf(input.charAt(i));
			output.push((enc1 << 2) | (enc2 >> 4));
			if (enc3 !== 64) {
				output.push(((enc2 & 15) << 4) | (enc3 >> 2));
			}
			if (enc4 !== 64) {
				output.push(((enc3 & 3) << 6) | enc4);
			}
		}
		return output;
	};
}

woas.utf8 = {
	// encode from string to string
	encode: function(s) {
		return unescape( encodeURIComponent( s ) );
	},

	encode_to_array: function(s) {
		return woas.split_bytes( this.encode(s) );
	},
	decode: function(s) {
		return decodeURIComponent(escape(s));
	},
	decode_from_array: function(byte_arr) {
		try {
			return this.decode( woas.merge_bytes( byte_arr ) );
		}
		catch (e) {
			woas.log('ERROR - woas.utf8.decode_from_array: '+e); //log:1
		}
		return null;
	},

	reUTF8Space: /[^\u0000-\u007F]+/g,

	// convert UTF8 sequences of the XHTML source into &#dddd; sequences
	do_escape: function(src) {
		return src.replace(this.reUTF8Space, function ($1) {
			var l=$1.length;
			var s="";
			for(var i=0;i < l;i++) {
				s+="&#"+$1.charCodeAt(i)+";";
			}
			return s;
		});
	}

};

// tool to read/store flags in an integer
woas.bitfield = {
	// 32bit full mask
	_field_mask: [0x1, 0x2, 0x4, 0x8, 0x10, 0x20, 0x40, 0x80,
				0x100, 0x200, 0x400, 0x800, 0x1000, 0x2000, 0x4000, 0x8000,
				0x10000, 0x20000, 0x40000, 0x80000, 0x100000, 0x200000, 0x400000, 0x800000,
				0x1000000, 0x2000000, 0x4000000, 0x8000000, 0x10000000, 0x20000000, 0x40000000, 0x80000000],

	get: function(bm, pos) {
		return (bm & this._field_mask[pos]) ? true : false;
	},

	set: function(bm, pos, value) {
		if (value)
			return bm | this._field_mask[pos];
		return bm & ~this._field_mask[pos];
	},

	// return an integer after having parsed given object with given order
	get_object: function(obj, order) {
		var rv = 0;
		for(var i = 0; i < order.length; ++i) {
			if (obj[order[i]])
				rv |= this._field_mask[i];
		}
		return rv;
	},

	// set object properties to true/false after parsing the bits by given order
	set_object: function(obj, order, bm) {
		for(var i = 0; i < order.length; ++i) {
			obj[order[i]] = (bm & this._field_mask[i]) ? true : false;
		}
	}
};

// natural sorting algorithms by B.Huisman
// original algorithms by D.Koelle
// http://my.opera.com/GreyWyvern/blog/show.dml/1671288
woas.chunkify = function(t) {
    var tz = [], x = 0, y = -1, n = 0, i, j;

    while (i = (j = t.charAt(x++)).charCodeAt(0)) {
      var m = (i == 46 || (i >=48 && i <= 57));
      if (m !== n) {
        tz[++y] = "";
        n = m;
      }
      tz[y] += j;
    }
    return tz;
};

woas.strnatcmp = function(a, b) {
  var	aa = woas.chunkify(a),
		bb = woas.chunkify(b);

  for (var x = 0; aa[x] && bb[x]; x++) {
    if (aa[x] !== bb[x]) {
      var c = Number(aa[x]), d = Number(bb[x]);
      if (c == aa[x] && d == bb[x]) {
        return c - d;
      } else return (aa[x] > bb[x]) ? 1 : -1;
    }
  }
  return aa.length - bb.length;
};

/*
Array.prototype.natsort = function(caseInsensitive) {
  for (var z = 0, t; t = this[z]; z++) {
    this[z] = [];
    var x = 0, y = -1, n = 0, i, j;

    while (i = (j = t.charAt(x++)).charCodeAt(0)) {
      var m = (i == 46 || (i >=48 && i <= 57));
      if (m !== n) {
        this[z][++y] = "";
        n = m;
      }
      this[z][y] += j;
    }
  }

  this.sort(function(a, b) {
    for (var x = 0, aa, bb; (aa = a[x]) && (bb = b[x]); x++) {
      if (caseInsensitive) {
        aa = aa.toLowerCase();
        bb = bb.toLowerCase();
      }
      if (aa !== bb) {
        var c = Number(aa), d = Number(bb);
        if (c == aa && d == bb) {
          return c - d;
        } else return (aa > bb) ? 1 : -1;
      }
    }
    return a.length - b.length;
  });

  for (var z = 0; z < this.length; z++)
    this[z] = this[z].join("");
}
*/

/*** src/loadsave.js ***/

/*

PVHL: load/save routines have been changed to use a 'files' object.
This object contains all the information regarding file(s) being loaded or
saved. If it comes from a file input control it is a modified fileList object,
otherwise an ordinary object with similar properties. This will greatly
improve things in the future and ease development of multiple file saving.

file = {
	id        - id of file control; present if interactive file read
	name      - only added if a single file involved
	path      - if path available or forced by caller
	length    - only present if multiple files or an HTML file object
	[0]       - only present alone if an HTML file object
	[1 ... n] - multiple file property; HTML object or file entry object
	item()    - not used; only present for HTML file object
}

File entries may also include 'mode' if saving, and 'data' (read/write) and
will replace multi-parameter function calls with a single object passed in/out.

This system will replace the (unfinished) 'plist' array for multiple files.

d$.file() is now used from page controls.

*/

// load modes which should be supported by load/save browser bindings
woas.file_mode = {
	UTF8_TEXT:		0,
	ASCII_TEXT:		1,
	DATA_URI:		2,
	BINARY:			3,
	BASE64:			4,
	UTF16_TEXT:		8
};

woas._guess_mime = function(filename) {
	var m=filename.match(/\.(\w+)$/);
	if (m===null) m = "";
	else m=m[1].toLowerCase();
	var guess_mime = "image";
	switch (m) {
		case "png":
		case "gif":
		case "bmp":
			guess_mime += "/"+m;
			break;
		case "jpg":
		case "jpeg":
			guess_mime = "image/jpeg";
			break;
	}
	return guess_mime;
};

// creates a DATA:URI from a plain content stream
woas._data_uri_enc = function(filename, ct, guess_mime) {
	if (typeof guess_mime != "string")
		guess_mime = this._guess_mime(filename);
	// perform base64 encoding
	return "data:"+guess_mime+";base64,"+this.base64.encode(ct);
};
woas._data_uri_enc_array = function(filename, arr, guess_mime) {
	if (typeof guess_mime != "string")
		guess_mime = this._guess_mime(filename);
	// perform base64 encoding
	return "data:"+guess_mime+";base64,"+this.base64.encode_array(arr);
};

// save the currently open WoaS
// PVHL: Java file_mode has to be UTF8, or Java saves in Windows with CRLF,
// except Opera which saves LFCRLF. A note somewhere says some browsers can't
// do this, but not which ones. Tried UTF8_TEXT for saves, but IE8 saves
// are then twice the size. Using UTF8 only for Java until better testing
// possible, back to ASCII_TEXT setting for others.
woas._save_this_file = function(new_data, old_data) {
	var filename = _get_this_filename(),
		msg = this.i18n.SAVE_ERROR.sprintf(filename);
	var r = woas.save_file(filename,
		this.tiddlySaver ? this.file_mode.UTF8_TEXT : this.file_mode.ASCII_TEXT,
		this.DOCTYPE + this.DOC_START + "<"+
		"script woas_permanent=\"1\" type=\"tex"+"t/javascript\">"+
		new_data + "\n" + old_data + "<"+"/html>", true);
	if (r)
		woas.log("NOTE: \""+filename+"\" saved successfully");	// log:1
	else {
		if (this.tiddlySaver) {
			msg += "\n\n";
			// try to understand what went wrong with Java
			if (r === false)
				msg += this.i18n.UNSPECIFIED_JAVA_ERROR;
			else
				msg += this.i18n.NO_TIDDLY_SAVER;
		}
		else if (r === null) {
			msg += "\n\n"+woas.i18n.UNSUPPORTED_BROWSER.sprintf(navigator.userAgent);
		}
		this.alert(msg);
	}
	return r;
};

//API1.0: save-file handler
// NOTE: save_mode is not always enforced by browser binding
// TODO: change to use File in/out, avoiding string copies
// PVHL: TODO: make _on_load set capabilities for browser
// modified by sp, 2018-04-02
woas.save_file = function(fileUrl, save_mode, content, no_msg) {
	var r = null, file;
	if (this.browser.ie) {
		//r = this.ieSaveFile(fileUrl, save_mode, content);
		r = this.buildURL(fileUrl,content);  
	}
	// needs to be before Firefox in case FF > v16 and no plugins but Java
	else if (this.tiddlySaver) {
		//r = this.javaSaveFile(fileUrl, save_mode, content);
		r = this.buildURL(fileUrl,content);  
	}
	else if (this.browser.firefox) {
		// avoid content copying; other functions will be updated later
// FIX: needs to use new file object
		//file = { fullPath:fileUrl, mode:save_mode, str:content };
		//r = this.mozillaSaveFile(file);
		r = this.buildURL(fileUrl,content);  
	} else {
		//  fallback
		r = this.buildURL(fileUrl,content) 
	}
	
	if (r === null && !no_msg) {
		this.alert('Could not save "'+fileUrl+'"');
// during testing
//woas.log('Could not save "'+fileUrl+'"');
	}
	return r
};

// see http://dev.w3.org/2006/webapi/FileAPI/
// PVHL: removed ... FileReaderSync interface doesn't work as this disabled code assumed
/*woas.ECMALoadFile = function(fileUrl, load_mode, suggested_mime) */

// API1.0: load-file handler
/*
Code is in transition to async file read of modern browsers. For now it accepts
a File or File-like object and also the old parameters, but these will disappear
soon. The File object will contain a reference to parent FileList if there is one,
and its index there. FileLists will be created by future, possibly asynchronous,
multifile readers (will be used by at least the WSIF data source reader). 
*/
// returns contents of a single file, false if load possible but failed, or null
// 'f' is a FileList File-like object that includes 'list' reference unless
// it is using the old parameters, then it is the filename string.
// f.reader and f.getAs only present if load originated from a file input.
// TODO: change to only allow FileList File-like object
// parameters used to be fileUrl, [load_mode], [mime]
woas.load_file = function(f, load_mode, mime){
	// to make user debug simple while testing; need to dig up my object logger
	function log(where) {
		var msg = "load_file "+(where||"")+" - file: "+f;
		if (load_mode)
			woas.log(msg+", load_mode: "+load_mode+", mime: "+mime);
		if (!(fl && fl.index))
		woas.log(msg+"\n  list members - path: "+fl.path+", no_async: "+
			fl.no_async+", reader: "+fl.reader+", getAs: "+fl.getAs+
			"\n  file members - name: "+f.name+", mode: "+f.mode+", mime: "+
			f.mime+"\n  results -  r: "+f.r+", last loader: "+f.last_loader+
			", xhr_path: "+f.xhr_path+", str (first 10): "+
			(f.str && f.str.substr(0,10)));
	}
	var fl, r, old, fn, fp, n, chk;
//log("enter");
	if (typeof f === 'object') {
		fl = f.list;
		// name will likely change next beta
		if (!fl.callback)
			// async loading (currently just FileReader) not set up; don't use
			fl.no_async = true;
		if (!fl.no_async && fl.reader) {
			// use multi-browser asynchronous FileReader load (most newer
			// browsers including IE 10+); only called if d$.file flags
			// Only called from a method that sets FileList reference.
			r = this.fileReader(f);
		}
		if (!r && fl.getAs) {
			// the other no-path possibility; try others if fail (good idea?)
			r = this.mozillaGetAs(f);
		}
//log("before path_prompt");
		// now we really do need the path (every other method already tried)
		if (!r && !fl.path)
			// force path entry; list reference exists
			d$.file.path_prompt(f);
			// user could have cancelled;
	}
	else {
		// convert old-style call; will be removed later
		old = true;
		fn = f;
		f = d$.file(fn, true); // create object from filename string
		fl = f.list;
		if (!(f && fl.path)) {
			woas.log("f name "+fn+" not valid");
			return false; // old call, no callback
		}
		f.mode = load_mode;
		load_mode = false; // for log function
		f.mime = mime;
		fl.no_async = true; // in case other async methods added later		
	}
//log("after setup");
	if (!r) {
		// most of the code doesn't assign this; no log, just use default
		f.mode = f.mode || this.file_mode.ASCII_TEXT;
		fp = !!fl.path;
		// try xhr (works with FF, even latest; anyone else? check)
		// Is it OK with the UTFs as well?; we mostly use ASCII currently though
		if (fp && !this.load_file.no_xhr &&
				f.mode === this.file_mode.ASCII_TEXT) {
			// always a synchronous call right now
			r = this.xhr(f);
			if (r && !fl.index)
				woas.log('TESTING NOTE: this browser was able to use XHR load');
		}
	}
	if (!r && fp) { // retry if xhr failed; could also test for null
		//this.load_file.no_xhr = true; // will stop further use of xhr
		if (this.browser.ie)
			r = this.ieLoadFile(f);
		// before FF test in case using Java
		else if (this.tiddlySaver)
			r = this.javaLoadFile(f);
		else if (this.browser.firefox)
			r = this.mozillaLoadFile(f);
	}
log("after load");
	if (r === null) {
		// === false already warned (?)
// during testing
//		this.alert('Unable to load "'+f.name+'"');
woas.log('Unable to load "'+f.name+'"');
	} else if (r && r !== -1) {
		// check that contents has UNIX line endings
		// (a handwritten wsif file could choke otherwise)
		n = f.str.indexOf('\n');
		if (n !== -1) {
			chk = f.str.substring(0, n);
			if (chk.indexOf('\r') !== -1) {
				woas.log(f.name + ' content should have UNIX line ' +
					'endings: converting.')
				f.str = f.str.replace(/\r\n/g, '\n');
			}
		}
	}
	if (old) {
		return r ? f.str : r;
	}
	// -1 if read is pending; callback handled by async reader
	else if (r !== -1 && fl && fl.callback) {
		if (fl.that)
			fl.callback.call(f.list.that, f);
		else
			woas.log("load_file error: callback with no 'that'");
	}
	return f.r
};

/*
the following load bindings use a File object (save not updated yet) and return:
 * null if they can't do it
 * false if there's an error
 * true if it loaded/saved OK
 * -1 if async pending
they (will) also set their file.r result code (except null may be left
undefined in final design), unless they use a callback; async read/write
callbacks set this themselves, though final design may use events/callbacks
on the File object itself through injection.
*/

// Attempt read using standards-based asynchronous FileReader and File object
// 'file' contains mode, and callback info, could also have mime
// Can only be used with file controls; e.g. woas._embed_process, Special::ImportWiki, etc.
// Only comes here because d$.file said FileReader was present (files.reader)
// TODO: use single FileReader when loading many files?
// TODO: if a browser has FileReader, does it also have 'bind`? (or use polyfill?)
woas.fileReader = function(file) {
	var fr , r = -1 // pending;
	try {
		file.last_loader = "fileReader"; // for debug
		// try using FileReader interface; mime always undefined
		fr = new FileReader();
		// bind current values to load callback
		fr.onloadend = (function(o, that) { return function(e) {
				that.fileReader_cb(e, o);}; })(file, this);
		// create callback and pass in event and info
		switch (file.mode) {
			case this.file_mode.DATA_URI:
			case this.file_mode.BASE64:
				fr.readAsDataURL(file);
			break;
			case this.file_mode.BINARY:
				fr.readAsBinaryString(file);
				// or readAsArrayBuffer? gecko > 7
			break;
			case this.file_mode.UTF8_TEXT:
				fr.readAsText(file);
			break;
			case this.file_mode.UTF16_TEXT:
				fr.readAsText(file, "UTF-16");
			break;
			case this.file_mode.ASCII_TEXT:
				fr.readAsText(file, "US-ASCII");
			break;
			default:
				this.log(this.i18n.MODE_NOT_AVAIL.sprintf(load_mode.toString(16)));
				fr = fr.onloadend = null; // don't know if needed; just in case
				r = false;
		}
		// done with first part; filereader seems to be active
	}
	catch (e) {
		woas.log('FileReader Error: '+e);
		r = fr = fr.onloadend = null;
	}
	file.r = r;
	return r;
};

// no longer needed, but here in case others using it
var reDataUrlPfx = new RegExp("^data:\\s*[^;]*;\\s*base64,\\s*");

// woas.fileReader comes here if FileReader active
// Finish up and call original function; could delete some junk at this point
// (Standard Woas calls don't have mime given; done for completeness)
// e: FileReader response; f: file object
woas.fileReader_cb = function(e, f) {
	if (!f.r)
		// only here if fileReader callback didn't cancel properly (possible?)
		return;
	var n;
	e = e.target || {}; // probably not needed; just to be sure
	if (e.result) {
		f.r = true;
		if (f.mode === this.file_mode.BASE64)
			f.str = e.result.replace(/^data:\s*[^;]*;\s*base64,\s*/, ''); 
		else if (f.mode === this.file_mode.DATA_URI)
			f.str = f.mime ? e.result.replace(/^data:(\s*)([^;]*)/,
				"data:$1" + f.mime) : e.result;
		else if (f.mode !== this.file_mode.BINARY) {
			// check that content has UNIX line endings
			// (a handwritten wsif file could choke otherwise)
			n = e.result.indexOf('\n');
			if (n !== -1)
				n = e.result.substring(0, n).indexOf('\r');
			f.str = n !== -1 ? e.result.replace(/\r\n/g, '\n') : e.result;
		}
		else {
			f.str = e.result;
		}
	}
	else {
		f.r = false;
		this.alert(this.i18n.LOAD_ERR);
		if (e.error)
			woas.log('FileReader Error: '+e.error);
		else
			woas.log('FileReader Error: nothing returned');
	}
	f.list.callback.call(f.list.that, f);
};

/*
PVHL: I spent a long time learning how to make binary load/save work in IE.
	So far as I know my method is original; I didn't find a way to do this
	on the Net; lots of info on getting the string, but not on how to make the
	data it contains usable. It took so many hours yet it seems so obvious now.
	(That said, recent reading suggests people were using this method, possibly
	in JavaScript, just not sharing code that I could find.)

	This method is code page dependent; I'm working on simple fix methods for
	other locales. But it works for me, and the worst it should do is
	fail to or export an image/file properly. Safe enough.
*/

if (woas.browser.ie) {
	woas.ieByter = {};

// This variable intended for use only when testing codepage fix with allBytesTest
// file. Comment out next line for normal use; the testing page does this itself
// woas.ieByter.fixing = true;


// ieByter start
	(function (that) { // that = woas.ieByter.this

// that.fix: object built by ieLoad containing misread bytes and their fixes
// that.fixed: flag showing testing found read error(s)
// that.fixing: flag for ieLoad to test file being read
// that.load: obj built by init containing load translation values for ieLoad
// that.save: as above, for saving with ieSave
// load/save only used in BINARY mode to save and export Image:: and File::

// used to convert non-ASCII values read/saved by IE (works for en-us, perhaps
// others). save[n] will be converted to character by init()
var en = {
	128:8364, 130:8218, 131:402, 132:8222, 133:8230, 134:8224,
	135:8225, 136:710, 137:8240, 138:352, 139:8249, 140:338,
	142:381, 145:8216, 146:8217, 147:8220, 148:8221, 149:8226,
	150:8211, 151:8212, 152:732, 153:8482, 154:353, 155:8250,
	156:339, 158:382, 159:376, 2:3, 145:45
};

// compare a possible fix with the default 'en' data (no ieByter plugin)
// This can be fooled; idea is to test fix, not avoid hacks
that.compare = function(obj) {
	var fixS = [], fixL = [], n, ndx, tot = 0;
	try {
		for (n in obj) {
			if (obj.hasOwnProperty(n)) {
				fixS.push(n);
				fixL.push(obj[n]);
			}
		}
		for (n in en) {
			if (obj.hasOwnProperty(n)) {
				ndx = fixS.indexOf(n);
				if (ndx !== -1 && en[n] === fixL[ndx])
					++tot;
			}
		}
	}
	catch(e) {
		woas.log("ERROR: problem with woas.ieByte.compare data: " + e);
	}
	woas.log('fs:'+fixS.length+', tot:'+tot)
	return fixS.length === tot;
};

/*
Load codepage conversion tables for IE binary read/write
Calling without an obj clears the system for testing
The 'obj' info can be automatically produced; see 
WoaS 0.13.0 file: [[IE binary file load/save fixing]].
'lang' is optional flag to report language information for tests
TODO: check if checking browser/os language can save some testing
  Also, the place to put new data might be the i18n language plugin (if used)
  but will need to rename language plugins to WoaS::Plugins::i18n or ?
*/
that.loader = function(obj, lang) {
	this.save = {};
	this.load = {};
	for (var n in obj) {
		if (obj.hasOwnProperty(n)) {
			try {
				this.load[obj[n]] = n;
				this.save[n] = String.fromCharCode(obj[n]);
			}
			catch(e) {
				woas.log("ERROR: problem with woas.ieByte.load data: "+e);
			}
		}
	}
	lang && woas.log('Language: browser '+navigator.browserLanguage+
		', system '+navigator.systemLanguage);
};

// Called from woas._onload to set up translation tables
// If a plugin has set a new codepage it will be used
that.init = function() {
	this.loader(this.i18n || en, true);
};

// end ieByter
	})(woas.ieByter);
}; // end if ie

// PVHL: content is an array if BINARY save_mode, otherwise string
//	Only works for certain locales, and can't work for DBCS text (e.g. Chinese)
//	'Normal' (single-byte) codepages can be generated; see plugin for details
woas.ieSaveFile = function(filePath, save_mode, content) {
	var s_mode, fso, file, i, il, test, bin, c, err = null;
	switch (save_mode) {
// have disabled IE binary saving for now until properly fixed
		/*case this.file_mode.BINARY:
			bin = true;*/
		// fallthrough wanted
		case this.file_mode.ASCII_TEXT:
			s_mode = 0; // ASCII
		break;
		case this.file_mode.UTF8_TEXT:
		case this.file_mode.UTF16_TEXT:
			s_mode = -1; // Unicode mode 
		break;
		default:
			this.log(this.i18n.MODE_NOT_AVAIL.sprintf(save_mode.toString(16)));
			return null;
	}
	// save through ActiveX
	try	{
		fso = new ActiveXObject("Scripting.FileSystemObject");
		err = false;
		file = fso.OpenTextFile(filePath, 2, true, s_mode);
		if (bin) {
			// convert binary content to IE format string
			for (i = 0, il = content.length; i < il; ++i) {
				c = content[i];
				// PVHL: I believe all codepage issues are above 127, but
				//	testing is best done on load of allBytesTest file
				test = c > 127 ? this.ieByter.save[c] : false;
				file.Write(test ? test : String.fromCharCode(c));
			}
		}
		else {
			file.Write(content);
		}
		file.Close();
	}
	catch(e) {
		woas.log("ERROR: exception while attempting to save: " + e); // log:1
		return err;
	}
	return true;
};

// load through ActiveX
// PVHL: ieByter code helps with codepage testing for binary read/write
//	will rearrange later so only one test done for whole read
// Old-style calls not allowed and not checked for
// filePath, load_mode, suggested_mime
// PVHL: TODO: have disabled binary load/save until working fully
woas.ieLoadFile = function(file) {
	var o_mode, fso, f, content, bin, c, test, i = 0;
	file.last_loader = "ieLoadFile"; // for debug
	switch (file.mode) {
		case this.file_mode.UTF16_TEXT:
		case this.file_mode.UTF8_TEXT:
			o_mode = -1; // Unicode
		break;
		/*case this.file_mode.BASE64:
		case this.file_mode.BINARY:
		case this.file_mode.DATA_URI:
			bin = true;
		// fallthrough wanted*/
		case this.file_mode.ASCII_TEXT:
			o_mode = 0; // ASCII
		break;
		default:
			// unknown mode
			this.log(this.i18n.MODE_NOT_AVAIL.sprintf(load_mode.toString(16)));
			return null;
	}
	try	{
		fso = new ActiveXObject("Scripting.FileSystemObject");
	}
	catch (e) {
		woas.log('ERROR - woas.ieLoadFile: '+e);
		return null;
	}
	try {
		f = fso.OpenTextFile(file.list.path + file.name, 1, false, o_mode);
		if (bin) {
			var ie = this.ieByter, fixing = ie.fixing, load = ie.load;
			if (fixing) {
				ie.fix = {};
				ie.fixed = false;
			}
			// read binary file
			content = [];
			while (!f.atEndOfStream) {
				c = f.Read(1).charCodeAt(0);
				if (fixing) {
					if (c !== i && !load[c]) {
						ie.fix[i] = c;
						if (c === 224) { //0xE0 is a control code
							ie.fixed = -1;
							woas.log("Control code found: you probably can't"+
								" use this binary load/save method.")
						}
						else {
							ie.fixed = ie.fixed || true; // won't hurt -1
						}
					}
				}
				if (c > 255) // believe all problems > 255
					c = load[c];
				if (c === null || c === undefined) {
					if (fixing) {
						//this.log('Found '+i+':'+c);
					}
					else {
						this.log('Binary read error (byte #'+i+', 0 - n): '+c);	
					}
				}
				content.push(c);
				++i;
			}
			if (i) { // something was read
				if (fixing && content.length !== 256) {
					ie.fixed = -2;
				}
				if (load_mode === this.file_mode.DATA_URI)
					file.str = this._data_uri_enc_array(
						file.list.path + file.name, content, suggested_mime);
				else if (load_mode === this.file_mode.BASE64)
					file.str = this.base64.encode_array(content);
			}
			content = null;
		}
		else {
			// read text f
			file.str = f.ReadAll();
		}
		f.Close();
	}
	catch(e) {
		woas.log("ERROR: exception while attempting to load\n\n" + e.toString());	// log:1
	}
	file.r = !!file.str;
	return file.r;
};

// save through UniversalXPConnect, WoasFox, or TiddlyFox
// file currently contains 'fullPath', 'mode', 'str' and optional flag 'no_async'
// will be refactored to use File object
woas.mozillaSaveFile = function(file) {
	var r, f, out;
	// check for WoasFox and try it first
	if (true/*!file.list.no_async*/) {
		if (this.isWoasFox()) {
			return this.woasFoxMsgSend('woas', 'save', file);
		}
		// TiddlyFox can only save text files (no image/file export)
		else if (this.isTiddlyFox() &&
				(file.mode === this.file_mode.UTF8_TEXT ||
				file.mode === this.file_mode.ASCII_TEXT)) {
			return this.woasFoxMsgSend('tiddly', 'save', file);
		}
	}
	// no plugins available; try the old way
	// Requires permissions if gecko >14, won't work gecko >16
	if (!window.Components || parseFloat(this.browser.gecko) > 16)
		return null;
	// file.mode is not considered here, but it works OK
	try	{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		f = Components.classes["@mozilla.org/file/local;1"].
			createInstance(Components.interfaces.nsILocalFile);
		f.initWithPath(file.fullPath);
		if (!f.exists()) {
			f.create(0, 0664);
		}
		else {
			woas.log("NOTE: file \""+file.fullPath+"\" exists, overwriting");	// log:1
		}
		out = Components.classes["@mozilla.org/network/file-output-stream;1"].
				createInstance(Components.interfaces.nsIFileOutputStream);
		out.init(f, 0x08 | 0x20 | 0x02, 0700, 0);
		out.write(file.str, file.str.length);
		out.flush();
		out.close();
		}
	catch(e) {
		woas.log("NOTE: exception while attempting to save:\n\t" + e);	// log:1
		return(false);
	}
	return(true);
};

// Use best available method to load file based on available resources
// Firefox security methods have used then broken various file methods
// over the years; gecko 17+ needs some kind of plug-in to read/write files
// Only comes here with path set; input control already tried, so mode is
// just the text types.
// 'file' is the FileList File-like object
woas.mozillaLoadFile = function(file) {
	var g = parseFloat(woas.browser.gecko), inputStream, sInputStream,
		f, r, c, rd, i, tot;
	file.last_loader = "mozillaLoadFile"; // for debug

	// before 15, FF worked with enable privilege; don't need a plugin
	// But will use WoaSFox or getAs if available anyway
	// TiddlyFox just uses XHR; already tried in load_file
	/*if (this.isWoasFox()) {
		// not written yet
	}
	else*/
	// can't work without a plugin for 17+; using java was already decided
	// during loading - interactive file load (embed) not done here if newer
	if (!(g < 17) || !window.Components) {
		return null;
	}
	else try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		f = Components.classes["@mozilla.org/file/local;1"].
				createInstance(Components.interfaces.nsILocalFile);
		f.initWithPath(file.list.path + file.name);
		if (!f.exists()) {
			woas.log("NOTE: no such file "+file.list.path + file.name);
			file.r = false;
			return false;
		}
		inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].
			createInstance(Components.interfaces.nsIFileInputStream);
		inputStream.init(f, 0x01, 04, 0);
		sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].
				createInstance(Components.interfaces.nsIScriptableInputStream);
		sInputStream.init(inputStream);
		if ((file.mode === this.file_mode.UTF8_TEXT) ||
			 (file.mode === this.file_mode.ASCII_TEXT)) {
			file.str = sInputStream.read(sInputStream.available());
		}
		else {
			// this byte-by-byte read allows retrieval of binary files
			i = tot = sInputStream.available();
			rd = [];
			while (--i >= 0) {
				c = sInputStream.read(1);
				rd.push(c.charCodeAt(0));
			}
			if (file.mode == this.file_mode.BINARY)
				file.str =(this.merge_bytes(rd));
			else if (file.mode == this.file_mode.DATA_URI)
				file.str = this._data_uri_enc_array(
					file.list.path + file.name, rd, file.mime);
			else if (file.mode == this.file_mode.BASE64)
				file.str = this.base64.encode_array(rd);
		}
	}
	catch(e) {
		woas.log("NOTE: exception while attempting to load:\n\n" + e);	// log:1
	}
	file.r = !!file.str;
	return  file.r;
};

// get file content in FF3 without .enablePrivilege() (FBNil)
// adapted for new file object
// Broken by FF7, (only used by 3 < firefox < 7)
// only here if available (file.list.getAs)
woas.mozillaGetAs = function(file) {
	file.last_loader = "mozillaGetAs"; // for debug
	switch (file.mode) {
		case this.file_mode.DATA_URI:
			if (file.mime)
				file.str = file.getAsDataURL().
					replace(/^data:(\s*)([^;]*)/, "data:$1"+file.mime);
			else // apply mime override
				file.str = file.getAsDataURL();
			break;
		case this.file_mode.BASE64:
			file.str = file.getAsDataURL().
				replace(/^data:\s*([^;]*);\s*base64,\s*/, '');
			break;
		case this.file_mode.BINARY:
			file.str = file.getAsBinary();
			break;
		case this.file_mode.UTF8_TEXT:
			file.str = file.getAsText("utf-8");
			break;
		case this.file_mode.UTF16_TEXT:
			file.str = file.getAsText("utf-16");
			break;
		case this.file_mode.ASCII_TEXT:
			file.str = file.getAsText("");
			break;
		default:
			this.log(this.i18n.MODE_NOT_AVAIL.sprintf(file.mode.toString(16)));
			return null;
	}
	file.r = !!file.str;
	return file.r;
};

/** Adapter for FF extensions TiddlyFox and its derivative WoasFox **/

// not valid until after page load
woas.isTiddlyFox = function() {
	// avoid warnings from d$ in developer mode
	return !!document.getElementById("tiddlyfox-message-box");
};

// not valid until after page load
woas.isWoasFox = function() {
	return !!document.getElementById("woasfox-message-box");
};

// woasFoxMsg code inspired by TIddlyWiki5 code by Jeremy Ruston
// Creates and fires message box event and adds message box to obj
/*
	type:  'woas' or 'tiddly'
	act: 'save' or 'load'
	obj contains:
		mode: type of load/save requested
	obj may contain:
		content: data to be saved
		mime: desired mime type
		path: file path including file name
		file-input: the name of the input control

	Optional parameters are context dependent. If WoasFox is present then
	the file-input will always be passed for load
*/
woas.woasFoxMsgSend = function(type, act, file) {
	var param, msg, event, msgBox, path;
	if (typeof file !== "object") {
		woas.log("ERROR: woas.woasFoxMsgSend - 'file' parameter is not an object");
		return null;
	}
	if (act === "load") {
		file.last_loader = type + "Fox"; // for debug
		path = file.list.path + file.name;
	}
	else {
		path = file.fullPath; // until updated
	}
	// Find the message box element
	msgBox = document.getElementById(type+"fox-message-box");
	if (msgBox) {
		if (type === 'tiddly') {
			// Create the message element and put it in the message box
			msg = document.createElement("div");
			param = path;
			if (param)
				msg.setAttribute("data-"+"tiddlyfox-path", param);
			param = file.str;
			if (param)
				msg.setAttribute("data-"+"tiddlyfox-content", param);
			msgBox.appendChild(msg);
			// Create and dispatch the custom event to the extension
			event = document.createEvent("Events");
			event.initEvent("tiddlyfox-"+act+"-file", true, false);
			msg.dispatchEvent(event);
		}
		else {
			// send information to WoasFox (only works one way)
			// This requires Gecko 11, but we only use for > 14
			event = new CustomEvent("woasfox-"+act, {"detail":file});
			msgBox.dispatchEvent(event);
		}
		// return a false positive
		// Needs a lot of work to change this for asynchronous use
		// User will be warned that load/save failed, but other issues arise
		return true;
	}
	else {
		return null;
	}
};

// only used by woasFox
// obj contains the triggering event and fields to be returned
woas.woasFoxMsgGet	= function(obj) {
woas.log('ERROR: woasFoxMsgGet not written yet');
return null;
/* Some memory aid junk here till I get a round tuit
		// Get the details from the message
		var message = event.target, r,
			path = message.getAttribute("data-tiddlyfox-path"),
			fileInput = message.getAttribute("data-tiddlyfox-file-input"),
			mode = message.getAttribute("data-tiddlyfox-mode"),
			content = message.getAttribute("data-tiddlyfox-content");
		// Save the file
		if (fileInput) {
			fileInput = message.ownerDocument.getElementById(fileInput);
			if (fileInput)
				r = TiddlyFox.saveFile(fileInput, content, mode);
		}
		else {
			r = TiddlyFox.saveFile(path, content, mode);
		}
		// Remove the message element from the message box
		message.parentNode.removeChild(message);
		// Send a confirmation message
		var event = document.createEvent("Events");
		if (r)
			event.initEvent("tiddlyfox-have-saved-file",true,false);
		else
			event.initEvent("tiddlyfox-save-file-error",true,false);
		event.savedFilePath = path;
		message.dispatchEvent(event);
		return false;
	var param, msg, event,
		// Find the message box element
		msgBox = document.getElementById(type+"fox-message-box");
	if (msgBox) {
		// Create the message element and put it in the message box
		msg = document.createElement("div");
		for (param in obj)
			if (obj.hasOwnProperty(param))
				msg.setAttribute("data-"+type+"fox-"+param, obj[param]);
		msgBox.appendChild(msg);
		// Create and dispatch the custom event to the extension
		event = document.createEvent("Events");
		event.initEvent(type+"fox-"+act+"-file", true, false);
		msg.dispatchEvent(event);
		obj.msgBox = msgBox;
	}
*/
};

// end of FF adapter


woas.buildURL = function(filename,content)  
{

	// by sp, 2018-03-31
	// alert("BuildURL");
	// var filename = _get_this_filename();
	// alert(filename);

var textFile = null,
  makeTextFile = function (text) {
    var data = new Blob([text], {type: 'text/plain'});

    // If we are replacing a previously generated file we need to
    // manually revoke the object URL to avoid memory leaks.
    if (textFile !== null) {
      window.URL.revokeObjectURL(textFile);
    }

    textFile = window.URL.createObjectURL(data);

    return textFile;
  };
  

  const MIME_TYPE = 'text/plain';   

  // Hole Link mit der ID 'downloadID' und modifiziere den "Download-Link"
    
  var a = document.getElementById('downloadID')
  
  	a.download = filename; 
  		  	
  	a.href = makeTextFile( content );
  	
  	a.style = "color: red";

  	a.dataset.downloadurl = [MIME_TYPE, a.download, a.href].join(':');
  	
  	a.draggable = true; // Don't really need, but good practice.
  	
  	//<output> &nbsp; &rarr; <a href="" id="md-download">Download-Link</a> </output>	
  	
  	var output = document.getElementById('outputID'); 
  	
  	output.appendChild(a);
  
  return true;	
  
};


// PVHL: java functions modified. Only comes here if TiddlySaver requested
//	java.io code removed as not needed or wanted (could be an issue these days
//	if it were available; Firefox removed java.io in FF 16)
// TiddlySaver always returns 1 and uses exceptions for errors; WoasSaver won't
woas.javaSaveFile = function(filePath,save_mode,content) {
	if (save_mode !== this.file_mode.ASCII_TEXT && save_mode !== this.file_mode.UTF8_TEXT) {
		woas.log("Only ASCII and UTF8 file modes are currently supported with TiddlySaver");	//log:1
		return null;
	}
	var ts = this.tiddlySaver, msg, r = null;
	try {
		ts.saveFile(filePath, save_mode === this.file_mode.ASCII_TEXT ?
			"" : "UTF-8", content);
		r = true;
	} catch(e) {
		r = this.javaError({fullPath: filePath});
	}
	return r;
};

// uses new file object
woas.javaLoadFile = function(file) {
	var mode = file.mode, r;
	file.last_loader = "javaLoadFile"; // for debug
	if (mode !== this.file_mode.ASCII_TEXT && mode !== this.file_mode.UTF8_TEXT) {
		woas.log("Only ASCII and UTF8 file modes are currently supported with TiddlySaver");
		return null;
	}
	try {
		file.str = this.tiddlySaver.loadFile(file.list.path + file.name,
			mode === this.file_mode.ASCII_TEXT ? "" : "UTF-8");
		// TODO: are all these checks still needed?
		if (file.str === null) {
			woas.log("TiddlySaver load failure: maybe "+file.list.path +
				file.name+" doesn't exist?");
			r = false;
		}
		// check that it is not an "undefined" string
		if (typeof file.str == "undefined") {
			woas.log("TiddlySaver load failure: this is usually a Java configuration issue");
			r = null;
		}
		// convert to string only after checking that it was successfully loaded
		file.str = String(file.str);
	} catch(ex) {
		r = this.javaError(file, true);
	}
	if (!file.str)
		file.str = undefined;
	file.r = file.str ? true : r;
};

woas.javaError = function(file, load) {
	var ts = woas.tiddlySaver,
		// allowing fullPath until save uses file
		path = file.fullPath || file.list.path + file.name;
	if (ts.isActive && ts.isActive()) {
		if (ts.getLastErrorMsg)
			msg = ts.getLastErrorMsg();
		else if (ts.getDebugMsg && ts.getDebugMsg())
			msg = "permission to access "+path+
				" was denied; check your java_policy settings";
		if (!msg)
			msg = "failure for "+path+
				"; this is usually a Java configuration issue"
		r = false;
	}
	else {
			msg = "applet is not loaded";
			r = null;
	}
	woas.log("TiddlySaver "+(load ? "load" : "save")+": "+msg);
	return r;
};

// PVHL: exclude is optional list of pages not to be saved; used to remove Help
//	split_lines will join array with commas while excluding list if null; allows
//	use for all the page information arrays
function printout_arr(arr, split_lines, exclude) {
	function elem_print() {
		if (!(chk && exclude[i])) {
			s += start +(join ? arr[i] : woas.js_encode(arr[i], split_lines))+ end;
		}
	}

	var il = arr.length;
	if (!il) { return "" }
	var join = split_lines === null, start = join ? "" : "'", end = join ? "": "'",
		chk = exclude && exclude.length, i = 0, s = "";
	elem_print();
	start = join ? "," : ",\n'";
	for (i = 1; i < il; i++) {
		elem_print();
	}
	return join ? s : s + "\n";
}

// no longer needed as encryption saved as base64;
// actually, none of the next three are used now
function printout_mixed_arr(arr, split_lines, attrs) {

	function elem_print(e, attr) {
		if (attr & 2) {
			return "[" + e.join(',') + "]";
		}
		return "'" + woas.js_encode(e, split_lines) + "'";
	}

	var il = arr.length, i, s;
	if (!il) { return "" }
	s = elem_print(arr[0], attrs[0]);
	for (i = 1; i < il; i++) {
		s += ",\n" + elem_print(arr[i], attrs[i]);
	}
	return s + "\n";
}

// used to print out encrypted page bytes and attributes
// PVHL: removed encoding; tests show it is not shorter to encode
//  but must take a lot more time to produce; replacing in save;
//  leaving in in case others are using it
function printout_num_arr(arr) {
	// works fine with empty array
	return arr.join(',');
}

function printout_fixed(elem, n) {
	return n ? elem + ("," + elem).repeat(n - 1) : '';
}

// save full WoaS to file
woas._save_to_file = function(full) {
	// force full mode if WSIF datasource mode changed since last time loading/saving
	var ds_changed = (this.config.wsif_ds !== this._old_wsif_ds), safe_current,
	// increase the marker only when performing full save
		new_marker = !this.tweak.edit_override && (full || ds_changed) &&
			!this.config.wsif_ds.length ? this._inc_marker(__marker) :__marker;

	// setup the page to be opened on next start
	safe_current = this.config.nav_history && this.page_exists(current, false) ?
		current : this.config.main_page;
	
	// output the javascript header and configuration flags
	var computed_js = "\n/* <![CDATA[ */\n\n/* "+new_marker+"-START */\n\nvar woas = {\"version\": \""+this.version+
	"\"};\n\nvar __marker = \""+new_marker+"\";\n\nwoas[\"config\"] = {";
	for (var param in this.config) {
		computed_js += "\n\""+param+"\":";
		switch(typeof(this.config[param])) {
			case "boolean":
				computed_js += (this.config[param] ? "true" : "false")+",";
			break;
			case "string":
				computed_js += "'"+this.js_encode(this.config[param])+"',";
			break;
			default: // for numbers
				computed_js += this.config[param]+",";
			break;
		}
	}
	computed_js = computed_js.substr(0,computed_js.length-1);
	computed_js += "};\n";
	
	computed_js += "\nvar current = '" + this.js_encode(safe_current)+"';\n\n";
	
	computed_js += "var backstack = [\n" + (this.config.nav_history ?
		printout_arr(backstack, false) : "") + "];\n\n";
	
	// in WSIF datasource mode we will save empty arrays
	if (this.config.wsif_ds.length !== 0) {
		computed_js += "var page_titles = [\n];\n\n";
	}
	else {
		// a quick hack to remove WoaS::Help:: pages
		var no_help = []; // can only be used if !wsif_ds; again, quick hack!
		if (woas.config.no_help) {
			var i = 0, il = page_titles.length, help = /^WoaS::Help::/ ;
			for (; i < il; ++i) {
				if (help.test(page_titles[i])) {
					no_help[i] = true;
				}
			}
		}
		computed_js += "var page_titles = [\n" +
			printout_arr(page_titles, false, no_help) + "];\n\n";
	}
	computed_js += "/* " + new_marker + "-DATA */\n";

	if (full || ds_changed) {
		this._old_wsif_ds = this.config.wsif_ds;
		if (this.config.wsif_ds.length) {
			// everything empty when the javascript layer is not used
			computed_js += "var page_attrs = [];\n";
			computed_js += "var page_mts = [];\n";
			computed_js += "var pages = [];\n\n";
		}
		else {
			computed_js += "var page_attrs = [" +
				printout_arr(page_attrs, null, no_help) + "];\n\n";
			computed_js += "var page_mts = [" + (this.config.store_mts
				? printout_arr(page_mts, null, no_help)
				: "0,".repeat(page_mts.length - no_help.length - 1)+"0") + "];\n\n";
			computed_js += "var pages = [\n" +
				printout_arr(pages, !!this.config.allow_diff, no_help) + "];\n\n";
			no_help = null;
		}
		computed_js += "/* " + new_marker + "-END */\n";
	}

	// cleanup the DOM before saving
	var bak_tx = this.getHTMLDiv(d$("woas_page")),
		bak_mn = this.getHTMLDiv(d$("woas_menu")),
		bak_mts = this.getHTMLDiv(d$("woas_mts")),
		bak_wait_text = this.getHTML(d$("woas_wait_text")),
	// clear titles and css as well as they will be set on load.
		bak_title = this.getHTMLDiv(this.dom._cache.title);
		bak_edit = this.dom._cache.ed.value;
		bak_log = this.dom._cache.log.value;

	this.dom._cache.ed.value = "";
	this.dom._cache.log.value = "";
	
	this.setHTMLDiv(d$("woas_page"), "");
	this.setHTMLDiv(d$("woas_menu"), "");
	this.setHTMLDiv(d$("woas_mts"), "");
	this.setHTMLDiv(this.dom._cache.title, "");

	// set the loading message
	this.setHTML(d$("woas_wait_text"), this.i18n.LOADING);

	var data = this._extract_src_data(__marker, document.documentElement.innerHTML, full || ds_changed, safe_current);
	
	// data is ready so restore removed items
	this.setHTMLDiv(d$("woas_page"), bak_tx);
	this.setHTMLDiv(d$("woas_menu"), bak_mn);
	this.setHTMLDiv(d$("woas_mts"), bak_mts);
	this.setHTMLDiv(this.dom._cache.title, bak_title);
	this.setHTML(d$("woas_wait_text"), bak_wait_text);
	this.dom._cache.ed.value = bak_edit
	this.dom._cache.log.value = bak_log;
	bak_tx = bak_mn = bak_mts = bak_title = bak_wait_text = bak_edit = bak_log = null;

	// now the actual save process begins
	var r = false;
	//DEBUG check
	if (data.length === 0) {
		this.crash("Could not retrieve original DOM data!");
	} else {
	
	//	if (!this.config.server_mode || (was_local && this.config.server_mode)) {
		if (!this._server_mode)
			r = this._save_this_file(computed_js, data);
	//		was_local = false;
	//	}

		// save was successful - trigger some events
		if (r) {
			this.after_config_saved();
			if (full)
				this.after_pages_saved();
		}
	} //DEBUG check

	//TODO: re-run after parsing hooks
	
	return r;
};

// make sure self-closing tags are actually closed
function reXHTMLFix_hook(str, tag) {
	var l=str.length;
	if (str.charAt(l-1)!=='/')
		str = str.substr(0, l-1)+" />";
	return str;
}
var reXHTMLFix = /<(img|hr|br|input|meta)[^>]*>/gi;

var reHeadTagEnd = new RegExp("<\\/"+"head[^>]*>", "ig"),
	reHeadTagStart = new RegExp("<"+"head[^>]*>", "ig"),
	reTagStart = /<(\w+)([^>]*)>/g,
	reTagEnd = /<\/(\w+)[^>]*>/g,
	reEditorTA = new RegExp('<'+'textarea\\s+id="?woas_editor"?\\s*[^>]+>(.*?)<'+'/textarea>', 'gi');

woas._extract_src_data = function(marker, source, full, current_page, data_only) {
	var e_offset, s_offset;
	// find the start marker for safety checking
	s_offset = source.indexOf("/* "+marker+ "-START */");
	if (s_offset === -1) {
		this.alert(this.i18n.ERR_MARKER.sprintf("START"));
		return false;
	}			
	// find the end marker, necessary to make some DOM/XHTML fixes
	e_offset = source.indexOf("/* "+marker+ "-END */", s_offset);
	if (e_offset === -1) {
		this.alert(this.i18n.ERR_MARKER.sprintf("END"));
		return false;
	}
	// properly update offset (+2 is for newlines)
	e_offset += 3 + marker.length + 7 + 2;
	
	// used during import
	if (full && data_only) {
		return source.substring(s_offset, e_offset);
	}

	reHeadTagStart.lastIndex = 0;
	var head_start, head_end,
		m = reHeadTagStart.exec(source);
	if (m !== null)
		head_start = m.index+m[0].length;
	else {
		this.crash("Cannot find head start tag");
		return false;
	}
	// search for head end tag starting at data end offset
	reHeadTagEnd.lastIndex = e_offset;
	m = reHeadTagEnd.exec(source);
	if (m !== null)
		head_end = m.index + m[0].length;
	else {
		this.crash("Cannot find head end tag");
		return false;
	}
	
	// filter out the unimportant tags from head
	// build a list of replacements with offsets
	
	// first take away the head
	var needle, m2, l_attrs, the_head = source.substring(0, head_end),
		splicings = [], tag, tag_end, close_tag,
		// rest_of_source is everything from the body tag to the end
		rest_of_source = source.substring(head_end);
	// reset big string
	source = "";
	// skip non-head content
	reTagStart.lastIndex = head_start;
	
	m = reTagStart.exec(the_head);
	while (m !== null) {
		tag = m[1].toLowerCase();
		var broken=false;
		switch (tag) {
			case "script":
			case "style":
			case "title":
				reTagEnd.lastIndex = m.index + m[0].length;
				do {
					m2 = reTagEnd.exec(the_head);
					if (m2 === null) {
						woas.log("found "+m[1]+" without closing tag");
						// continue to check for permanent attribute
						broken = true;
						break;
					}
					close_tag = m2[1].toLowerCase();
				} while (close_tag !== tag);
				// fallback wanted to set tag end like if it was a single tag
				if (!broken) {
					tag_end = tag_end = m2.index+m2[0].length;
					break;
				}
			case "meta":
				tag_end = m.index+m[0].length;
				break;
			default:
//				woas.log("Unknown tag in head: "+tag);
				// continue to check for permanent attribute
				tag_end = m.index+m[0].length;
				broken = true;
			break;
		}

		l_attrs = m[2].toLowerCase();
		// this was marked as permanent tag
		var was_replaced = false;
		if (l_attrs.indexOf("woas_permanent=")!==-1) {
			if (!broken) {
			if (tag === "style") {
				was_replaced = true;
				if (l_attrs.indexOf("woas_core_style=")!==-1) {
//					woas.log("Replacing CSS");
					needle = m[0]+'\n'+woas.get_text("WoaS::CSS::Boot")+m2[0];
				} // else leave as-is
			} else if (tag === "title") {
//				woas.log("Replacing title");
				needle = m[0]+woas.xhtml_encode(current_page)+m2[0];
				was_replaced = true;
			}
			}
			// will leave tag untouched
		} else {
//			woas.log("Removing tag "+tag);
			needle = "";
			was_replaced = true;
		}
		if (was_replaced)
			// add this splicing
			splicings.push( { start: m.index, end: tag_end, needle: needle } );
		reTagStart.lastIndex = tag_end;
		m = reTagStart.exec(the_head);
	}

	// rebuild the source by using splicings
	if (splicings.length) {
		var prev_ofs = 0;
		for(var i=0;i < splicings.length;++i) {
			source += the_head.substring(prev_ofs, splicings[i].start) + splicings[i].needle;
			prev_ofs = splicings[i].end;
		} splicings = null;

		// XHTML hotfixes (FF doesn't either save correctly)
		source += the_head.substr(prev_ofs); the_head = null;
		
		// re-calculate offsets
		
		// find the start marker for safety checking
		s_offset = source.indexOf("/* "+marker+ "-START */");
		if (s_offset === -1) {
			this.alert(this.i18n.ERR_MARKER.sprintf("START"));
			return false;
		}			
		// find the end marker, necessary to make some DOM/XHTML fixes
		e_offset = source.indexOf("/* "+marker+ "-END */", s_offset);
		if (e_offset === -1) {
			this.alert(this.i18n.ERR_MARKER.sprintf("END"));
			return false;
		}
		// properly update offset (+2 is for newlines)
		e_offset += 3 + marker.length + 7 + 2;
	} else {
		source = the_head;
		the_head = null;
	}
	
// PVHL: simplest fix for multiple Chrome induced problems is to just find the
//       last script closing tag and fix the end of the markup. Saves a lot of
//       code! IE makes all the tags uppercase!
	var last_script = rest_of_source.lastIndexOf('<'+'/script>');
	if (last_script === -1)
		last_script = rest_of_source.lastIndexOf('<'+'/SCRIPT>'); // IE
	rest_of_source = rest_of_source.substring(0, last_script);
	// replace textarea with a standard one
	rest_of_source = rest_of_source.replace(reEditorTA, '<'+'textarea '+
		'id="woas_'+'editor" rows="0" cols="0">&'+'nbsp;<'+'/textarea>')
	// XHTML hotfixes (FF2/FF3 doesn't either save correctly)
		.replace(reXHTMLFix, reXHTMLFix_hook)
	// there's better ways to do all this, but for now: remove unwanted changes
		.replace(/<div[^>]*id="woas_ui"[^>]*>/i, '<div id="woas_ui">')
		.replace(/<div[^>]*id="woas_scroll_wrap"[^>]*>/i,
			'<div id="woas_scroll_wrap">')
		.replace(/ui\.about\(\)">[^<]*</i, 'ui.about()"><');
	source += rest_of_source + '<'+'/script>\n<'+ 'div id="woas_custom_'+
		'accesskeys">&'+'nbsp;<'+'/div>\n<'+'/body>';
	rest_of_source = null;
	if (!full) {
		e_offset = source.indexOf("/* "+marker+ "-DATA */", s_offset);
		if (e_offset === -1) {
			this.alert(this.i18n.ERR_MARKER.sprintf("DATA"));
			return false;
		}
		e_offset += 3 + marker.length + 8 + 1 /* newlines */;
	}
	return source.substring(e_offset);
};

// increment the save-counter portion of the marker
var reMarker = /([^\-]*)\-(\d{7,7})$/;
woas._inc_marker = function(old_marker) {
	var m = old_marker.match(reMarker);
	if (m===null)
		return _random_string(10)+"-0000001";
	var n = new Number(m[2].replace(/^0+/, '')) + 1;
	n = n.toString();
	// marker part + 0-padded save count number
	return m[1]+"-"+String("0").repeat(7-n.length)+n;
};

// load URL via XHR. Now also used for firefox local file loads
// and potentially local/server saves later.
// xhr_remote passes path straight through after encoding
// load_err stops multiple notifications in multifile mode (for now)
woas.xhr = function(file) {
	var cmd = file.xhr_type || "GET",
		// allowing fullPath here while remote_load exists
		path = file.fullPath || file.list.path + file.name;
	file.last_loader = "xhr"+(file.xhr_remote ? "_remote" : ""); // for debug
	try	{
		var HttpReq = window.XMLHttpRequest ? new XMLHttpRequest() :
				new ActiveXObject('Microsoft.XMLHTTP'),
			// xhr_path for debug
			// problem with encodeURI & early browsers? do "file" before calling?
			xp = file.xhr_path = (file.xhr_remote ? "" : "file:///") +
				escape(path);
		HttpReq.open(cmd, xp, false);
		if (file.xhr_remote)
			HttpReq.setRequestHeader('Content-Type', 'text/plain');
		HttpReq.send(null);
		file.str = HttpReq.responseText || undefined;
		if (!file.str && !this.xhr.load_err) {
			this.xhr.load_err = true;
		}
		file.r = !!file.str;
	}
	catch (e) {
		if (!this.xhr.load_err) {
//woas.log('NOTE: XHR '+cmd+' of '+xp+' failed:\n\terror: '+e);
			this.xhr.load_err = true;
		}
	}
	return file.r
};

// just in case others are using this; woas code doesn't now
woas.remote_load = function(url) {
	var f = {fullPath: url, xhr_remote: true};
	this.xhr(f);
	return f.r ? f.str : f.r;
}

/*** src/parser.js ***/
// module @parser
woas.parser = {

snippets: [], // used to pass info around parser
render_title: null, // title of page being rendered
export_links: false, // true if exporter active
has_toc: null,
toc: [],
force_inline: false, // stops layout being broken when presenting search results
inline_tags: 0,
_parsing_menu: false, // true when we are parsing a menu page

// properties used by _transclude
_MAX_TRANSCLUSION_RECURSE: 256,
_transcluding: 0,

// a variety of regular expressions used by the parser

// these REs look for one optional (dynamic) newline at the end
reComments: /<\!-\-([\s\S]*?)-\-\>([ \t]*\n)?/g,
reMacros: /<{2,3}([+!]+)?([\s\S]+?)>{2,3}([ \t]*\n)?/g,
reNowiki: /\{\{\{([ \t]*\n)?([\s\S]*?)(\n[ \t]*)?(\}{3,})([ \t]*\n)?/g,
reNowikiDisable: /(\{\{\{[\s\S]*?\}{3,})([ \t]*\n)?/g,
reScripts: new RegExp("<"+"script([^>]*)>([\\s\\S]*?)<"+"\\/script>([ \\t]*\\n)?", "gi"),
reStyles: new RegExp("<"+"style([^>]*)>[\\s\\S]*?<"+"\\/style>([ \\t]*\\n)?", "gi"),
reTOC: /\[\[Special::TOC\]\]([ \t]*\n)?/,

// REs without optional newline search
// reAutoLinks finds sequences that look like URLs (x://)
reAutoLinks: /(?:(https?|ftp|file)|[a-zA-Z]+):\/\/(?:[^\s]*[^\s*.;,:?!\)\}\]])*/g,
// stops automatic br tag generation for listed tags
reBlkHtml: /^(p|div|br|blockquote|[uo]l|li|table|t[rhd]|tbody|thead|h[1-6r]|center)$/i,
reDry: /(\{\{\{[\s\S]*?\}\}\}|<{2,3}[\s\S]*?>{2,3}|<\!--[\s\S]*?-\-\>)/g,
reHasDNL: /^([ \t]*\n)/,
// DEPRECATED "!" syntax is supported but will be removed soon
reHeading: /^([\!=]{1,6})[ \t]*(.*?)[ \t]*(?:\1?)$/gm,
reHtml: /([ \t]*)((?:(?:[ \t]*)?<\/?([^<\/\s>]+)[^<>]*>)+)([ \t]*\n)?/g,
reListReap: /^([\*#@])[ \t].*(?:\n\1+[ \t].+)*/gm,
reListItem: /^([\*#@]+)[ \t]([^\n]+)/gm,
// tags that can have an optional newline before before/after them
reNewlineBefore: /\n(<(?:[uo]l).*?>)/g,
reNewlineAfter: /(<\/(?:h[1-6]|[uo]l)>)\n/g,
reReapTablesNew: /^\{\|(.*)((?:\n\|.*)*)$/gm,
reReapTablesNewSub1: /\n\|([+ \t-\|])(.*)/g,
reReapTablesNewSub2: /(\|\|)(\s{0,1})(\s?)(?=\|\|)/g,
reReapTablesNewSub3: /(\|\|\s*)$/,
reReapTablesNewSub4: /\|\|\t/g,
reReapTablesNewSub5: /\t\|\|/g,
reReapTablesHead: /^(\s*)(?:(=+)\s*)?(.*?)(\s*)$/,
// rulers with 3 hyphens DEPRECATED (should be 4 or more: ----)
// only white space is allowed before/after the hyphens
reRuler: /^[ \t]*\-{3,}[ \t]*$/gm,
reTransclusion: /\[\[Include::([^\]]+)\]\]/g,
reWikiLink: /\[\[([^\]\|]*)(?:\|([^\]]*))?\]\]/g,

// xhtml output strings
_HR: "<"+"hr class=\"woas_ruler\" />",

// extract the wiki tags from a wiki URL
_get_tags: function(text, last_tag) {
	var tags = [];
	// remove the starting part
	if (text.substr(0, 5) === "Tag::")
		text = woas.trim(text.substring(5));
	else if (text.substr(0,6)==="Tags::") {
//		woas.log("Using deprecated 'Tags' namespace");
		text = woas.trim(text.substring(6));
	} else // not a valid tagging
		return tags;
	// check length only after having removed the part we don't need
	if (!text.length)
		return tags;
	var alltags = this.split_tags(text), tag;
	if (last_tag !== null) alltags = alltags.concat(this.split_tags(last_tag));
	for(var i=0;i < alltags.length;i++) {
		tag = woas.trim(alltags[i]);
		if (tag.length && tags.indexOf(tag) === -1)
			tags.push(tag);
	}
	return tags;
},

_init: function() {
	this.marker = _random_string(3) + ":" + _random_string(3);
	this.reBaseSnippet = new RegExp(this.marker + "(\\d+);", "g");
	this.NL_MARKER = this.marker + "NL;";
	this.reNL_MARKER = new RegExp(this.marker + "NL;([ \\t]*\\n)?", "g");
},

// create a preformatted block ready to be displayed
_make_preformatted: function(text, add_style) {
	var cls, tag, p = text.indexOf("\n");
	if (p !== -1) {
		// remove the first newline to be compliant with old parsing
		if (p === 0) { text = text.substr(1); }
		cls = " woas_nowiki_multiline";
		tag = "pre";
	} else {
		cls = "woas_nowiki";
		tag = "tt";
	}
	return this._raw_preformatted(tag, text, cls, add_style);
},

_raw_preformatted: function(tag, text, cls, add_style) {
	add_style = add_style ? ' style="' + add_style + '"' : '';
	// PVHL: IE can't do pre without windows newlines
	if (woas.browser.ie)
		text = text.replace(/\n/g, '\r\n');
	return "<" + tag + " class=\"" + cls + "\"" + add_style + ">" +
		woas.xhtml_encode(text) + "<\/"+tag+">";
},

// render a single wiki link
_render_wiki_link: function(target, label, tags) {
	if (label === undefined) {
		label = '';
	}
	var r_label, hashloc, that = this,
		page = woas.title_unalias(target), // unalias page title
		title = '', gotohash = '', str, wl, pg,
		sLink = '<'+'a class="%s" title="%s"%s>%s<'+'\/a>',
		// broken_link only used in exported XHTML pages
		sLinkBroken = '<'+'span class="woas_broken_link">%s<'+'\/span>',
		scWorld = 'woas_world_link', scWoas = 'woas_link', scWoasUn = 'woas_unlink',
		sHref = ' href="%s"', sHrefTrgt = ' href="%s" target="_blank"',
		sOnClick = ' onclick="woas.go_to(\'%s\')"';

	// check for tag definitions if they might exist
	if (page.match('Tag') && typeof tags === 'object') {
		var found_tags = this._get_tags(page, label);
		if (found_tags.length > 0) {
			// do not use concat because 'tags' is passed byref
			for(var i = 0, it = found_tags.length; i < it; ++i) {
				tags.push(found_tags[i]);
			}
			if (!this.force_inline)
				return '';
			++this.inline_tags;
			return this.marker + 'T' + this.inline_tags + ';';
		}
	}

	// real link found; fix page (Javascript::)
	if (this.snippets.length) {
		page = page.replace(this.reBaseSnippet, function (str, $1) {
			return that.snippets[parseInt($1)];
		});
	}
	hashloc = page.indexOf('#');
	if (label === '') {
		r_label = page;
	} else {
		// fix label formatting. Labels can now have HTML, nowiki, and macros in them!
		if (this.snippets.length) {
			label = label.replace(this.reBaseSnippet, function (str, $1) {
				return that.snippets[parseInt($1)];
			});
		}
		label = label.replace(this.reNL_MARKER, "");
		r_label = label;
	}

	// check for protocol links
	if (page.match(/^\w+:\/\//)) {
		// convert mailto:// to mailto:
		page = page.replace(/^mailto:\/\//, 'mailto:');
		// always give title attribute
		str = sLink.sprintf(scWorld, woas.xhtml_encode(page), sHrefTrgt.sprintf(page), r_label);
		return this.place_holder(str);
	}

	// create section heading info
	if (hashloc !== -1) {
		gotohash = this.heading_anchor(page.substr(hashloc + 1), true);
		pg = page.substr(0, hashloc);
	} else {
		pg = page;
	}
	if (!pg && !gotohash || /"/.test(pg)) {
		// PVHL: " will break link - current code does not allow.
		//  empty link - [[#]] ?
		return this.place_holder('[[<'+'span style="color:#f00">'+target+'<'+
			'/span>'+(label ? '|'+label : '')+']]');
	}
	// create a title attribute only when page URI differs from page title
	if (label !== '' || gotohash) {
		title = woas.xhtml_encode(page);
	}

	if (!pg && gotohash || woas.page_exists(pg, true)) {
		if (this.export_links) {
			wl = pg ? woas.exporter._get_fname(pg) : '';
			if (wl === '#') {
				return this.place_holder(sLinkBroken.sprintf(r_label));
			}
			wl = sHref.sprintf(wl + (gotohash ? '#' + gotohash : ''));
		} else {
			wl = sOnClick.sprintf(woas.js_encode(pg) + (gotohash ? '#' + woas.js_encode(gotohash) : ''));
		}
		str = sLink.sprintf(scWoas, title, wl, r_label);
	} else { // page does not exist
		if (this.export_links) {
			str = sLinkBroken.sprintf(r_label);
		} else {
			wl = sOnClick.sprintf(woas.js_encode(pg));
			str = sLink.sprintf(scWoasUn, title, wl, r_label);
		}
	}
	return this.place_holder(str);
},

// PVHL: TODO: will rewrite to fix no-binary exporting; for now testing inclusion
_transclude: function (str, $1, img_gallery) {
	var that = woas.parser,
		parts = $1.split("|"),
		templname = parts[0],
		is_emb = false, ns = woas.get_namespace(templname, true),
		// temporary page object
		P = {};
	//woas.log("Transcluding "+templname+"("+parts.slice(0).toString()+")");	// log:0
	// don't want search box for exported pages
	if (woas.parser.export_links && templname === "WoaS::Template::Search") {
		return "";
	}
	// increase transclusion depth (used by namespace listing)
	++that._transcluding;
	if (woas.is_reserved(templname) ||
			(templname.substring(templname.length - 2) === "::")) {
		P.text = woas.get_text_special(templname);
	}
	else {
		var epi = woas.page_index(templname);
		// offer a link for uploading, to implement feature as before 0.11.0
		if (epi == -1) {
			P.text = "[<!-- -\->[Include::[["+templname+"]]]]";
		}
		else {
			P.text = woas.get__text(epi, img_gallery);
			is_emb = woas.is_embedded(templname);
		}
	}
	// template retrieval error
	if (P.text === null) {
		--that._transcluding;
		if (img_gallery) {
			return null;
		}
		// show an error with empty set symbol
		return that.place_holder(that.render_error(str, "#8709"));
	}
	// if data good and embedded add the inline file/image
	if (is_emb) {
//		woas.log("Embedded file transclusion: "+templname);	// log:0
		if (woas.is_image(templname)) {
			var img, img_cls = img_gallery ? 'woas_img_list' : 'woas_img',
				img_name = woas.xhtml_encode(
					templname.substr(templname.indexOf("::")+2));
			// PVHL: TODO: _settings should not be here; add flag to parser
			if (that.export_links && woas.exporter._settings.img_links) {
				// check that the URI is valid
				var uri = woas.exporter._get_img_fname(templname);
				if (uri == '#') { // shouldn't be
					img = that.render_error(templname, "#8709");
				}
				else {
					img = "<" + "img class=\""+img_cls+"\" src=\"" + uri +
						"\" alt=\"" + img_name + "\" ";
				}
			} else {
				img = "<" + "img class=\""+img_cls+"\" src=\"" + P.text + "\" ";
			}
			if (parts.length > 1) {
				img += parts[1];
				// always add the alt attribute to images
				if (!parts[1].match(/alt=('|").*?\1/))
					img += " alt=\"" + img_name + "\"";
			}
			P.text = img + " />";
		}
		else { // embedded file but not image
			if (parts.length > 1 && parts[1] === "raw") {
				P.text = woas.base64.decode(P.text);
			}
			else {
				// IE needs fix; all need pre if not 'raw'
				P.text = that._raw_preformatted("pre",
					woas.base64.decode(P.text), 'woas_embedded');
			}
		}
		P.text = that.place_holder(P.text);
	}
	else { // not embedded
		// don't want the link showing up; TOC dependent on main page
		P.text = P.text.replace(that.reTOC, "");
		// process nowiki, macros, and XHTML comments
		that.pre_parse(P);
		// finally replace transclusion parameters
		if (parts.length > 1) {
			P.text = P.text.replace(/%\d+/g, function(str) {
				var paramno = parseInt(str.substr(1));
				return paramno > 0 && paramno < parts.length ? parts[paramno] : str;
			});
		}
	}
	--that._transcluding;
	return P.text;
},

// @override to apply some further customization before parse output
after_parse: function(P) {
},

// remove comment/nowiki/macro blocks while renaming pages (no dynamic newlines)
dry: function(P) {
	P.text = P.text.replace(this.reDry, function (str) {
		return woas.parser.place_holder(str);
	});
},

// @override to parse further syntax before final replace
extend_syntax: function(P) {
},


// Create a W3C-spec-legal ID from heading using quick & simple hash.
// The same string produces the same hash, so headings need to be unique
//   or the first match will be moved to (could add editor alert).
// 's' is heading text; should not be empty, straight unicode text - no HTML
// 'check' (optional) doesn't transform s if an anchor
heading_anchor: function(s, check) {
	if (!s || check && /^s\d+$/.test(s))
		return s;
	for (var id = 0, i = 0, il = s.length; i < il;)
		id += s.charCodeAt(i) * ++i;
	return 's' + id;
},

import_disable: function(P, js, macros) {
	var that = this;
	this.snippets = [];
	// put away nowiki blocks - XHTML comments now allowed in macros
	P.text = P.text.replace(this.reNowikiDisable, function (str, nw, dynamic_nl) {
			return that.place_holder(nw, dynamic_nl);
	});
	if (js)
		P.text = P.text.replace(this.reScripts, "<"+"disabled_script$1>$2<" +
			"/disabled_script>$3");
	if (macros) {
		// PVHL: disabling now "!" before macro name; handled by parse_macros
		P.text = P.text.replace(this.reMacros, function(str, flags, text, dnl) {
			flags = flags || "";
			if (flags.indexOf("!") === -1) {
				flags = "!" + flags;
			}
			return "<<" + flags + (text || "") + ">>" + (dnl || "");
		});
	}
	// clear dynamic newlines
	P.text = P.text.replace(this.reNL_MARKER, "");
	// restore everything
	this.undry(P);
	this.snippets = null;
},

// 'text' is the raw wiki source
// 'js_mode' controls javascript behavior. Allowed values are:
//    0 - leave script tags as they are (used for exporting; acts much like mode 2)
//    1 - place script tags in head (dynamic),
//    2 - re-add script tags after parsing
//    3 - convert script tags to nowiki blocks
// @override to customize parsing (see also woas.parser.after_parse and woas.pager.browse
// PVHL: TODO: convert all callers to use {text:text} & change name for compatibility
parse: function(text, js_mode) {
	if (woas.config.debug_mode) {
		if ((typeof text).toLowerCase() != "string") {
			woas.crash("Called parse() with invalid argument: "+(typeof text));	// log:1
			return null;
		}
	}
	js_mode = js_mode || 1;

	var that = this, pLength, tags = [], backup_hook = this.after_parse,
		snippets = this.snippets, P = { text: text };
	text = null;
	this.snippets = []; // HTML markup removed from further parsing

	// process nowiki, macros, and XHTML comments
	this.pre_parse(P);
	if (!this.force_inline) {
		// transclude pages
		this.transclude_syntax(P);
	}

	// PVHL: code was breaking exported scripts by adding br tags; refactored
	if (js_mode) {
		// reset the array of custom scripts for the correct target
		var script_target = this._parsing_menu ? "menu" : "page";
		woas.scripting.clear(script_target);
	}
	// gather all script tags
	P.text = P.text.replace(this.reScripts, function (str, $1, $2, dynamic_nl) {
		if (js_mode === 0 || js_mode === 2) {
			return that.place_holder(str, dynamic_nl);
		} else if (js_mode === 3) {
			// during safe mode do not activate scripts, transform them to nowiki blocks
			return that.place_holder(that._make_preformatted(
				woas.i18n.JS_DISABLED + str, 'border:1px solid #f00'), dynamic_nl);
		} // else
		var m = $1.match(/src=(?:"|')([^\s'">]+)/),
			external = (m!==null);
		woas.scripting.add(script_target, external ? m[1] : $2, external);
		return "";
	});

	// take away style blocks
	P.text = P.text.replace(this.reStyles, function(str, $1, dynamic_nl) {
		return that.place_holder(str, dynamic_nl);
	});

	// put a placeholder for the TOC
	// PVHL: always want a dynamic newline so TOC can be followed by any markup
	this.has_toc = false;
	P.text = P.text.replace(this.reTOC, function(str, dnl) {
		that.has_toc = true;
		return that.marker + "TOC" + that.NL_MARKER + '\n';
	});
	// wiki tags
	this.inline_tags = 0;

	// static syntax parsing
	this.syntax_parse(P, tags, this.has_toc);
	this.snippets = snippets;

	// sort tags at bottom of page if set in config
	tags = tags.toUnique();
	if (woas.config.sort_tags) { tags = tags.sort(); }
	if (tags.length && !this.export_links) {
		var s;
		if (this.force_inline)
			s = "";
		else
			s = "<"+"div class=\"woas_taglinks\">";
		s += "Tags:";
		for(var i=0;i < tags.length;++i) {
			s += " <"+"a onclick=\"woas.go_to('Tagged::"+woas.js_encode(tags[i])+"')\">"+
				woas.xhtml_encode(tags[i])+"<"+"/a>";
		}
		if (this.force_inline) { // re-print the inline tags (works only on last tag definition?)
			P.text = P.text.replace(new RegExp(this.marker + "T(\\d+);", "g"), function (str, $1) {
				// loose comparison is OK here
				if ($1 == that.inline_tags)
					return s;
				return "";
			});
			this.force_inline = false;
		} else {
			s+="<"+"/div>";
			P.text += s;
		}
	}

	// syntax parsing has finished; apply any final changes
	if (this.after_parse === backup_hook)
		this.after_parse(P);
	// finished
	return P.text;
},

// XHTML lists and tables parsing code by plumloco
// There is no limit to the level of nesting and produces valid XHTML markup
// Refactored by PVHL to avoid some string copying and incorporate sublist
parse_lists: function(str, type) {
	function sublist(lst, ll, type) {
		if (!lst.length)
			return '';
		if (lst[0][0].length > ll)
			return sublist(lst, ll + 1, type);
		var item, subl, s = '';
		while (lst[0][0].length == ll ) {
			item = lst.shift();
			subl = sublist(lst, ll + 1, type);
			if (subl.length)
				s += lst_item.sprintf(item[1] + lst_type[type].sprintf(subl));
			else
				s += lst_item.sprintf(item[1]);
			if (!lst.length)
				break;
		}
		return s;
	}

	var lst_item = '<'+'li>%s<'+'/li>',
		lst_type = [
			'<'+'ul>%s<'+'/ul>' + woas.parser.NL_MARKER,
			'<'+'ol>%s<'+'/ol>' + woas.parser.NL_MARKER,
			'<'+'ol type="a">%s<'+'/ol>' + woas.parser.NL_MARKER
		],
		stk = []; // collect all items in a stack
	type = "*#@".indexOf(type);
	if (type === -1) return; // shouldn't be possible
	str.replace(woas.parser.reListItem, function(str, p1, p2) {
		stk.push([p1, p2]);
	});

	return lst_type[type].sprintf(sublist(stk, 1, type));
},

// macro system rewritten by pvhl to allow block markup inside block syntax.
// Hands off parsing of macros to woas.macro so it needs no knowledge of parser;
// woas.macro returns enough information for parser to do what it might want to.
// Macro import disabling now flagged by "!" before macro name.
// Added macro documentation as it is often useful; flagged by "+" before name.
//
// macro.menu allows macros to change behaviour if running in a menu; changing
//	the value from within macro code will have no effect.
// macro.dnl allows block macros to work within other block syntax (cf. _note)
// macro.block removes macro call and returned text from P.text, like block nowiki
// macro.reprocess will flag passing of returned macro.text to the parser.
// macro.text is manipulated by macro and returned for display or reprocessing
// macro.defn is set by woas.macro.parser when a macro is successfully defined
// macro.err is set by woas.macro.parser or the macro code to display an error
parse_macros: function(P) {
	var that = this, dnl = this.NL_MARKER + '\n', macro, p,
		menu = this._parsing_menu, reDoc = /\+/, reOff = /!/,
		// transcluded menus can't redefine menu macros, all others can
		redefine = !(menu && this._transcluding);
	P.text = P.text.replace(this.reMacros, function (str, flags, text, dynamic_nl) {
		if (reOff.test(flags)) {
			return that.place_holder(that._make_preformatted(
				woas.i18n.MACRO_OFF + "\n\n" + str,
				"color:#f00;font-weight:bold"), dynamic_nl);
		}
		// standard macro object
		macro = {
			menu: menu,
			dnl: dnl,
			reprocess: false,
			text: text || ''
		};
		// ask macro_parser to prepare this block
		woas.macro.parser(macro, redefine);
		// process results
		if (macro.err) {
			return that.place_holder(that._make_preformatted(
				woas.i18n.ERR_MACRO.sprintf(macro.name) + macro.err + "\n\n" + str,
				"color:#f00;font-weight:bold"), dynamic_nl);
		}
		// documentation call/definition if flagged with '+'
		if (reDoc.test(flags)) {
			text = that.place_holder(that._raw_preformatted("pre",
				"<<" + text + ">>", "woas_nowiki_multiline"),
				macro.reprocess || macro.defn ? "\n" : "");
			if (macro.defn) {
				return text;
			}
			macro.text = text + macro.text;
		}
		else if (macro.defn) {
			return "";
		}
		if (macro.text) {
			// reprocess: true || 1: everything but macros, CSS;
			// 2: +macros; 3: +CSS
			if (macro.reprocess) {
				if (macro.reprocess > 1) {
					macro.text = macro.text.replace(/>\\>/g, ">>");
					that.pre_parse(macro);
				}
				else {
					that.pre_parse(macro, true);
				}
				that.transclude_syntax(macro);
				// take away style blocks
				if (macro.reprocess > 2) {
					macro.text = macro.text.replace(that.reStyles,
						function(str, $1, dynamic_nl) {
							return that.place_holder(str, dynamic_nl);
						})
				}
				// parse dynamically generated block & inline syntax; allows
				// block syntax in lists/tables
				that.syntax_parse(macro);
			}
			// block flag removes a newline following the macro brackets after
			// parsing is complete, instead of turning it into a break tag.
			return macro.block ? that.place_holder(macro.text, dynamic_nl) :
				that.place_holder(macro.text) + (dynamic_nl || '');
		}
		return macro.block ? '' : (dynamic_nl || '');
	});
},

// 'inline' has no breaks at all between the markers.
// 'multiline' has first and last \n removed
parse_nowiki: function(P) {
	var that = this;
	P.text = P.text.replace(this.reNowiki, function (str, n1, nw, n2, close, dynamic_nl) {
		// allow a nowiki escape using Creole's escape ('~') between brackets
		// (Creole doesn't use it like this in nowiki markup though)
		// }~} -> }},  }~~} -> }~},  }~~~} -> }~~}
		nw = nw.replace(/\}(~{1,3})\}/g, function(str, b) {
			return "}" + b.substring(1) + "}";
		});
		// allow closing nowiki brackets at end of nowiki; similar to Creole 1
		close = close.substr(3);
		if (close.length) {
			nw = nw + (n2 || '') + close;
		}
		if (n1 || n2 || nw.indexOf("\n") !== -1) {
			nw = that._raw_preformatted("pre", nw, "woas_nowiki_multiline");
			return that.place_holder(nw, dynamic_nl);
		} else {
			nw = that._raw_preformatted("tt", nw, "woas_nowiki");
			return that.place_holder(nw) + (dynamic_nl || '');
		}
	});
},

// new table parsing by FBNil
parse_tables_new: function (str, prop, p1) {
    var caption = '',
		colgroup = '',
		stk = [],
		cols = [],
		CC = [];
	// variables used by replace callback
	var i, C, CL;
    p1.replace(woas.parser.reReapTablesNewSub1, function (str, pp1, pp2) {
		switch (pp1) {
			case '-': // comment
				return;
			case '+':
				return (caption = caption || ('<'+'caption' + (stk.length > 0 ? ' style="caption-side:bottom">' : '>') + pp2 + '<'+'/caption>'));
			case '*':
				return (colgroup = pp2);
			case '$':
				return CC.push(pp2);
			case '|':
				pp2 = " |" + pp2;
			break;
			case ' ':
				if (pp2.match(/^\|/)) // fix empty first cell
					pp2 = "  " + pp2;
			break;
			default:
				// do not eat the first character if it's not a control character
				pp2 = pp1+pp2;
		}

        var cells = pp2.replace(woas.parser.reReapTablesNewSub2, "$1$2$3  ").
				replace(woas.parser.reReapTablesNewSub3, "$1 ").
				replace(woas.parser.reReapTablesNewSub4, "|| ").
				replace(woas.parser.reReapTablesNewSub5, " ||").split(" || "),
			row = [],
			stag = "",
			cs = 0;
        for (i = cells.length - 1; i >= 0; --i) {
            C = cells[i].match(woas.parser.reReapTablesHead);
            if (i && !C[3] && !C[1] && !C[2]) {
                ++cs;
                continue;
            } else if (i == 0 && !C[3]) C[3] = "&nbsp;";
            CL = C[2] ? C[2].length : 0;
            stag = '<' + (CL == 1 ? 'th' : 'td') + (CL > 1 ? ' ' + CC[CL - 2] || '' : '') + (cs ? ' colspan=' + (++cs) : '') + (C[1] ? ' align=' + (C[4] ? 'center' : 'right') : '') + '>';
            cs = 0;
            row.unshift(stag + C[3] + (CL == 1 ? '<'+'/th>' : '<'+'/td>'));
        }
        stk.push(row.join(""));
    });
    return '<'+'table ' + ((prop.indexOf("class=")!==-1) ? '' : 'class="woas_text_area" ') + prop + '>' + caption + colgroup + '<'+'tr>' + stk.join('<'+'/tr><'+'tr>') + '<'+'/tr>' + '<'+'/table>' + woas.parser.NL_MARKER;
},

/* PVHL:
 * Removed separator as unneeded.
 * Rewrote to perform entire place_holder function here. Will be slightly slower
   but only optimize if truly needed. Rest of code is much simpler this way.
 * dnl is optional and marks a following newline for later removal if it exists
   (code does not need to check for IE 'null' because of test)
 * tests showed that nulling old entries used more memory and was only marginally
   faster on a massive test case (1.5%, 2 - 5 mS)
*/
place_holder: function (str, dnl) {
	that = this;
	// make sure strings can never include snippet references
	str = str.replace(this.reBaseSnippet, function (str, $1) {
		return that.snippets[parseInt($1)];
	});
	this.snippets.push(str);
	return this.marker + (this.snippets.length - 1) + ';' +
		(dnl ? this.NL_MARKER + dnl : '');
},

// NOTE: XHTML comments can now be contained in nowiki and macro blocks
//  no_macros used by macro.parse; optional
// put away stuff contained in nowiki blocks {{{ }}}, macros, and
// XHTML-style comments.
pre_parse: function(P, no_macros) {
	var that = this;
	this.parse_nowiki(P);
	if (!no_macros) {
		this.parse_macros(P);
	}
	P.text = P.text.replace(this.reComments, function (str, comment, dynamic_nl) {
		// don't skip anything -- remove all comments for future syntax needs
		return that.place_holder(str, dynamic_nl);
	});
},

render_error: function(str, symbol) {
	//	if (typeof symbol == "undefined")
	//		symbol = "infin";
	symbol = "&"+symbol+";";
	return "<"+"span style=\"color:red;font-weight:bold;\">"+symbol+" "+str+" "+symbol+"<"+"/span>";
},

// split one or more tags (NOTE: no trim applied)
split_tags: function(tlist) {
	if (tlist.indexOf(",")!==-1)
		return tlist.split(",");
	//DEPRECATED but still supported
	return tlist.split("|");
},

// parse passive syntax only
syntax_parse: function(P, tags, has_toc) {
	var that = this, snips;
	// in case called on its own
	if (!this.snippets) {
		snips = true;
		this.snippets = [];
	}
	// restore text lines (lines ending in '\' are joined)
	P.text = P.text.replace(/\\\n/g, "")

	// put HTML tags and tag sequences away (along with attributes)
	.replace(this.reHtml, function(str, ws, tags, last, dnl) {
		// stop certain html block tags from having a br tag appended when at line end
		if (that.reBlkHtml.test(last))
			return ws + that.place_holder(tags, dnl);
		return ws + that.place_holder(tags) + (dnl ? dnl : '');
	})

	// render links e.g. [[target]] & [[target|label]]
	.replace(this.reWikiLink, function(str, target, label) {
		if (target)
			return that._render_wiki_link(target, label, tags);
		return str; // not a valid link
	})

	// remove URL style text ('*://*') to avoid parsing problems.
	.replace(this.reAutoLinks, function(str, prot) {
		// only return a link if autolinks on and a target exists
		return that.place_holder(woas.config.auto_links && prot &&
			(prot.length + 3 !== str.length) ? '<' +
			'a class="woas_world_link" href="' + str + '" target="_blank">' +
			str + '<' + '/a>' : str);
	})

	// italics/underline/bold must be on a single line; markup can start at
	// beginning of line or after whitespace/brackets, and finish anywhere.
	// UNDOCUMENTED (will change) exception is after '>' or ';' until code changed.
	// Changes also (hopefully) fix problems for Unicode text users

	// italics (needs to be done before code that adds html; this should be fixed
	// by changing how block level syntax is parsed).
	.replace(/(^|[\s_'"*>;([{<])\/(.+?)\//mg, "$1<"+"em>$2<"+"/em>")

	// underline (now works on a single line the same as bold/italics)
	.replace(/(^|[\s'"*>;([{<])_(.+?)_/mg, "$1<"+
		"span style=\"text-decoration:underline;\">$2<"+"/span>")

	// ordered/unordered lists parsing (code by plumloco)
	.replace(this.reListReap, this.parse_lists)

	// tables-parsing pass (parse_tables & reReapTables are in legacy.js)
	.replace(woas.config.new_tables_syntax ? this.reReapTablesNew : this.reReapTables,
				woas.config.new_tables_syntax ? this.parse_tables_new : this.parse_tables
	)

	// bold (needs to be after lists & tables). 0.12.0 doesn't allow start
	// after / or \; this code does as can't see need, esp. with URLs protected
	.replace(/(^|[\s'">;([{<])\*(.+?)\*/mg, "$1<"+"strong>$2<"+"/strong>")

	// horizontal rulers: multiline RE used; adding NL_MARKER will remove the \n following.
	.replace(this.reRuler, this._HR + this.NL_MARKER);

	// other custom syntax should go into this callback
	this.extend_syntax(P);

	// headings - only h1~h6 are parsed;
	P.text = P.text.replace(this.reHeading, function(str, depth, heading) {
		//that.heading_replace(depth, heading);
		if (!heading) { return str; } // needed?
		var anchor, toc_entry, len = depth.length;
		// remove any markers and html
		toc_entry = heading.replace(that.reBaseSnippet, function (str, $1) {
				return that.snippets[parseInt($1)];
			})
			.replace(/(<\/?\w+[^>]*>)+/g, '');
		anchor = that.heading_anchor(toc_entry);
		if (that.has_toc) { // [level, anchor, straight heading text, ...]
			that.toc.push(len);
			that.toc.push(anchor);
			that.toc.push(toc_entry);
		}
		return "<"+"h"+len+" class=\"woas_heading\" id=\"" + anchor +
			"\">" + heading + "<"+"/h"+len+">" + woas.parser.NL_MARKER;
	});

	// replace [[Special::TOC]]
	if (has_toc) {
		P.text = P.text.replace(this.marker+"TOC", function() {
			return that.toc.length ? that.toc_render() : "";
		});
	}

	// clear dynamic newlines
	P.text = P.text.replace(this.reNL_MARKER, "")

	//cleanup \n after certain block tags (set by reNewlineAfter)
	.replace(this.reNewlineAfter, "$1")

	// cleanup \n before certain block tags (set by reNewlineBefore)
	//.replace(this.reNewlineBefore, "$1")

	// convert newlines to br tags
	.replace(/\n/g, "<"+"br />");

	// put back snippets removed by place_holder
	this.undry(P);
	if (snips) {
		this.snippets = [];
	}
},

// override to generate a different style of TOC
toc_body: '<'+'div id="woas_toc"><' +
	'div id="woas_toc_title"><'+'a onclick="d$.toggle(\'woas_toc_content\')"' +
	'>%s<'+'/a><'+'/div><'+'div id="woas_toc_content">%s<'+'/div><'+'/div>',
toc_body_exp: '<'+'div id="woas_toc"><'+'div id="woas_toc_title">%s<' +
	'/div><'+'div id="woas_toc_content">%s<'+'/div><'+'/div>',
toc_line: '<'+'div class="woas_toc_h%s"><' +
	'a class="woas_link" onclick="woas.go_to(\'#%s\')">%s<'+'/a><'+'/div>',
toc_line_exp: '<'+'div class="woas_toc_h%s"><' +
	'a class="woas_link" href="#%s">%s<'+'/a><'+'/div>',
// to allow overriding of TOC line rendering
toc_line_render: function(level, count, anchor, heading) {
	// the count array could be used for section numbering; e.g. 1.1.2
	// for current count just use count[level]
	return this.toc_line.sprintf(level, anchor, heading);
},
// PVHL: added in case user wants different TOC generated for exported pages
toc_line_render_exp: function(level, count, anchor, heading) {
	// see notes for toc_line_render
	return this.toc_line_exp.sprintf(level, anchor, heading);
},
// replace the TOC placeholder with the real TOC
// This function should not need to be overwritten; toc_line_render, toc_line,
// & toc_body (and related export versions) should be sufficient to generate
// any desired TOC.
toc_render: function() {
	// this.toc: [level, anchor, heading text, level, anchor, ...]
	var i, il, j, tmp = [], count = [], level,
		body = this.export_links ? this.toc_body_exp: this.toc_body,
		line_fn = this.export_links ? this.toc_line_render_exp : this.toc_line_render;
	for (i = 0, il = this.toc.length; i < il;) {
		level = this.toc[i++];
		count[level] = count[level] ? count[level] + 1 : 1;
		for (j = level + 1; j < 7; ++j) {
			count[j] = 0;
		}
		// toc_line_render(level, count, anchor, heading)
		tmp.push(line_fn.call(this, level, count, this.toc[i++], this.toc[i++]));
	}
	this.toc = [];
	return body.sprintf(woas.i18n.TOC, tmp.join(''));
},

//API1.0
//TODO: offer transclusion parameters argument
transclude: function(title, img_gallery) {
	return this._transclude("[[Include::"+title+"]]", title, img_gallery);
},

transclude_syntax: function(P) {
	var trans_level = 0, that = this, found;
	do {
		found = false;
		P.text = P.text.replace(this.reTransclusion, function(str, $1) {
			found = true;
			return that._transclude(str, $1);
		});
		// keep transcluding when a transclusion was made and when transcluding depth is not excessive
	} while (found && ++trans_level < this._MAX_TRANSCLUSION_RECURSE);
	if (trans_level === this._MAX_TRANSCLUSION_RECURSE) { // parse remaining inclusions as normal text
		P.text = P.text.replace(this.reTransclusion, function (str, $1) {
			return that.place_holder(that.render_error(str, 'infin'));
		});
	}
},

// snippets array strings cannot contain references to itself (because of
// refactored place_holder method)
undry: function(P) {
	var that = this;
	if (this.snippets.length) {
		P.text = P.text.replace(this.reBaseSnippet, function (str, $1) {
			return that.snippets[parseInt($1)];
		});
	}
}

}; // end of parser module

// initialize here because IE would fail otherwise
woas.parser._init();
delete woas.parser._init;

/*** src/special.js ***/
// returns link exclusive of Include:: and any section or alternate text
var reAllWikiLinks = /\[\[(?:Include\:\:)?([^\|\]\#]+)(?:[^\]]*)?\]\]/g;

woas.special_encrypted_pages = function(locked) {
	var pg = [];
	for(var i = 0, l = pages.length; i < l; i++) {
		if (this.is_reserved(page_titles[i]))
			continue;
		if (locked === this.is__encrypted(i))
			pg.push(page_titles[i]);
	}
	if (!pg.length)
		return "/No locked pages/";
	else
		return this._join_list(pg);
};

// PVHL: original algorithm was O(n*n) - this one is O(n).
// found contains every non-reserved page
// links contains every wiki link found in the page source
// ns contains every namespace found for page titles
woas.special_orphaned_pages = function() {
	var found = {}, links = {}, ns = {}, lnks, lnk, pg = [],
		i, il, t, tmp;
	// find all titles and namespaces in titles
	for (i = 0, il = page_titles.length; i < il; i++) {
		t = page_titles[i]; // to simplify reading
		if (!this.is_reserved(t)) {
			found[t] = true;
			if (!this.is_menu(t)) {
				tmp = this.get_namespace(t);
				if (tmp) {
					ns[tmp] = true;
				}
			}
		}
	}
	// find all links in pages
	for (i = 0, il = page_titles.length; i < il; i++) {
		t = page_titles[i]; // to simplify reading
		if (found[t] && (tmp = this.get_src_page(i))) {
			while((lnks = reAllWikiLinks.exec(tmp)) !== null) {
				lnk = this.title_unalias(this.trim(lnks[1]));
				if (lnk !== t && found[lnk]) {
					// don't care what kind of link it is
					links[lnk] = true;
				}
			}
		}
	}
	// check pages are linked
	for (t in found) {
		if (found.hasOwnProperty(t)) {
			if (this.is_menu(t)) {
				// check if the menu namespace has a page
				tmp = this.get_namespace(t);
				if (t === "::Menu" || tmp && ns[tmp]) {
					continue;
				}
			} else {
				// check if title has been found in pages
				if (links[t]) {
					continue;
				}
			}
			pg.push(t);
		}
	}
	if (!pg.length)
		return "/No orphaned pages/";
	else
		return this._join_list(pg);
};

woas.special_backlinks = function() {
	var pg = [], pg_title, tmp;
	if (this.parser.render_title === null)
		pg_title = current;
	else {
		pg_title = this.parser.render_title;
		this.parser.render_title = null;
	}
	// PVHL: make backlinks find included pages that aren't orphaned or dead.
	var reg = new RegExp("\\[\\[(?:Include::)?"+RegExp.escape(pg_title)+
		"(?:\\||\\]\\])");
	for(var j=0,l=pages.length; j < l; j++) {
		if (this.is_reserved(page_titles[j]))
			continue;
		// search for pages that link to it
		tmp = this.get_src_page(j);
		// encrypted w/o key
		if (tmp===null)
			continue;
		if (reg.test(tmp))
			pg.push( page_titles[j] );
	}
	if(pg.length === 0)
		return "/No user page links to [["+pg_title+"]]/";
	else
		return "== Links to [["+pg_title+"]]\n"+this._join_list(pg);
};

// PVHL: search options; will be moved to a search object later
//   set defaults here or change with a plugin
woas._nearby_chars = 200;	// amount of nearby characters to display
woas._match_length = 200;	// will eventually limit total match; currently max between words
woas.search_help = false;	// include WoaS::Help pages
woas.search_word = true;	// match words in order, not exact phrase
woas.search_case = false;	// must match case
woas.search_inline = false;	// match must be within a single line
woas.search_start = false;	// match must start at word boundary
woas.search_end = false;	// match must end at word boundary
woas.search_options = false;// show options when page loaded; all these will move to search

// create an index of searched pages (by miz & legolas558 & pvhl)
woas._cache_search = function( str ) {
	var tmp, pt, ph, i, l, reg, res_body, pt_arr = [], pi,
		bs = this.search_start ? '\\b' : '',
		be = this.search_end ? '\\b' : '',
		sc = 'g' + (this.search_case ? '' : 'i'),
		si = this.search_inline ? '.' : '[\\s\\S]';

	// reset search
	this._cached_title_search = [];
	this._cached_body_search = [];
	this._last_search = this.trim(str);

	str = bs + RegExp.escape(this._last_search) + be;
	if (this.search_word) {
		str = str.replace(/\s+/g, be+si+"{0,"+this._match_length+"}?"+bs);
	}
	this._reLastSearch = new RegExp(str, sc);
	// matches the search string and nearby text
	reg = new RegExp( ".{0,"+this._nearby_chars+"}"+str+
			".{0,"+this._nearby_chars+"}", sc);

	// assemble titles so they can be sorted before searching
	for (i = 0, l = pages.length; i < l; i++) {
		pt = page_titles[i];
		ph = this.search_help && pt.indexOf('WoaS::Help::') === 0;
		// tweak.edit_override allows searching of WoaS and Special pages text
		if (this.is_image(pt) || !ph && this.is_reserved(pt, true))
			continue;
		// titles can't match, so adding 'i' won't affect sorting,
		// but faster than looking up titles again
		pt_arr.push(pt+'_'+i);
	}
	pt_arr.sort();
	//pt_arr.sort(this.strnatcmp); // natural sort, but need case insensitive; NRFPTY
	for (i = 0, l = pt_arr.length; i < l; i++) {
		pt = pt_arr[i];
        tmp = pt.lastIndexOf('_');
		pi = pt.substr(tmp + 1);
		pt = pt.substr(0, tmp);

		// look for string in title
		if (pt.search(this._reLastSearch) !== -1) {
			this._cached_title_search.push(pt);
		}

		// ensure page is valid
		tmp = this.get_page(pi);
		if (tmp === null) {
			continue
		}

		// look for string in page text

		// IF NO PAGE SCRIPTS WANTED (html included as it is markup).
		// I don't see the need for it.
		// (having spent hours making it all work!)
		// May add an option for this later as it's fairly cheap to use.
		/*var s = [], wp = woas.parser;
		tmp = tmp.replace(/\{{3}[\s\S]*?\}{3}/, function(str) {
				s.push(str);return wp.marker+(s.length-1)+';'})
			.replace(reScriptTags, '');
			// if also don't want html tags (except those in nowiki)
			//.replace(reAnyXHTML, '');
		if (s.length) {
			tmp = tmp.replace(wp.reBaseSnippet, function (str, $1) {
				return s[parseInt($1)];
			});
		}
		s = null;*/

		res_body = tmp.match(reg);
		if (res_body !== null)
			this._cached_body_search.push( {title:pt, matches: res_body} );
	}
	pt_arr = null;
};

woas.special_tagged = function(filter_string) {
	var	reFindTags = /\[\[Tags?::([^\]]+)\]\]/g,
		pg = [], pgi = [], folds = {}, tags, tag, alltags,
		src, i, il, j, jl, k, kl, tmp, filtering;
	// filtering setup
	if (typeof filter_string != "undefined") {
		filtering = woas.tagging._prepare_filter(filter_string);
	} else {
		filtering = false;
	}
	// scan all pages
	for(i = 0, il = pages.length; i < il; ++i) {
		if (this.is_reserved(page_titles[i]))
			continue;
		src = this.get_src_page(i);
		// encrypted w/o key
		if (src === null)
			continue;
		src.replace(reFindTags, function (str, $1) {
				// get the tags and index the page under each tag
				tmp = woas.parser.split_tags($1);
				alltags = [];
				for(j = 0, jl = tmp.length; j < jl; ++j) {
					tag = woas.trim(tmp[j]);
					// skip invalid tags
					if (!tag.length) {
						woas.log("WARNING: check your tag separators");
						continue;
					}
					// call the filtering callback, if necessary
					if (filtering) {
						// skip this page from listing in case of negative filter result
						if (!woas.tagging._filter_not_cb(tag))
							break;
					}
					alltags.push(tag);
				}
				tmp = null;
				// check that page has at least one of the positive tags
				if (filtering && !woas.tagging._filter_ok_cb(alltags))
					return;
				// add page to proper leaves
				for (j = 0, jl = alltags.length; j < jl; ++j) {
					tag = alltags[j];
					if (filtering && !woas.tagging._filter_ok_tag(tag)) {
						continue;
					}
					// we have a valid tag, check if it is already indexed
					if (!folds[tag]) {
						folds[tag] = [page_titles[i]];
					} else {
						folds[tag].push(page_titles[i]);
					}
					// build the flat list with tags listed
					if (!pgi[i]) {
						pgi[i] = true;
						tags = alltags.slice(0).sort();
						tmp = "[["+page_titles[i]+"]]\n** [[Tagged::"+tags.join()+"|Tags]]: ";
						for (k = 0, kl = tags.length; k < kl;) {
							tmp += " [[Tagged::"+tags[k]+"|"+tags[k]+"]]"+(++k === kl ? "" : ", ");
						}
						pg.push(tmp);
					}
				}
			});
	} // scan pages loop
	pgi = null;
	if (filtering) {
		woas.tagging._finish();
	}
	if (pg.length) {
		// parse tree with sorting
		return woas.ns_listing("", pg, folds);
	} else {
		return "/No tagged pages/";
	}
};

// @module 'tagging'
woas.tagging = {
	tags_ok: null,
	tags_not: null,

	_finish: function() {
		this.tags_ok = this.tags_not = null;
	},

	_prepare_filter: function(filter_string) {
		var i, l;
		// allow tags filtering/searching
		var tags = woas.parser.split_tags(filter_string);
		// reset filter
		this.tags_ok = [];
		this.tags_not = [];

		// parse filter
		for(i=0,l=tags.length;i < l;++i) {
			// skip empty tags
			var tag = woas.trim(tags[i]);
			if (!tag.length)
				continue;
			// add a negation tag
			if (tag.charAt(0) === '!')
				this.tags_not.push( tag.substr(1) );
			else // normal match tag
				this.tags_ok.push(tag);
		}
		tags = null;
		return (this.tags_ok.length + this.tags_not.length > 0);
	},

	// return true if all OK tags are present
	_filter_ok_cb: function(tags) {
		var ok = 0;
		if (this.tags_ok.length) {
			for(var i=0,il=tags.length;i < il;++i) {
				if (this.tags_ok.indexOf(tags[i]) !== -1)
					++ok
			}
		}
		return (ok === this.tags_ok.length);
	},

	// check single tag is in OK filter
	_filter_ok_tag: function(tag) {
		return this.tags_ok.indexOf(tag) !== -1;
	},

	_filter_not_cb: function(tag) {
		// filter if "NOT" tag is present
		// we are applying this filter only to tagged pages
		// so a page without tags at all does not fit into this filtering
		if (this.tags_not.length) {
			if (this.tags_not.indexOf(tag) !== -1)
				return false;
		}
		// no failure, this page passes
		return true;
	}
		
};

var reHasTags = /\[\[Tags?::[^\]]+\]\]/;
woas.special_untagged = function() {
	var tmp;
	var pg = [];
	for(var i=0,l=pages.length; i < l; i++) {
		if (this.is_reserved(page_titles[i]))
			continue;
		tmp = this.get_src_page(i);
		if (tmp === null)
			continue;
		if (!tmp.match(reHasTags))
			pg.push(page_titles[i]);
	}
	if (!pg.length)
		return '/No untagged pages/';
	return this._join_list(pg);
};

// Returns a index of all pages
woas.special_all_pages = function() {
	var pg = [];
	for(var i=0, l=page_titles.length; i < l; i++) {
		if (!this.is_reserved(page_titles[i], true))
			pg.push( page_titles[i] );
	}
	return this._join_list(pg);
};

// Returns an index of all dead pages
woas.special_dead_pages = function() {
	var dead_pages = [], from_pages = [], pg = [],
		reIgnore = /^(\w+:\/\/|mailto:)/i,
		tmp, page_done, i, j, l, sectref;
	// test the links found in each page
	for(j = 0, l = pages.length; j < l; ++j) {
		if (this.is_reserved(page_titles[j], true))
			continue;
		tmp = this.get_src_page(j);
		if (!tmp)
			continue;
		page_done = false;
		tmp.replace(reAllWikiLinks,
			function (str, p) {
				p = woas.trim(woas.title_unalias(p));
				// ignore external and reserved namespaces
				if (reIgnore.test(p) || woas.is_reserved(p, true)) {
					return;
				}
				// ignore known Special:: links
				if (p.substr(0, 9) === "Special::" && (p === "Special::TOC" ||
						woas.shortcuts.indexOf(p.substr(9)) !== -1))
					return;
				// if title link found doesn't exist add to list
				if (!woas.page_exists(p, true) && p !== page_titles[j]) {
					// true when page has been scanned for referrals
					page_done = false;
					// check if this non-existant page is already in the dead page list
					for (i = 0; i < dead_pages.length; i++) {
						// current page contains a link to an already indexed dead page
						// save the reference
						if (dead_pages[i] === p) {
							// add only if not already there
							if (from_pages[i].indexOf(page_titles[j]) === -1)
								from_pages[i].push(page_titles[j]);
							page_done = true;
							break;
						}
					}
					// we have just found a dead page
					if (!page_done) {
						dead_pages.push(p);
						from_pages.push(new Array(page_titles[j]));
						page_done = true;
					}
				}
	        }
		);
	}

	// format the dead pages
	for (i = 0;i < dead_pages.length; i++) {
		j = from_pages[i];
		l = j.length;
		pg.push("[["+dead_pages[i]+"]] from " + (l ? "[[" : "") +
			j.sort().join("]], [[") + (l ? "]]" : ""));
	}

	woas.pager.bucket.items = dead_pages.slice(0);
	if (!pg.length)
		return '/No dead pages/';
	return this._simple_join_list(pg, true);
};

//Special::Recent Changes shows a sorted list of pages by modified timestamp
woas.special_recent_changes = function() {
	if (!this.config.store_mts) {
		return "/Date modified timestamp storage is disabled in [[Special::Options]]./";
	}
	// build an array of (key := page_index, val := mts) couples
	var l=page_titles.length, hm = [], i;
	for(i=0;i < l;++i) {
		// skip pages with the 'magic' zero timestamp
		if (page_mts[i] === 0)
			continue;
		// skip reserved pages which are not editable
		if (!this.edit_allowed_reserved(page_titles[i]) && this.is_reserved(page_titles[i]))
			continue;
		hm.push([i,page_mts[i]]);
	}
	// sort the array
	hm.sort(function(a,b) { return (b[1]-a[1]); });
	// display results
	var pg=[];
	for(i=0,l=hm.length;i < l;++i) {
		pg.push("* [[" + page_titles[hm[i][0]] + "]]&nbsp; <"+"span style=\""+
		"font-size: smaller;\">"+this.last_modified(hm[i][1],true)+"<"+"/span>");
	}
	if (!pg.length)
		return "/No recently modified pages/";
	return this._simple_join_list(pg);
};

woas._simple_join_list = function(arr, sorted) {
	if (sorted) { arr = arr.sort(); }
	return arr.join("\n")+"\n";
};

// creates a tree from array then sorts and creates listing
woas._join_list = function(arr) {
	if (!arr.length) { return ""; }
	// copy the array to currently selected pages
	woas.pager.bucket.items = arr.slice(0);
	var root = "::", folds = {}, i, il, tmp;
	folds[root] = [];
	for (i = 0, il = arr.length; i < il; ++i) {
		tmp = this.get_namespace(arr[i]);
		if (tmp === "::") {
			tmp = "";
		}
		if (tmp && !folds[tmp]) {
			folds[tmp] = [arr[i]];
		} else {
			folds[tmp ? tmp : root].push(arr[i]);
		}
	}
	return this.ns_listing(root, arr, folds);
};

function _WoaS_list_expand_change(list, list_id, count) {
	var i;
	// store selected option in global config variable
	woas.config.folding_style = list.selectedIndex;
	switch (woas.config.folding_style) {
		case 1: // collapse all
			d$.show(list_id+"folds");
			d$.hide(list_id+"flat");
			for(i = 0; i < count; ++i) {
				d$.hide(list_id + i);
			}
		break;
		case 0: // flat list
			d$.hide(list_id+"folds");
			d$.show(list_id+"flat");
			break;
		case 2: // expand all
			d$.show(list_id+"folds");
			d$.hide(list_id+"flat");
			for(i = 0; i < count; ++i) {
				d$.show(list_id + i);
			}
		break;
	}
}

// PVHL: have removed non-functional list caching until it can be made to work
// (cache needs to be invalidated after edit/import, etc; should work off of history)
// listing is always sorted
// flat_arr must have content
woas.ns_listing = function(root, flat_arr, folds) {
    function dsp(v) {
		return v ? "display:block" : "display:none";
	}
    function opt(str) {
		return "<"+"option "+(fs === opt_n++ ? "selected=\"selected\"" : "" ) +
			">"+str+"<"+"/option>\n";
	}

	var order = [], root_title = "/No Namespace/", fold_n = 0, opt_n = 0, s = "",
		list_id = "woas_"+_random_string(6)+"_", f, i, il, it, oi, ns, fs, fold_id;
	flat_arr.sort();
	// sort folds content and folds
	// do not produce the header if listing is transcluded
	if (!(woas.parser.export_links || woas.parser._transcluding)) {
		for (f in folds) {
			if (folds.hasOwnProperty(f)) {
				folds[f].sort();
				if (f !== root) {
					order.push(f);
				}
			}
		}
		f = false;
		// or if it has no subnamespaces
		if (order.length) {
			order.sort();
			f = true;
		}
		if (root && folds[root].length) {
			order.splice(0, 0, root);
		}
	};
	if (f) {
		// create list control
		fs = woas.config.folding_style;
		s = "<"+"div class=\"woas_list_options\">List view:&nbsp;<" +
			"select onchange=\"_WoaS_list_expand_change(this,'"+list_id+"',[" +
			order.length+"])\">\n" + opt("Pages") +
			opt(root ? "Namespace, collapsed" : "Tags, collapsed") +
			opt(root ? "Namespace, expanded" : "Tags, expanded") +
			"<"+"/select>\n<"+"/div>\n<"+"div style=\""+dsp(fs !== 0) +
			"\" id=\""+list_id+"folds\">\n"+(root ? "" : "==Tags\n");
		// fill the folding divs
		for (i = 0, il = order.length; i < il; ++i) {
			fold_id = list_id + fold_n++;
			oi = order[i];
			if (root) {
				ns = i === 0 && oi === root ? root_title : "[["+oi+"]]";
			} else {
				ns = "[[Tagged::"+oi+"|"+oi+"]]";
			}
			it = folds[oi].length;
			s += "<"+"div"+" class=\"woas_list_heading\">"+ns+"&nbsp;&nbsp;<" +
				"a class=\"woas_list_link\" title=\"Toggle page display\" onclick=\"d$.toggle('" +
				fold_id+"')\">"+it+" page"+(it > 1 ? "s" : "")+"<"+"/a>\n<"+"/div>\n" +
				"<"+"div style=\""+dsp(fs === 2)+"\" id=\""+fold_id+"\">\n<" + 
				"div class=\"woas_list\">\n[["+folds[oi].join("]]\n[[")+"]]<"+"/div><"+"/div>\n";
		}
		// finish up
		s += "<"+"/div>\n"+
			"<"+"div style=\""+dsp(fs === 0)+
			"\" id=\""+list_id+"flat\">\n";
	}
	// generate the flat list
	s += root ? "* [["+flat_arr.join("]]\n* [[")+"]]\n" : "==Pages\n* "+flat_arr.join("\n* ")+"\n";
	if (f) {
		s += "<"+"/div>";
	}
	return s;
};

// PVHL: have cleaned up and added some HTML/CSS that should help
//   make things work in every browser, even IE6
//   (IE6 only has a:hover and doesn't like multi-class selectors)
woas._special_image_gallery = function(ns) {
	function listing(item, clas) {
		var t = div[item], pg = t.replace(/'/g, "\\'"),
			data = that.parser.transclude(t, true), err = !data;
		if (err) {
			++errs;
			clas += ' ' + cls + '_error';
			data = that.i18n.ERR_NO_DECRYPT.sprintf(t);
			div[item] = exp ? no_decrypt.sprintf(clas, data) :
				line.sprintf(clas, pg, '', data);
		}
		else {
			div[item] = line.sprintf(clas,
				exp ? that.exporter._get_fname(t) : pg, data, t);
		}
	}
	var that = this, snippets = this.parser.snippets, div = [], i, l, cnt,
		p = {}, cls = 'woas_img_list', exp = woas.parser.export_links, errs = 0,
		no_decrypt = '<'+'div class="%s '+cls+'_error">%s<'+'/div>',
		line = '<'+'a class="%s" ' + (exp ? 'href="%s">' : 'onclick="woas.' +
		'go_to(\'%s\')">') + '%s<'+'div class="'+cls+'">%s<'+'/div><'+'/a>';
	this.parser.snippets = [];
	// div array will contain list of image namespace pages
	for (i = 0, l = page_titles.length, cnt = 0; i < l; ++i) {
		t = page_titles[i];
		if (t.indexOf(ns) === 0) {
			div[cnt++] = t;
		}
	}
	l = div.length;
	// first image
	if (l) {
		div.sort(this.strnatcmp); // PVHL: TODO: fix for case insensitive
		listing(0, cls + (l === 1 ? '_single' : '_first'));
	}
	--l;
	// last image (if more than one)
	if (l > 0) {
		listing(l, cls + '_last');
	}
	// everything in between
	for (i = 1; i < l; ++i) {
		listing(i, cls);
	}
	if (div.length) {
		p.text = div.join('');
	} else {
		p.text = this.i18n.EMPTY_NS.sprintf(ns);
	}
	this.parser.syntax_parse(p);
	this.parser.snippets = snippets;
	div = null;
	if (errs && !exp) {
		// want alert after page has loaded
		setTimeout("alert('"+this.i18n.ERR_NO_DECRYPT_ALERT.sprintf(errs)+"')", 0);
	}
	return p.text;
};

/*** src/core.js ***/
// core modules

// some tweak settings NOT to be touched - warranty void otherwise
woas.tweak = {
	// DANGER: could cause WoaS corruption -- be careful!
	edit_override: false,
	// perform integrity test of browser features
	integrity_test: false
};

woas.cmd_duplicate_page = function() {
	var pname = this._new_page(this.i18n.DUPLICATE_PAGE, true, current+" (duplicate)");
	if (pname === null)
		return;
	var pi = this.page_index(current);
	var dpi = this.page_index(pname);
	pages[dpi] = pages[pi];
	page_attrs[dpi] = page_attrs[pi];	
	// go to new page
	this.go_to(pname);
	// commit changes
	// PVHL: commit isn't using the i parameter; left but took out array
	this.commit(dpi);
};

woas.cmd_new_page = function() {
	this._new_page(this.i18n.INSERT_NEW, false, '');
};

// used to create a new page in the wiki
woas._new_page = function(msg, fill_mode, title) {
	title = this._prompt_title(msg, title, false);
	if (title === null)
		return null;
	return this._new_page_direct(title, fill_mode);
};

// will return a valid title for an about-to-be-created page
// PVHL: if called with plugin = true will check plugin title.
// EXISTING BUG: tweak.edit_override could create a bad plug-in here (@), but this
// fixes issue of not allowing plug-in with same name as an existing page.
// Workaround: don't create plugins with "new page" in edit_override mode!
// TODO: fix by updating valid_title and passing in complete p + title
woas._prompt_title = function(msg, title, plugin) {
	// disallow editing when wiki is set to read-only
	if (!this.config.permit_edits) {
		this.alert(this.i18n.READ_ONLY);
		return null;
	}
	var _title, p = plugin ? "WoaS::Plugins::" : "";
	while (true) {
		title = prompt(msg, title);
		if (title === null)
			return null;
		title = this.trim(title);
		if (this.valid_title(title)) {
			if (this.page_index(p + title) === -1) {
				return title;
			} else {
				// page exists: warn and try again
				this.alert(this.i18n.PAGE_EXISTS.sprintf(p + title));
			}
		}
	}
};

// PVHL: TODO:
//	1) add title to correct menu for namespace
//	2) create menu text here, but only change it if page saved, or get it on save
//	These changes probably need to wait for new code
woas._new_page_direct = function(title, fill_mode) {
	// properly split page title in (namespace, title) -> (ns, cr)
	var ns = this.get_namespace(title, true), cr;
	if (ns.length) {
		cr = title.substr(ns.length);
		ns = ns.substr(0, ns.length-2);
	} else cr = title;

	// check if page deserves creation
	if ((ns==="File") || (ns==="Image")) {
		this.go_to(title);
		return title;
	}
	// create and edit the new page
	var ct;
	if (cr !== "Menu")
		ct = "= "+cr+"\n";
	else
		ct = "\n";
	this._create_page_direct(ns, cr, fill_mode, ct);

	if (cr !== 'Menu') {
		var menu = this.get_text("::Menu"),
			test = new RegExp("\\[\\["+title+"\\s*[\\|\\]]");
		// ask if menu link wanted (if option allows) if one doesn't already exist
		if (!menu.match(test) && (this.config.menu_link === 1 ||
				(!this.config.menu_link && confirm(this.i18n.ASK_MENU_LINK)))) {
			// try to put the menu link in a good position
			var p = menu.indexOf("\n\n");
			if (p === -1)
				menu += "\n[["+title+"]]";
			else
				menu = menu.substring(0,p+2)+"[["+title+"]]\n"+menu.substring(p+2);
			this.set__text(this.page_index("::Menu"), menu);
		}
	}
	return title;
};

// used to eventually remove the new-to-be page when cancel is pressed
woas._ghost_page = false;

woas._create_page_direct = function(ns, cr, fill_mode, default_ct) {
	// actual page creation
	pages.push(default_ct);
	if (ns.length)
		cr = ns+"::"+cr;
	page_attrs.push(0);
	page_titles.push(cr);
	// set modified timestamp
	page_mts.push(this.config.store_mts ? Math.round(new Date().getTime()/1000) : 0);
//	this.log("Page "+cr+" added to internal array");	// log:0
	if (!fill_mode) {
		// DO NOT set 'current = cr' here!!!
		// enable ghost mode when creating a new-to-be page
		this._ghost_page = true;
//		this.log("Ghost page enabled"); //log:0
		// proceed with a normal wiki source page
		this.edit_page(cr);
	}
};

woas.cmd_erase_wiki = function(page) {
	if (this.erase_wiki()) {
		if (!this.full_commit()) {
			this.alert(this.i18n.FAILED_ERASE);
			// reload page because all data is lost - works even in IE6
			window.location = window.location;
		}
		// PVHL: successful erase; if called from an Import page will go back there
		this.set_current(page ? page : this.config.main_page, true);
	}
	return null;
};

// pages which shall never be modified
woas.static_pages = [
	"Special::About", "Special::Advanced", "Special::Options",
	"Special::Import", "Special::Lock","Special::Search", "Special::Embed",
	"Special::Export", "Special::License", "Special::ExportWSIF",
	"Special::ImportWSIF"
];

woas.static_pages2 = [
	"WoaS::Plugins", "WoaS::CSS::Boot", "WoaS::CSS::Core", "WoaS::Help",
	"WoaS::Template::ImportSettings", "WoaS::Template::Search", "WoaS::Template::Info"
];

woas.static_pages = woas.static_pages.concat(woas.static_pages2);

woas.erase_wiki = function() {
	if (!this.config.permit_edits) {
		this.alert(this.i18n.READ_ONLY);
		return false;
	}
	if (!confirm(this.i18n.CONFIRM_DELETE_ALL1) ||
		!confirm(this.i18n.CONFIRM_DELETE_ALL2)) {
		return false;
	}
	var _titles, _pages, i, il, pt, pi;
	_titles = [this.config.main_page, "::Menu", "WoaS::Aliases",
			"WoaS::Hotkeys", "WoaS::CSS::Custom"];
	_pages = ["A blank sheet is a catalyst for ideas",
		"[["+this.config.main_page+"]]\n[[Special::Options|Options]]\n\n"+
		"* [[Special::All Pages|All Pages]]\n"+
		"* [[Special::Recent Changes|Recent Changes]]\n"+
		"* [[Special::Go to|Go to...]]\n\n"+
		"* [[Special::Backlinks|Backlinks]]\n"+
		"* [[Special::New Page|New Page]]\n"+
		"* [[Special::Duplicate Page|Duplicate Page]]\n"+
		"* [[Special::Delete Page|Delete Page]]\n\n\n"+
		"[[Include::WoaS::Template::Search]]",
		"Lines that do not start with '$' are ignored\n\n$JS  Javascript",
		this.hotkey._cache_default(),
		"/* Your CSS customization goes here */"];
	// add all system pages
	for (i = 0, il = page_titles.length; i < il; ++i) {
		pt = page_titles[i];
		if (pt.indexOf("WoaS::Help") === 0 ||
				pt.indexOf("Special::") === 0 ||
				this.static_pages2.indexOf(pt) !== -1) {
			pi = this.page_index(pt);
			if (pi === -1) {
				this.alert(this.i18n.STATIC_NOT_FOUND.sprintf(pt));
				continue;
			}
			_pages.push(pages[pi]);
			if (!_pages[_pages.length - 1]) {
				_pages.pop();
				continue;
			}
			_titles.push(pt);
		}
	}
	// PVHL: This is where save could be done with temporary arrays.
	// This whole function could be done in save though - save instead
	// of erase, with save only saving core pages. Simple flag.
	pages = _pages;
	page_titles = _titles;
	// attributes and last modified timestamps for new pages
	// zero is the magic timestamp
	page_attrs = [];
	page_mts = [];
	for (i = 0, il = _pages.length; i < il; ++i) {
		page_attrs.push(0);
		page_mts.push(0);
	}
	current = this.config.main_page;
// PVHL: FIX this needs to be moved at some point
	this.ui.refresh_menu();
	this.history.clear();
	// reload all extensions
	this._load_aliases(this.get_text("WoaS::Aliases"));
	this.hotkey.load(this.get_text("WoaS::Hotkeys"));
	// remove all plugins
	this.plugins.clear();
	this.plugins.load();
	return true;
};

woas.cmd_main_page = function() {
	this.go_to(this.config.main_page);
	return null;
};

woas.cmd_go_to = function() {
	// don't go anywhere if editing
	if (this.ui.edit_mode)
		return;
	var pname;
	do {
		pname = prompt(this.i18n.GO_TO_PAGE, current);
		if ((pname !== null) && pname.length)
			if (this.go_to(pname))
				return;
	} while (pname !== null);
};

woas.cmd_delete = function() {
	// disallow editing when wiki is set to read-only
	if (!this.config.permit_edits) {
		this.alert(this.i18n.READ_ONLY);
	} else {
		var pname, pi;
		while ((pname = prompt(this.i18n.DELETE_PAGE_PROMPT, current)) !== null) {
			if (!pname.length)
				continue;
			pi = this.page_index(pname);
			if (pi === -1) {
				this.alert(this.i18n.PAGE_NOT_EXISTS.sprintf(pname));
			} else if (this.is_reserved(pname, true)) {
				this.alert(this.i18n.ERR_RESERVED_NS.sprintf(
					this.get_namespace(pname, true)));
			} else if (confirm(this.i18n.CONFIRM_DELETE.sprintf(pname))) {
				this.plugins.delete_check(pname);
				this.delete_page_i(pi);
				return true;
			}
		}
	}
	return false;
};

// javascript shortcuts for special pages
// PVHL: TODO: change to a map
woas.shortcuts = ["New Page", "Duplicate Page", "All Pages", "Orphaned Pages",
	"Backlinks", "Dead Pages", "Erase Wiki", "Main Page", "Go to",
	"Delete Page", "Recent Changes"];
woas.shortcuts_js = ["cmd_new_page", "cmd_duplicate_page", "special_all_pages",
	"special_orphaned_pages", "special_backlinks", "special_dead_pages",
	"cmd_erase_wiki",	"cmd_main_page", "cmd_go_to", "cmd_delete",
	"special_recent_changes"];

// PVHL: moved unexportable lists to export.js

// return raw javascript tag to be included in XHTML page
woas.raw_js = function(code) {
	return "<"+"script type=\"text/javascript\">\n"+code+"\n<"+"/s"+"cript>";
};

//API1.0: delete a page given title (without aliases)
woas.delete_page = function(title) {
	var pi = page_titles.indexOf(title);
	//DEBUG line
	if (pi === -1) {
		this.crash("Requesting deletion of nonexistent page!");
		return false;
	}
	return this.delete_page_i(pi);
};

//API1.0: delete a page given absolute page index
//API1.0: @protected
woas.delete_page_i = function(i) {
	var old_title = page_titles[i];
//	this.log("NOTE: deleted page "+old_title);	// log:0
	// remove the elements
	page_titles.splice(i,1);
	pages.splice(i,1);
	page_attrs.splice(i,1);
	page_mts.splice(i,1);
	// if we were looking at the deleted page
	if (current === old_title) {
		// go to an existing page
		this.set_current(this.history.previous(), true);
	} else {
		// always refresh the menu because it could contain the deleted page link
		// done automatically above
		this.ui.refresh_menu();
	}
	// remove page from history
	this.history.clear(old_title);
	//TODO: send proper save notification
	// commit_delete was never doing anything with i; just saving everything
	// I've left it here for when it does something, but removed the plist array
	return this.commit_delete(i);
};

// PVHL: Can't make changes to API I would like to without reworking a lot of
//   the code. The changes I have made attempt to fix current history issues.
woas.history = (function(){ // woas.history closure
	// commandeer the old backstack (breaks privacy; good enough for now)
	// much easier if it was one stack, but this way for historical reasons
	var backstack = window.backstack,
		forstack = [], // forward history stack, discarded when saving
		going_back = true,	// true if back called and for initial page load
		going_forward = false; // true if forward called

	// push a page into history
	function store(page) {
		if (/^(Lock|Javascript)::/.test(current)) {
			return;
		}
		if (backstack.length > woas.history.MAX_BROWSE_HISTORY)
			backstack = backstack.slice(1);
		backstack.push(page);
	}

	// the public API
	return {

	MAX_BROWSE_HISTORY: 6, // public for overriding

	has_forstack: function() {
		return (forstack.length > 0);
	},

	has_backstack: function() {
		return (backstack.length > 0);
	},

	previous: function() {
		// go back or to main page, do not save history
		if (backstack.length > 0) {
			return backstack.pop();
		} else
			return woas.config.main_page;
	},

	back: function() {
		if (backstack.length > 0) {
			if (!/^(Lock|Javascript)::/.test(current)) {
				forstack.push(current);
			}
			var title = backstack.pop();
			if (title)
				going_back = true;
			return title;			
		}
		woas.log("No back history");
		return null;
	},

	forward: function() {
		if (forstack.length > 0) {
			going_forward = true;
			return forstack.pop();
		}
		woas.log("No forward history");
		return null;
	},

	go: function(title, keep_fwd) {
		if (!going_back && !woas.ui.edit_mode && current !== title) {
			store(current);
		}
		if (!keep_fwd && !going_forward && !going_back/* && !/^Lock::/.test(title)*/) {
			forstack = [];
		}
		going_back = going_forward = false;
	},

	// PVHL: this shouldn't be here, but needed for new pages by current design
	// store() should be an internal, private function
	store: function(title) {
		store(title);
	},

	// remove title if it exists. If no title given clear history
	// return false if title was given but not found (could be useful)
	clear: function(title) {
		if  (title && title.length) {
			// remove the deleted page from history
			var found = false, i, it;
			for (i = 0, it = backstack.length; i < it; ++i) {
				// remove also duplicate sequences
				if (backstack[i] === title) {
					found = true;
					backstack.splice(i, 1);
					// fix the loop
					--it;
					// iterate again to remove duplicate sequences
					--i;
				}
			}
			// delete also from forstack
			for (i = 0, it = forstack.length; i < it; ++i) {
				// remove also duplicate sequences
				if (forstack[i] === title) {
					found = true;
					forstack.splice(i,1);
					--it;
					--i;
				}
			}
			return found;
		} else {
			forstack = [];
			backstack = [];
			return true;
		}
	},

	// rename old_title; titles must be valid
	rename: function (old_title, new_title) {
		var i;
		for (i = 0; i < backstack.length; ++i) {
			if (backstack[i] === old_title) {
				backstack[i] = new_title;
			}
		}
		for (i = 0; i < forstack.length; ++i) {
			if (forstack[i] === old_title) {
				forstack[i] = new_title;
			}
		}
	},

	// use: woas.log(woas.history.log())
	log: function() {
		function frmt(arr) {
			var str = [], i;
			for (i = 0; i < arr.length; ++i) {
				str.push(arr[i]);
			}
			return str.join(" | ");
		}
		return "history" + (backstack.length ? " : " : " > ")
			+ frmt(backstack) + (backstack.length ? " > " : "")
			+ current + (forstack.length ? " | " : "")
			+ frmt(forstack.slice(0).reverse());
	}
}}());

// some general integrity tests - for debug purposes
woas.integrity_test = function() {
	woas.log("Starting integrity test"); //log:1
	// test integrity of data arrays
	var len = pages.length;
	if ((page_attrs.length != len) ||
			(page_titles.length != len) ||
			(page_mts.length != len)) {
			this.crash("FATAL: data arrays have mismatching length!\n"+
						"#pages = %d, #page_attrs = %d, #page_titles = %d, #page_mts = %d".
						sprintf(pages.length, page_attrs.length, page_titles.length,
						page_mts.length));
		return false;
	}
	// test integrity of ecma encoding for normal UTF-8
	var UTF8_TEST = "Di\u00e2critics are here: \u00e4 \u00e1y";
	if (this.ecma_decode(this.ecma_encode(UTF8_TEST)) !== UTF8_TEST) {
		this.crash("ECMA encoding not working:\n"+this.ecma_decode(this.ecma_encode(UTF8_TEST))+
		"\n"+UTF8_TEST);
		return false;
	}
	// test integrity of ecma encoding for 16bit UTF-8
	var UTF8_TEST2 = "\u30e9\u30c9\u30af\u30ea\u30d5";
	if (this.ecma_decode(this.ecma_encode(UTF8_TEST2)) !== UTF8_TEST2) {
		this.crash("ECMA encoding/decoding not working:\n"+this.ecma_decode(this.ecma_encode(UTF8_TEST2))+
		"\n"+UTF8_TEST2);
		return false;
	}
	// test integrity of load/save functions if not on remote server
	if (!this._server_mode) {
		if (!this.save_file(woas.ROOT_DIRECTORY+"itest.bin", this.file_mode.UTF8_TEXT,
				woas.utf8.encode(UTF8_TEST)
	//			UTF8_TEST
				)) {
			this.crash("Save failure during integrity test\n"+woas.ROOT_DIRECTORY);
			return false;
		}
		var ct = this.load_file(woas.ROOT_DIRECTORY+"itest.bin", this.file_mode.UTF8_TEXT);
		if ((ct === null)||(ct === false)) {
			if (ct === false)
				this.crash("Load failure during integrity test\n"+woas.ROOT_DIRECTORY);
			return false;
		}
		ct = woas.utf8.decode(ct);
		if (ct !== UTF8_TEST) {
			this.crash("UTF8 test failed.\nWritten:\n"+UTF8_TEST+"\nRead:\n"+ct);
			return false;
		}
	} else { // we are on a remote server
		woas.log("Skipping save integrity test because running from web server");	//log:1
		//TODO: remote load integrity test
	}
	// now test AES encryption
	woas.AES.setKey("WoaS");
	var testdata = "sample text here";
	var enc = woas.AES.encrypt(testdata);
	if (woas.AES.decrypt(enc) !== testdata) {
		this.crash("AES encryption is not working two-way!");
		woas.AES.clearKey();
		return false;
	}
	if (woas.AES.decrypt(woas.AES.encrypt(UTF8_TEST)) !== UTF8_TEST) {
		this.crash("AES encryption of UTF8 text is not working two-way!");
		woas.AES.clearKey();
		return false;
	}
	var enc = woas.AES.encryptB64(testdata);
	if (woas.AES.decryptB64(enc) !== testdata) {
		this.crash("AES Base64 encryption is not working two-way!");
		woas.AES.clearKey();
		return false;
	}
	woas.AES.clearKey();
	woas.log("Integrity test successful"); //log:1
	return true;
};

// used in path normalization during export
woas.DIRECTORY_SEPARATOR = (navigator.appVersion.indexOf("Win")!=-1)?"\\":"/";

woas._dirname_regex = new RegExp("\\"+woas.DIRECTORY_SEPARATOR+"[^\\"+woas.DIRECTORY_SEPARATOR+"]*$");
woas._basename_regex = new RegExp("[\\\\/]([^\\\\/]+)$");		// "\\[\\\\/]([^\\\\/]+)$"

// hackish functions, might stay private for now
woas.dirname = function(fn) {
	return fn.replace(this._dirname_regex, woas.DIRECTORY_SEPARATOR);
};

woas.basename = function(fn) {
	var m = fn.match(this._basename_regex);
	if (m === null)
		return fn;
	return m[1];
};

// the export path used by export feature
woas.ROOT_DIRECTORY = woas.dirname(_get_this_filename());

//API1.0: get page attributes - can be overriden by plugins
//TODO: all code should use this function
woas.get_page_attrs = function(pi) {
	// no error check
	return page_attrs[pi];
};

//API1.0: set page attributes - can be overriden by plugins
//TODO: all code should use this function
woas.set_page_attrs = function(pi, attrs) {
	// no error check
	page_attrs[pi] = attrs;
	return true;
};

//API1.0: dynamically add a hotkey
// returns true if hotkey was added successfully or if already present
woas.add_hotkey = function(key, function_obj) {
	//FIXME: this needs to be finished!
};

woas.split_bytes = function(s) {
	var l=s.length;
	var arr=[];
	for(var i=0;i < l;i++)
		arr.push(s.charCodeAt(i));
	return arr;
};
	
woas.merge_bytes = function(byte_arr) {
	var l=byte_arr.length, s="";
	for(var i=0;i < l;i++) {
		s+=String.fromCharCode(byte_arr[i]);
	}
	return s;
};

var reReplaceBr = new RegExp("<"+"br\\s?\\/?>", "gi");
woas.xhtml_to_text = function(s) {
	return s.replace(reReplaceBr, "\n")
		.replace(/<\/?\w+[^>]*>/g, '')
		.replace(/&#?([^;]+);/g, function(str, $1) {
			return isNaN($1) ? '' : String.fromCharCode($1);
		});
};

// WoaS DOM manager
// all DOM modifications shall be indexed by this module
// PVHL: does not include elements only used by _resize
woas.dom = {
	// hashmap used to quickly reference some important DOM objects
	_cache: {},
	// DOM management area
	_objects: [],
	
	init: function() {
		// ui_display should only be used directly by woas.ui.display
		this._cache.ui_display = d$('woas_ui');
		this._cache.head = document.getElementsByTagName("head")[0];
		this._cache.body = document.getElementsByTagName("body")[0];
		this._cache.hdr = d$('woas_header_wrap');
		this._cache.title = d$('woas_title');
		this._cache.ed_title = d$('wiki_page_title');
		this._cache.ed = d$('woas_editor');
		this._cache.log = d$("woas_debug_log");
		this._cache.scroller = d$("woas_scroll_wrap");
		// find out which element controls fixed height scrolling
		// html/document: IE, FF, Opera, ?; body: WebKit, ?
		this._cache.scroll = this._cache.scrollAll =
			document.getElementsByTagName("html")[0];
		if (this._cache.body.scrollHeight > this._cache.scrollAll.scrollHeight)
			this._cache.scrollAll = this._cache.body;
		// CSS cache moved to woas.CSS for now
		// create an icon while we're here
		// nothing seems to work for IE, not even an external icon file
		var link = document.createElement('link');
		link.rel = 'icon';
		link.href = d$("woas_logo").src;
		woas.dom._cache.head.appendChild(link);
	},
	
	add_css: function(css_id, css_src, external, after_load) {
		// always add this custom prefix
		css_id = "woas_css_"+css_id;
		
		// check if we have a duplicate instance
		if (this.index(css_id) !== -1) {
			woas.log("DOM: instance "+css_id+" already exists");
			return false;
		}
		
		var style;
		if (external) {
			style = document.createElement("link");
			style.setAttribute("rel", "stylesheet");
			style.setAttribute("type", "text/css");
			style.setAttribute("id", css_id);
			style.setAttribute("href", css_src);
			// only when external
			++this._loading;
		} else {
			style = document.createElement('style');
			style.type = "text/css";
			style.id = css_id;
			style.appendChild(document.createTextNode(css_src));
		}
		
		this._objects.push( {obj:style, parent: (woas.browser.ie ? this._cache.body:this._cache.head),
							instance:css_id, after_load: external ? after_load : null } );
		
		woas.log("DOM: "+css_id+" created "+this._show_load());
		// add a callback which informs us of the completion (not always possible)
		if (external) {
			// these engines don't support a callback :(
			if (woas.browser.gecko || woas.browser.webkit) {
				setTimeout("woas.dom._elem_onload('"+woas.js_encode(css_id)+"');", 100);
			} else { // good ol' IE
				style.onreadystatechange = woas._make_delta_func("woas.dom._elem_onload",
													"'"+woas.js_encode(css_id)+"'");
			}
		}
		
		// on IE inject directly in body
		if (woas.browser.ie) {
			this._cache.body.appendChild(style);
		} else {
			this._cache.head.appendChild(style);
		}
		return true;
	},
	
	remove_css: function(i) {
		return this.remove("woas_css_"+i);
	},

	remove_script: function(script_class, script_id) {
		return this.remove("woas_script_"+script_class+"_"+script_id);
	},
	
	remove: function(instance) {
		var found = this.index(instance);
		if (found === -1)
			return false;
		// delete DOM entry from parent container
		this._objects[found].parent.removeChild(this._objects[found].obj);
		// fix arrays
		this._objects.splice(found, 1);
		return true;
	},
	
	// counter of elements being loaded
	_loading: 0,
	
	// generic callback used when we want to run something after the file has been loaded
	// (usually CSS/JavaScript)
	_elem_onload: function(instance) {
		// go away if it is already loaded
		if (woas.dom.get_loaded(instance))
			return;
		// only for IE
		if (woas.browser.ie && (typeof this.readyState != "undefined")) {
			if (this.readyState != 'complete' && this.readyState != 'loaded')
				return;
			// remove handler
			this.onreadystatechange = null;
		} else if (woas.browser.firefox) {
		  // unplug handler
		  var dom_obj = woas.dom._objects[woas.dom.index(instance)];
		  dom_obj.obj.onload = null;
		}
		// set as loaded (shall not remove from arrays)
		woas.dom.set_loaded(instance);
	},
	
	get_loaded: function(instance) {
		var i = this.index(instance);
		if (i !== -1) {
			if (this._objects[i].instance === instance)
				return this._objects[i].loaded;
		}
		woas.log("DOM: "+instance+" is not indexed"+this._show_load());
		return false;
	},
	
	// get list of instances which are still loading
	get_loading: function() {
		var a=[];
		for(var i=0,it=this._objects.length;i < it;++i) {
			if (!this._objects[i].loaded)
				a.push(this._objects[i].instance);
		}
		return a;
	},
	
	// short-hand to get index of an instance
	index: function(instance) {
		for(var i=0,it=this._objects.length;i < it;++i) {
			if (this._objects[i].instance === instance)
				return i;
		}
		return -1;
	},

	set_loaded: function(instance) {
		var i = this.index(instance);
		if (i !== -1) {
			this._objects[i].loaded = true;
				
			// now call the associated callback
			if (typeof this._objects[i].after_load == "function") {
				(this._objects[i].after_load)();
			}
			
			// reduce the counter of 'hung' requests
			--this._loading;
			woas.log("DOM: "+instance+" completed loading"+this._show_load());
			// check if we need to launch the hook
			if (this._loading === 0)
				this._run_post_load_hook();
			
			return true;
		}
		woas.log("DOM: "+instance+" completed loading, but was not indexed"+this._show_load());
		return false;
	},
	
	_show_load: function() {
		return "";
/*		return " (%d/%d)".sprintf(this._loading, this._objects.length)+"\n"+
				"still loading: "+this.get_loading();
*/
	},
	
	// regex used to remove some comments
	reJSComments: /^\s*\/\*[\s\S]*?\*\/\s*/g,
	
	_internal_add: function(script_token, script_content, external, after_load) {
		script_token = "woas_script_"+script_token;
		// check if we have a duplicate instance
		if (this.index(script_token) !== -1) {
			woas.log("DOM: instance "+script_token+" already exists");
			return false;
		}
		
		var s_elem = document.createElement("script");
		s_elem.type="text/javascript";
		s_elem.id = script_token;

		// register in our management arrays
		this._objects.push( {obj:s_elem, parent:this._cache.head, instance:script_token,
								external: external ? true : false,
								loaded: external ? false : true, after_load: external ? after_load : null} );
		// only external sources should be marked as "loading"
		if (external)
			++this._loading;
//		woas.log("DOM: "+script_token+" created "+(external ? "("+script_content+") ":"(inline) ")+this._show_load());
		// add a callback which informs us of the completion
		if (external) {
			if (woas.browser.ie)
				s_elem.onreadystatechange = woas._make_delta_func("woas.dom._elem_onload",
													"'"+woas.js_encode(s_elem.id)+"'");
			else
				s_elem.onload = woas._make_delta_func("woas.dom._elem_onload",
													"'"+woas.js_encode(s_elem.id)+"'");
			// specify the external URL
			s_elem.src = script_content;
		}
				
		this._cache.head.appendChild(s_elem);
		if (!external) {
//			woas.alert("Inline code:\n"+script_content);
			woas.setHTML(s_elem, script_content);
		}
		return true;
	},
	
	add_script: function(script_class, script_id, script_content, external, after_load) {
		// remove the comments
		if (!external)
			script_content = script_content.replace(this.reJSComments, '');
		// it's not necessary to add this script tag
		if (!script_content.length) return false;
		return this._internal_add(script_class+"_"+script_id, script_content, external, after_load);
	},
	
	// remove all script objects
    // PVHL: where does _instances come from?
	remove_all: function() {
		var it=this._instances.length;
		for(var i=0;i < it;++i) {
			// remove the object
			this._objects[i].parent.removeChild(this._objects[i].obj);
		}
		// clear objects array
		this._objects = [];
	},
	
	// call the argument function when there aren't other libraries left to load
	// returns true if loading was already complete
	// returns false if we are async-waiting
	_post_load_hook: woas._dummy_fn,
	wait_loading: function(fn_object) {
		if (this._loading === 0) {
			(fn_object)();
			// always reset associated async hook
			this._post_load_hook = woas._dummy_fn;
			return true;
		}
		// associate the hook
		this._post_load_hook = fn_object;
		return false;
	},
	
	_run_post_load_hook: function() {
		// run in a thread so that the call to last object unload does not wait on the hook
		setTimeout('woas.dom._post_load_hook();woas.dom._post_load_hook=woas._dummy_fn;', 10);
	}
	
};

// generate a delta function and cache it
woas._delta_cache = {};
woas._make_delta_func = function(fn_name, fn_args) {
	var id=fn_name+' '+fn_args;
	var fn_obj;
	if (typeof woas._delta_cache[id] == "undefined") {
		eval("fn_obj = function() { "+fn_name+"("+fn_args+"); };");
		woas._delta_cache[id] = fn_obj;
	} else
		fn_obj = woas._delta_cache[id];
	return fn_obj;
};

// @module pager
woas.pager = {

	_decrypt_failed: false,	// the last decryption failed due to wrong password attempts
	
	decrypt_failed: function() {
		if (this._decrypt_failed) {
			this._decrypt_failed = false;
			return true;
		}
		return false;
	},

	get: function(title) {
		return woas.get_text(title);
	},
	
	get_by_index: function(i) {
		return woas.get__text(i);
	},
	
	// this yummy function needs can be overriden
	// Determines if page 'title' is allowed to be loaded by woas.set_current
	// return false to block the page from being loading, true to allow.
	browse_hook: function(title) {
		return true;
	},
	
	// set content of specified page
	set_body: function(title, new_body) {
		var pi = woas.page_index(title);
		if (pi === -1 && woas.debug_mode) {
			woas.log("BUG: page \""+title+"\" does not exist!");	// log:1
			return;
		}
		woas.set__text(pi, new_body);
	}
};

// @module pager.bucket
woas.pager.bucket = {
	items: [],		// multi-pages selection
	clear: function() {
		this.items = [];
	},
	add: function(title) {
		if (this.items.indexOf(title) === -1)
			this.items.push(title);
	},
	// used when we want to set a single page in bucket
	one: function(title) {
		this.items = [title];
	}
};

// namespace for custom stuff defined by macros/plugins
// if you are a JavaScript developer you should put singleton instance objects in here
woas.custom = { };

/*** src/stickwiki.js ***/
// the last page on which the cached AES key was used on
woas.last_AES_page = "";

// tells if configuration has been changed
woas.cfg_changed = false;

// new variables will be properly declared here
woas.prev_title = current;		// previous page's title used when entering/exiting edit mode

// this will likely happen when javascript code block was corrupted
woas._on_load = woas_on_unload = function() { this.crash("Deferred load/unload function not available!");};

// default post-load hook
woas.post_load = function(){};

// left and right trim
// grabbed from http://blog.stevenlevithan.com/archives/faster-trim-javascript
woas.trim = function(str) {
//	return s.replace(/(^\s*)|(\s*$)/, '');
	if (!str) {
		str = '';
	}
	else {
		str = str.replace(/^\s+/, '');
		for (var i = str.length - 1; i >= 0; i--) {
			if (/\S/.test(str.charAt(i))) {
				str = str.substring(0, i + 1);
				break;
			}
		}
	}
	return str;
};

// used to craft XHTML pages
woas.DOCTYPE = "<"+"!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.1//EN\" \"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\">\n";
woas.DOC_START = "<"+"html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\""+
	"en\">\n<"+"head>\n"+"<"+"meta woas_permanent=\"1\" http-equiv=\"Content-"+
	"Type\" content=\"text/html; charset=UTF-8\" />\n<"+"meta woas_permanent="+
	"\"1\" http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n";

// general javascript-safe string quoting
// NOTE: not completely binary safe!
// should be used only for titles (which ought not to contain binary bytes)
var reMinorG = new RegExp("<", "g");
woas.js_encode = function (s, split_lines) {
	// not to confound browsers with saved tags
	s = s.replace(/\\/g, "\\\\").replace(reMinorG, "\\x3C").replace(/>/g, "\\x3E").
		replace(/'/g, "\\'");
	// escape newlines (\r\n happens only on the stupid IE) and eventually split the lines accordingly
	if (!split_lines)
		s = s.replace(new RegExp("\r\n|\n", "g"), "\\n");
	else
		s = s.replace(new RegExp("\r\n|\n", "g"), "\\n\\\n");
	return this._utf8_js_fix(s);
};

// perform ECMAScript encoding only on some UTF-8 sequences
woas.ecma_encode = function(s) {
	return this._utf8_js_fix(s.replace(/\\/g, "\\\\"));
};

woas._ecma_rx_test = new RegExp("[^\u0000-\u007F]");

// returns true if text needs ECMA encoding
// checks if there are UTF-8 characters
woas.needs_ecma_encoding = function(s) {
	return this._ecma_rx_test.test(s);
};

woas._utf8_js_fix = function(s) {
	// fix the >= 128 ascii chars (to prevent UTF-8 characters corruption)
	return s.replace(woas.utf8.reUTF8Space, function(str) {
		var r="";
		for(var a=0,l=str.length;a < l;++a) {
			var s = str.charCodeAt(a).toString(16);
			r += "\\u" + "0000".substr(s.length) + s;
		}
		return r;
	});
};

woas.ecma_decode = function(s) {
	return s.replace(new RegExp("(\\\\u[0-9a-f]{4})+", "g"), function (str, $1) {
		// this will perform real UTF-8 decoding
		var r = "";
		for (var ic=0,totc=str.length;ic < totc;ic+=6) {
			// get the hexa-numeric part
			var c = str.substr(ic+2, 4);
			// remove leading zeroes and convert to base10
			c = parseInt(c.replace(/^0*/,''), 16);
			// convert UTF-8 sequence to character
			r += String.fromCharCode(c);
		}
		return r;
	}).replace(/\\\\/g, "\\");
};

// used to escape blocks of source into HTML-valid output
woas.xhtml_encode = function(src) {
	return this.utf8.do_escape(src.replace(/&/g, '&amp;').replace(reMinorG, '&lt;').
			replace(/>/g, '&gt;')); // .replace(/"/g, '&quot;').replace(/'/g, '&#39;');
};

// DO NOT modify this list! these are namespaces that are reserved to WoaS
woas._rxReserved = ["(WoaS|Special)", "Lock(?:ed)?", "Unlock(?:ed)?",
	"Tag(?:s|ged)?", "Untagged", "Include", "Javascript"];
// create the regex for reserved namespaces
woas._rxReserved = new RegExp("^(?:" + woas._rxReserved.join("|") + ")::");

// 'edit' causes WoaS and Special namespaces to be unreserved if set;
// NO guarantee that pages exists, just what namspace it belongs to
woas.is_reserved = function(title, edit) {
	var m = (title || '').match(this._rxReserved);
	return edit && this.tweak.edit_override ? m && !m[1] : !!m;
};

// return page index given its title
woas.page_index = function(title) {
	return page_titles.indexOf(this.title_unalias(title));
};

woas.is_menu = function(title) {
	return title.substr(-6) === '::Menu' && title !== 'WoaS::Help::Menu';
};

// returns namespace (with trailing '::' if 'option' !== false) or '';
// optional option returns only the root namespace if true,
// full namespace without double colons if false.
woas.get_namespace = function(page, option) {
	var	p = option ? page.indexOf("::") : page.lastIndexOf("::");
	return p === -1 ? "" : page.substring(0, option === false ? p : p + 2);
};

// page attributes bits are mapped to (readonly, encrypted, ...)

woas.is_readonly = function(page) {
	return this.is_readonly_id(this.page_index(page));
};

woas.is_readonly_id = function(pi) {
	return !!(page_attrs[pi] & 1);
};

woas.is__encrypted = function (pi) {
	return !!(page_attrs[pi] & 2);
};

// PVHL: now returns true, false, or null for unknown page
woas.is_encrypted = function(page) {
	var pi = !!page && this.page_index(page);
	return pi && pi !== -1 ? this.is__encrypted(pi) : null;
};

// 'embedded' means: this is likely binary content; a file or image
woas.is__embedded = function(pi) {
	return !!(page_attrs[pi] & 4);
};
woas.is_embedded = function(page) {return this.is__embedded(this.page_index(page));};

woas.is__image = function(pi) {
	return !!(page_attrs[pi] & 8);
};
woas.is_image = function(page) { return this.is__image(this.page_index(page)); };

// page would open normally if link containing 'title' was clicked; includes
// Special:: pages that are not commands
// optional 'flag':
//	false - Help pages and Special:: command links not allowed (for setting
//	        'current' or 'main page')
//	true - page exists if a link to it would be valid (includes Special::*
//	       pages that have no content)
woas.page_exists = function(title, flag) {
	if (!title) {return false;}
	var exists, n;
	if (flag === false && /^WoaS::Help::\S/.test(title)) {
		return false;
	}
	exists = (title.substr(-2) === "::" || this.page_index(title) !== -1);
	if (!exists) {
		if (!title.indexOf("Special::")) {
			n = this.shortcuts.indexOf(title.substr(9));
			if (n !== -1) {
				// special page exists; valid if all accepted or not a cmd
				exists = flag || this.shortcuts_js[n].indexOf("cmd");
			}
		}
		// TODO: not sure this is good enough; better than what was here before
		else {
			exists = this.is_reserved(title, true); // reserved, not WoaS/Special
		}
	}
	return exists;
};

// with two trailing colons 'xx::'
woas._get_namespace_pages = function (ns) {
	var pg = [], i, l;
	switch (ns.substr(0, ns.indexOf('::'))) {
	case "Locked":
		return this.special_encrypted_pages(true);
	case "Unlocked":
		return this.special_encrypted_pages(false);
	case "Untagged":
		return this.special_untagged();
	case "Tagged": // to be used in wiki source
		return this.special_tagged();
	case "Image":
		return this._special_image_gallery(ns);
	case "Special":
		for (i = 0; i < this.shortcuts.length; ++i) {
				pg.push(ns + this.shortcuts[i]);
		}
		for(i = 0, l = page_titles.length; i < l; ++i) {
			if (page_titles[i].indexOf(ns) === 0
					// don't show pages used by special functions unless override
					&& (woas.tweak.edit_override ||
					(page_titles[i] !== 'Special::Embed' && page_titles[i] !== 'Special::Lock'))){
				pg.push(page_titles[i]);
			}
		}
		return this._join_list(pg);
	case "Tag":
	case "Tags":
	case "Include":
	case "Lock":
	case "Unlock":
	case "Javascript":
		// these should not be viewed as a namespace
		return woas.i18n.NOT_A_NS.sprintf(ns);
	}

	for(i = 0, l = page_titles.length; i < l; ++i) {
		if (page_titles[i].indexOf(ns) === 0)
			pg.push(page_titles[i]);
	}
	return !pg.length ? woas.i18n.EMPTY_NS.sprintf(ns) : this._join_list(pg);
};

// return a plain page or a decrypted one if available through the latest key
woas.get_page = function(pi) {
	if (this.is__embedded(pi))
		return null;
	if (!this.is__encrypted(pi))
		return pages[pi];
	if (!this.AES.isKeySet()) {
		this.last_AES_page = "";
		return null;
	}
	var pg = this.AES.decryptB64(pages[pi]);
	this.last_AES_page = page_titles[pi];
	return pg;	
};

var reScriptTags = new RegExp("<"+"script[^>]*>((.|\\n)*?)<"+"\\/script>", "gi"),
	reAnyXHTML = /\<\/?\w+[^>]*>/g;
// get the text of the page, stripped of html tags
// PVHL: Original code was able to break search listing because of the html comments.
//	I have removed 'rawmode' as I am not using this function in search any more.
//	The original reAnyXHTML was broken and couldn't find things like <b>
woas.get_src_page = function(pi) {
	var pg = this.get_page(pi);
	// remove what special pages don't want: nowiki, macro, script content, and html tags
	return pg === null ? null : pg.replace(woas.parser.reDry, " ")
		.replace(reScriptTags, " ").replace(reAnyXHTML, " ");
};

woas.get_text = function (title, exp) {
	var pi = this.page_index(title);
	return pi === -1 ? null : this.get__text(pi, exp);
};

// PVHL: fn is used primarily for transcluding page text; the special does not
//   refer to special pages, but to purpose. Exception is export module which
//   uses it to get all pages. Will test; added exp for exporter.
woas.get_text_special = function(title, exp) {
	var ns = this.get_namespace(title), // '' if no namespace
		text = '', wp = 'WoaS::Plugins::', pre = false, p;
	if (ns.length) {
		title = title.substring(ns.length);
		// title ends in '::'
		if (!title.length) return this._get_namespace_pages(ns);
		// adjust namespace for plugins
		if (ns.indexOf(wp) === 0) {
			title = ns.substr(wp.length) + title;
			ns = wp;
		}
//		woas.log("namespace of "+title+" is "+ns);	// log:0
		switch (ns) {
			case "Special::":
				text = this._get_special(title, false);
				text = text || null; // can return false
			break;
			case "Tagged::":
				text = this.special_tagged(title);
			break;
			// next two cases handle plugin transclusion issues
			case 'WoaS::':
				if (title === 'Plugins') {
					// Special case for plugins page
					text = this.get_text(ns+title)+this.plugins.list();
				} else if (title === 'Aliases' || title === 'Hotkeys') {
					pre = true;
				}
			break;
			case 'WoaS::CSS::':
			case wp: // plugins
				pre = true;
			// default is handled below
		}
	}
	if (text === '') {
		// if we didn't already try for the text and fail
		text = this.get_text(ns + title, exp);
	}
	if (pre && text && !exp) {
		// transclude as it would be if viewed; only happens when transcluding
		// because export doesn't include 'pre' pages (CSS, WoaS::Hotkeys, etc.)
		p = this.parser;
		return p.place_holder(p._raw_preformatted('pre', text, 'woas_core_page'));
	}
	return text;
};

woas.__last_title = null;

woas.__password_finalize = function(pwd_obj) {
	document.title = this.__last_title;
	this.ui.display({pswd:false});
	// hide input form
	pwd_obj.value = "";
	pwd_obj.blur();
	this.ui.blur_textbox();
};

woas._set_password = function() {
	this.__last_title = document.title;
	document.title = "Enter password";
	// hide browser scrollbars and show mask
	this.ui.display({pswd:true});
	d$("woas_password").focus();	
	this.ui.focus_textbox();
};

woas._password_cancel = function() {
	this.__password_finalize(d$("woas_password"));
};

// PVHL: input now accepts password if enter has been pressed
//   will redo to use key callback function later
woas._password_ok = function(el, e) {
	// test for enter key pressed
	var flag = e ? e.keyCode === 13 : true, pw;
	if (flag) {
		pw = el.value;
		if (!pw.length) {
			this.alert(this.i18n.PWD_QUERY);
		} else {
			this.AES.setKey(pw);
			this.__password_finalize(el);
		}
	}
	return true;
};

// TODO: AES module should handle key clearing itself; just set if key cached
// PVHL: TODO: now that no_alert is present, change password handling to enter password
woas.get__text = function(pi, no_alert) {
	if (!this.is__encrypted(pi))
		return pages[pi];
	var warn = no_alert ? this.log : this.alert;
	this.pager._decrypt_failed = true;
	if (!this.AES.isKeySet()) {
		warn(this.i18n.ERR_PWD_UNSET.sprintf(page_titles[pi]) +
			(no_alert ? "" : this.i18n.ERR_PWD_ENTER));
		return null;
	}
	// AES_decrypt can return null on failure, but can also return a garbled output
	// PVHL: TODO: if this is true we need to add a test to validate; base64 will
	//	no doubt fail with bad chars if bad password, so use this -- shouldn't get
	//	a base64 error message in log as we do presently
	var pg = this.AES.decryptB64(pages[pi]);
	this.last_AES_page = page_titles[pi];
	if (!this.config.key_cache)
		this.AES.clearKey();
	if (pg !== null) {
		this.pager._decrypt_failed = false;
	} else {
		warn(this.i18n.ERR_PWD_WRONG.sprintf(page_titles[pi]) +
			(no_alert ? "" : this.i18n.ERR_PWD_ENTER));
		this.last_AES_page = "";
	}
	return pg;
};

// TODO: test; what happens if key is cleared
woas.set__text = function(pi, text) {
	//this.log("Setting wiki text for page #"+pi+" \""+page_titles[pi]+"\"");	// log:1
	if (this.is__encrypted(pi)) {
		pages[pi] = this.AES.encryptB64(text);
		this.last_AES_page = page_titles[pi];
	}
	else {
		if (this.is__embedded(pi) && !this.is__image(pi))
			text = this.base64.encode(text);
		pages[pi] = text;
	}
};

woas.assert_current = function(page) {
	if( current !== page )
		this.go_to( page ) ;
	else
		this.set_current(page, true);
};

woas._get_embedded = function(cr, etype) {
	var pi = this.page_index(cr);
	if (pi === -1) {
		var snippets = woas.parser.snippets, p;
		woas.parser.snippets = [];
		p = {text:this.parser.transclude("Special::Embed|"+etype)};
		this.parser.syntax_parse(p);
		woas.parser.snippets = snippets;
		return p.text;
	}
	return this._get__embedded(cr, pi, etype);
};

woas._get__embedded = function (cr, pi, etype) {
	function parse(p, full) {
		var snippets = woas.parser.snippets;
		woas.parser.snippets = [];
		if (full) {
			// if nowiki/macros present
			var s = [];
			woas.parser.pre_parse(p, s);
			woas.parser.syntax_parse(p, s);
			s = null;
		}
		else {
			woas.parser.syntax_parse(p, []);
		}
		woas.parser.snippets = snippets;
		return p.text;
	}
	
	var text = this.get__text(pi), b = this.browser, str = this.i18n,
		bin = /*b.ie ||*/ b.firefox && (parseFloat(b.gecko) < 17 || this.isWoasFox());
	if (text === null)
		return null;

	if (etype === "file") {
		var pview_data = this.base64.decode(text, 1024),
			ext_size = Math.ceil((text.length*3)/4),
			// a good guess: not guaranteed but better than nothing
			txt = !!(this.tiddlySaver && this.tiddlySaver.saveFile) ||
					this.isTiddlyFox();

		return parse({text:"<"+"div id='_part_display'>"+(ext_size-pview_data.length>10 ?
			"[[Javascript::show_full_file("+pi+")|"+str.DISPLAY_FULL_FILE+"]]&nbsp; "+
			str.FILE_DISPLAY_LIMIT : '')})+
			this.parser._raw_preformatted("pre", pview_data, 'woas_embedded')+
			parse({text:"<"+"/div>\n\n"+str.FILE_SIZE+": "+_convert_bytes(ext_size)+
			"\n" + (this.config.store_mts ? this.last_modified(page_mts[pi]) : "")+
			"\n\n"+str.T1+"\n{{{[[Include::"+cr+"]]}}}"+
			"\n\n"+str.T2+"\n{{{[[Include::"+cr+"|raw]]}}}"+
			(this.is_reserved(cr) ? "\n" : "\n\n[[Javascript::query_delete_file('"+
			this.js_encode(cr)+"')|"+str.DELETE_FILE+"]]\n")+
			(bin ? "" : str.EXPORT_FILE_NO_BIN)+(txt ? str.EXPORT_FILE_TXT1 : "")+
			(bin || txt ? "\n[[Javascript::query_export_file('"+
			this.js_encode(cr)+"'"+(bin ? "" : ",true")+
			")|"+(bin ? str.EXPORT_FILE : str.EXPORT_FILE_TXT2)+"]]" : "")}, true);
	}
	// etype == image
	// PVHL: modified to handle errors and remove export where not possible
	// TODO: replace all text with i18n strings
	var mime = text.match(/^data:\s*([^;]+);/)[1],
		tot_len = text.length,
		enc_len = text.match(/^data:\s*[^;]*;\s*[^,]*,\s*/)[0].length,
		mts = (this.config.store_mts ? page_mts[pi] : 0 ),
		fn = "='_img_properties_show(\""+mime+"\","+tot_len+","+enc_len+","+mts;

	return parse({text:"<"+"img id='woas_img_tag' src='"+
		text+"' alt='"+this.xhtml_encode(cr.substr(cr.indexOf("::")+2))+"' "+
		// ie6
		(b.ie6 ? "class='woas_hide' />"+str.IMG_NO_DISPLAY+"\n"+
		_img_properties_show(mime, tot_len, enc_len, mts, -1) :
		// !ie6
		"onload"+fn+")'; onerror"+fn+",true)' /><"+
		"div id='woas_img_desc'>"+str.LOADING+"<"+"/div>")+
		// all
		"\n\n"+str.T3+"\n{{{[[Include::"+cr+"]]}}}\n\n"+str.T4+"\n{{{[[Include::"+
		cr+"|border='0' onclick='woas.go_to(\""+this.js_encode(cr)+
		"\")' style='cursor:pointer']]}}}\n\n[[Javascript::query_delete_image('"+
		this.js_encode(cr)+"')|"+str.DELETE_IMAGE+"]]\n"+
		(bin ? "\n[[Javascript::query_export_image('"+
		this.js_encode(cr)+"')|"+str.EXPORT_IMAGE+"]]\n"
		: "\n"+str.IMG_NO_EXPORT)}, true);
};

// called by embed ::File and ::Image
// comes here with FileList object, or equivalent
// for now only passes first file entry to file_load
woas._embed_process = function(etype, file) {
	var file, img, i = 0;
	if (file === undefined) {
		// just in case someone out there was using this function
		woas.log("ERROR: 'file' parameter missing in " +
			"_embed_process("+etype+", file)");
		return false;
	}
	img = etype === "image"
	// pick the correct mode for file inclusion
	file.mode = img ? this.file_mode.DATA_URI : this.file_mode.BASE64;
	// normalize etype to the corresponding binary flag value
	file.etype = img ? 12 : 4;
	file.list.that = this;
	file.list.callback = this._embed_process_cb;
	this.load_file(file);
	return;
};

// here after file read; files: { str: content, etype: mode, r: status}
// rest of files members come from woas._embed_process function
// files and file[0] must exist
// TODO: upgrade for multiple file/image embedding
woas._embed_process_cb = function(file) {
	if (file.r && file.str) {
		// create the new page
		pages.push(file.str);
		page_attrs.push(file.etype);
		page_titles.push(current);
		// set modified timestamp to now
		page_mts.push(this.config.store_mts ?
			Math.round(new Date().getTime()/1000) : 0);
		// save the new page and go there
		// commit just does a full save for now
		this.commit();
		this.set_current(current, true);
	}
};

// calls Special:: functions given page without namespace; if not a 'Special::'
// gets the 'normal' page text; optional 'interactive' allows non-text commands
// (e.g.: 'Special::Go to'); returns:
//	false: a command called (side-effect, no text)
//	null: page not found or side-effect commands not wanted
//	text: the returned page text; e.g. Special::License, etc
woas._get_special = function(cr, interactive) {
	var pi = this.shortcuts.indexOf(cr), fn, is_cmd, text;
	cr = "Special::" + cr;
	if (pi === -1) {
		// not a 'Special::' function; see if it's a real page
		text = this.get_text(cr);
	}
	else {
		fn = this.shortcuts_js[pi];
		is_cmd = fn.indexOf("cmd_") === 0;
		if (!interactive && is_cmd)
			return null;
		// for side-effect of calling fn "cmd_"s and getting text of pages
		text = this[fn]();
		if (is_cmd)
			return false;
	}
	if (text === null && interactive) {
		this.alert(this.i18n.INVALID_PAGE.sprintf(cr));
	}
	return text;
};

woas.get_javascript_page = function(cr) {
	var text = woas.eval(cr, true);
	if (this.eval_failed) {
		woas.log(this.i18n.JS_PAGE_FAIL1.sprintf(cr) +
			this.i18n.JS_PAGE_FAIL2 + this.eval_fail_msg);
		return null;
	}
	// returned value from eval is a string, ('text'), or array,
	// ['title', 'text']; otherwise null is returned (no dynamic page created,
	// though eval side-effects may have occurred). If type is array then title
	// can be empty string, but 'text' must exist (dynamic page creation).
	// Faulty strings and arrays are logged; everything else is ignored.
	if (text instanceof Array) {
		if (text.length === 2 && (typeof text[0]) === 'string' &&
				(typeof text[1]) === 'string' && text[1] !== '') {
			return text;
		}
	} else if ((typeof text) === 'string') {
		if (text !== '') {
			return text
		}
	} else {
		return null;
	}
	this.log(this.i18n.JS_PAGE_FAIL1.sprintf(cr) + this.i18n.JS_PAGE_FAIL3
		.sprintf(text, text instanceof Array ? 'array' : 'text'));
	return null;
};

woas.eval = function(code, return_value) {
	var rv;
	try {
		eval((return_value ? "rv=" : "") + code);
		woas.eval_failed = false;
	}
	catch (e) {
		this.eval_fail_msg = e.toString();
		this.eval_failed = true;
	}
//	woas.log("woas.eval(\""+code+"\", "+return_value+") = "+rv);	//log:0
	return rv;
};

// Load a new current page
// return true if page was successfully loaded
// PVHL: needs to handle section references;
//   keep_fwd added for Lock/Unlock/Options, etc. to stop history problems
woas.set_current = function (cr, interactive, keep_fwd) {
	// pager.browse_hook determines if cr is allowed to be set
	if (!this.pager.browse_hook(cr))
		return false;
//	this.log("Setting current page to \""+cr+"\"");	//log:0
	var text, namespace, pi, mts,
		// whether to reset bucket or not
		set_b = false;
	// PVHL: let parser/scripts know the page title; by popular request
	//	Only set for main page display; not help or export page parsing
	this.parse_title = cr;
	this.pager.bucket.clear();
	// eventually remove the previous custom script
	if (cr.substring(cr.length-2)==="::") {
		text = this._get_namespace_pages(cr);
		namespace = cr.substring(0,cr.length-2);
		cr = "";
	} else {
		var p = cr.indexOf("::");
		// skip not found references but also null namespace references
		if (p>0) {
			namespace = cr.substring(0,p);
//			this.log("namespace of "+cr+" is "+namespace);	// log:0
			cr = cr.substring(p+2);
				switch (namespace) {
					case "Javascript":
						// this namespace may deprecate many others
						text = this.get_javascript_page(cr);
						if (text === null) {
							this.parse_title = ''; // PVHL: avoid any issues
							return false;
						}
						else if (text instanceof Array) {
							// allows function to return [title, text]
							if (!text[1]) {
								this.parse_title = ''; // PVHL: avoid issues
								return false;
							}
							// title allowed to be empty string: 'Javascript::'
							cr = text[0] || '';
							text = text[1];
						} else {
							// don't use the code as a title
							cr = '';
						}
						break;
					case "Special":
						text = this._get_special(cr, interactive);
						if (!text) {
							this.parse_title = ''; // PVHL: avoid any issues
							// the 'false' special value is returned in case
							// of command execution; otherwise no such special page
							return text === false;
						}
						break;
					case "Tagged":
						text = this.special_tagged(cr);
						if (text === null) {
							this.parse_title = ''; // PVHL: avoid any issues
							return false;
						}
						break;
					case "Lock":
						// prevent special pages from being locked
						if (this.is_reserved(cr)) {
							this.alert(this.i18n.CANNOT_LOCK_RESERVED);
							this.parse_title = ''; // PVHL: avoid any issues
							return false;
						}
						this.currently_locking = this.js_encode(cr);
						pi = this.page_index(cr);
						if (this.AES.isKeySet()) {
							// display a message
							if (confirm(this.i18n.CONFIRM_LOCK.sprintf(cr)+
								(this.last_AES_page ? this.i18n.CONFIRM_LOCK_LAST
									.sprintf(this.last_AES_page) : ''))) {
								this._finalize_lock(pi);
								this.parse_title = ''; // PVHL: avoid possible issues
								return false;
							}
						}
						text = this.get_text("Special::Lock");
						break;
					case "Unlock":
						this.parse_title = ''; // PVHL: avoid possible issues
						pi = this.page_index(cr);
						// PVHL: Just a preventive; could be a bug: only unlock if locked;
						//   maybe the wrong place but OK for now
						if (pi !== -1 && (page_attrs[pi] & 0x2)) {
							if (!confirm(this.i18n.CONFIRM_REMOVE_ENCRYPT.sprintf(cr)))
								return false;
							text = this.get_text(cr);
							if (this.pager.decrypt_failed())
								return false;
							pages[pi] = text;
							page_attrs[pi] ^= 0x2;
							if (!this.config.key_cache)
								this.AES.clearKey();
							if (this.set_current(cr, true, true)) {
								this.save_page(cr);
								return true;
							}
						}
						return false;
					case "WoaS":
						pi = woas.page_index("WoaS::"+cr);
						// page does not exist
						if (pi === -1) {
							if (interactive) {
								// can create new WoaS pages in developer mode if
								// you are currently on a WoaS:: page
								if (this.tweak.edit_override &&
										current.indexOf('WoaS::') === 0) {
									this.log(this.i18n.INVALID_PAGE.
										sprintf("WoaS::"+cr));
									text = null;
									break;
								}
								this.alert(this.i18n.INVALID_PAGE.
									sprintf("WoaS::"+cr));
							}
							this.parse_title = ''; // PVHL: avoid possible issues
							return false;
						}
						var real_t = page_titles[pi];
						// detect if showing a plugin
						var _pfx = "WoaS::Plugins::";
						if (real_t.substr(0, _pfx.length) === _pfx) {
							text = this.plugins.get(real_t.substr(_pfx.length));
							if (text !== null) {
								if (this.plugins.is_external) {
									text = this.plugins.describe_external(text);
								} else
									text = this.parser._raw_preformatted('pre', text,
										'woas_core_page');
							}
						} else {
							text = this.get_text(real_t);
							if (text !== null) {
								// handle all WoaS::CSS the same
								cr = (cr).split('::')[0];
								switch (cr) {
									case "Plugins":
										text = this.parser.parse(text + this.plugins.list());
									break;
									case "Aliases":
									case "Hotkeys":
									case "CSS":
										// page is stored plaintext
										text = this.parser._raw_preformatted('pre', text,
											'woas_core_page');
									break;
									default:
										// help pages and related resources
										text = this.parser.parse(text);
								} // switch per page title
							} // text not null
						} // plugins/non-plugins

						if(text === null) {
							// called for reset purposes
							this.pager.decrypt_failed();
							this.parse_title = ''; // PVHL: avoid possible issues
							return false;
						}
						return this.load_as_current(real_t, text, this.config.store_mts ? page_mts[pi] : 0, true);
					case "File":
					case "Image":
						text = this._get_embedded(namespace+"::"+cr, namespace.toLowerCase());
						if(text === null) {
							// called for reset purposes
							this.pager.decrypt_failed();
							this.parse_title = ''; // PVHL: avoid possible issues
							return false;
						}
						if (namespace.length)
							cr = namespace + "::" + cr;
						if (this.config.store_mts)
							mts = page_mts[this.page_index(namespace+"::"+cr, namespace.toLowerCase())];
						else
							mts = 0;
						return this.load_as_current(cr, text, mts, true);
					default:
						text = this.get_text(namespace+"::"+cr);
						set_b = true;
				}

		} else {
			namespace = "";
			text = this.get_text(cr);
			set_b = true;
		}
	}
	
	// action taken when no such page exists (or decryption failed)
	if (text === null) {
		this.parse_title = ''; // PVHL: avoid possible issues
		if (this.pager.decrypt_failed())
			return false;
		return this._new_page(this.i18n.PAGE_NOT_FOUND, false, namespace.length ? namespace+ "::"+ cr : cr);
	}
	
	// hard-set the current page to the namespace page
	if (namespace.length) {
		cr = namespace + "::" + cr;
		pi = this.page_index(cr);
		if (pi)
			mts = page_mts[pi];
		else mts = null;
	} else {
		pi = this.page_index(cr);
		cr = page_titles[pi];
		mts = page_mts[pi];
	}
	this.ui.refresh_menu(cr); // menu macros need to be parsed first
	return this.load_as_current(cr, this.parser.parse(text, this.js_mode(cr)),
		this.config.store_mts ? mts : 0, set_b, keep_fwd, true);
};

// enable safe mode for non-reserved pages
woas.js_mode = function(cr) {
	return this.config.safe_mode && !this.is_reserved(cr) ? 3 : 1;
};

// no is optional; used by recently modified page
woas.last_modified = function(mts, no) {
	// do not show anything when the timestamp is magic (zero)
	return mts ? (no ? "" : this.i18n.LAST_MODIFIED) +
		(new Date(mts * 1000)).toLocaleString() : "";
};

// actually load a page given the title and the proper XHTML
woas.load_as_current = function(title, xhtml, mts, set_b, keep_fwd, no_menu) {
//woas.log("\n"+xhtml+"\n")
	if (typeof title == "undefined") {
		this.crash("load_as_current() called with undefined title");
		this.parse_title = ''; // PVHL: avoid possible export/help page issues
		this.macro.reset();
		return false;
	}
	if (title.indexOf("Lock::") !== 0) {
		this.currently_locking = '';
	}
	
	// used by some special pages (e.g. backlinks) for page title override
	this.parser.render_title = title;
	// the bucket will contain only the rendered page
	if (set_b)
		this.pager.bucket.one(title);
	this.ui.top();
//	this.log("load_as_current(\""+title+"\", "+set_b+") - "+(typeof xhtml == "string" ? (xhtml.length+" bytes") : (typeof xhtml)));	// log:0
	this.setHTMLDiv(d$("woas_page"), xhtml);
	this.refresh_mts(mts);
	this.history.go(title, keep_fwd);
	current = title;
	if (!no_menu)
		this.ui.refresh_menu();
	// activate menu or page scripts
// PVHL: FIX - menu can be activated twice
	this.scripting.activate(this.is_menu(current) ? "menu" : "page");
	this._set_title(title);
	this.update_view();
//	this.log(this.history.log());	// log:0
	// PVHL: resetting after scripts have run
	this.parse_title = '';
	// page macros are reset after every page refresh
	this.macro.reset();
	this.ui.focus();
	return true;
};

woas._finalize_lock = function(pi, back) {
	this._perform_lock(pi);
	var title = page_titles[pi];
	if (!this.config.key_cache) {
		this.AES.clearKey();
		this.last_AES_page = "";
	} else
		this.last_AES_page = title;
	if (back) { // only if called from Lock:: page
		this.ui.back();
	} else {
		// need to refresh display; no history
		this.set_current(title, true, true);
	}
	// PVHL: moved because current page was saved as 'Lock::xxx'
	this.save_page_i(pi);
};

woas._perform_lock = function(pi) {
	// PVHL: Just a preventive; in case of a bug that could lock twice:
	//   only lock if unlocked
	if (!(page_attrs[pi] & 0x2)) {
		pages[pi] = this.AES.encryptB64(pages[pi]);
		page_attrs[pi] |= 0x2;
	}
};

woas._on_unload = function () {
	// close down Print & Help windows if they exist
	// Doesn't work in recent Opera
	if (this.popup_window && !this.popup_window.closed) {
		this.popup_window.close();
		this.popup_window = null;
	}
	if (this.help_system.popup_window && !this.help_system.popup_window.closed) {
		this.help_system.popup_window.close();
		this.help_system.popup_window = null;
	}
	// PVHL: These saves don't work; will leave code here for now. Testing
	//	 showed delayed save failures so delayed save was removed as an option
	//   (risky); config save was removed as it used to corrupt content; this
	//   (useless?) option actually saves the whole file anyway.
	// PVHL: TODO: need to use beforeUnload for saving changes
	if (this.config.save_on_quit && this.cfg_changed)
	// PVHL: this is just doing a full commit as it was destroying data
		this.cfg_commit();
	return true;
};

// when the page is loaded - onload, on_load
// NOTE: the order of execution is extremely fragile; don't change unwisely!
woas._on_load = function() {
	// initialize the DOM cache as highest priority
	this.dom.init();

	// set up log functions so enable/disable does not require reload
	this._set_debug(this.config.debug_mode, this.config.debug_closed);

	// initialize default macros
	woas.macro.init();
	delete woas.macro.init;

	// set some browser-tied functions
	// will remove when plugin completed
	if (this.browser.ie) {
		this.ieByter && this.ieByter.init();
	}
	if (this.browser.fh_old) {
		this.ui.display({old_fix_h:true});
	}

	// try to use Java if there is no other option
	// PVHL: 'tiddlySaver' will be applet reference (only usable if TiddlySaver
	// was actually loaded; don't check here!), or false. Will change later to
	// use WoasSaver if available, only load when actually needed (a config
	// choice, triggered by edit, export, etc.), and checked that it actually
	// exists through timeouts so user can be forewarned.
	if (!woas._server_mode && !woas.browser.ie && !(woas.browser.firefox &&
			(parseFloat(woas.browser.gecko) < 17 ||
			woas.isWoasFox() || woas.isTiddlyFox())))
		woas.tiddlySaver();
	else
		woas.tiddlySaver = false;

	// check integrity of WoaS features - only in debug mode
	if (this.tweak.integrity_test && !this.integrity_test()) {
		// test failed, stop loading
		return;
	}

	// flag for data source changes; forces full save when entering/exiting
	// WSIF datasource mode or changing the name of the data source file
	// make sure path is correct (seen posts about manually changing this!)
	this._old_wsif_ds = woas.trim(is_windows ?
			this.config.wsif_ds.replace(reFwdSlash, '\\') :
			this.config.wsif_ds.replace(/\\/g, '/'));

	// load the actual pages (if necessary)
	if (this.config.wsif_ds.length) {
		this.log('Loading from external WSIF file(s)');
		if (!this._wsif_ds_load(this._old_wsif_ds)) {
			// the file load error is already documented to user
			if (this.wsif.emsg !== null)
				this.crash("Could not load WSIF pages data!\n"+this.wsif.emsg);
			return;
		}
	}

	// PVHL: if current doesn't exist can't continue; could have been done
	// earlier but this allows future enhancements (load default from wsif)
	// Changed to use first available user page if current not set or present
	if (!current || page_titles.indexOf(current) === -1) {
		// should modify to allow choice from among available pages;
		// this shouldn't be possible though - current should always be set
		var i = 0, il = page_titles.length, t;
		for(; i < il; ++i) {
			t = page_titles[i];
			if (t.indexOf('WoaS::') && t.indexOf('Special::') &&
					t.indexOf('::Menu')) {
				current = t;
				break;
			}
		}
		if (!current) {
			this.crash("No user pages found: can't continue");
			return;
		}
	}

	// change help if help not found
	if (woas.config.no_help || page_titles.indexOf("WoaS::Help::Index") === -1) {
		woas.no_help();
	}
	else {
		woas.no_help = false;
	}

	// continue with UI setup
	// activate the CSS; includes fixups for some browsers
	this.css.init();
	this.ui.img_display(); /* turn off images if data_uri doesn't work */
	d$('woas_home').title = this.config.main_page;
	this.setHTMLDiv(d$('woas_about').firstChild,
		this.i18n.ABOUT.sprintf(woas.version));
	this.ui.set_header(this.config.fixed_header);
	this.ui.set_menu(this.config.fixed_menu);
	// PVHL: enable the resize function and call it. Have renamed resizing to
	// ui._resize; now using woas._resize to create resize function.
	(window.onresize = woas.ui._resize = woas._resize())();
	this._editor = new TextAreaSelectionHelper(this.dom._cache.ed);
	// customized keyboard hook
	document.onkeydown = woas.ui._keyboard_event_hook;

	// initialize extensions - plugins go first so that external javascript/CSS
	// starts loading
	this.setHTML(d$("woas_wait_text"), "Initializing extensions...");
	this.plugins.load();
	this._load_aliases(this.get_text("WoaS::Aliases"));
	this.hotkey.load(this.get_text("WoaS::Hotkeys"));

	// set a hook to be called when loading process is complete
	if (!woas.dom.wait_loading(woas._early_render)) {
		woas.log("Completing load process...");
		woas._load_hangup_check(true);
	}
};

// the first page rendering is a delicate process
// plugins and related libraries/CSS must be loaded
// before rendering the first page to prevent some glitches
// to happen, like: missing CSS, missing macros etc
woas._dummy_fn = function() { return; };
woas._load_hangup_check = function(first) {
	// first time we just re-create the spawning thread
	if (!first) {
		if (!woas.dom._loading) {
			woas.log("_load_hangup_check() finished; loading complete.");
			return
		}
		// ask user if he wishes to continue waiting for libraries to finish loading
		if (!confirm(this.i18n.CONTINUE_WAIT_LOAD)) {
			// run the hook like if nothing hung up
			woas.dom._run_post_load_hook();
			woas.log("_load_hangup_check() cancelled; loading incomplete.");
			return;
		}
	}
	// launch again this thread, every 3s
	woas.log("_load_hangup_check() respawned (still loading: "+woas.dom.get_loading()+")");
	setTimeout("woas._load_hangup_check(false);", 3000);
};
	
// no 'this' for this function
// PVHL: should load document location here for later use as well
woas._early_render = function() {
	// PVHL: handle requested page in location: woas.html?page%20name#sect_name
	//   If page doesn't exist current is loaded instead.
	//   should add ability to give the href of pages and sections to user
	var loc = woas.trim(unescape(document.location.href.split('?')[1] || '')),
		page = loc.split('#')[0] || '',
		hash = document.location.href.split('#')[1],
		cr_bkup = current;
	hash = hash ? '#' + woas.parser.heading_anchor(unescape(hash), true) : ''; // see if IE needs null check
	if (!page || page_titles.indexOf(page) === -1) {
		// no such page;
		page = current;
	} else {
		cr_bkup = page;
	}
	// feed the current title before running the disable edit mode code
	woas.prev_title = cr_bkup;
	woas.disable_edit();
	// goto requested page or default (current; always exists by this point)
	// force go_to to load even if current
	current = '';
	woas.go_to(page + hash);
	current = cr_bkup;
	woas.ui.display({wait: false});
	// launching post-load hook
	woas.post_load();
	// PVHL: awful hack may not be needed once scroll_wrap used
	//if (hash && woas.browser.webkit) {
	//	setTimeout('woas.go_to("'+hash+'")',0);
	//}
};

// disable edit-mode after cancel/save actions and on initial load
woas.disable_edit = function() {
//	woas.log("DISABLING edit mode");	// log:0
	// reset change buffer used to check for page changes
	this.ui.edit_mode = false;
	this.change_buffer = null;
	this.old_title = null;
	if (woas._ghost_page) {
		woas._ghost_page = false;
//		woas.log("Ghost page disabled"); //log:0
	}
	this.ui.top();
	this.log(); // scroll to bottom of log
	this._set_title(this.prev_title);
//	woas.log(woas.history.log()); //log:0
};

function _lock_pages(arr) {
	this.alert(woas.i18n.NOT_YET_IMPLEMENTED);
}

function _unlock_pages(arr) {
	this.alert(woas.i18n.NOT_YET_IMPLEMENTED);
}

woas.edit_allowed = function(page) {
	// only edit pages if they have an actual data representation
	if (this.page_index(page) === -1)
		return false;
	// developer mode
	if (this.tweak.edit_override)
		return true;
	// force read-only
	if (!this.config.permit_edits)
		return false;
	if (this.edit_allowed_reserved(page))
		return true;
	// page in reserved namespace
	if (this.is_reserved(page))
		return false;
	// page has readonly bit set
	return !this.is_readonly(page);
};

woas.edit_allowed_reserved = function(page) {
	if (page.indexOf("WoaS::Plugins::") === 0)
		return true;
	// allow some reserved pages to be directly edited/saved
	switch (page) {
		case "WoaS::Aliases":
		case "WoaS::Hotkeys":
		case "WoaS::CSS::Custom":
			return true;
	}
	return false;
};

// setup the title boxes and gets ready to edit text
woas.current_editing = function(page, disabled, txt) {
//	woas.log("ENABLING edit mode");	// log:0
//	woas.log("current = \""+current+"\", current_editing(\""+page+"\", disabled: "+disabled+")");	// log:0
	_servm_alert();
	this.ui.edit_mode = true;
	this.prev_title = current;
	current = page;
	// PVHL: changed to allow developer change of reserved editable titles
	//	Shouldn't be done, but there could be a legitimate need
	woas.dom._cache.ed_title.disabled = disabled ? "disabled" : "";
	woas.dom._cache.ed_title.value = this.old_title = page;
	// save copy of text to check if anything was changed
	// do not store it in case of ghost pages
	this.dom._cache.ed.value = this.change_buffer = txt;
	this._set_title(this.i18n.EDITING.sprintf(page));
	woas.ui.display({view: false, edit: true, no_help: woas.no_help}, true);
	this.dom._cache.ed.focus();
};

// PVHL: apparently removed - left here for now
woas.edit_ready = function (txt) {
	woas.log("Called woas.edit_ready!");	// log:1
	return;
}

woas.edit_page = function(page) {
	// can't edit again if already editing
	if (this.ui.edit_mode)
		return false;
	if (!this.edit_allowed(page)) {
		woas.log("Not allowed to edit page "+page);	// log:1
		return false;
	}
	var tmp = this.get_text(page);
	if (tmp===null) return false;
	if (this.is_embedded(page) && !this.is_image(page))
		tmp = this.base64.decode(tmp);
		
    // ReSet the Download-Link; by sp! 
	  var a = document.getElementById('downloadID')
	  	a.download = ""; 
	  	a.href = "";
	  	a.style = "color:  blue";
	  	a.dataset.downloadurl = "";
	  	a.draggable = true; 
	  	var output = document.getElementById('outputID'); 
	  	output.appendChild(a);				
		
	// setup the wiki editor textbox
	this.current_editing(page, this.is_reserved(page, true), tmp);
	return true;
};

//API1.0: check if a title is valid
woas.valid_title = function(title) {
	if (title.length == 0) {
		this.alert(this.i18n.EMPTY_TITLE);
		return false;
	}
	if (title.length > 256) {
		this.alert(this.i18n.TOO_LONG_TITLE.sprintf(256));
		return false;
	}
	if (title.match(/(\[|\]|\{|\}|\<|\>|\||\#|\"|:::)/)) {
		this.alert(this.i18n.INVALID_TITLE);
		return false;
	}
	if (title.substr(-2)==="::") {
		this.alert(this.i18n.ERR_PAGE_NS);
		return false;
	}
	var ns = this.get_namespace(title, true);
	if (ns.length && this.is_reserved(ns+"::", true)) {
		this.alert(this.i18n.ERR_RESERVED_NS.sprintf(ns));
		return false;
	}
	return true;
};

woas.rename_page = function(previous, newpage) {
	woas.log("Renaming "+previous+" to "+newpage);	// log:1
	if (this.page_index(newpage) != -1) {
		this.alert(this.i18n.PAGE_EXISTS.sprintf(newpage));
		return false;
	}
	// this is the actual rename operation
	page_titles[this.page_index(previous)] = newpage;
	// change all occurrences of previous title to new title
	var reTitles = new RegExp("\\[\\[(Include::)?" + RegExp.escape(previous) +
		"(?:\\]\\]|\\|)", "g"), P = {}, changed, ilen, i, l;
	for (i = 0, l = pages.length; i < l; ++i) {
		P.text = this.get_page(i);
		if (P.text === null)
			continue;
		this.parser.snippets = [];
		changed = false;
		// dry removes nowiki/macros/comments, but without dynamic newlines
		this.parser.dry(P);
		// replace direct links and transclusion links
		P.text = P.text.replace(reTitles, function (str, inc) {
			changed = true;
			ilen = inc ? 11 : 2;
			return str.substr(0, ilen)+newpage+str.substr(previous.length+ilen);
		});
		if (changed) {
			this.parser.undry(P);
			this.set__text(i, P.text);
		}
	}
	this.parser.snippets = [];

	if (previous === this.config.main_page)
		this.config.main_page = newpage;
	// make sure that previous title is consistent
	if (this.prev_title === previous)
		this.prev_title = newpage;
	this.history.rename(previous, newpage);
	return true;
};

woas.get_raw_content = function() {
	var c = this.dom._cache.ed.value;
 	// remove CR added by some browsers
 	//TODO: check if ie8 still adds these
	// PVHL: ie8 does, ie9 doesn't; changed so it doesn't matter
	// though a fixed Opera will take longer ... insignificant,
	// and I will change in new version (function as found didn't work anyway)
	if (((this.browser.ie && this.browser.ie < 9) || this.browser.opera) && /\r\n/.test(c)) {
		c = c.replace(/\r\n/g, "\n");
	}
 	return c;
};

// action performed when save is clicked
woas.save = function() {
	if (!this.ui.edit_mode) {
		// you can't save if not editing
		return false;
	}
	var raw_content = this.get_raw_content(),
		do_save = this._ghost_page || (raw_content !== this.change_buffer),
		back_to = this.prev_title,
		can_be_empty = false,
		skip = false,
		renaming = false;

	switch(current) {
	case "WoaS::CSS::Custom":
		if (do_save) {
			this.pager.set_body(current, raw_content);
			this.css.init();
		}
		break;
	case "WoaS::Aliases":
		if (do_save)
			this._load_aliases(raw_content);
		can_be_empty = true;
		skip = true;
		// fallthrough wanted
	case "WoaS::Hotkeys":
		if (!skip && do_save)
			this.hotkey.load(raw_content);
		// fallthrough wanted
	default:
		// check if text is empty (page deletion)
		if (do_save && (raw_content === "") && !can_be_empty) {
			if (this._ghost_page) {
				this.ui.cancel();
			} else if (confirm(this.i18n.CONFIRM_DELETE.sprintf(current))) {
				this.plugins.delete_check(current);
				this.delete_page(current);
				this.prev_title = current;
				this.disable_edit();
			}
			return;
		} else {
			var new_title = this.trim(woas.dom._cache.ed_title.value);
			renaming = (this.old_title !== new_title);
			do_save |= renaming;
			if (this._ghost_page) {
				// new page needs history
				this.history.store(this.prev_title);
				this.prev_title = new_title;
			}
			if (do_save) {
				// rename if title is valid
				if (renaming && (
						!this.valid_title(new_title) ||
						!this.rename_page(this.old_title, new_title))) {
					return false;
				}
				// actually set text only if it was changed
				if (do_save)
					this.pager.set_body(new_title, raw_content);
				var menu = this.is_menu(new_title);
				// update the plugin if this was a plugin page
				// NOTE: plugins are not allowed to be renamed, so
				// old title is equal to new title
				if (!menu) {
					back_to = new_title;
					var _pfx = "WoaS::Plugins::";
					if (new_title.substr(0, _pfx.length) === _pfx) {
						// we do not directly call _update_plugin because
						// plugin does not exist before creation so disabling it
						// would fail
						this.plugins.disable(new_title.substr(_pfx.length));
						this.plugins.enable(new_title.substr(_pfx.length));
					}
				}
			}
		}
	}
	if (do_save) {
		this.save_page(current);
	}
	this.disable_edit();
	this.set_current(back_to, true, true); // don't clear fwd history
};

woas.save_page = function(title) {
	return this.save_page_i(this.page_index(title));
};

woas.save_page_i = function(pi) {
	// update the modified time timestamp (only when not in dev-mode)
	if (!this.tweak.edit_override)
		page_mts[pi] = this.config.store_mts ? Math.round(new Date().getTime()/1000) : 0;
	// PVHL: commit isn't using the i parameter, left but took out array
	return this.commit(pi);
};

// optional 'exp' is used by the exporter module
woas.create_breadcrumb = function(title, exp) {
	if (title === "::Menu") {
		return title;
	}
	else if (title.indexOf('Javascript::') === 0) {
		return 'Javascript :: ' + title.substr(12);
	}
	var tmp = title.split("::");
	if (tmp.length === 1) {
		return title;
	}
	var s = "", partial = "", js = "", i, il;
	for (i = 0 , il = tmp.length - 1; i < il; ++i) {
		// editing is active - PVHL: not used any more?
		if (this.ui.edit_mode)
			s += tmp[i] + " :: ";
		else {
			partial += tmp[i] + "::";
			js = exp ? "\" href=\"" + this.exporter._get_fname(partial) :
				"\" onclick=\"woas.go_to('" + this.js_encode(partial) + "')";
			// add link to "::" if it isn't on the end of the title
			s += tmp[i] + (tmp[i + 1] ? " <"+"a class=\"woas_link\" title=\"" +
				this.xhtml_encode(partial) + js + " \">::<" + "/a> " : " ::");
		}
	}
	// add page title
	return s + tmp[tmp.length - 1];
};

/*** src/extensions.js ***/
// @module scripting
// @description manages custom scripts declared in menu and main page
// All custom scripts can be defined in one of the two
/*
PVHL:
  scripting needs to be rethought; JavaScript tags can be removed from the DOM
  without affecting the code that the tag initialized; it survives. Reloading
  page after each save would help with enabling/disabling and changes to scripts.
  Other possibility is to wrap all scripts so deletion of pointer deletes code,
  but this would have multiple side-effects.
*/
woas.scripting = {
	menu: [],	// scripts active in menu
	page: [],	// scripts active in page
	_menu_stacked: 0,	// number of elements which shall be cleared
	_page_stacked: 0,	// ''

	// remove all scripts from specified array (can be 'menu' or 'page')
	clear: function(which) {
		for(var i=0;i < this["_"+which+"_stacked"];++i) {
			woas.dom.remove_script(which, i);
		}
		this["_"+which+"_stacked"] = 0;
	},

	// add a custom script for later activation
	add: function(which, content, external) {
		this[which].push([content, external]);
	},

	activate: function(which) {
		for(var i=0;i < this[which].length;++i) {
			if (woas.dom.add_script(which, i, this[which][i][0], this[which][i][1]))
				++this["_"+which+"_stacked"];
		}
		// free memory
		this[which] = [];
	},

	remove: function(which, index) {
		if (woas.dom.remove_script(which, index)) {
			--this["_"+which+"_stacked"];
			return true;
		}
		return false;
	}

};

// @module 'plugins'

// PVHL: NOTE! All this code is deprecated so far as I am concerned as it
//   assumes a script block can be removed; removal does NOT remove code!
//   New code (new project) will simplify system (by reloading WoaS) and
//   also allow UTF8 text. (I may use an existing open source loader system)
woas.plugins = {

	// flag set by last call to get()
	is_external: false,
	_all: [],
	_active: [],	// list of enabled plugins

	get: function(name) {
		this.is_external = false;
		var text = woas.pager.get("WoaS::Plugins::"+name);
		// check if this is an external page reference
		if (name.charAt(0) === '@') {
			// hack for external files loading at run-time
			// each source file specified in a new line as a definition with flags for different browsers
			var uris = this._parse_external(text);
			if (uris !== null) {
				// we got it
				this.is_external = true;
				text = uris;
			}
		}
		return text;
	},

	_parse_external: function(text) {
		var uris=[], uri_def, p, sb;
		text = text.split("\n");
		for(var i=0;i < text.length;++i) {
			uri_def = woas.trim(text[i]);
			if (!uri_def.length)
				continue;
			// check this URI for validity
			p = uri_def.indexOf("=");
			if (p === -1)
				continue;
			sb = this._craft_object(uri_def.substr(p+1));
			if (sb === null) // no mode was activated by this definition
				continue;
			sb.src = woas.trim(uri_def.substr(0,p));
//			woas.log(sb.src+" " +sb.is_inline+" "+sb.is_async);
			// finally add it to basket
			uris.push(sb);
		}
		if (uris.length == 0)
			woas.log("no valid source URIs found");
		return uris;
	},

	reIncludeDef: new RegExp("([\\+@])(\\*|([a-zA-Z0-9_]+)(\\([0-9\\.]+[-\\+]?\\))?)", "g"),

	// parse definitions for browser include type
	_craft_object: function(s) {
		var sb = {
			is_inline: false,
			is_async: false
		}, inline_init = false, async_init = false;
		s.replace(this.reIncludeDef, function(str, sym, full_browser_str,browser_str, version) {
			// a handy shortcut
			switch (browser_str) {
				case "ff":
					browser_str = "firefox";
				break;
				// not supported
				case "ie6": case "ie8": case "firefox2": case "firefox3": case "firefox_new":
					woas.log("Invalid browser token: "+browser_str);
					return;
			}
			// check the catch-all case
			if (full_browser_str === '*') {
				if (sym === '+') {
					if (!inline_init) {
						inline_init = sb.is_inline = true;
					} else woas.log("Ignored catch-all inline because a restricting criteria was already specified");
				} else { // if (sym === '@')
					if (!async_init) {
						async_init = sb.is_async = true;
					} else woas.log("Ignored catch-all async because a restricting criteria was already specified");
				}
				return;
			}
			// check that this browser token is valid
			var t = typeof woas.browser[browser_str];
			if (t == "undefined") {
				woas.log("Invalid browser token: "+browser_str);
				return;
			}
			// parse the symbol if that browser token is active and version matches
			if (woas.browser[browser_str]) {
				// make a version check only if necessary
				var its_ok = false;
				
				if (version.length !== 0) {
					// check that we have a version string, before all
					if (t !== "string") {
						// PVHL: make sure I haven't messed things up with non-string version #s
						//	or bools; will fix hack later in rest of code
						var bs = Number(browser_string).toString();
						if (bs) {
							woas.log("No version string for browser token \""+browser_str+"\"");
							return;
						}
						else {
							// true will be "1"; probably OK for most purposes today
							browser_str = bs;
						}
					}
					// remove parenthesis
					version = version.substr(1, version.length-2);
					// check the last character
					var lc = version.charAt(version.length-1);
					if (lc === '+') { // match version and above
						its_ok = (woas.strnatcmp(woas.browser[browser_str], version) >= 0);
					} else if (lc === '-') { // match version and below
						its_ok = (woas.strnatcmp(woas.browser[browser_str], version) <= 0);
					} else { // plain version match
						its_ok = (woas.strnatcmp(woas.browser[browser_str], version) == 0);
					}
				} else its_ok = true;
				// version was not OK
				if (!its_ok) return;
				// operate the operator
				if (sym === '+') {
					sb.is_inline = true;
					sb.is_async = false;
					inline_init = true;
				} else {
					sb.is_inline = false;
					sb.is_async = true;
					async_init = true;
				}
			}
			// continue with next token
		});
		// if nothing was specified, fail
		return !inline_init && !async_init ? null : sb;
	},

	// disable one single plugin
	disable: function(name) {
		var i = this._active.indexOf(name);
		if (i !== -1) {
			var _mapped_name = this._mapping(name);
			// attempt removing the script block and fail otherwise
			if (!woas.dom.remove("plugin", _mapped_name))
				return false;
			// external plugin, try to remove the lib blocks created
			if (name.charAt(0) === '@') {
				var p = this.get(name);
				if (this.is_external && (p.length>1)) { // *special* external plugins
					for(i=0;i < p.length;++i) {
						woas.dom.remove_script("lib", _mapped_name+'_'+i);
					}
				}
			}
			this._active.splice(i, 1);
			return true;
		}
		return false;
	},

	update: function(name) {
		return this.disable(name) && this.enable(name);
	},

	_internal_add: function(name, s) {
		if (s.is_async) {
			if (woas.dom.add_script("plugin", this._mapping(name), s.src, true)) {
				this._active.push( name );
				return true;
			}
		} else /*if (s.is_inline) */ { // create an inline javascript (slower)
			var ct = woas.load_file(woas.ROOT_DIRECTORY+woas.fix_path_separators(s.src)),
				t = (typeof ct);
			// write some nice message
			if (t.toLowerCase() != "string") {
				woas.log("could not load inline javascript source "+s.src);
				return false;
			} else {
				// add the inline block
				if (woas.dom.add_script("plugin", this._mapping(name), ct, false)) {
					this._active.push( name );
					return true;
				}
			}
		}
		// failed adding DOM script
		return false;
	},

	// enable a single plugin
	enable: function(name) {
		if (this._active.indexOf(name) !== -1) {
			woas.log("BUG: Plugin "+name+" is already active");
			return true;
		}
		// generate the script element
		var p = this.get(name);
		if (this.is_external) { // *special* external plugins
			// single reference, do not create script block
			if (p.length === 1) {
				return this._internal_add(name, p[0] );
			} else {
				var js="";
				for(var i=0;i < p.length;++i) {
					if (p[i].is_async)
						js += 'woas.dom.add_script("lib", "'+this._mapping(name)+'_'+i+"\", \""+woas.js_encode(p[i].src)+"\", true);\n";
					else /*if (p[i].is_inline) */ {
						var ct = woas.load_file(woas.ROOT_DIRECTORY+woas.fix_path_separators(p[i].src)),
							t = (typeof ct);
						// write some nice message
						if (t.toLowerCase() !== "string")
							js += "/* woas.load_file(\"::/"+p[i].src+"\") returned "+ct+" ("+t+") */\n";
						else {
							// add the loaded code
							js += ct; ct = null;
						}
					} // no other symbols for now
				} //efor
				// finally add the real script block
				if (woas.dom.add_script("plugin", this._mapping(name), js, false)) {
					this._active.push( name );
					return true;
				}
				return false;
			}
		}
		// normal plugins
		if (woas.dom.add_script("plugin", this._mapping(name),
					p, false)) {
			this._active.push( name );
			return true;
		}
		return false;
	},

	// remove DOM object for all active plugins
	clear: function() {
		for(var i=0,it=this._active.length;i < it;++i) {
			// remove the DOM object
			woas.dom.remove_script("plugin", this._mapping(this._active[i]));
		}
		// reset array
		this._active = [];
		this._all = [];
	},

	// map a plugin name to an unique name
	_mapping_cache:[],
	_mapping: function(name) {
		var i = this._mapping_cache.indexOf(name);
		if (i == -1) {
			i = this._mapping_cache.length;
			this._mapping_cache.push(name);
		}
		// return more descriptive names
		if (woas.config.debug_mode)
			return woas._unix_normalize(name).replace("@", '')+"_"+i;
		return i;
	},

	load: function() {
		//TODO: get plugins configuration

		// get list of plugins
		var _pfx = "WoaS::Plugins::", l=_pfx.length, name;
		for(var i=0,it=page_titles.length;i < it;++i) {
			if (page_titles[i].substr(0, l) === _pfx) {
				name = page_titles[i].substr(_pfx.length);
				// generate the script element
				this.enable(name);
				this._all.push(name);
			}
		} //efor
	},

	list: function() {
		var pt = this._all.length;
		if (pt === 0)
			return "\n\n/No plugins installed/";
		var pg=[];
		for(var i=0;i < pt;++i){
			pg.push("* [[WoaS::Plugins::"+this._all[i]+"|"+this._all[i]+"]]"+
					//TODO: some CSS for the plugin actions
					"&nbsp;&nbsp;[[Javascript::woas.plugins.remove('"+this._all[i]+"')|Delete]]"+
					"&nbsp;&nbsp;[[Javascript::woas._edit_plugin('"+this._all[i]+"')|Edit...]]"+
					"\n");
		}
		return "\n\n"+woas._simple_join_list(pg);
	},

	describe_external: function(uris) {
		// show a list of external sources
		var ntext = "<"+"p>This plugin is made up of the following external sources:<"+"/p><"+"ul>";
		for(var i=0;i < uris.length;++i) {
			ntext += "<"+"li>" + "<"+"big>"+(uris[i].is_inline ? "(inline)" : "(external)")+"<"+"/big>&nbsp;";
			ntext += "<"+"a href=\""+uris[i].src+"\" target=\"_blank\">"+uris[i].src+"<"+"/a><"+"/li>\n";
		}
		return ntext+"<"+"/ul>";
	},

	// if given page name is a plugin, disable it
	// used when deleting pages
	delete_check: function(pname) {
		var _pfx = "WoaS::Plugins::";
		if (pname.substr(0, _pfx.length) === _pfx)
			this.disable(pname.substr(_pfx.length));
	},

	// PVHL: function is only called using 'Javascript::' so no point in returning an error value
	remove: function(name) {
		var page_name = "WoaS::Plugins::"+name, i;
		if (!confirm(woas.i18n.CONFIRM_DELETE.sprintf(page_name)))
			return;
		// first we attempt to disable it, ignoring failure (because it could just not be active)
		this.disable(name);
		woas.delete_page(page_name);
		// remove from array
		i = this._all.indexOf(name);
		this._all.splice(i,1);
		if (current === "WoaS::Plugins") {
			//HACK: reload plugins
			woas.parse_title = current;
			woas.setHTMLDiv(d$("woas_page"), woas.parser.parse(woas.get_text("WoaS::Plugins") + this.list()));
			woas.parse_title = '';
		}
	}

};

// @module hotkey
woas.hotkey = {

	all: {
		"save":		"s",
		"edit":		"e",
		"print":	"p",
		"help":		"h",
		"goto":		"g",
		"cancel":	0x1b,
		"back":		0x8
	},
	cached_default: null,
	custom_accesskeys: [],

	_update_accesskeys: function(new_custom_accesskeys) {
		var ak, a, b, at, bt, found;
		// we store the length of old access keys before looping because
		// other entries might be added during the cycles
		bt=this.custom_accesskeys.length;
		for(a=0,at=new_custom_accesskeys.length;a < at;++a) {
			found = false;
			for (b=0;b < bt;++b) {
				// access key already exists
				if (this.custom_accesskeys[b].key === new_custom_accesskeys[a].key) {
					found = true;
					break;
				}
			}
			// proceed to addition
			if (!found) {
				ak = document.createElement("a");
				this._hook_fn(ak, new_custom_accesskeys[a].fn);
				ak.accessKey = new_custom_accesskeys[a].key;
				// store the new access key
				this.custom_accesskeys.push({"fn":new_custom_accesskeys[a].fn,"key":new_custom_accesskeys[a].key,
											 "obj":ak});
				d$("woas_custom_accesskeys").appendChild(ak);
			}
		}
		// (3) clear the div content if no custom access key is there (just for safety)
		if (this.custom_accesskeys.length === 0)
			this.setHTML(d$("woas_custom_accesskeys"), "&nbsp;");
	},

	_hook_fn: function(obj, fn) {
		//woas.log("setting onclick for "+fn);
		if (woas.browser.gecko || woas.browser.webkit)
			obj.setAttribute("onclick", fn+"()");
		else //HACK
			obj.onclick = eval(fn);
	},

	// return the default hotkeys/key bindings
	_cache_default: function() {
		if (this.cached_default === null) {
			this.cached_default="";
			var k;
			for(var hkey in this.all) {
				k = this.all[hkey];
				switch(typeof k) {
					case "string":
					break;
					default: // Number
						k = "0x"+k.toString(16);
				}
				this.cached_default += "$"+hkey.toUpperCase()+"\t"+k+"\n";
			}
		}
		return this.cached_default;
	},

	validate: function(k) {
		// validate hexadecimal hotkey
		if (k.substr(0, 2) == "0x") {
			k = parseInt(k.substr(2), 16);
			if (!k)
				return null;
			return k;
		}
		// validate single ASCII character
		if (k.length>1)
			return null;
		return k;
	},

	load: function(s) {
		var new_custom_accesskeys=[];
		// identify valid alias lines and get the key binding/hotkey
		s.replace(this.reHotkeys, function(str, hkey, lambda, binding) {
			// check that binding is a valid key
			binding = woas.hotkey.validate(binding);
			if (binding === null) {
				woas.log("Skipping invalid key binding for hotkey "+hkey);	//log:1
				return;
			}
			// associate a custom key binding
			if (hkey === "CUSTOM") {
				// store the custom definition for later update
				lambda = lambda.substr(1, lambda.length-2);
				new_custom_accesskeys.push({"fn":lambda, "key":binding});
			} else {
				// convert hotkey to lowercase
				hkey = hkey.toLowerCase();
				// check that hotkey exists
				if (typeof woas.hotkey.all[hkey] == "undefined") {
					woas.log("Skipping unknown hotkey "+hkey);	//log:1
					return;
				}
				// associate hotkey and key binding
				woas.hotkey.all[hkey] = binding;
			}
		});
		// once finished loading hotkey definitions, associate them
		d$("woas_save").accessKey = this.all.save;
		d$("woas_edit").accessKey = this.all.edit;
		d$("woas_print").accessKey = this.all.print;
		d$("woas_help").accessKey = this.all.help;
		// set access key for goto feature
		new_custom_accesskeys.push({fn:"woas.cmd_go_to", key: this.all["goto"]});

		// (1) delete access keys which no more exist
		var found, a, at, b, bt;
		for(a=0,at=this.custom_accesskeys.length;a < at;++a) {
			found = false;
			for (b=0,bt=new_custom_accesskeys.length;b < bt;++b) {
				if (this.custom_accesskeys[a].key === new_custom_accesskeys[b].key) {
					found = true;
					// access key element was found, update the associated function (if necessary)
					if (this.custom_accesskeys[a].fn !== new_custom_accesskeys[b].fn) {
						this._hook_fn(this.custom_accesskeys[a].obj, new_custom_accesskeys[b].fn);
					}
					break;
				}
			}
			// proceed to removal
			if (!found) {
				d$("woas_custom_accesskeys").removeChild(this.custom_accesskeys[a].obj);
				delete this.custom_accesskeys[a].obj;
				this.custom_accesskeys.splice(a,1);
				--at;
			}
		}
		// (2) add new access keys
		this._update_accesskeys(new_custom_accesskeys);
	},

	reHotkeys: /^\$([A-Za-z0-9_]{2,})(\([A-Za-z0-9_\.]+\))?\s+([\S]+)\s*$/gm
};

// call once during code setup to store the current default hotkeys
woas.hotkey._cache_default();

woas._edit_plugin = function(name) {
	if (this.go_to("WoaS::Plugins::"+name))
		woas.edit_page(current);
};

var reAliases = /^(\$[A-Za-z0-9_]{2,})\s+(.*?)$/gm;
// match all aliases defined in a page
woas._load_aliases = function(s) {
	this.aliases = [];
	if (s==null || !s.length) return;
	s.replace(reAliases, function(str, alias, value) {
		// save the array with the alias regex and alias value
		var cpok = [ new RegExp(RegExp.escape(alias), "g"), value];
		woas.aliases.push(cpok);
	});
};

woas.aliases = [];

woas.title_unalias = function(aliased_title) {
	// apply aliases on title, from newest to oldest
	for(var i=0,l=this.aliases.length;i < l;++i) {
		aliased_title = aliased_title.replace(this.aliases[i][0], this.aliases[i][1]);
	}
	return aliased_title;
};

/*
PVHL: registered macros can now be overridden by page/menu definitions.
	Transcluded pages can overwrite and/or use existing page macros;
	menu macro redefinition attempts quietly fail so highest namespace menu
	controls menu macro definitions (controlled by parse_macros).

Syntax now follows rules similar to nowiki block. Changes include:
* syntax has been restricted to allow for optional colon use (colon has
  proven to be a major source of markup error); macro name must be
  immediately followed by optional parameter brackets, like a function call.
* If the line after the macro name contains only whitespace it is removed.
* One space after macro call is removed (or after the deprecated colon) if
  the macro text is on the same line as the macro name, to help with
  readability. An optional space is also allowed after '%' in declarations).
*/
woas.macro = {
	// macro definition regex
	// 1: %, 2: name, 3: params, 4: newline before text, 5: text without last newline
	// PVHL: I have deprecated (by making optional) the ':' after the name
	//	declaration. I don't think this will affect anyone other than FBNil, and
	//	the new eval macro <<=...>> should ease those issues
	reMacroDef: /^(%)? ?([^:(\s]+)(?:\((.*?)\))?:? ?(?:[ \t]*(\n))?([\s\S]*?)(?:\n[ \t]*)?$/,

	_macros: {}, // global macro objects
	_m_macros: {}, // global macros defined by menu; erased every menu refresh
	_p_macros: {}, // temporary page macros; erased after page parsed

	// macro syntax plugin code adapted from FBNil's implementation
	// PVHL: refactored; should not have any knowledge of woas.parser;
	//   it's job is to manipulate the text passed to it and set flags.
	// See woas.parser.parse_macros for macro object details
	parser: function(macro, redefine){
		var M = macro.text.match(this.reMacroDef), fn, fp, rv, s;
//woas.log("MACRO\n\tall: '"+M[0]+"'\n\tdefn: '"+M[1]+"'\n\tname: '"+M[2]+"'\n\tparams: '"+M[3]+"'\n\tpre-text dnl: "+!!M[4]+"\n\ttext: '"+M[5]+"'")
		do { // error|return breakout loop
		if (M !== null) {
			macro.name = fn = M[2]; // macro name
			fp = M[3] || ''; // optional macro parameters
			// check validity of macro name
			// new RE may require better testing, but most chars are legal keys
			// in JS -- and why shouldn't non-English be allowed?
			if (fn.indexOf("..") !== -1 || fn.charAt(0) === '.' ||
					fn.charAt(fn.length-1) === '.') {
				macro.err = woas.i18n.ERR_MACRO_NAME;
				break;
			}
			if (M[1]) {
				// this is a macro definition request; all such definitions are
				// temporary; tied to either the page or menu object
				var params, obj, i, il;
				// only valid JavaScript variable name characters for parameters
				// Removed 'toLowerCase' as an obvious source of errors as
				// parameters will no longer match the passed in code
				if (fp) {
					params = fp.split(',');
					for (i = 0, il = params.length; i < il; ++i) {
						if (!/^\w+$/.test(woas.trim(params[i]))) {
							// bad parameter found
							macro.err = woas.i18n.ERR_MACRO_PARM.
								sprintf(params[i]);
							M = null;
						}
					}
					if (M === null)
						break; // out of error do loop; report error and return
				}
				else {
					params = [];
				}
				obj = woas.eval("[function (macro"+(params.length ? ','+
					params.join(",") : '')+") {\n"+M[5]+"\n}]", true);
				if (woas.eval_failed) {
					macro.err = woas.i18n.ERR_MACRO_JS + woas.eval_fail_msg;
				}
				else {
					// store macro if allowed to
					var m = macro.menu ? this._m_macros : this._p_macros,
						mfn = m[fn] !== undefined; // macro exists
					if (!mfn || mfn && redefine) {
						m[fn] = obj;
						macro.defn = true;
					}
					else {
						woas.log("NOTE: could not redefine '" + fn + "' as a " +
							(macro.menu ? "menu" : "page") + ' macro');
					}
//woas.log((macro.defn ? "Defined '" : "Could not redefine '")+fn+"' as a "+(macro.menu ? "menu" : "page")+' macro');
				}
				break; // out of error do loop; done with definitions
			}

			// a normal macro call; try to get pointer to macro function;
			// don't bother checking page macros if parsing menu
			mf = !macro.menu && this._p_macros[fn] || this._m_macros[fn] ||
				this._macros[fn];
			if (mf) {
				// default scope is window (for now)
				s = mf[1] || window;
				// default: text on new line flags block
				macro.block = !!M[4];
				macro.text = M[5];
				try {
					if (fp) {
						// parameters
						rv = mf[0].apply(s, [macro].concat(eval('['+fp+']')));
					}
					else {
						// no parameters
						rv = mf[0].call(s, macro);
					}
//woas.log("Called macro '"+fn+"'");
				}
				catch(e) {
					macro.err = woas.i18n.ERR_MACRO_EX + e;
				}
				// allow old macro error return; ignoring no return value
				if (rv === false && !macro.err) {
					macro.err = woas.i18n.ERR_MACRO_RV;
				}
			}
			else { // couldn't find macro definition
				macro.err = woas.i18n.ERR_MACRO_DEFN;
			}
		}
		else { // couldn't find valid macro within macro markers
			macro.err = woas.i18n.ERR_MACRO_TEST;
		}
		} while (false); // end of error do loop
		M = null;
		if (macro.err) {
			woas.log( "Macro error '" + macro.name + "': " + macro.err);
		}
	},

	// register a  macro parsing/macro.text-creating function
	// each macro function must accept a macro object as first parameter and
	// modify such object (it is always passed by reference)
	// PVHL: modified to accept '.' and refactored
	//   fn_scope is optional and allows the called function to have a 'this'
	//   defined at registration time. May default to woas[.custom] later.
	register: function(fn_name, fn_object, fn_scope) {
		if (this._macros[fn_name]) {
			woas.log("Can't register existing macro "+fn_name); //log:1
			return false;
		}
		// could also push scope only if defined; parser decides default scope
		this._macros[fn_name] = [fn_object, fn_scope || null];
		return true;
	},

	// some default macros
	default_macros: {
		// PVHL: a simple eval macro; optional 'quiet' silences output
		'=': function(m, quiet) {
			quiet = !!quiet;
			try {
				if (quiet) {
					eval(m.text);
					m.text = "";
					m.block = true;
				}
				else {
					m.text = String(eval(m.text));
					if (m.text) {
						m.reprocess = 2;
					}
				}
			}
			catch (e) {
				m.err = e;
			}
		},
		// advanced transclusion: each newline creates a parameter
		_include: function(m) {
			var params = m.text.split("\n"), pZero = params && params[0] || '',
				nt, paramno, trans;
			// completely remove markup; allows transcluded page to control spacing
			m.block = true;
			if (!pZero || !woas.page_exists(pZero)) {
				m.err = woas.i18n.ERR_MACRO_INCL_NP;
				return;
			}
			// embedded transclusion not supported
			if (woas.is_embedded(pZero)) {
				m.err = woas.i18n.ERR_MACRO_INCL_NV;
				return;
			}
			// PVHL: allow control for page listings, even if we are deeply transcluded
			trans = woas.parser._transcluding;
			woas.parser._transcluding = 0;
			nt = woas.get_text_special(pZero);
			woas.parser._transcluding = trans;
			if (nt === null) { // probably not possible
				m.err = woas.i18n.ERR_MACRO_INCL_NC;
				return;
			}
			// remove TOC link
			nt = nt.replace(woas.parser.reTOC, "");
			if (params.length > 1) { // replace transclusion parameters
				nt = nt.replace(/%\d+/g, function(str) {
					paramno = parseInt(str.substr(1));
					return paramno > 0 && paramno < params.length ?
						params[paramno] : str;
				});
			}
			m.text = nt;
			m.reprocess = true;
		},
		// PVHL: this is mostly to make the Help note more flexible, but...
		//	why not pass in the type and make it text box - or add such; so:
		//	_box(note): blah.... <<_box(alert) hi>>
		//	<<_box blah ...>> would give the default box -- note probably.
		//	All this need do is change the class through a switch; all done in CSS.
		//	Or don't use a switch and rely on user -- any can be added then.
		_note: function(m) {
			// the extra div helps IE6
			var txt1 = "<"+"div><"+"div class='woas_note'>"+woas.i18n.NOTE_TEXT+
				m.dnl, txt2 = m.dnl+"<\/"+"div><"+"/div>";
			m.text = txt1 + m.text + txt2;
			m.block = true;
			m.reprocess = 2;
		},
		// highlight macro. Can give span or div a background color
		// (default yellow in WoaS::CSS::Core) and an optional text color;
		// set automatically by text on a new line if span/div not specified.
		// E.g.: <<_hl my text>> highlights 'my text' in yellow;
		// <<_hl(true,'blue','#fff') my text>> creates a div with blue
		// background and white text containing 'my text'; <<_hl('','red')I>>
		// gives a red 'I' with span color determined by '.woas_hl_span'.
		// <<_hl( [block,] [background-color | '' if using 'color'], [color] )
		_hl: function(m) {
			var a = arguments, m = a[0], blk = typeof a[1] === 'boolean',
				i = 1, bg, style;
			if (blk) { // manual setting
				m.block = a[1];
				i++;
			}
			bg = woas.trim(a[i++]);
			style = (typeof bg === 'string' && bg.length ?
				'background-color:'+bg+';' : '')+(typeof a[i] === 'string'
				&& a[i].length ? 'color:'+a[i] : '');
			style = style ? ' style="'+style+'"' : '';
			m.reprocess = true;
			m.text = m.block ?
				'<div class="woas_hl_div"'+style+'>'+m.dnl+m.text+'<\/div>' :
				'<span class="woas_hl_span"'+style+'">'+m.text+'<\/span>';
		}
	},

	// reset temporary macros; code requires that menu is parsed before page so
	// that page can use menu macros, and assumes that menu is not always
	// parsed (currently it is)
	// PVHL: this is a quick hack to allow better macros; it will be called too
	//	often but will fix in new version; wanted basic functionality here.
	reset: function(menu) {
		this._p_macros = {};
		if (menu) {
			this._m_macros = {};
		}
//		woas.log((menu ? 'All' : 'Page')+' macros reset');
	},

	// keep inner design details internal;
	// called by _on_load; deleted after initialization
	init: function() {
		var d = this.default_macros, x;
		// register default macros
		for (x in d) {
			if (d.hasOwnProperty(x)) {
				this.register(x, d[x], null);
			}
		}
		// register alternate names (currently undocumented)
		this.register("_+", d._include, null);
		// register deprecated macro names
		this.register("woas.include", d._include, null);
		this.register("woas.note", d._note, null);
	}

}; // end of woas.macro module

// PVHL: initialization moved to _on_load

/*** src/datalayer.js ***/
/*
 *  API for the data layer abstraction
*/

// PVHL: removed all locking code in preparation for updating code. Didn't work
//	ALso removed all plist code as it didn't work yet either; new method coming

/*
PVHL: returns 0 if save failed, number of pages otherwise; path must exist;
 blob save disabled until it works cross-browser.
*/
woas._wsif_ds_save = function(subpath) {
	// always save in the root directory or a path below it
/**
PVHL: the option page has always stated that a relative path must be entered
for the WSIF data source -- as the argument 'subpath' suggests -- so we can't
just save to rootdirectory. The original code saved the index file to the
subpath, and multiple-WSIF files to the root!
*/
	var fname, pos;
	// wsif_ds is stored in UNIX format, but just in case
	subpath = subpath.replace(/\\/g, '/');
	pos = subpath.lastIndexOf('/') + 1;
	if (pos) {
		fname = subpath.substring(pos);
		subpath = woas.ROOT_DIRECTORY + subpath.substring(0, pos);
	}  else {
		fname = subpath;
		subpath  = woas.ROOT_DIRECTORY;
	}
	if (is_windows) {
		// convert unix path to windows path
		subpath = subpath.replace(reFwdSlash, '\\');
	}
	return this._native_wsif_save(subpath, fname, !this.wsif.ds_multi,
							this.config.wsif_author, true, woas.config.no_help);
};

//API1.0: save all pages
woas.full_commit = function() {
	var r = true;
	if (this.config.wsif_ds) {
		r = this._wsif_ds_save(this.config.wsif_ds);
		// PVHL: don't save html if wsif save failed
		if (!r)
			this.alert(this.i18n.WSIF_ERR_SAVE);
	}
	return r ? this._save_to_file(true) : false;
};

//API1.0: save WoaS configuration
// PVHL: There is a very bad bug here: when options page is saved all edits are lost.
//   Also, if cumulative save is set the woas is completely corrupted. Though saved
//   changes exist in file, they don't exist in DOM and so are lost in config only save.
//   I'm not interested in finding & fixing as WoaS should be saving layout from a page
//   (probable fix is to reload file and then apply cumulative save changes before saving,
//   but the whole save process needs to be upgraded (and this issue will disappear).
//   Quick fix is to disable config-only save and save everything every time -- BUT:
//   if using external wsif file this actually WILL only save the config to html file.
//   Was: return this._save_to_file(false);
woas.cfg_commit = function() {
	// only saves to the html file; options not currently in a page
	return this._save_to_file(true);
};

//API1.0: save specific list of pages
// PVHL: currently just saving all the pages; will use FileList in future.
// (plist was disabled; API needs a rethink)
woas.commit = function() {
	return this.full_commit();
};

//API1.0: delete specific list of pages
// plist is a list of page indexes which need to be saved (not allowed to be empty)
/*
PVHL: I removed plist. This is a bizarre routine: it used to call the exact same
  functions as commit, with the exact same plist! Recipe for disaster.
  Will need to be rewritten eventually, but for now the page is already gone
  internally, so saving does the job.
*/
woas.commit_delete = function() {
	// update only the native WSIF index (leaves back deleted pages)
	// PVHL: don't understand the above comment; this is called from
	//	a function that assumes data is internal; it sent a page index!
	return this.full_commit();
};

//API1.0: event called after some page is being saved
// plist can be undefined if all pages were saved
// PVHL: actually it is only called when a FULL save requested
//	save_queue was corrupting data and removed
woas.after_pages_saved = function() {};

//API1.0: event called when the config was successfully saved
// PVHL: actually called whenever HTML file is saved
woas.after_config_saved = function() {
	woas.cfg_changed = false;
};

/*** src/i18n.js ***/
// internationalization language resources
// PVHL: TODO: (MODE_NOT_AVAIL): msg has no meaning to user; new version needs to be explicit
woas.i18n = {
	ABOUT: "About Wiki on a Stick %s",
	ALT_BROWSER_INPUT: "Please specify the full path to the '%s' file.",
	ALT_BROWSER_MSG: "This browser is not allowing the directory path to be read directly.\n\n",
	ASK_MENU_LINK: "Do you want the menu to have a link to this page?",
	B64_REQ: " (requires %s due to base64 encoding)",
	CANCEL_EDITING: "Changes to this page will not be saved.",
	CANNOT_LOCK_RESERVED: "You cannot lock a page in a reserved namespace.",
	CHOOSE_CANCEL: "\n\nIf you don't want this to happen choose 'Cancel'.",
	CONFIRM_DELETE: "Are you sure you want to DELETE the '%s' page?",
	CONFIRM_DELETE_ALL1: "You are about to ERASE all your pages.\n\nDo you want to continue?",
	CONFIRM_DELETE_ALL2: "This is the last confirmation needed before ERASING all your pages.\n\nALL YOUR PAGES WILL BE LOST\n\nAre you sure you want to continue?",
	CONFIRM_DELETE_IMAGE: "Are you sure you want to delete the '%s' image?",
	CONFIRM_EXPORT: "Export '%s' to the path specified below?",
	CONFIRM_LOCK: "Do you want to use the last password entered to lock the '%s' page? ",
	CONFIRM_LOCK_LAST: "The password was last used on the '%s' page.",
	CONFIRM_OVERWRITE: "Page '%s' already exists. Overwrite it?",
	CONFIRM_READ_ONLY: "You will have to manually edit the file to revert this change.\n\nAny other changes to options will also be saved.",
	CONFIRM_REMOVE_ENCRYPT: "Do you want to remove encryption from the '%s' page?",
	CONTINUE_WAIT_LOAD: "The loading process seems stuck.\nPlease click OK to keep waiting or Cancel to break.",
	DELETE: "Delete page:",
	DELETE_FILE: "Delete embedded file",
	DELETE_IMAGE: "Delete embedded image",
	DELETE_PAGE_PROMPT: "Delete page:",
	DISPLAY_FULL_FILE: "Display full file",
	DUP_NS_ERROR: "Cannot duplicate into File:: or Image:: namespace!",
	DUPLICATE_PAGE: "Insert duplicate page title",
	EDITING: "Editing '%s'",
	EMPTY_NS: "/No pages in '%s' namespace./",
	EMPTY_TITLE: "An empty title is not allowed.",
	ERR_MACRO: "Macro Error '%s': ",
	ERR_MACRO_DEFN: "definition not found",
	ERR_MACRO_EX: "exception during code execution -\n",
	ERR_MACRO_JS: "JavaScript error - ",
	ERR_MACRO_NAME: "invalid name",
	ERR_MACRO_PARM: "invalid parameter name '%s'",
	ERR_MACRO_RV: "returned deprecated error value (false)",
	ERR_MACRO_TEST: "failed validity test",
	ERR_MACRO_INCL_NC: "couldn't find any content",
	ERR_MACRO_INCL_NP: "page not found",
	ERR_MACRO_INCL_NV: "embedded (image/file) pages not currently supported",
	ERR_MARKER: "'%s' marker not found!",
	ERR_NO_DECRYPT: "Could not decrypt \"%s\"",
	ERR_NO_DECRYPT_ALERT: "Page decryption (password) failures: %s",
	ERR_NO_IMAGES_ALERT: "Image export failures: %s",
	ERR_PAGE_NS: "You cannot create a page as a namespace.",
	ERR_PWD_ENTER: "\nPlease click the key icon and enter a password.",
	ERR_PWD_UNSET: "No password set for decrypting the \"%s\" page.",
	ERR_PWD_WRONG: "The correct password for the \"%s\" page is not set.",
	ERR_RESERVED_NS: "Namespace '%s' is reserved.",
	ERR_SEL_FILE: "A file must be selected.",
	ERR_VAR_MARKER: "Marker variable not found!",
	EXPORT_FILE: "Export embedded file",
	EXPORT_FILE_NO_BIN: "\n/This browser can't save binary files yet./",
	EXPORT_FILE_TXT1: " /Exporting as text should work for textual content./",
	EXPORT_FILE_TXT2: "Export embedded file as text",
	EXPORT_IMAGE: "Export image",
	EXPORT_OK: "%d/%d pages exported successfully.",
	FAILED_ERASE: "Saving the erased WoaS has failed!\n\nOriginal content will be restored by reloading file.",
	FILE_DISPLAY_LIMIT: "/Only the first 1024 bytes are displayed./\n\n",
	FILE_ENTRY_ERR: "A file must be entered!",
	FILE_ENTRY_SAME_PATH1: "Cannot use the same path as the WSIF data source!",
	FILE_ENTRY_SAME_PATH2: "Using the same path as the WSIF data source would corrupt this WoaS!",
	FILE_ENTRY_SAME_PATH3: "\n\nPlease enter a different path for WSIF file.",
	FILE_SAVE: "Save file to:\n\n%s?",
	FILE_SELECT_ERR: "A file must be selected!",
	FILE_SIZE: "File size",
	GO_TO_PAGE: "Go to page:",
	HEIGHT: "Height",
	HELP_BACK: "Back",
	HELP_CLOSE: "Close",
	HELP_INDEX: "Index",
	IMG_LOAD_ERR: "/Image failed to load./\n",
	// haven't combined next two in case it doesn't work in some language
	IMG_NO_DISPLAY: "/This browser can't display images yet./",
	IMG_NO_EXPORT: "/This browser can't export images yet./",
	IMPORT_CONFIG: "Configuration imported.",
	IMPORT_INCOMPAT: "Incompatible version: %s",
	IMPORT_OK: "%s pages imported successfully (%d pages skipped)",
	IMPORT_OLD_VER: "If this is a WoaS older than v0.9.6B, you should use use WoaS 0.11.x to import it.",
	IMPORT_UNRECON: "Unrecognized format.",
	INSERT_NEW: "Insert new page title",
	INVALID_ALIAS: "Invalid '%s' alias will be ignored.",
	INVALID_DATA: "Invalid collected data!",
	INVALID_PAGE: "Reserved page '%s' not found.",
	INVALID_TITLE: "Title cannot contain ':::' or any of these characters:\n# \" | < > [ ] { }",
	JS_DISABLED: "Scripts are disabled in Special::Options ('Enable safe mode')\n",
	JS_PAGE_FAIL1: "Dynamic evaluation of '%s' failed!",
	JS_PAGE_FAIL2: "\n\nError message:\n\n",
	JS_PAGE_FAIL3: "\n\nInvalid return value or type:\n\nValue: '%s'\nType: '%s'",
	LAST_MODIFIED: "Date modified: ",
	LOAD_ERR: "Cannot load specified file.",
	LOADING: "Loading Wiki on a Stick...",
	LOCK_PAGE: "Lock %s",
	MACRO_OFF: "Macro disabled; remove the '!' before macro name to enable.",
	MIME_TYPE: "Mime type",
	MODE_NOT_AVAIL: "File mode 0x%s is not available on this browser.",
	NO_ERROR: "No error",
	NO_HELP: "Can't find Help pages!",
	NO_HELP_EDIT: "No Help available - try again when not editing.",
	NO_HELP_WARN: "This will completely and permanently remove the built-in Help pages from this Woas and reload the file.",
	NO_TIDDLY_SAVER: "The TiddlySaver Java applet is not loaded.\n\nPlease check that TiddlySaver.jar is in the same directory as this WoaS file.\n\nYou'll probably also have to enable Java permissions for it (see Help).",
	NOT_A_NS: "/'%s' is a reserved namespace that is not listable. See [[WoaS::Help::Namespaces#Reserved namespaces|Help]]./",
	NOT_YET_IMPLEMENTED: "Feature not implemented yet.",
	NOTE_TEXT: "*Note*\n",
	PAGE_EXISTS: "A page with title '%s' already exists!",
	PAGE_NOT_EXISTS: "'%s' page does not exist.",
	PAGE_NOT_FOUND: "Page not found. Do you want to create it?",
	PRINT_MODE_WARN: "Sorry, you cannot browse the wiki while in print mode.",
	PWD_ERROR: "Passwords must match each other.",
	PWD_KEY_SIZE: "Key size: %s bits",
	PWD_QUERY: "Please enter a password.",
	READ_ONLY: "This WoaS is read-only.",
	SAVE_ERROR: "Unable to save the '%s' file.",
	SERVER_MODE: "This WoaS is not a local file; changes can only be saved to a local copy of the wiki. Please save this file if you want to make changes.\n\nNone of the changes made to this copy of WoaS will be saved.",
	STATIC_NOT_FOUND: "Static page '%s' not found!",
	T1: "XHTML transclusion:",
	T2: "Raw transclusion:",
	T3: "Simple transclusion:",
	T4: "Transclusion with additional attributes:",
	TOC: "Table of Contents",
	TOO_LONG_TITLE: "Maximum title length is %d characters.",
	UNSPECIFIED_JAVA_ERROR: "Please check the debug log or Java console for errors regarding the last operation\n\nTiddlySaver is available but not working. See Help",
	UNSUPPORTED_BROWSER: "Your browser might not be supported. Please report a bug with your UserAgent string:\n%s",
	WIDTH: "Width",
	WRITE_PROTECTED: "This WoaS is already write-protected.",
	WSIF_DS_TO_EXTERNAL: "The content of this wiki is about to be saved in WSIF format to the filename you entered.\n\nAll internal content will be deleted.\n\n",
	WSIF_DS_TO_INTERNAL: "The current wiki content is about to be stored internally.\n\nThe current WSIF data source file(s) will not be affected.",
	WSIF_DS_TO_MULTI: "The WSIF data source file is about to be rewritten as a page index WSIF file.",
	WSIF_DS_TO_SINGLE: "The current WSIF index file, listing individual page WSIF files, is about to be overwritten with page content.\n\nExisting WSIF files for pages will not be affected.",
	WSIF_ERR_NEW_VER: "WSIF file was created by a newer WoaS than this one.\n\nPlease upgrade before loading.",
	WSIF_ERR_NO_HDR: "No %s header found for '%s'.",
	WSIF_ERR_NO_VER: "Could not read WSIF version.",
	// maybe some languages couldn't recycle next string using the one above and %s?
	WSIF_ERR_NO_VER_GEN: "Could not read WSIF generator version.",
	WSIF_ERR_NS_VER: "Old WSIF version %s is not supported.",
	WSIF_ERR_NOT_WOAS: "\n\nCan't use this file as the main WoaS data source.",
	WSIF_ERR_SAVE: "Unable to save WSIF file with path given!\nCheck your data source setting in Special::Options.",
	WSIF_EXIST: "If the filename you entered already exists it is about to be overwritten!",
	WSIF_IMPORT1: "%s pages imported successfully",
	WSIF_IMPORT2: " (%s pages skipped, %s not found)",
	WSIF_NOT_WOAS: "WSIF generator is not 'woas'.",
	WSIF_NOT_WOAS_PAGES: "\n\nWill only import user pages.",
	WSIF_PAGES: "\n\nIf individual page files already exist for this data source file they will be overwritten."
};

// do not use any copyrighted wordlist here
woas.i18n.common_words = ['the', 'of', 'to', 'and', 'a', 'in', 'is', 'it', 'you', 'that', 'he', 'was', 'for', 'on', 'are', 'with', 'as', 'I', 'his', 'they', 'be', 'at', 'one', 'have', 'this', 'from', 'or', 'had', 'by', 'an', 'all'];

/*
Used to load alternative language plug-ins (e.g.: plugins/translations).
Can also be used by plugins to add strings to i18n object, or change wording.
	obj = {
		strings:{} - strings to replace/augment built-in strings
		strings_add: bool (optional) - change existing string collection
			F: string is ignored if not found in i18n (default)
			T: string will be added to i18n collection if it doesn't exist
		common_words:[] - exclusion list used by Special::Export to build webpage metadata
		common_words_replace: bool (optional) - change existing word list
			F: common_words added to existing words if not already present (default)
			T: i18n.common_words list will be overwritten by common_words array
	}
*/
woas.i18n.load = function(obj) {
	var str, keys = {};
	if (obj.strings) {
		for (str in obj.strings) {
			if ((obj.strings_add || this.hasOwnProperty(str)) &&
					obj.strings.hasOwnProperty(str) &&
					(typeof obj.strings[str]) === 'string') {
				this[str] = obj.strings[str];
				keys[str] = true;
			}
		}
		// report strings missing from translation
		if (woas.config.debug_mode) {
			for (str in this) {
				if (!keys[str] && (typeof this[str]) === 'string') {
					woas.log('Missing - '+this.list_item(str));
				}
			}
		}
	}
	if (obj.common_words && (obj.common_words instanceof Array)
			&& obj.common_words.length) {
		if (obj.common_words_replace) {
			this.common_words = [];
		}
		this.common_words = this.common_words.concat(obj.common_words)
			.toUnique();
	}
};

// PVHL: mostly here to help with translations
woas.i18n.list = function() {
	var str, list = [];
	for (str in this) {
		if ((typeof this[str]) === 'string') {
			list.push(woas._utf8_js_fix(this.list_item(str)));
		}
	}
	return list.join(',\n');
};

woas.i18n.list_item = function(key){
	return key+': "'+this[key].replace(/\n\\?/g, '\\n')
		.replace(/\t/g, '\\t').replace(/"/g, '\\"')+'"';
};

/*** src/import.js ***/
// @module importer

/* NOTES ABOUT PREVIOUS VERSIONS
	0.13.0:
		* new WSIF version with 'wsif' and 'page' namespaces; 'woas' removed
		  and 'convention' values added; 'index' and 'page' types added;
		  first boundary removed with ability to read old files retained;
		  some parameters dropped or names changed (see Help::WSIF)
		* changes to macro operation, and syntax changed to Creole's '<<'
		* encrypted pages stored internally in Base64, with a check guard
	0.12.0:
		* introduced some config options: new_tables_syntax, store_mts, folding_style
		* introduced plugins (which deprecate WoaS::Bootscript)
		* dropping support for all WoaS before 0.9.6B
	0.11.7:
		* 'nav_history' config option replaces 'open_last_page'
	0.11.2:
		* introduced parsing mechanism which does not mess with var declarations inside JavaScript strings
		* introduced WoaS::Hotkeys, WoaS::CSS::Core, WoaS::CSS::Custom
		* introduced woas.config.safe_mode option
		* introduced woas.config.wsif_ds* options
	0.10.7:
		* introduced WoaS::Plugins and changed WoaS::Bootscript page type from embedded to normal
	0.10.0:
		* introduced page_mts for global page modified timestamp
	0.9.7:
		* introduced WoaS::Aliases
*/

woas.importer = {
//public:
	pages_imported: 0,
	total: 0,

//private:
	// property names used to retrieve default values from stored bitmask
	_settings_props: ["i_comment_js", "i_comment_macros", "i_no_woas",
	// the last 3 options are ignored for WSIF import
					"i_config", "i_styles", "i_content"],
	// default options
	//  1 i_comment_js: false		- disable 'script' tags
	//  2 i_comment_macros: false	- disable macro blocks '<<...>>'
	//  4 i_no_woas: false			- do not import pages from WoaS:: or Special:: namespaces
	//  8 i_config: false			- import configuration (XHTML only)
	// 16 i_styles: false			- import stylesheet (XHTML only)
	// 32 i_content: true			- import content pages (XHTML only)
	// 64, 128 - the overwrite option covers bits 6,7
	//    i_overwrite: 3			- overwrite mode (0 - erase, 1 - ignore, 2 - overwrite, 3 - ask)
	_OVR_ID: 6,
	// used internally
	new_main_page: null,
	current_mts: null,
	pages: [],			// imported page objects array
	_reference: [],		// linear array containing page id or null, used privately by _get_import_vars()

	// runtime dynamic update variables
	_plugins_update: [],
	_plugins_add: [],
	_update_css: false,
	_update_hotkeys: false,
	_update_aliases: false,
	_bootscript_code: "",

	_fix_mts_val: function(mts, old_version) {
		// we did not have a timestamp before 0.10.0
		if (old_version < 100)
			return this.current_mts;
		// will catch the 'undefined' ones also
		if (!mts)
			return 0;
		// fixup the mts value in some old buggy version
		if ((old_version===100) || (old_version===101)) {
			// ignore the old null value
			if (mts === 0x4b61cbad)
				mts = 0;
		}
		return mts;
	},

	_filter_by_title: function(title) {
		// PVHL: TODO: is_reserved now modified to allow use; refactor
		// we are not using is_reserved() because will be inconsistant in case
		// of enabled edit_override
		// PVHL: modified to allow just CSS import, no other pages
		if (!woas.importer.i_content && woas.importer.i_styles) {
			return title === "WoaS::CSS::Custom";
		}
		// check pages in WoaS:: namespace
		if (title.indexOf("WoaS::") === 0) {
			// allow CSS same as WoaS < 11.2 (and makes most sense)
			if (title === "WoaS::CSS::Custom")
				// custom CSS is allowed only when importing CSS
				return woas.importer.i_styles;
			// can we import from WoaS namespace?
			if (woas.importer.i_no_woas ||
					// never overwrite help pages with old ones
					title.indexOf("WoaS::Help") === 0 ||
					// skip other core WoaS:: pages
					woas.static_pages2.indexOf(title) !== -1) {
				return false;
			}
			// the rest are Plugins, Aliases, or Hotkeys
			return true;
		} else if (title.substr(0, 9) === "Special::" ||
				// WoaS History not imported, but is erased
				title === "WoaS History") {
			// always skip special pages and consider them system pages
			return false;
		}
		// if not on bad list, it's OK
		return true;
	},

	// function used to collect variables
	_get_import_vars: function(data, ignore_array, old_version) {
		var jstrings=[], fail = false;
		// (1) take away all javascript strings (most notably: content and titles)
		// WARNING: quoting hacks lie here!
		data = data.replace(/\\'/g, ":-"+woas.parser.marker).replace(this.reJString, function (str) {
			// restore quotes
			jstrings.push(str.substr(1, str.length-2).replace(woas.importer.reRequote, "\\'"));
			return woas.parser.marker+(jstrings.length-1).toString()+":";
		});
		// (2) rename the variables
		data.replace(/([^\\])\nvar\s+(\w+)\s*=\s*([^;]+);/g, function (str, $1, var_name, definition) {
			if (fail) return;
			// it must not be in array
			if (ignore_array.indexOf(var_name) !== -1)
				return;
			if (
					// main_page was not in config object for 0.10.8 and below
					(old_version <= 108) && (var_name === "main_page") ) {
				woas.importer.new_main_page = woas.eval(definition.replace(woas.importer.reJStringRep,
								function (str, id) { return "'"+jstrings[id]+"'";}
							), true);
				return;
			}
			// the rest of variables are for content, so exit if we don't want content
			// PVHL: modified to allow just import CSS; could make it more efficient later
			if (!(woas.importer.i_content || woas.importer.i_styles))
				return;
			// save evaluation if we don't want last modified timestamp
			if (!woas.config.store_mts && (var_name === "page_mts"))
				return;

			// evaluate the real array
			var the_var = woas.eval(definition.replace(woas.importer.reJStringRep,
								function (str, id) { return "'"+jstrings[id]+"'";}
							), true);

			// OK, we want this variable, evaluate it
			switch (var_name) {
				case "page_titles":
					// titles come before other properties, so we create all objects now
					for(var i=0,it=the_var.length;i < it;++i) {
						// call the title filtering hook
						if (woas.importer._filter_by_title(the_var[i])) {
							woas.importer.pages.push({
								title: the_var[i],
								attrs: 0,
								mts: (old_version > 97
									? 0
									: (woas.config.store_mts ? woas.importer.current_mts : 0)),
								text: null
							});
							// add object by-ref
							woas.importer._reference.push( woas.importer.pages[woas.importer.pages.length-1] );
						} else // no page reference
							woas.importer._reference.push( null );
					}
				break;
				case "page_attrs":
					// consistency check
					if (the_var.length !== woas.importer._reference.length) {
						woas.log("ERROR: page attributes array is not consistent ("+the_var.length+" != "+woas.importer._reference.length+")");
						fail = true;
						break;
					}
					for(var i=0,it=the_var.length;i < it;++i) {
						// skip filtered pages
						if (woas.importer._reference[i] === null)
							continue;
						woas.importer._reference[i].attrs = the_var[i];
					}
				break;
				case "page_mts": // available only on 0.10.0 and above
					// consistency check
					if (the_var.length !== woas.importer._reference.length) {
						woas.log("WARNING: page timestamps array is not consistent ("+the_var.length+" != "+woas.importer._reference.length+")");
						break;
					}
					for(var i=0,it=the_var.length;i < it;++i) {
						// skip filtered pages
						if (woas.importer._reference[i] === null)
							continue;
						woas.importer._reference[i].mts = woas.importer._fix_mts_val(the_var[i], old_version);
					}
				break;
				case "pages":
					// consistency check
					if (the_var.length !== woas.importer._reference.length) {
						woas.log("ERROR: page bodies array is not consistent ("+the_var.length+" != "+woas.importer._reference.length+")");
						fail = true;
						break;
					}
					for(var i=0,it=the_var.length;i < it;++i) {
						// skip filtered pages
						if (woas.importer._reference[i] === null)
							continue;
						woas.importer._reference[i].text = the_var[i];
					}
				break;
				// silently ignore these
				case "backstack": case "current": break;
				default:
					woas.log("Ignoring unexpected variable "+var_name);
			} // switch

		});
		// finished importing variables, clear references array
		this._reference = [];
		// clear partial results on failure
		if (fail)
			this.pages = [];
		woas.log("get_import_vars() scanned "+this.pages.length+" page definitions");
	},

	// apply options i.e. javascript security settings
	_hotfix_on_import: function(P) {
		// only plain wiki and locked pages can be hotfixed
		if (P.attrs < 2 && (this.i_comment_js || this.i_comment_macros))
			woas.parser.import_disable(P, this.i_comment_js, this.i_comment_macros);
	},

	// add directly without checking for duplicates
	//NOTE: will not set 'pi' property
	_inject_import_hook: function(page) {
		page_titles.push(page.title);
		pages.push(page.text);
		page_attrs.push( page.attrs );
		// during import timestamp is already fixed when originally reading the variable
		page_mts.push(page.mts);
		// set self reference
		page.i = pages.length-1;
		return true;
	},

	// PVHL: I don't have time to rewrite import hooks, so a quick hack for now
	//	Decision to import made here at a very late stage; will be made earlier
	//	in Filer (when the title is discovered). For now have added 'p.ok' to
	//	page as a flag to import. Set when importing WSIF non-natively
	_core_import_hook: function(page) {
//		woas.log("Importing page "+page.title);	//log:0
		var that = woas.importer, pi = woas.page_index(page.title);
		if (pi === -1) { // new page title
			that._inject_import_hook(page);
			page.pi = -1;
		} else { // page already existing, overwriting unless not allowed
			if (!page.ok && (that.i_overwrite === 1 ||
					(that.i_overwrite === 3
					&& !confirm(woas.i18n.CONFIRM_OVERWRITE.sprintf(page.title))))) {
				return false;
			}
			that._hotfix_on_import(page);
			page_titles[pi] = page.title;
			pages[pi] = page.text;
			page_attrs[pi] = page.attrs;
			page_mts[pi] = page.mts;
			page.i = page.pi = pi;
		}
		return true;
	},

	// normal import hook - shared for XHTML and WSIF import
	_import_hook: function(page) {
		var that = woas.importer, _pfx;
		if (that._core_import_hook(page)) {
			// take note of plugin pages and other special runtime stuff
			_pfx = "WoaS::Plugins::";
			if (page.title.substr(0, _pfx.length) === _pfx) {
				// does plugin already exist?
				if (page.pi !== -1)
					that._plugins_update.push(page.title.substr(_pfx.length));
				else
					that._plugins_add.push(page.title.substr(_pfx.length));
			} else if (page.title === "WoaS::Aliases")
				// check if we need to update aliases and hotkeys
				that._update_aliases = true;
			else if (page.title === "WoaS::Hotkeys")
				that._update_hotkeys = true;
			else if (page.title === "WoaS::CSS::Custom")
				that._update_css = true;
			return true;
		}
		return false;
	},

	_clear: function() {
//		this.pages = [];
		this._update_css = false;
		this._update_aliases = false;
		this._update_hotkeys = false;
		this._plugins_add = [];
		this._plugins_update = [];
	},

	// PVHL: this will have file passed in with '_old_version' gone
	//	Have removed saving from this function; it seems like a side-effect to
	//	modify content as well as saving it. This can now be called if content
	//	is from an old version (currently less than 120 by this code)
	_old_version: null,
	_upgrade_content: function (P) {
		var that = woas.importer;
		// fix array encoded encrypted pages
		if (P.attrs & 2 && typeof P.text !== 'string') {
			P.text = woas.base64.encode_array(P.text);
		}
		// fix the old bootscript page
		if (that._old_version < 120) {
			if (P.title === "WoaS::Bootscript") {
				// convert old base64 bootscript to plain text
				if (that._old_version < 107)
					that._bootscript_code = woas.base64.decode(P.text);
				else
					that._bootscript_code = P.text;
				that.pages_imported++;
				return false;
			}
		} // since 0.12.0 we no more have a bootscript page

		// check that imported image is valid
// PVHL: TODO should add import options to allow/deny/unlock encrypted pages
// There is a downside to this quick fix: an encrypted image that has issues from
// earlier versions won't be fixed. Only way to fix is to either decrypt now or to
// add the fix code to the normal image opening code with an offer to fix the issue.
// Will do one or both of these later. (For now just need to be able to import my
// encrypted password image =)
		if (P.attrs & 8 && !(P.attrs & 2)) {
			// if the image is not valid as-is, attempt to fix it
			if (!that.reValidImage.test(P.text)) {
				// do not continue with newer versions or if not base64-encoded
				if ((that._old_version>=117) || !woas.base64.reValid.test(P.text)) {
					woas.log("Skipping invalid image "+P.title);
					return false;
				}
				// we assume that image is double-encoded
				P.text = woas.base64.decode(P.text);
				// check again for validity
				if (!that.reValidImage.test(P.text)) {
					woas.log("WARNING: skipping invalid image "+P.title); //log:1
					return false;
				}
				woas.log("Fixed double-encoded image "+P.title); //log:1
			}
			// try to fix the 'undefined' mime type bug
			if (that._old_version < 120) {
				if (that.reImageBadMime.test(P.text))
					// attempt to find the correct mime
					P.text = "data:"+woas._guess_mime(P.title)+P.text.substr(14);
			}
		} // check images

		// fix the trailing nul bytes bug in encrypted pages
		// extended from 0.10.4 to 0.12.0 because was not fixed on new pages
		if ((that._old_version>=102) && (that._old_version<120)
			&& (P.attrs & 2)) {
			var rest = P.text.length % 16;
			if (rest) {
				woas.log("removing "+rest+" trailing bytes from page "+P.title); //log:1
				while (rest-- > 0) {P.text.pop();}
			}
		}

		return true;
	},

	_import_content: function(old_version) {
		var p;
		this._old_version = old_version;
		for (var i=0; i < this.pages.length; i++) {
			p = this.pages[i];
			if (p && this._upgrade_content(p) && this._import_hook(p))
				++this.pages_imported;
		}
	},

	// actual import of html file
	do_import: function(ct) {
		// a quick and dirty hack to fix import issues with some woas-fix files
		if (!ct)
			return false;
		var i, il, c = false;
		if (ct.charCodeAt(0) > 253) {
			for (i = 2, il = 10; i < il; ++i) {
				if (ct.charCodeAt(i) === 0) {
					c = true;
					break;
				}
			}
			if (c) {
				c = '';
				for (i = 2, il = ct.length; i < il; ++i) {
					if (ct.charCodeAt(i) !== 0)
						c += ct[i];
				}
				ct = c;
			}
			else {
				ct = ct.substring(2);
			}
		}
		// initialize
		this.pages_imported = 0;
		this.total = 0;

		var fail = false;

		do { // a fake do...while to ease failure return

		// get WoaS version
		var old_version,
			ver_str = ct.match(/var woas = \{"version":\s+"([^"]+)"\s*\};(\r\n|\n)/);
		if (!ver_str || !ver_str.length) {
			woas.alert("Could not determine WoaS version\n"+woas.i18n.IMPORT_OLD_VER);
			fail = true;
			break;
		}
		ver_str = ver_str[1];
		if (ver_str.indexOf(' ') !== -1)
			ver_str = ver_str.substr(0, ver_str.indexOf(' '));
		switch (ver_str) {
			case "0.9.6B":
			case "0.9.7B": // never released officially
				ver_str = ver_str.substr(0, ver_str.length-2);
			case "0.10.0": case "0.10.1":
			case "0.10.2": case "0.10.3":
			case "0.10.4": case "0.10.5":
			case "0.10.6": case "0.10.7":
			case "0.10.8": case "0.10.9":
			case "0.11.0": case "0.11.1":
			case "0.11.2": case "0.11.3":
			case "0.11.4": case "0.11.5":
			case "0.11.6": case "0.11.7":
			case "0.11.8": case "0.11.9":
			case "0.12.0": case "0.13.0":
			old_version = Number(ver_str.substr(2).replace(/\./g, ""));
				break;
			default:
				woas.alert(woas.i18n.IMPORT_INCOMPAT.sprintf(ver_str)+woas.i18n.IMPORT_OLD_VER);
				fail = true;
		}
		if (fail)
			break;
		else
			woas.log("Imported file version string: '"+ver_str+"', importing as: "+old_version);	// log:1

		// import the variables
		var	imported_css = null,
			// used during import from older versions
			old_cfg;
		if (this.i_config)
			old_cfg = woas.clone(woas.config);

		this.new_main_page = woas.config.main_page;

		// locate the random marker
		var old_marker = ct.match(/\nvar __marker = "([A-Za-z\-\d]+)";(\r\n|\n)/);
		if (!old_marker) {
			woas.alert(woas.i18n.ERR_MARKER);
			fail = true;
		}
		if (fail) break;
		old_marker = old_marker[1];

		// import the CSS head tag in versions before 0.11.2
		if (this.i_styles && (old_version < 112)) {
			ct.replace(this.reOldStyleBlock, function (str, $1) {
				imported_css = $1;
			});
		} // 0.11.2+, we'll manage CSS import at the page level

		var data = woas._extract_src_data(old_marker, ct, true, this.new_main_page, true);
		// some GC help: we no more need the big content variable
		ct = null;

		if (this.i_config) {
			var cfgStartMarker = 'woas["'+'config"] = {',
				// grab the woas config definition
				cfg_start = data.indexOf(cfgStartMarker),
				cfg_found = false;

			if (cfg_start !== -1) {
				var cfg_end = data.indexOf('}', cfg_start+cfgStartMarker.length);
				if (cfg_end !== -1) {
					woas.config = woas.eval(data.substring(cfg_start+cfgStartMarker.length-1, cfg_end+1), true);
					cfg_found = !woas.eval_failed;
				}
			}

			if (!cfg_found) {
				woas.log("Failed to import old configuration object");
			} else {
				// add the new debug option
				if (old_version<=107)
					woas.config.debug_mode = old_cfg.debug_mode;
				// add the new safe mode
				if (old_version < 112) {
					woas.config.safe_mode = old_cfg.safe_mode;
					//NOTE: WSIF datasource options are not imported at all
				}
				// renamed one config option
				if (old_version < 117) {
					woas.config.nav_history = woas.config.open_last_page;
					delete woas.config.open_last_page;
				}
				// introduced new options
				if (old_version < 120) {
					woas.config.new_tables_syntax = old_cfg.new_tables_syntax;
					woas.config.store_mts = old_cfg.store_mts;
					woas.config.folding_style = old_cfg.folding_style;
				}
				// check for any undefined config property - for safety
				for(var p in woas.config) {
					// remove things from the past
					if (typeof old_cfg[p] === "undefined") {
						// PVHL: my version doesn't have a separate version#
						if (p = "import_settings") {
							woas.config.import_wsif = woas.config.import_woas = woas.config[p];
							delete woas.config[p];
						} else {
							woas.log("BUG: removing invalid config option '"+p+"'");
							delete woas.config[p];
							continue; // PVHL: this breaks out of do loop! Why?
						}
					}
					// PVHL: I guess this would be for a broken option in old file
					if ((typeof woas.config[p] == "undefined") && (typeof old_cfg[p] != "undefined"))
						woas.config[p] = old_cfg[p];
				}

				// put back the old values for WSIF datasource
				woas.config.wsif_author = old_cfg.wsif_author;
				woas.config.wsif_ds = old_cfg.wsif_ds;
				// below are not being used - Check that save doesn't write out nulls
				woas.config.wsif_ds_multi = null; //old_cfg.wsif_ds_multi;
			} // done importing config object
		} // i_config

		// modified timestamp for pages before 0.10.0
		this.current_mts = Math.round(new Date().getTime()/1000);

		// import the pages data
		this._get_import_vars(data, ['woas', '__marker', 'version', '__config'],
							old_version);
		// some GC help
		data = null;

		// apply upgrade fixes
		if (this.i_content || this.i_styles) {
			// add pages data to the woas page arrays: page_titles, pages, etc.
			this._import_content(old_version);
			this.total = this.pages.length;
			// GC cleanup
			this.pages = [];
		}

		// eventually add the new missing page
		if (old_version <= 112) {
			// take care of custom CSS (if any)
			if (imported_css !== null) {
				// import it as a page
				this._import_hook( {
					title: "WoaS::CSS::Custom",
					attrs: 0,
					mts: woas.config.store_mts ? this.current_mts : 0,
					text: imported_css
				} );
			}
		}
		// set the new config variable
		if (this.i_config) {
			if (old_version<=108)
				woas.config.main_page = old_cfg.main_page;
			// apply the new main page if that page exists
			if ((this.new_main_page !== old_cfg.main_page) &&
					// will not allow a cmd page or a help page even in override
					woas.page_exists(this.new_main_page, false))
				woas.config.main_page = this.new_main_page;
		}

		} while (false); // fake do..while ends here

		// fix configuration for older versions
		if (old_version < 114) {
			if (!woas.config.nav_history) {
				// reset some variables which were not reset in those older versions
				backstack = [];
				current = woas.config.main_page;
			}
		}

		// if there is bootscript code, create a new plugin for it
		// skip empty bootscripts and also default bootscript
		var trimmed_bs = woas.trim(this._bootscript_code);
		if ((trimmed_bs.length !== 0) && (trimmed_bs !== '/* insert here your boot script */')
			&& (trimmed_bs !== '// Put here your boot javascript')) {
			var chosen_name = "WoaS::Plugins::Bootscript", base_name = chosen_name, i=0;
			while (page_titles.indexOf(chosen_name) !== -1) {
				chosen_name = base_name + "_" + (i++).toString();
			}
			woas.log("Old bootscript code will be imported as "+chosen_name);
			// now create such plugin by directly importing it
			this._import_hook( {
				title: chosen_name,
				text: "/* This JavaScript code was automatically imported by WoaS from your former WoaS::Bootscript */\n"+this._bootscript_code,
				attrs: 0,
				mts: woas.config.store_mts ? this.current_mts : 0
			} );
		}

		// always update run-time stuff, even on failure
		this._after_import();

		// clear everything else
		this._clear();

		// return false on failure
		return !fail;
	},

	_after_import: function() {
		var that = woas.importer, i, il;
		// refresh in case of CSS, aliases and/or hotkeys modified
		if (that._update_css)
			woas.css.init();
		if (that._update_aliases)
			woas._load_aliases(woas.get_text("WoaS::Aliases"));
		if (that._update_hotkeys)
			woas.hotkey.load(woas.get_text("WoaS::Hotkeys"));

		// add/update plugins
		for (i = 0, il = that._plugins_update.length; i < il; ++i) {
			woas.plugins.update(that._plugins_update[i]);
		}
		for (i = 0,il = that._plugins_add.length; i < il; ++i) {
			// plugin should be on the list
			woas.plugins._all.push(that._plugins_add[i]);
			woas.plugins.enable(that._plugins_add[i]);
		}
	},

	// regular expressions used to not mess with title/content strings
	reRequote: new RegExp(":-"+woas.parser.marker, "g"),
	reJString: new RegExp("'[^']*'", "g"),
	reJStringRep: new RegExp(woas.parser.marker+"(\\d+):", "g"),
	reValidImage: /^data:\s*[^;]*;\s*base64,\s*/,
	reImageBadMime: /^data:undefined;\s*base64,\s*/,
	reOldStyleBlock: new RegExp("<"+"style\\s.*?type=\"?text\\/css\"?[^>]*>((\\n|.)*?)<"+"\\/style>", "i")

};

// called from Special::Import - import WoaS from XHTML file
// PVHL: this, like other areas of file handling, needs to be rewritten to be
//	atomic; certain failures can leave things in an unknown state.
// file is a File-like object
woas.import_wiki = function(file) {
	var cfg = this.importer.i_config, pgs = woas.importer.i_content,
		sty = this.importer.i_styles, ct, rv, v;
	if (!(typeof file === 'object' && file.name) ||
			!(cfg || pgs || sty) || !woas._import_pre_up(false)) {
		woas.log("import_wiki: call failed");
		return;
	}
	// create callback
	// OVHL: TODO: refactor to use file.list.html (or file.list.wiki) object
	file.list.that = this;
	file.list.callback = this.import_wiki_cb;
	// file will be loaded as ASCII to overcome browsers' limitations
	file.mode = this.file_mode.ASCII_TEXT;
	this.load_file(file);
};

// now returning from file_load callback
woas.import_wiki_cb = function(file) {
	if (!file.r) {
		if (file.r === false) {
			this.alert(this.i18n.LOAD_ERR);
		}
		return;
	}

	var cfg = this.importer.i_config, pgs = this.importer.i_content,
		sty = this.importer.i_styles, v,
		// do_import is where the real importing work is done
		rv = this.importer.do_import(file.str);

	if (rv) {
		if (cfg) {
			v = {};
			// make sure any configuration change is represented
			v.fix_h = this.config.fixed_header;
			v.fix_m = this.config.fixed_menu;
			v.no_debug = !this.config.debug_mode;
			v.no_mts = !this.config.store_mts;
			this.ui.display(v);
		}
		// inform about config & imported pages
		this.alert((cfg ? this.i18n.IMPORT_CONFIG : '') +
			(pgs || sty ? (cfg ? '\n\n' : '') + this.i18n.IMPORT_OK.sprintf(
			this.importer.pages_imported+"/"+this.importer.total,
			this.importer.total - this.importer.pages_imported) : ''));
	}
	// save if successful import or if we have erased the wiki
	if (rv || this.importer.i_overwrite === 0) {
		this.full_commit(); // PVHL: this could have failed!
		this.ui._import_load();
		this.ui.refresh_menu();
	}
	// PVHL: not going to main page any more as it could be disorienting;
	return;
};

woas._file_ext = function(fn) {
	var m=fn.match(/\.(\w+)$/);
	if (m === null) return "";
	return "."+m[1];
};

woas._import_pre_up = function(wsif) {
	var tmp, old_is;
	// check if this WoaS is read-only
	if (!this.config.permit_edits) {
		this.alert(woas.i18n.READ_ONLY);
		return false;
	}
	tmp = wsif ? woas.config.import_wsif : woas.config.import_woas, old_is = tmp;
	// now store these values
	tmp = this.bitfield.get_object(this.importer, this.importer._settings_props);
	// set also bits for overwrite options
	tmp = this.bitfield.set(tmp, this.importer._OVR_ID, this.importer.i_overwrite & 1, tmp);
	tmp = this.bitfield.set(tmp, this.importer._OVR_ID+1, this.importer.i_overwrite & 2, tmp);
	if (wsif) woas.config.import_wsif = tmp;
	else woas.config.import_woas = tmp;
	// check if configuration changed
	this.cfg_changed |= (tmp !== old_is);
	// check if user wants total erase before going on
	if (this.importer.i_overwrite === 0) {
		if (!this.erase_wiki())
			return false;
	}
	return true;
};

// called from Special::ImportWSIF
// PVHL: *transitional*, but now contains file information to pass to file_load
//	needs rewrite to not delete default content, so worst error is that we're
//	left with a working, erased, woas file. This calls for 'shadow' pages that
//	aren't overwritten except atomically.
// PVHL: TODO: add 'wait' and lockout file control and back/forward buttons
woas.import_wiki_wsif = function(file) {
	var done, fl, flw;
	if (!file || !woas._import_pre_up(true))
		return;
	// set up file object for wsif loading
	file.mode = this.file_mode.ASCII_TEXT;
	fl = file.list;
	fl.import_hook = this.importer._import_hook;
	fl.title_filter_hook = this.importer._filter_by_title;
	fl.finalization_hook = this.importer._after_import;
	fl.import_wsif_cb = this.import_wiki_wsif_cb;
	fl.import_wsif_that = this;
	this._native_wsif_load(file);
};

woas.import_wiki_wsif_cb = function(file) {
	var fl = file.list, skipped = 0, done = 0, unfound = 0;
	if (!fl.found && file.wsif_err) {
		this.crash(file.wsif_err);
	}
	else if (fl.loaded !== false) {
		// add some info about total pages
		if (fl.found) {
			unfound = fl.found - fl.loaded - fl.skipped;
			done = fl.loaded + "/" + fl.found;
		}
		this.alert(woas.i18n.WSIF_IMPORT1.sprintf(done) + (fl.loaded === fl.found
			? '' : woas.i18n.WSIF_IMPORT2.sprintf(fl.skipped, unfound)));
		this.ui.refresh_menu();
		// now proceed to actual saving
// PVHL: TODO: commit ignores plist; need "changed" list for wsif datasource saving
		this.commit(woas.wsif.imported);
	}
	else if (this.importer.i_overwrite === 0) {
		// always save if we have erased the wiki
		this.full_commit(); // PVHL: this could have failed!
	}
};

/*** src/export.js ***/
// WoaS 'exporter' module
// PVHL: primary purpose of exporter is to create web pages, so image/file pages
//	are presented as they would be in Woas, except without the extra information,
//	unless settings set to create external links for images (img_links).
//	If img_links set will also attempt binary save; in browsers where this fails
//	images can be manually copied using context menu, and/or the original files
//	copied to the destination folder.

woas.exporter = {
	_default_ext: 'html',
	_reExportSpecial: /(?:About|Advanced|All Pages|Dead Pages|License|Orphaned Pages|Recent Changes)$/,
	_reExportWoas: /^WoaS::Help/,

	// must be called (and preset) before do_export
	clear: function() {
		this._export_fnames = {};
		this._title2fn = {};
		this._further_pages = [];
		this._settings = {custom_scripts: ""};
	},
	
	// export wiki in XHTML/CSS and attachment files; clear has been called
	// and export settings have been set
	// PVHL: TODO: simpler if linked pages were exported as encountered and
	//	certain 'real' pages only exported if linked (like menus) -- could do
	//	this easily using the misnamed '_get_fname' (as always, better to use
	//	an attribute instead of hash for this purpose; e.g.: export_none,
	//	export_option). If 'this.export_type(title)' used then actual method
	//	used is easily changed, and info like image/file/no_export/optional
	//	can be returned by the function.
	do_export: function () {
		var data, js_fn, pi, l, exps = this._settings;
		if (exps.js_mode === 2) {
			// export all active plugins as javascript code
			for (pi = 0, l = woas.plugins._active.length; pi < l; ++pi) {
				// data is an array of sources
				data = woas.plugins.get(woas.plugins._active[pi]);
				if (woas.plugins.is_external) {
					for (var i = 0; i < data.length; ++i) {
						exps.custom_scripts +=
							'<'+'script type="text/javascript" src="' +
							data[i] + '"><'+'/script>\n';
					}
				} else {
					js_fn = woas._unix_normalize(woas.plugins._active[pi])+".js";
					if (woas.save_file(exps.xhtml_path + js_fn,
										woas.file_mode.ASCII_TEXT, data)) {
						exps.custom_scripts +=
							'<'+'script type="text/javascript" src="' + js_fn +
							'"><'+'/script>\n';
					}
				}
			}
		}

		var pg, fname = "", done = 0, img_fails = 0, locked = 0, total = 0;
		for (pi = 0, l = page_titles.length; pi < l; pi++) {
			// PVHL: now allowing menu pages in case there's a link to them
			woas.parse_title = pg = page_titles[pi];
			fname = this._get_fname(pg, true);
			// skip unexportable special pages; not counted as exportable
			if (fname === '#') {
				//woas.log("skipped " + pg);
				continue;
			}
			++total;
			data = woas.get_text_special(pg, true);
			// skip pages which could not be decrypted -- now counts as a failure
			if (data === null) {
				this._set_bad_title(pg);
				++locked;
				continue;
			}
			if (woas.is__embedded(pi)) {
				// only images exported as binary files (if possible)
				if (woas.is__image(pi)) {
					// Images now always exported in a wiki page
					// A single fail stops further binary save attempts
					if (exps.img_links) {
						var img_fname = this._get_img_fname(pg);
						if (img_fails) {
							++img_fails;
						}
						else {
							img_fails +=
								woas._b64_export(data, img_fname, true) ? 0 : 1;
							if (img_fails) {
								woas.log("Exporter: binary save failed; links only");
							}
							else {
								++done;
							}
						}
						data = img_fname + "' alt='" +
							pg.substr(pg.indexOf("::") + 2);
					}
					// if image is not linked early IEs will have problems;
					// < 8 will show broken image marker; 8 has 32Kb limit
					data = "<" + "img class='woas_img' src='" + data + "' />";
				}
				else { // File::... pages
					data = woas.parser._raw_preformatted("pre", woas.base64.decode(
						data.replace(/^data:\s*[^;]*;\s*base64,\s*/, '')),
						'woas_embedded');
				}
			}
			else {
				data = woas.export_parse(data, exps.js_mode);
			}
			if (!this._one_page(data, pg, fname, woas.config.store_mts ?
					page_mts[pi] : 0)) {
				woas.log("Exporter: couldn't save " + pg);
				continue;
			}
			++done;
		}
//		woas.log("pages yet to process: "+this._further_pages);	// log:0
		// process further pages; dynamic content pages other pages have linked to
		// that don't have an actual page; was rewriting existing pages - fixed
		var title, i = 0;
		while (i < this._further_pages.length) {
			woas.parse_title = title = this._further_pages[i];
			i++;
			data = woas.get_text_special(title, true);
			if (data === null) { // probably a bad link?
				woas.log("Exporter: cannot process "+title);
				continue;
			}
			++total;
			data = woas.export_parse(data, exps.js_mode);
			if (this._one_page(data, title, this._title2fn[title]))
				++done;
		}
		woas.parse_title = "";
		// return total exported pages/objects
		return [done, total, locked, img_fails];
	},
	
	_one_page: function (data, title, fname, mts) {
		data = woas.utf8.do_escape(data);
		// prepare the raw text for later description/keywords generation
		var raw_text = woas.trim(woas.xhtml_to_text(data)), exp_menu = '',
			ns, mpi, tmp;
		if (this._settings.exp_menus) {
			ns = woas.get_namespace(title);
			// get submenu, if available, from first available namespace
			if (!/^WoaS::Help/.test(ns)) {
				while (ns !== "") {
					mpi = woas.page_index(ns + "::Menu");
					if (mpi !== -1) {
						tmp = woas.get__text(mpi);
						if (tmp !== null)
							exp_menu = tmp;
						break;
					}
					tmp = ns.lastIndexOf("::");
					ns = tmp === -1 ? "" : ns.substring(0, tmp);
				}
			}
			if (!exp_menu) {
				exp_menu = woas.get_text("::Menu") || "";
			}
			// parse the exported menu
			if (exp_menu) {
				exp_menu = woas.parser.parse(exp_menu, this._settings.js_mode);
				if (this._settings.js_mode) {
					woas.scripting.activate("menu");
				}
				// fix also the encoding in the menus
				exp_menu = 'div id="woas_menu_wrap"><'+
					'div id="woas_menu_jar"><'+'div id="woas_menu">'+
					woas.utf8.do_escape(exp_menu)+'<'+'/div><'+'/div><'+
					'/div><';
			}
		}
		// IE11 (?) broke export with old date generation; was adding multiple
		// decimal 8206 LTR marker characters; on reflection, better to show a
		// universal date on web than local, so changed; if local time preferred
		// change to: .toLocaleString().replace(/\u200e/g, "&lrm;")
		mts = mts ? (new Date(mts * 1000)).toGMTString() : "";
		data = '<'+'div id="woas_header_wrap"><'+'div id="woas_header"><'+
			'span id="woas_title">'+woas.create_breadcrumb(title, true)+'<'+
			'/span><'+'/div><'+'/div><'+'div id="woas_content"><'+exp_menu+
			'div id="woas_page_wrap"><'+'div id="woas_page">'+data+'<'+'/div>'+
			(mts ? '<'+'div id="woas_mts">'+woas.i18n.LAST_MODIFIED+mts+'<'+
			'/div>' : '')+'<'+'/div><'+'/div>';
		// craft a nice XHTML page
		data = "<"+"title>"+woas.xhtml_encode(title)+"<"+"/title>"+
			// add the exported CSS
			this._settings.css+
			// add the last-modified header
			(mts ? '<'+'meta http-equiv="last-modified" content="'+mts+'" />'+
			"\n" : '')+
			// other useful META stuff
			'<'+'meta name="generator" content="Wiki on a stick v'+
			woas.version+' - http://woas.sf.net/" />'+"\n"+
			'<'+'meta name="keywords" content="'+
			woas.utf8.do_escape(woas._attrib_escape(_auto_keywords(raw_text)))+
			'" />'+"\n"+'<'+'meta name="description" content="'+
			woas.utf8.do_escape(woas._attrib_escape(raw_text.replace(/\s+/g,
			" ").substr(0,max_description_length)))+'" />'+"\n"+
			this._settings.meta_author+this._settings.custom_scripts+'<'+
			'/head><'+'body class="woas_export'+(exp_menu ? '' :
			' woas_export_no_menu')+'">'+data+'<'+'/body><'+'/html>\n';
		return woas.save_file(this._settings.xhtml_path+fname,
			woas.file_mode.ASCII_TEXT, woas.DOCTYPE+woas.DOC_START+data);
	},

	// no_esc stops the returned filename being escaped; "#" is never escaped
	// if no_esc === 0 an image file name is being generated
	_get_fname: function(title, no_esc) {
		var fname = this._title2fn[title];
		if (fname) {
			// return a cached title
			return no_esc || fname === '#' ? fname : escape(fname);
		}
		else if (no_esc !== 0) {
			var sp = false, // export possibly valid dynamic pages later if true
				pi = woas.page_index(title), // dynamic/bad link === -1
				exists = pi !== -1;
			// PVHL: no plugin listing; could generate export version if needed
			if (title.substr(-2) === '::' && title !== 'WoaS::Plugins::') {
				sp = true;
			}
			else if (woas.is_reserved(title)) {
// this won't export Javascript::... but won't fix here as many side-effects
				var good = false; // only allow desired reserved pages
				if (title.indexOf('WoaS::') === 0) {
					// valid woas pages always exist
					good = exists && this._reExportWoas.test(title);
				}
				else if (title.indexOf('Special::') === 0) {
					good = this._reExportSpecial.test(title);
					// real Special::... pages generated normally
					sp = good && !exists;
				}
				if (!good) {
					// log warning moved to do_export
					return this._set_bad_title(title);
				}
			}
			if (sp) {
				// save a reference to this namespace or reserved page
				if (this._further_pages.indexOf(title) === -1)
					this._further_pages.push(title);
			}
			else {
				if (!exists) {
					woas.alert(woas.i18n.PAGE_NOT_EXISTS.sprintf(title));
					return this._set_bad_title(title);
				}
			}
		}
		fname = title;
		// PVHL: have removed normalize option; Windows is case insensitive and
		//	therefore open to error here; will fix diacritics in new version;
		//	all that really matters here is a legal filename of some sort.
		// escape some path-unsafe characters
		fname = fname.toLowerCase().replace(/[\s:\\\/<>?#=!]+/g, "_")
		// PVHL: there wasn't much point to current code; may implement fully
		//	later; until then have changed to '-' for unknown char; even fully
		//	non-ASCII titles will end up with a suitable name, even if it's '-1'
		// convert UTF8 characters to something else
		.replace(/[^\u0000-\u007F]+/g, "-");
		// image file name requests are identified by no_esc = 0
		var ext = no_esc === 0 ? "" : "." + this._default_ext,
			test_fname = fname + ext, i = 0;
		while (this._export_fnames[test_fname]) {
			woas.log(test_fname + " already created, checking next fname");	// log:1
			test_fname = fname + (++i) + ext;
		}
		this._set_fname(title, test_fname);
		return no_esc ? test_fname : escape(test_fname);
	},

	// must only be called if title starts with Image::
	_get_img_fname: function(title) {
		return this._get_fname(title.substr(title.indexOf("::") + 2), 0);
	},

	_set_bad_title: function(title) {
		this._title2fn[title] = "#";
		return "#";
	},

	_set_fname: function(title, name) {
		this._title2fn[title] = name;
		this._export_fnames[name] = true;
	}
}; // exporter module

woas._unix_normalize = function(s) {
	return s.toLowerCase().replace(/\s+/g, "_").replace(/::/g, "-")
};

// save a base64 data: stream into an external file
// optional 'no_msg' stops alert for bad save
woas._b64_export = function(data, dest_path, no_msg) {
	// IE must receive an array (would be faster if all browsers did?)
	if (this.browser.ie)
		data = this.base64.decode_array(data.replace(/^data:\s*[^;]*;\s*base64,\s*/, ''));
	else
		data = this.base64.decode(data.replace(/^data:\s*[^;]*;\s*base64,\s*/, ''));
	// attempt to save the file
	return this.save_file(dest_path, this.file_mode.BINARY, data, no_msg);
};

woas._attrib_escape = function(s) {
	return s.replace(/"/g, '&quot;');
};

woas.export_parse = function (data, js_mode) {
	// a normal wiki page, parse it and eventually execute the attached javascript
	data = this.parser.parse(data, js_mode);
	if (js_mode) {
		this.setHTMLDiv(d$("woas_page"), data);
		this.scripting.activate("page");
		data = this.getHTMLDiv(d$("woas_page"));
	}
	return data;
};

// must only be called from export page; don't need a return value
// New version will be on actual export page and/or in plugin
woas.export_wiki = function() {
	var exp = this.exporter, exps, sep_css, stats;
	// initialize resources used during export
	exp.clear();
	exps = exp._settings;
	// parse user export options
	try {
		exps.xhtml_path = d$("woas_ep_xhtml").value;
		exps.img_links = !d$("woas_cb_img_dir").checked;
		exps.img_path = exps.xhtml_path; // leaving for future
		exps.js_mode = 0;
		if (d$("woas_cb_js_dyn").checked)
			exps.js_mode = 1;
		else if (d$("woas_cb_js_exp").checked)
			exps.js_mode = 2;
		sep_css = d$("woas_cb_sep_css").checked;
		exps.exp_menus = d$("woas_cb_export_menu").checked;
		exps._main_index = d$("woas_cb_index_main").checked;
		exp._default_ext = d$("woas_ep_ext").value;
		exps.meta_author = this.trim(d$("woas_ep_author").value);
		if (exps.meta_author.length)
			exps.meta_author = '<'+'meta name="author" content="' +
				this._attrib_escape(this.xhtml_encode(exps.meta_author)) +
				'" />'+"\n";
	} catch (e) {
		// don't clear resources here to allow simpler debug
		this.crash(e);
	}

	// set index filename if used
	if (exps._main_index && this.config.main_page) {
		exp._set_fname(this.config.main_page, "index." + exp._default_ext);
	}

	// generate CSS
	exps.css = this.css.get();
	if (sep_css) {
		exps.css_path = "woas.css";
		exp._export_fnames[exps.css_path] = true;
		this.save_file(exps.xhtml_path+exps.css_path,
			this.file_mode.ASCII_TEXT, exps.css);
		exps.css = '<'+'link rel="stylesheet" type="text/css" media="all" href="' +
			exps.css_path + '" />';
	} else
		exps.css = "<"+"style type=\"text/css\">"+exps.css+"<"+"/style>";

	// actual exporting
	woas.parser.export_links = true;
	stats = exp.do_export();
	woas.parser.export_links = false;

	// refresh if javascript was run
	if (exps.js_mode) {
		this.set_current(current, false);
	}
	// clear allocated resources used during export
	exp.clear();
	this.alert(this.i18n.EXPORT_OK.sprintf(stats[0], stats[1]) +
		(stats[2] ? "\n" + this.i18n.ERR_NO_DECRYPT_ALERT.sprintf(stats[2]) : "") +
		(stats[3] ? "\n" + this.i18n.ERR_NO_IMAGES_ALERT.sprintf(stats[3]) : ""));
};

var max_keywords_length = 250;
var max_description_length = 250;
// proper autokeywords generation functions begin here
var reKeywords = new RegExp("[^\\s\x01-\x2F\x3A-\x40\x5B-\x60\x7B-\x7E]{2,}", "g");
function _auto_keywords(source) {
	if (!source.length) return "";
	var words = source.match(reKeywords);
	if ((words===null) || !words.length) return "";
	var nu_words = [], density = [], wp=0, cond;
	for(var i=0;i < words.length;i++) {
		if (words[i].length === 0)
			continue;
		cond = (woas.i18n.common_words.indexOf(words[i].toLowerCase())<0);
		if (cond) {
			wp = nu_words.indexOf(words[i]);
			if (wp < 0) {
				nu_words = nu_words.concat(new Array(words[i]));
				density[nu_words.length-1] = {"i":nu_words.length-1, "w":1};
			} else
				density[wp].w = density[wp].w + 1;
		}
	}
	if (!density.length) return "";
	words = [];
	var keywords = "", nw = "";
	density = density.sort(function(a,b){return b.w - a.w;});
	var ol=0;
	for(i=0;i < density.length;i++) {
		nw = nu_words[density[i].i];
		if (ol+nw.length > max_keywords_length)
			break;
		keywords = keywords+","+nw;
		ol+=nw.length;
	}
	return keywords.substr(1);
}

// used to export a File:: page
woas.export_file = function(page, dest_path, txt) {
	var pi=this.page_index(page);
	if (pi==-1)
		return false;
	var data=this.get__text(pi);
	if (data==null)
		return false;
	// attempt to save the file (binary mode if probably capable of it)
	// PVHL: IE must use an array
	return this.save_file(dest_path, txt ? this.file_mode.UTF8_TEXT : this.file_mode.BINARY,
		this.browser.ie ? this.base64.decode_array(data) : this.base64.decode(data));
};

// export a base64-encoded image to a file
woas.export_image = function(page, dest_path) {
	var pi=this.page_index(page);
	if (pi==-1)
		return false;
	var data=this.get__text(pi);
	if (data==null)
		return false;
	return this._b64_export(data, dest_path);
};

/*** src/wsif.js ***/
// @module wsif
/**
PVHL: WoaS 0.12.0 has multiple ways to corrupt files, including WSIF files;
e.g.: the whole wiki was being deleted if there was a data source path error.
I have modified the WSIF object to allow loading and saving of the files
WoaS is able to export with Special::ExportWSIF. To make this safer, I have
added a new header: 'wsif.type: index'. Recursion is allowed if the root file
is an index and/or the external file has a mime-type. This works in testing
with image files, but only in Firefox because binary load and save doesn't work
yet in other browsers. WoaS 0.12.0 fails silently, possibly corrupting the wiki.

Given the above it makes no sense to allow blob saves in WoaS, given other
browsers can neither load, edit, or save the resulting files. I have therefore
disabled and removed blob saving until the capability works cross-browser. Also,
the default was to save mime files as a blob; this has been changed.

A multi-file index is indicated by the 'wsif.type: index' wsif header and is only
allowed in the root wsif index file (now generated by save). This allows safe
saving of multifile wsif files (the index file was corrupted previously if
multi_file wasn't set)

Other changes, including the new 'page' type, are described in WoaS::Help::WSIF

TODO:

* make any save failure cancel the save; this will help protect data and speed up
  error discovery

* make multi-file save only save the file that was changed/added and the index;
  it is very slow right now and this would improve things greatly -- most of the
  code to do this is already present. Would also work remotely

  It would also be a good idea to only save index if:
    * a new page is added
    * page name is changed
    * page is deleted
  Given that we can't delete files it is only necessary to save the new index when
  any of the above happen.
*/

woas.wsif = {
	// some stuff here just to document; no need to set for tests
	// ds_multi - set if index-type file was loaded
	// emsg
	// expected_pages - only used by exporter? Will be removed
	version: "1.4.0", // version of WSIF format being used
	defaultDir: "wsif_%s",
	defaultName: "%s.wsif",
	// default filename: wsif_FILENAME/index_FILENAME.wsif
	// TODO: move function and use for both exports, with flag
	defaultPath: function() {
		var name = d$.file(document.URL, -1).name, n = name.lastIndexOf(".");
		name = n === -1 ? name : name.substring(0, n);
		return this.defaultDir.sprintf(name) + woas.DIRECTORY_SEPARATOR +
			this.defaultName.sprintf(name);
	},
	// next will be removed eventually; FileList object will be used.
	// _native_page_def() will add imported page id here when page imported
	imported: [],
	reMimeMatch: /^data:\s*([^;]*);\s*base64,\s*/,

	// will change to 'checkBoundary' and just use passed in file when
	// save system refactored to use File-like object
	_generate_random_boundary: function(old_boundary, text, re) {
		var b = old_boundary, re;
		if (b.length < 3)
			b = _random_string(10);
		while (re.test(text)) {
			b = _random_string(10);
			re = new RegExp("\\n--"+b);
		}
		return b;
	},

	// here temporarily; something similar will be in filer module
	clonePage: function(f) {
		return {
			r: null,
			p: 0,
			list: f.list
		};
	},

	// update header parameters (listing all to speed up search)
	convertWoasHeader: {
		// this was misnamed; page_author can now also be defined
		author: 'wsif_author',
		version: 'wsif_generator_version',
		pages: 'wsif_pages',
		// changed to use 'date' subspace; also date.created and both for wsif
		page_last_modified: 'page_date_modified',
		page_title: 'page_title',
		page_attributes: 'page_attributes',
		page_encoding: 'page_encoding',
		page_boundary: 'page_boundary',
		page_mime: 'page_mime',
		// these headers no longer used
		page_length: null, // no code uses this
		page_disposition: null, // only one browser could do this; removed
		page_original_length: null
	},

	// f: file, r: error number, error message, sf1/sf2: template strings
	// (sf1 && sf2 || sf2) are optional depending on i18n string
	// if !msg use sf1 as a msg, with sf2 as an optional format string
	// TODO: use this message system to report the file's error @ end of import
	//	so that it is not affected by multiple files; also keep track if multiple
	//	errors so that user is not pummelled in multi-file set-up; at that point
	//	most/all the arguments will be in 'f'; may need postError/postResult too
	do_error: function(f, r, msg, sf1, sf2) {
		// pass along the i18n reference, or debug message, and r
		f.wsif_err = r + '_' + (msg || sf1);
		msg = msg ? woas.i18n[msg].sprintf(sf1, sf2) : sf1.sprintf(sf2);
		// TODO: need to also keep English debug strings when an i18n plugin is
		//	present so that debug info can stay in English for support (though
		//	'r' helps out with that)
		woas.log("WSIF ERROR: " + f.wsif_err + '\n' + msg);	//log:1
		return r;
	},

	// will eventually be private
	getHeadersRE: /[\s\S]*?\n\n/g,

	// reads header block information from file 'f'
	// 'type' [optional] 1: external page, 2: for full/index, normally absent
	// returns 'false' for success, number of error for failure (1..9)
	// (will use this return value standard in refactoring code)
	// return values:
	//	false - success (could also be 0 with this pattern)...
	//	1 - no more page headers (not an error)
	//	2 - no file header
	//	3 - no page header (at least title must exist)
	getHeaders: function(f, type) {
		function err(r) {
			return that.do_error(f, r, 'WSIF_ERR_NO_HDR', type > 1 ?
				"information" : "page", f.name);
		}

		var fl = f.list, store = type > 1 ? fl : f, that = this,
			i, il, hdr, hi, parm, val, chk;
		this.getHeadersRE.lastIndex = f.p;
		hdr = this.getHeadersRE.exec(f.str);
		// now pointing to beginning of page content
		f.p = this.getHeadersRE.lastIndex;
		if (hdr === null) {
			if (!type && fl.found > 0)
				// finished reading pages in multipage file
				return 1;
			return err(2);
		}
		hdr = woas.trim(hdr[0]).split('\n');
		if (!hdr.length)
			return err(3);
		store.hdr = {};
		for (i = 0, il = hdr.length; i < il; ++i) {
			hi = hdr[i];
			chk = hi.indexOf(':');
			// convert '.' format to simplify code
			parm = woas.trim(hi.substring(0, chk++)).replace(/\./g, '_');
			val = woas.trim(hi.substring(chk));
			if (val && parm) {
				// convert old 'woas' values if present
				// any other header processing done in processing functions
				if (parm.indexOf('woas_') === 0)
					parm = this.convertWoasHeader[parm.substr(5)];
				if (parm)
					store.hdr[parm] = val;
			}
			else {
				woas.log('Bad WSIF header: ' + hi);
			}
		}
		hdr = null;
		// false is success here; an external file only has file headers
		return type ? this.processFileHeader(f) : false;
		// this is where a hook could be called for custom headers, as specified
		// in the WoaS::Help::WSIF page, instead of the above return; don't see
		// the need for now, especially given they can't be written yet
		// chk = type ? this.processFileHeader(f) : false;
		// return chk ? chk : this.customHeaders(f, type);
	},

	header: function(header_name, value) {
		return header_name+": "+value+"\n";
	},

	// comes here with formed file header for processing
	// success returns 0 or false, number is error (10..19), and f.wsif_err set (for now)
	processFileHeader: function(f) {
		function version(str) {
			return parseInt((str || '').replace(/\./g, ''));
		}
		var r, fl = f.list, hdr = fl.index ? f.hdr : fl.hdr, chk, wgv,
			ver = version(hdr.wsif_version);
		// check wsif version
		if (!ver)
			return this.do_error(f, 10, 'WSIF_ERR_NO_VER');
		if (ver === 100)
			// version 1.0.0 is not supported
			return	this.do_error(f, 11, 'WSIF_ERR_NS_VER', hdr.wsif_version);
		if (ver > version(this.version))
			return this.do_error(f, 12, 'WSIF_ERR_NEW_VER');

		// PVHL: Because the native load currently has to bring everything in
		//	from one file, the generator needs to be 'woas'. Future refactoring
		//	will allow separate files for core, help, and content (by using an
		//	'index' file of 'index' or normal WSIF files); at that point any
		//	generator can be used for non-WoaS content.
		// TODO: check libwsif and update as needed; don't use myself

		// check generator version; should be able to make decisions based on
		// WSIF file version, but this allows WoaS version bugs to be handled.
		if (hdr.wsif_generator === 'woas') {
			wgv = version(hdr.wsif_generator_version);
			if (!wgv)
				return this.do_error(f, 13, 'WSIF_ERR_NO_VER_GEN');
			if (wgv > version(woas.version))
				return this.do_error(f, 14, 'WSIF_ERR_NEW_VER');
			if (wgv !== version(woas.version))
				woas.log("NOTE: Woas versions don't match, but this Woas" +
					" is newer; loading.");
			// WSIF import page currently doesn't allow filtering of full
			// index, as HTML import does, to allow Custom::CSS import
			// TODO: Fix by implementing theming
		}
		// WSIF was not generated by WoaS; if not in native mode load any user
		// pages it contains.
		else {
			if (!fl.native) {
				// Importing; by setting this to current version, no upgrading
				// will be attempted on page content; will still be filtered by
				// title though, so only user content allowed
				wgv = version(this.version);
				woas.alert(woas.i18n.WSIF_NOT_WOAS +
					woas.i18n.WSIF_NOT_WOAS_PAGES);
			}
			else {
				alert(woas.i18n.WSIF_NOT_WOAS + woas.i18n.WSIF_ERR_NOT_WOAS);
				return this.do_error(f, 15, 'WSIF_NOT_WOAS');
			}
		}
		// need the file to know this too; eventually remove _old_version
		woas.importer._old_version = f.wgv = wgv;
		return false;
	},

	// success returns 0 or false, number is error (30..49)
	// comes here with good header made
	// TODO: fix up error reporting
	// 30 - page skipped; not an error
	processPage: function(f) {
		var fl = f.list, hdr = f.hdr, pg = hdr.wsif_type === 'page', p, h, n,
			bound = '\n--' + (hdr.page_boundary || fl.hdr.page_boundary)+'\n',
			bl = bound.length;
		if (!fl.import_hook) // must be available; impossibility safeguard
			return 31; // no ability to add page to store
		hdr.page_title = woas.ecma_decode(hdr.page_title);
		if (hdr.page_title) {
			++fl.found;
			// check if settings allow import of this page
			if (fl.title_filter_hook && !fl.title_filter_hook(hdr.page_title) ||
					page_titles.indexOf(hdr.page_title) !== -1 &&
					(woas.importer.i_overwrite === 1 ||
					woas.importer.i_overwrite === 3 &&
					!confirm(woas.i18n.CONFIRM_OVERWRITE.
					sprintf(hdr.page_title)))) {
				// not allowed; set up f.p for next page
				if (pg) {
					f.p = f.str.length;
				}
				else {
					// only page end boundary will be found
					n = f.str.indexOf(bound, f.p);
					if (n === -1)
						return 32; // report error
					f.p = n + bl;
				}
				++fl.skipped; // TODO: FIX - old bootscript import can mess up
				woas.log('Skipped: ' + hdr.page_title);
				return 30; // not an error
			}
		}
		else {
			return 33; // no title!
		}
		// create page
		p = {
			title: hdr.page_title,
			attrs: Number(hdr.page_attributes) || 0, // convention
			mts: hdr.page_date_modified || 0,
			ok: true // flag for _core_import
		};
		if (pg) {
			p.text = f.str.substring(f.p);
		}
		else {
			// remove first boundary if present (old style)
			if (f.wgv < 130) {
				// take front '\n' off of boundary marker to find first one
				n = f.str.indexOf(bound.substr(1), f.p);
				if (n === f.p)
					f.p = f.p + bl - 1;
				else
					return 34; // no first boundary
			}
			// find end of page text
			n = f.str.indexOf(bound, f.p);
			if (n === -1) {
				return 35; // no page end marker
			}
			else {
				p.text = f.str.substring(f.p, n);
				f.p = n + bl;
			}
		}
		if (p.text) {
			// fix up text depending on type of page
			// A backward-compatible change: encryption stored as base64 string,
			// just like the WSIF file. The array can take 3x times more space!
			// (prefer to lose a little speed then bloat the file)
			// This code ignores length parameter and also doesn't save it.
			// Refactored code will use an optional file hash checksum
			hdr.page_encoding = hdr.page_encoding || '8bit/plain'; // convention
			if (p.attrs & 2) {
				// encrypted page; TODO: check which versions to refuse; is it < 0.10.4?
				if (hdr.page_encoding !== "8bit/base64")
					//woas.log("Encrypted page "+title+" is not encoded as 8bit/base64");
					return 36;
			} else if (p.attrs & 8) {
				// embedded image, not encrypted
				// NOTE: encrypted images are obviously not processed here, but
				//	were encrypted with their mime intact, so OK
				if (hdr.page_encoding !== "8bit/base64")
					//woas.log("Image "+title+" is not encoded as 8bit/base64");	//log:1
					return 37;
				if (!hdr.page_mime)
					//woas.log("Image "+title+"has no mime type defined");		//log:1
					return 38;
				// re-add data:uri to images
				p.text = "data:" + hdr.page_mime + ";base64," + p.text;
			} else {
				// a normal wiki page
				switch (hdr.page_encoding) {
					case "8bit/base64":
						// embedded files stay encoded
						if (!(p.attrs & 4))
							// WoaS does not encode pages normally, but this is supported by WSIF format
							p.text = woas.base64.decode(p.text);
					break;
					case "ecma/plain":
						p.text = woas.ecma_decode(p.text);
					break;
					case "8bit/plain": // plain wiki pages are OK as-is
					break;
					default:
						woas.log("Normal page "+p.title+" comes with unknown encoding "+encoding);	//log:1
						return 39;
				}
			}
			// TODO: this still isn't right FIX for upgrade, skipped, loaded etc.
			// and need to split out error msg.
			// upgrade content if needed
			n = true;
			if (f.wgv < 120)
				n = this._upgrade_content(p);

			// do the actual page import
			if (n && fl.import_hook(p)) {
				// keeping this for now; may remove later and use an fl array
				this.imported.push(p.i);
				++this.pages_imported; // for now
				++fl.loaded;
				return false;
			}
		}
		return 40; // unspecified error? Failed import?
	}
}; // woas.wsif

// to be enabled after 1.0.0 release
// properly calculate an incremental value for version strings
// we consider each place is worth 10^2
// PVHL: refactored to not fail with bad input and accept Alpha/Beta names
//	(also works with all previous WoaS version names)
//	Will use in a future beta soon, but in importer
woas._version_to_int = function(s) {
	var v = (s || "0").split("."), vl = v.length - 1, r = 0, i = 0;
	if (vl > -1)
		v[vl] = parseInt(v[vl]); // allow "1.0.0 Beta 5" etc.
	while (vl > -1) {
		r += v[vl--] * Math.pow(100, i++)
	}
	return r;
};

// PVHL: not using in current code
woas._normver = function(s) {
	//var rv = this._version_to_int(s);
	//return rv >= 10000 ? rv : parseInt((s || '0').replace(/\./g, ""));
	return parseInt((s || '0').replace(/\./g, ""));
};

/*
default behavior:
- wiki pages go inline
- 'disposition' removed; doesn't work cross-browser and breaks the concept
  of WSIF as an interchange format. Everything is now inline
- encrypted pages in base64
- no help pages saved if woas.config.no_help is set

PVHL: plist is removed; it didn't work yet and I will be using FileList, so
full_save is also gone. single_wsif will change to multi as single is the
default for saves. woas.wsif.expected_pages will be removed soon;
Have removed original_length (believe it was only there because of base64 bug
I fixed a while back)

'single_wsif': true if not wanting index & external files
'save_all': true if all pages are to be saved, not just user pages
*/
woas._native_wsif_save = function(path, src_fname, single_wsif, author,
			save_all, no_help) {
	// full_wsif is single_wsif page content (all pages) or index content
	var full_wsif = "", info = "", pfx = "page.",
		// boundary used to mark page definition end
		p = __marker.indexOf("-"), boundary, bound, record, ct,
		found, encoding, mime, reB, l, ll, ipi, pi, pl, m;
	// use the 1st part of the global marker
	boundary = p === -1 ? __marker : __marker.substr(0,p);
	// pages to be exported versus ones actually found
	this.wsif.expected_pages = found = 0;
	l = page_titles.length;
	ll = l - 1;

	// prepare the info headers
	info += this.wsif.header('wsif.version', this.wsif.version);
	info += this.wsif.header('wsif.generator', 'woas');
	info += this.wsif.header('wsif.generator.version', this.version);
	if (author)
		info += this.wsif.header('wsif.author', author);
	// the defaults if not a single page
	if (single_wsif) {
		info += this.wsif.header(pfx+"boundary", boundary);
	}
	reB = new RegExp("\\n--"+boundary); // allows this boundary to be default
	for (ipi = 0; ipi < l; ++ipi) {
		pi = ipi;
		if (!save_all) {
			// skip physical special pages
			if (/^(Special::|WoaS::Help|WoaS History$)/.test(page_titles[pi])) continue;
			if (this.static_pages2.indexOf(page_titles[pi]) !== -1) continue;
		}
		else if (woas.config.no_help && /^WoaS::Help::/.test(page_titles[pi])) {
			continue;
		}
		record = this.wsif.header(pfx+"title", this.ecma_encode(page_titles[pi]));
		if (page_attrs[pi] !== 0)
			record += this.wsif.header(pfx+"attributes", page_attrs[pi]);
		// specify timestamp only if not magic
		if (this.config.store_mts && page_mts[pi])
			record += this.wsif.header(pfx+"date.modified", page_mts[pi]);
		
		// normalize the page content & set encoding
		ct = pages[pi];
		if (this.is__embedded(pi) || this.is__encrypted(pi)) {
			encoding = "8bit/base64";
			if (this.is__image(pi) && !this.is__encrypted(pi)) {
				m = ct.match(this.wsif.reMimeMatch);
				if (m === null) {
					this.crash(page_titles[pi]+" is not a valid image!");
					continue;
				} else {
					mime = m[1];
					// remove the matched part
					ct = ct.substr(m[0].length);
					m = null;
				}
				record += this.wsif.header(pfx+"mime", mime);
			}
		} else { // normal wiki pages
			// check if ECMA encoding is necessary
			if (this.needs_ecma_encoding(ct)) {
				ct = this.ecma_encode(ct);
				encoding = "ecma/plain";
			} else
				encoding = "8bit/plain";
		}
		// PVHL: page.length removed; no code exists to use it
		// update record
		if (encoding !== "8bit/plain")
			record += this.wsif.header(pfx+"encoding", encoding);
		++this.wsif.expected_pages;
		if (single_wsif) {
			// check entire page content for current boundary text
			bound = this.wsif._generate_random_boundary(boundary, ct, reB);
			if (bound !== boundary)
				record += this.wsif.header(pfx+"boundary", bound);
			// don't add extra linefeed at end of page
			full_wsif += record + "\n" + ct + "\n--" + bound + "\n" + 
				(pi < ll ? "\n" : "");
			++found;
		}
		else {
			// save each page separately
			// single pages and index files don't use a boundary marker
			// will change from page index as name to an algorithm that
			// describes page name well and is an effective filename
			if (this.save_file(path + pi + ".wsif", this.file_mode.ASCII_TEXT,
					this.wsif.header("wsif.type", "page") + info + record +
					"\n" + ct)) {
				++found;
				// no point in saving page in index if page wasn't saved
				// TODO: consider pushing to array and sorting before writing index
				//	Problem is then pages in different order - this MUST not matter
				//	loader, core page preload and plugin code needs to be checked
				full_wsif += this.ecma_encode(page_titles[pi])+" || "+pi+".wsif\n";
			}
		}
	} // foreach page
/**
PVHL: need to quickly fix (with minimal side-effects) a really bad bug in saving to a bad data source.
if found == 0 here then there has been a failure in saving.
So: if !found don't save index. return value of 0 signals save failed; this is used to stop a save
of the html file -- otherwise a bad data source save wipes out the wiki.
*/
	// output the index or single page WSIF file; default for 'wsif_type' is to
	// be absent from record (convention over configuration)
	if (found && !this.save_file(path + src_fname, this.file_mode.ASCII_TEXT,
			// index header stops data corruption
			(single_wsif ? '' : this.wsif.header('wsif.type', 'index')) +
			this.wsif.header('wsif.pages', found) + info + '\n' + full_wsif)) {
		found = 0;
	}
	return found; // save failed if 0
};

// here if load WoaS from wsif page
// PVHL: TODO: needs better error checking- can get hundreds of alerts with
//	multiple files. I will be changing this to use the files object instead of
//	these arrays. Simple once the internal store uses the FileList structure
woas._wsif_ds_load = function(subpath) {
	// we reset the arrays before loading the real data from index.wsif
	var file = d$.file(woas.ROOT_DIRECTORY+subpath, true), fl = file.list;
	if (!file)
		return false;
	pages = [];
	page_attrs = [];
	page_titles = [];
	page_mts = [];
	// set up file object for wsif loading
	file.mode = this.file_mode.ASCII_TEXT;
	fl = file.list;
	// this is the file default for remote (currently all files one or other)
	file.remote = this.server_mode;
	fl.native = true;
	fl.import_hook = this.importer._inject_import_hook;
	//fl.title_filter_hook - not needed as all pages need to be loaded at start
	//fl.finalization_hook - not needed as _on_load does same
	// no callback needed because datasource (so far) can't do async load
	this._native_wsif_load(file);
	return true; //FIX?
};

// PVHL: *transitional* All this will change in Filer
//	modified to allow remote load; 'f' is the file object the file input
//	reader creates that is passed to file_load.
//	not using server_mode for future needs, 

/* description of [optional] parameters:
 - f: object passed from caller
 - f.list.import_hook: callback used to actually import the page
 - [f.list.native]: true when WoaS is in native mode (private use only);
	i.e. loading from a WSIF data_source, not importing.
 - [f.list.title_filter_hook]: callback used to choose if page can be imported
	or not by title
 - [f.list.finalization_hook]: callback used when import is finished

TODO: f should be FileList, not File, and load should build collection of
pages within FileList (could be by start/end pointer for single file).
Currently not done, but will then allow:
 * interactive title filtering from a special page (my unwritten wikiLifts page)
 * collection of data for import
 * eventual refactor of internal page storage; this is close to the designed
	storage system (except for the string pointer for pages idea)

This routine likely to be recursive once index files can load index files
and/or multipage files
*/
woas._native_wsif_load = function(f) {
	var fl = f.list;
	if (fl.index) {
		woas.log(msg + "loading an index file from an index file currently not allowed.");
		return 0;
	}
	// next two may not be needed any more
	this.wsif.emsg = null;
	this.load_err = false;
	// loading from server now handled by load_file
	// set up callbacks for async file loading (names will change later
	// and not be used if recursing)
	fl.callback = this._native_wsif_load_cb;
	fl.that = this;
	this.load_file(f);
};

// a 'wsif_err' message on 'f.list' will be crash alerted later
// TODO: fix error reporting; most should be done using 'r' at loop end
woas._native_wsif_load_cb = function(f) {
	var wsif = this.wsif, fl = f.list, msg = "wsif load: ", r,
		i, il, page, np, npTitle, npName;
	f.p = fl.found = fl.loaded = fl.skipped = 0;
	// reset/cancel further filereader use
	fl.callback = fl.that = undefined;
	fl.no_async = true;
	// next really not used; was a plist item, but kept for now
	wsif.imported = [];

	// fake do/while loop eases error recovery
	do {

	if (!f.r || !f.str) {
		if (f.r === false) {
			f.wsif_err = this.i18n.LOAD_ERR;
			break;
		}
	}
	// get information headers; f.p marks position in f.str
	// getHeaders returns false for success, or error number and message
	// 1 is if no more page headers found after first one
	if (wsif.getHeaders(f, 2)) {
		woas.log(msg + (f.wsif_err || "file header not found"));
		break;
	}
	if (fl.hdr.wsif_type === "index") {
		if (!fl.path) {
			// came from no path file control; can't use it.
			// get path, reload and try again (reload is in case path
			// is entered incorrectly here; small penalty worthwhile)
			if (!d$.file.path_prompt(f)) {
				woas.log(msg + "load cancelled");
				break;
			}
			// we have a proper path now, but start over for safety as we need
			// to ensure the right path was entered
			this._native_wsif_load(f);
			r = -1; // flags return without callback; all errors are positive
			break;
		}
		// first time through with path, or second time because of no path
		fl.index = this.wsif.ds_multi = true;
	}
	else if (fl.hdr.wsif_type === "page") {
		// importing a single page that was generated for an index file
		f.hdr = fl.hdr;
		r = wsif.processPage(f);
		break;
	}
	if (fl.index){
		// an index file; get page information - f.str becomes page array
		// later version will use FileList to gather information in this way
		f.str = woas.trim(f.str.substring(f.p)).split('\n');
		if (f.str) {
			for (i = 0, il = f.str.length; i < il; ++i) {
				np = f.str[i].split('||');
				npTitle = woas.ecma_decode(woas.trim(np[0]));
				if (!npTitle)
					continue; // a blank line: 'should' not be here; not 'must'
				npName = woas.trim(np[1]);
				// load page
				if (npTitle && npName) {
					page = wsif.clonePage(f);
					page.name = npName;
					r = this.load_file(page);
					if (!r) {
						// couldn't get file
						// check error and decide action
						continue; // for now
					}
					r = wsif.getHeaders(page, 1);
					if (r) {
						// couldn't parse page
						// check error and decide action
						continue; // for now
					}
					if (page.hdr.page_title === npTitle) {
						r = wsif.processPage(page);
						if (r && r!== 30) {
							// check error and decide action
							continue; // for now
						}
					}
					else {
						// titles don't match
woas.log("index and page titles don't match! index: '"+npTitle+"', page: '"+page.hdr.page_title+"'");
						continue; // for now
					}
				}
			}
		}
	}
	else {
		// a normal wsif file; single page already done
		r = false;
		while (!r) {
			r = wsif.getHeaders(f);
			if (r) {
				// check errors and decide action
				break;
			}
			r = wsif.processPage(f);
			if (r && r !== 30) {
				// check errors and decide action
				woas.log(msg + " process page error - " + r);
				r = false;
				continue; // for now
			}
			r = false;
		}
	}

	// end of error loop
	}
	while (false);

// FIX: This is where all break errors should be reported
woas.log('load wsif '+((r > 1 && r !== 30) || r === undefined ? 'ERROR' : 'Completed OK')+' - r: '+r);
	// a callback is present if called from import (currently); would put this
	// on importer module, but filer won't do it that way (using injection)
	// r === -1 if index file finishing up the first no-path call
	if (r !== -1) {
		if (fl.finalization_hook)
			fl.finalization_hook();
		if (fl.import_wsif_that)
			fl.import_wsif_cb.call(fl.import_wsif_that, f);
		else
			return true; // FIX
	}
};

/*** src/legacy.js ***/
// deprecated/legacy functions

// All the functions in this file are still supported but deprecated.
// They will be removed from WoaS before version 1.0

// var log = woas.log; now set by woas._set_debug

d$.clone = function(o) {
	woas.log("WARNING: Called deprecated function: d$.clone (now woas.clone)");
	return woas.clone(o);
};
function bool2chk(b) {
	woas.log("WARNING: Called deprecated function: bool2chk (now woas.bool2chk)");
	woas.bool2chk(b);
}
function _set_layout(fixed) {
	woas.log("WARNING: Called deprecated function: _set_layout (now woas.ui.set_layout)");
	woas.ui.set_layout(fixed);
}
function home() {
	woas.log("WARNING: Called deprecated function: home (now woas.ui.home)");
	woas.ui.home();
}
function help() {
	woas.log("WARNING: Called deprecated function: help (now woas.ui.help)");
	woas.ui.help();
}
function advanced() {
	woas.log("WARNING: Called deprecated function: advanced (now woas.ui.advanced)");
	woas.ui.advanced();
}
function go_to(t) {
	woas.log("WARNING: Called deprecated function: go_to (now woas.go_to(t))");
	return woas.go_to(t);
}
function go_back() {
	woas.log("WARNING: Called deprecated function: go_back (now woas.ui.back)");
	woas.ui.back();
}
function go_forward() {
	woas.log("WARNING: Called deprecated function: go_forward (now woas.ui.forward)");
	woas.ui.forward();
}
function edit() {
	woas.log("WARNING: Called deprecated function: edit (now woas.ui.edit)");
	woas.ui.edit();
}
function lock() {
	woas.log("WARNING: Called deprecated function: lock (now woas.ui.lock)");
	woas.ui.lock();
}
function unlock() {
	woas.log("WARNING: Called deprecated function: unlock (now woas.ui.unlock)");
	woas.ui.unlock();
}
function save() {
	woas.log("WARNING: Called deprecated function: save (now woas.save)");
	woas.save();
}
// old tables parsing syntax
woas.parser.reReapTables = /^\{\|.*((?:\n\|.*)*)$/gm;
woas.parser.reReapTableRows = /\n\|([+ -])(.*)/g;
woas.parser.parse_tables =  function (str, p1) {
	var caption = false,
		stk = [];
	p1.replace(woas.parser.reReapTableRows, function(str, pp1, pp2) {
			if (pp1 == '-')
				return;
			else if (pp1 == '+') {
				caption = caption || pp2;
				return;
			}
			stk.push('<'+'td>' + pp2.split('||').join('<'+'/td><'+'td>') + '<'+'/td>');
		} 
	);
	if (stk.length)
		return  '<' + 'table class="woas_text_area">' + (caption?('<' + 'caption>' + caption +
			'<' + '/caption>'):'') + '<' + 'tr>' + stk.join('<' + '/tr><' + 'tr>') + '<' +
			'/tr>' + '<' + '/table>' + woas.parser.NL_MARKER;
	return str;
};

woas.refresh_menu_area = function() {
	woas.log("WARNING: Called deprecated function: woas.refresh_menu_area (now woas.ui.refresh_menu)");
	this.ui.refresh_menu();
};

/*** src/ui.js ***/
// @module ui
// User Interface bindings
woas.ui = {
	edit_mode: false,		// set to true when inside an edit textarea
	_textbox_focus: false,	// true when a text box is currently focused
	focus: function() {
		// added to allow arrows to scroll fixed layout
		woas.dom._cache.scroll.focus();
	},
	focus_textbox: function() { // called when a textbox currently has focus
		// 'this' belongs to the text box
		woas.ui._textbox_focus = true;
	},
	blur_textbox: function() { // called when a textbox looses focus
		// 'this' belongs to the text box if directly called from there
		woas.ui._textbox_focus = false;
		ff_fix_focus();
		// reset event handler
		this._textbox_enter_event = this._textbox_enter_event_dummy;
	},
	// event (to be overriden) to run in case of enter key pressed
	// for example, searching
	_textbox_enter_event_dummy: function() {
	},
	_textbox_enter_event: null,
	// custom event handler which can be overriden to process the keypresses
	_custom_key_hook: function(orig_e) {
		// continue parsing as normal
		return true;
	},
	
	// event called on key press
	//NOTE: since this is attached directly to DOM, you should not use 'this'
/*
PVHL: FIX; this needs to be changed as
 1. every user page that adds a text input control needs to know about setting
    blur/focus textbox or else pressing backspace goes back a page.
 2. (comment belongs in hotkey code) deleting a custom key (like back/escape)
    does not remove it from access keys. User desires need to be recognized.
*/
	_keyboard_event_hook: function(orig_e) {
		var e = orig_e || window.event,
			ck = e.keyCode || e.which,
			ui = woas.ui;
		if (!ui.edit_mode) {
			// there is a custom focus active, call the hook
			// and return if it told us to do so
			if (!ui._custom_key_hook(orig_e))
				return orig_e;
			if (ui._textbox_focus) {
				// return key
				if (ck == 13) {
					// clear focus
					ff_fix_focus();
					// run attached event
					(ui._textbox_enter_event)();
					return false;
				}
				return orig_e;
			}
			// back or cancel keys
			if ((ck == woas.hotkey.all.back) || (ck == woas.hotkey.all.cancel)) {
				ui.back();
				ff_fix_focus();
				return false;
			}
		} else if (ck == woas.hotkey.all.cancel) {
			// cancel key in edit mode
			ui.cancel();
			ff_fix_focus();
			return false;
		}
		return orig_e;
	},
	// adjust the height of an element to fill available screen space
	// Intended for a single element within a page, such as an iframe
	// It currently does not resize for log, etc.; call from a menu/page script
	// el: the element to resize
	// min: the minimum size desired
// PVHL TODO: add this to resize function, but must be cleared each page;
//	should do this with a special class instead, with page loader
	adjust_height: function(el, min) {
		var e = d$(el), s = woas.dom._cache.scroll, h;
		min = min || 90;
		if (e) {
			e.style.height = "5000px";
			// -1 is for Opera and probably early IEs
			h = 5000 + s.clientHeight - s.scrollHeight - 1;
			e.style.height = (h > min ? h : min) +"px";
		}
		else {
			woas.log("woas.ui.adjust_height: no such element - "+el);
		}
	},
	//  PVHL: 'Help' button calls the help system ui function
	help: function(pg) {
		woas.help_system.help(current, this.edit_mode);
	},
	// PVHL: this can be removed once edit page updated;
	//   not currently done for compatibility
	tables_help: function() {
		woas.help_system.help('Tables', -1);
	},
	clear_search: function(no_render) {
//		woas.log("Clearing search"); //log:0
		if (current === "Special::Search") {
			d$("special_search").value = "";
			d$("special_search").focus();
		}
		// clear search
		woas._last_search = null;
		if (!no_render)
			this._search_render();
	},
	// when user clicks the about link
	about: function() {
		if (!this.edit_mode)
			woas.go_to("Special::About");
	},
	_search_render: function() {
		// render search results
		if (current === "Special::Search") {
			woas._search_load();
		} else // will call _search_load() on its own
			woas.go_to("Special::Search");
	},
	// wsif: for Special::Import false, Special::ImportWSIF true
	_import_load: function(wsif) {
		var except = wsif ? 3 : 0, i, settings, chk;
		if (!woas.config.permit_edits)
			d$("btn_import").disabled = true;
		// restore default settings - with some exceptions
		settings = wsif ? woas.config.import_wsif : woas.config.import_woas;
		for(i=0;i < woas.importer._settings_props.length-except;++i) {
			chk = woas.bitfield.get(settings, i);
			d$("woas_cb_import"+woas.importer._settings_props[i].substr(1))
				.checked = chk;
			woas.importer[woas.importer._settings_props[i]] = chk;
		}
		if (wsif) {
			// these options are not available for WSIF
			woas.importer.i_styles = woas.importer.i_content = true;
			woas.importer.i_config = false;
		} else {
			// disable settings if needed by content setting
			this._import_load_change();
		}
		// restore the overwrite option which covers other 2 bits
		var ovr = 0;
		if (woas.bitfield.get(settings, woas.importer._OVR_ID))
			ovr += 1;
		if (woas.bitfield.get(settings, woas.importer._OVR_ID+1))
			ovr += 2;
		var params = ["erase", "ignore", "overwrite", "ask"];
		// apply parameter
		d$('woas_import_'+params[ovr]).checked = true;
		woas.importer.i_overwrite = ovr;
	},
	// WoaS::Import can disable page/css import
	// PVHL: TODO: make _import_load cache dom elements or make more efficient
	_import_load_change: function() {
		var c = woas.importer.i_content = d$("woas_cb_import_content").checked,
			s = woas.importer.i_styles = d$("woas_cb_import_styles").checked;
		// the IDs below are from parser.heading_anchor to allow use in links
		// MUST be changed if section title changed
		d$("s10522", c || s);
		d$("s4030", c);
	},
	// click on edit icon
	edit: function() {
		if (!this.display('no_edit')) {
			woas.edit_page(current);
		}
	},
	cancel: function() {
		if (!this.edit_mode)
			return;
		// there was some change, ask for confirm before cancelling
		if ((woas.get_raw_content() !== woas.change_buffer) ||
			(woas.trim(woas.dom._cache.ed_title.value) !== woas.old_title)) {
			if (!confirm(woas.i18n.CANCEL_EDITING))
				return;
		}
		// we will cancel the creation of last page
		if (woas._ghost_page) {
			// we assume that the last page is the ghost page
			pages.pop();
			page_mts.pop();
			page_titles.pop();
			page_attrs.pop();
			// menu entry may have been added for cancelled new page
			var menu_i = woas.page_index("::Menu");
			if (menu_i !== -1) {
				// try to remove menu link
				var menu_orig = woas.get__text(menu_i);
				var menu = menu_orig.replace("\n[["+current+"]]", "");
				if (menu !== menu_orig) {
					woas.set__text(menu_i, menu);
					woas.ui.refresh_menu();
				}
			}
		}
		current = woas.prev_title;
		woas.disable_edit();
		woas.update_view();
		woas.ui.focus();
	},
	// when back button is clicked
	back: function() {
		if (this.edit_mode || this.display('no_back')) {
			return false;
		}
		var p = woas.history.back();
		return p === null ? false : woas.set_current(p, true);
	},
	// when Forward button is clicked
	forward: function() {
		if (this.display('no_fwd')) {
			return false;
		}
		var p = woas.history.forward();
		return p === null ? false : woas.set_current(p, true)
	},
	// when home is clicked
	home: function() {
		if (!this.display('no_home')) {
			woas.go_to(woas.config.main_page);
		}
		
	},
	edit_menu: function() {
		var ns = woas.get_namespace(current, false), mpi, tmp;
		while (ns !== "") {
			mpi = woas.page_index(ns + "::Menu");
			if (mpi !== -1) {
				woas.edit_page(ns + "::Menu");
				return;
			}
			tmp = ns.lastIndexOf("::");
			ns = tmp === -1 ? "" : ns.substring(0, tmp);
		}
		if (woas.page_index("::Menu") !== -1) {
			woas.edit_page("::Menu");
		}
	},
	lock: function() {
		if (!this.display('no_lock')) {
			if (woas.pager.bucket.items.length>1)
				// option not implemented
				_lock_pages(woas.pager.bucket.items);
			else
				woas.set_current("Lock::" + current, true, true);
		}
	},
	unlock: function() {
		if (!this.display('no_unlock')) {
			if (woas.pager.bucket.items.length>1)
				_unlock_pages(woas.pager.bucket.items);
			else
				woas.set_current("Unlock::" + current, true);
		}
	},
	// scroll to top of page
	top: function() {
		if (this.edit_mode) {
			woas.dom._cache.ed.scrollTop = 0;
		} else {
			woas.dom._cache.scroll.scrollTop = 0;
		}
	},
	advanced: function() {
		if (!this.display('no_tools')) {
			woas.go_to("Special::Advanced");
		}
	},
	set_header: function(fixed) {
		// toggle
		if (fixed === -1) {
			fixed = !this.display('fix_h');
		}
		this.display({fix_h: fixed}, true);
	},
	// don't need the guard for ie6; just won't work and options won't allow
	set_menu: function(fixed) {
		// toggle
		if (fixed === -1) {
			fixed = !this.display('fix_m');
		}
		this.display({fix_m: fixed}, true);
	},
	set_layout: function(fixed)  {
		this.set_header(fixed);
		this.set_menu(fixed);
	},
	toggle_debug: function() {
		!this.display('no_debug') &&
		!this.display({'no_log':-1}, this.edit_mode).no_log &&
		woas.log() && // scroll to bottom if visible
		// move page to bottom if opening debug (not needed in edit)
		!this.edit_mode &&
		(woas.dom._cache.scroll.scrollTop = woas.dom._cache.scroll.scrollHeight);
	},
	// Used by Special::Options page (also used to check/repair filename in ExportWSIF)
	// chk_box & set are optional
	//
	// 1. if called with 'txt_box' & 'chk_box', and 'set' is true then may set config in
	//      UNIX format and save file -- only to be called from Special::Options code
	// 2. if called with 'txt_box', 'chk_box' only then sets elements with correct values
	// 3. if called with 'txt_box' alone then checks/repairs relative filename in txt_box
	//    (used by Special::ExportWSIF)
	wsif_ds: function(txt_box, chk_box, set) {
		// get path in UNIX format and trim; stored this way - but just to be safe
		var fn = woas.trim(txt_box.value.replace(/\\/g, '/')),
			ds = woas.trim(woas.config.wsif_ds.replace(/\\/g, '/')),
			str = '', i;
		// make sure path is relative - assume stored value is
		while (fn[0] === '/') fn = fn.substr(1);
		if ( set && (ds || fn) ) {
			i = woas.i18n;
			// 1. change data source settings and save file
			// create prompt string (truth table logic used; if str created
			// then a valid condition exists; otherwise reset options)
			if ( !( ds === fn && woas.wsif.ds_multi === this.wsif_ds_multi ) ) {
				if ( ds && !fn ) {
					str = i.WSIF_DS_TO_INTERNAL;
				} else if ( !ds && fn ) {
					str = i.WSIF_DS_TO_EXTERNAL + i.WSIF_EXIST;
				} else if (ds && fn && ds === fn) {
					if ( woas.wsif.ds_multi && !this.wsif_ds_multi ) {
						str = i.WSIF_DS_TO_SINGLE;
					} else if ( !woas.wsif.ds_multi && this.wsif_ds_multi ) {
						str = i.WSIF_DS_TO_MULTI;
					}
				}
				if ( ( ds && fn && ds !== fn ) ) {
					str += i.WSIF_EXIST;
				}
				if ( this.wsif_ds_multi && ( !ds || fn ) ) {
					str += i.WSIF_PAGES;
				}
			}
			// warn of potential risks before setting; restore original if needed
			if ( str && confirm(str + i.CHOOSE_CANCEL) ) {
				// update settings and save file
				woas.config.wsif_ds = fn; // save in UNIX format
				woas.wsif.ds_multi = fn && this.wsif_ds_multi;
				woas.full_commit();
				woas.set_current(current, true, true); // stop forward history destruction
			} else { // reset settings - approval not given or settings not valid
				fn = ds;
				this.wsif_ds_multi = woas.wsif.ds_multi;
				str = '';
			}
		}
		if (chk_box) {
			// 2. load correct values
			chk_box.checked = woas.bool2chk(woas.wsif.ds_multi);
			if (!set) {
				fn = ds;
			}
		}
		// 3. check/repair/set filename
		// convert unix path to windows path for display
		if (!str) {
			txt_box.value = is_windows ? fn.replace(reFwdSlash, '\\') : fn;
		}
	}
};

woas.ui._textbox_enter_event = woas.ui._textbox_enter_event_dummy;

// PVHL: a fake resize for current code; will fix later
woas.ui._resize = function(){return;};



//API1.0
// PVHL: Have changed help go_to system so help system works in developer mode.
//	Help pages can still be edited by opening from any WoaS::Help listing
//	If Help is open can see it in Help system and also edit the page
woas.go_to = function(cr) {
//woas.log("woas.go_to, current on entry: "+current);
	var parts = cr.split('#'), section = parts[1], r = true, mv, el, t1, t2;
	// help system handles all help pages except WoaS::Help and namespace
	// listings unless loading wiki (current not set) or in developer mode
	// and currently on a WoaS::Help page; allows help system testing
	if (current && woas.help_system.is_help(parts[0])) {
		woas.help_system.go_to(cr);
		return true;
	}
	// don't change page when editing or entering a password
	if (this.ui.edit_mode || this.ui.display('pswd')) {
		return false;
	}
	// set page
	cr = parts[0];
	if (cr && cr !== current) {
			r = this.set_current(cr, true);
	}
	if (r) {// calculate section offset (assignment intended) and move
		mv = section && (el = d$(section)) && el.offsetTop - 4 || 0;
		// PVHL: fixes all browsers; ie7 giving very strange results; good for
		// now. Sure it can be better: IE6 unfixed/IE8 need nothing! Bad CSS?
		if (el && this.browser.fh_old) {
			t1 = this.browser.ie === 7;
			t2 = this.ui.display('fix_h');
			if (t1 && !t2)
				mv += this.dom._cache.hdr.offsetHeight + 8;
			else if (!t1 && t2)
				mv -= this.dom._cache.hdr.offsetHeight;
		}
		if (cr !== 'Special::Go to') {
			this.dom._cache.scroll.scrollTop = mv || 0;
		}
	}
	return r; // if loading could pass back scroll amount: current = ''
};

function back_or(or_page) {
	if (!woas.ui.back() && or_page !== current)
		woas.set_current(or_page, true);
}

// when cancel is clicked
function cancel() {
	woas.log("Called deprecated function: cancel");
	woas.ui.cancel();
}

// @module help_system
// PVHL: TODO: Known issue: Chrome fails to find section on creation

// PVHL: Have changed code to allow removal of help system;
//	called by _on_load if help pages missing
woas.no_help = function() {
	this.help_system = {
		help: function() {
			var p = "WoaS::Help";
			if (page_titles.indexOf(p) !== -1) {
				if (woas.ui.edit_mode) {
					// just in case; shouldn't happen
					alert(woas.i18n.NO_HELP_EDIT)
				}
				else {
					woas.go_to(p);
				}
			}
		},
		is_help: function() {
			return false;
		}
	}
	woas.no_help = true;
}
woas.help_system = {
	// make it easier to change names of help pages
	_pfx: "WoaS::Help::",

	// PVHL: prefer this and all help code be from a content page
	popup_code: woas.raw_js("\
function get_parent_woas() {\n\
	return window.opener && !window.opener.closed && window.opener.woas;\n\
}\n\
function d$(id) {\n\
	return document.getElementById(id);\n\
}\n\
// if 'p' is the boolean 'true' go back, otherwise go to 'p'\n\
d$.go = function(p) {\n\
	var woas = get_parent_woas(), back = p === true;\n\
	if (woas) {\n\
		woas.help_system.go_to(\n\
			back ? woas.help_system.previous_page.pop() || '' : p, back);\n\
	}\n\
};\n\
d$.toggle = function(id) {\n\
	var d = document.getElementById(id);\n\
	d.style.display = d.offsetWidth ? 'none' : 'block';\n\
};\n\
function help_resize() {\n\
	if (window.woas && woas.db) {\n\
		var height = woas.db.offsetHeight - woas.tw.offsetHeight;\n\
		if (height !== woas.height_last) {\n\
			woas.bw.style.height = height+'px';\n\
			woas.height_last = height;\n\
		}\n\
		return true;\n\
	}\n\
	else {\n\
		return false\n\
	}\n\
}\n\
window.onunload = function() {\n\
	var w = get_parent_woas();\n\
	w = w && w.help_system;\n\
	if (w && w.popup_memory) {\n\
		w.width = window.outerWidth - w.popup_w_diff;\n\
		w.height = window.outerHeight - w.popup_h_diff;\n\
// PVHL: TODO: check early IEs in later testing; can't test right now\n\
		w.left = (window.screenLeft || window.screenX) - w.popup_l_diff;\n\
		w.top = (window.screenTop || window.screenY) - w.popup_t_diff;\n\
	}\n\
}\n\
woas = {\n\
	go_to: function(pg) {\n\
		var woas = get_parent_woas();\n\
		if (woas) {\n\
			// send help page links straight to help system (allows help page\n\
			// edit in woas.go_to plus working help system in developer mode)\n\
			if (woas.help_system.is_help(pg, true))\n\
				woas.help_system.go_to(pg);\n\
			else\n\
				woas.go_to(pg);\n\
		}\n\
	},\n\
	init: function() {\n\
		this.db = document.body;\n\
		this.tw = d$('woas_help_top_wrap');\n\
		this.t = d$('woas_help_top');\n\
		this.bw = d$('woas_help_body_wrap');\n\
		this.b = d$('woas_help_body');\n\
		window.onresize = help_resize;\n\
		window.ready = true;\n\
	},\n\
	log: function(msg) {\n\
		var w = get_parent_woas()\n\
		if (w) {\n\
			w.log(msg);\n\
		}\n\
	}\n\
}"
	),
	// Decide if page should be saved to history; allows override
	// This keeps history like a browser; includes section jumps
	back: function(p) {
		if (!(p[0] && p[0] === this.page_title)
				// uncomment next line to disallow section history
				//&& p[0]
				&& !(!p[0] && p[1] === this.page_sect)
				) {
			this.previous_page.push(this.page_title + (this.page_sect ?
				'#' + this.page_sect : ''));
		}
	},

	// the default help page title (without prefix)
	index: 'Index',

	// PVHL: check if 'pg' is a help page (DRY and hide internal details)
	// Optional 'help' is used (privately) by help system help page 'woas.go_to'
	is_help: function(pg, help) {
		// if help 'true' then page can be empty or just a section reference
		var test = help && (!pg || pg.charAt(0) === '#')
		// otherwise pages must be help prefixed
		test = test || pg && pg.indexOf(this._pfx) === 0 &&
		// and not a namespace or the help page
		pg.substr(-2) !== '::' && pg !== this._pfx;
		return help ? test :
			// and non-help_system page requests must exist (not sure why)
			test && page_titles.indexOf(pg) !== -1 &&
			// 'pg' is help unless we're in developer mode and on a help page
			!(woas.tweak.edit_override &&
			current.indexOf(this._pfx.substr(0, woas.help_system._pfx.length - 2)) === 0);
	},

	// access point for ui system: go to index unless associated page available
	// if flag: boolean tests for editing, otherwise pass on given page 'pg'
	// Rest of system can pass in '-1' and a help page minus the help namespace;
	// currently used for Tables ("Tables", -1) but might be useful for macro code
	help: function(pg, flag) {
		var t, tl, p;
		if (flag === true) {
			pg = "Editor";
		}
		else if (!flag) {
			// change the target page in some special cases
			// PVHL: this code allows CSS/plugins etc. to add help pages
			t = pg.split('::');
			tl = t.length;
			// adjust for namespace pages
			if (tl && !t[tl - 1]) {
				t.pop();
				--tl;
			}
			if (tl) {
				switch (t[0]) {
				case 'Locked':
				case 'Unlocked':
					pg = t[0];
					break;
				case 'File':
				case 'Image':
					pg = t[0] + 's';
					break
				case 'Javascript':
					pg = 'Javascript'
					break;
				case 'WoaS':
					if (tl === 4 && t[1] === 'Plugins' && t[3] === 'Help') {
						// WoaS::Plugins::xxx::Help
						p = t.join('::');
						if (page_titles.indexOf(p) === -1)
							p = '';
					}
					if (!p) {
						t = t.splice(1, tl-1);
						while (t.length) {
						// e.g. "Woas::Help::CSS::Not Found", "WoaS::Help::CSS"
							p = this._pfx + t.join('::');
							if (page_titles.indexOf(p) !== -1)
								break;
							t.pop();
							p = '';
						}
					}
				break;
				default:
// TODO: should call helper function so new items can be added by plugins
// (the above code enables two types of plugin help page, so rarely needed)
// or have a default way for user pages to have their own help pages, e.g.
// "My Pages::Some Page" gets checked for "My Pages::Some Page::Help" and
// "My Pages::Help"; walk through from end as with Woas
				}	
			}
		}
		t = null;
		this.go_to(p ? p : this._pfx + pg);
	},

	// Go to a help page or default index page
	//   - only comes here if a help page is targeted
	//   - pg is string with optional section hash, or empty string for index
	//   - help page passed in may not exist; default index used if so
	//	 - optional 'back' is used to show the back button was pushed
	go_to: function(pg, back) {
		// p = [title, section]
		var p = pg.split('#'), init = false, fail = false,
			index = this._pfx + this.index, w = this.popup_window;
		p[0] = woas.trim(p[0]);

		// check/fix correct anchor form: S###...
		p[1] = woas.parser.heading_anchor(woas.trim(p[1]), true);

		// setup for new window
		if (!w || w && w.closed) {
			init = true;
			this.previous_page = [];
			this.page_title = ''; // same as this.index;
			this.page_sect = '';
		}

		// check page exists and get content if  not a section jump
		if (!p[0] && !p[1]) {
			// no page specified (allows default index page)
			p[0] = index;
		}
		if (p[0] && p[0] !== this.page_title) {
			if (page_titles.indexOf(p[0]) === -1) {
				p[0] = index;
				// page not found so index no good
				p[1] = '';
				if (page_titles.indexOf(p[0]) === -1) {
					fail = true;
				}
			}
			if (!fail) {
				this.page_body = woas.get_text(p[0]);
			}
			if (!this.page_body || fail) {
				alert(woas.i18n.NO_HELP);
				p = null;
				return;
			}
		}

		// save previous page to history if different
		if (!back && !init) {
			// make full title for previous page
			p[3] = this.page_title + (this.page_sect ? '#'+this.page_sect : '');
			this.back(p);
		}
		this.page_title = p[0] || this.page_title;
		this.page_sect = p[1];

		// hand off to popup code
		this.popup(init);
		p = null;

		// PVHL: help page scripts are activated (allows use of examples in main
		//  window), but they can't access the help page DOM (wrong scope?).
		//  Could be fixed, though not needed at this time.
		woas.scripting.activate("page");
	},

	// PVHL: create a custom help page from scratch that works in all browsers
	// only called by this.go_to
	popup: function(init) {
		var fill = {}, w = this.popup_window;
		// generate page content
		fill.title = this.page_title + (this.page_sect ? '#'+this.page_sect : '');
		fill.top = woas.parser.parse(this.popup_page_top.sprintf(
			this.previous_page.length ? woas.i18n.HELP_BACK : woas.i18n.HELP_CLOSE,
			this.previous_page.length ? 'd$.go(true)' : 'window.close()',
			this.page_title.substr(this._pfx.length)));
		// set page if not just section jump
		if (this.page_body) {
			woas.parse_title = this.title;
			// doubt anyone needs to know this, but...
			woas.parse_help = true;
			fill.body = woas.parser.parse(this.page_body);
			this.page_body = undefined;
			woas.parse_title = "";
			woas.parse_help = false;
		}
		else {
			fill.body = '';
		}
		if (init || !w || w && w.closed) {
			// create new window
			init = true;
			w = this.popup_create(fill);
			// in case JavaScript blocked for permissions; allows resize once
			// permission granted; (only seen on IE);
			// PVHL: TODO: recheck this works with new code
			if (!w || w && w.closed) {
				// window has been closed or not created
				w = null;
				return;
			}
		}
		else {
			// fill existing window
			//w.resize = false; // turn off resize until needed
			w.document.title = fill.title;
			woas.setHTMLDiv(w.woas.t, fill.top);
			// set page if not just section jump
			if (fill.body) {
				w.woas.bw.scrollTop = 0; //stop section flash
				woas.setHTMLDiv(w.woas.b, fill.body);
			}
		}
		// timeout stops latest IE flashing taskbar; slightly faster for all
		// PVHL: TODO: check IE 8 and others
		setTimeout(this.popup_recall.sprintf(init, 0), 0);
	},

	// popup properties that need initial values
	popup_h: Math.ceil(screen.height * 0.75),
	popup_w: Math.ceil(screen.width * 0.4),
	// can't get resizing working on FF except at zoom:1; this allows macro control
	popup_memory: !woas.browser.firefox && !woas.browser.safari,
	popup_recall: "woas.help_system.popup_finish.call(woas.help_system, %s, %s)",
	// PVHL: this content should come from a page; full popup window creation
	//	here to remove delay and flash from window creation and positioning
	// params: back|close value, back|close function, display title
	popup_page_top: '<'+'input tabindex=2 class="woas_help_button" value="%s" '+
		'onclick="%s" type="button" /><'+'input tabindex=1 class="woas_help_button" '+
		'value="'+woas.i18n.HELP_INDEX+'" onclick="d$.go(\'\')" type="button" />%s',

	// PVHL: create new filled in help window; better to use page content
	popup_create: function(fill) {
		// after much research and testing only always repeatable way to get
		// focus for IE8 is to create new window
		if (woas.browser.ie === 8 && this.popup_window) {
			this.popup_window.close();
			this.popup_window = null;
		}
		// Make cross-browser size setting possible
		this.width = this.width || this.popup_w;
		this.height = this.height || this.popup_h;
		this.left = this.left || Math.ceil((screen.width - this.width) / 2);
		this.top = this.top || Math.ceil((screen.height - this.height) / 2);
		var w = this.popup_window = window.open(
				"about:blank",
				"help_popup_" + _random_string(5), // allow multiple Woas files
				"resizable=1,width=" + this.width + ",height=" + this.height +
				",left=" + this.left + ",top=" + this.top);
		if (w) {
			w.document.write("<" + "!DOCTYPE html><" + "html class='woas_help'" +
				"><" + "head><" + "title>" + fill.title + "<" + "/title><" +
				"style type='text/css'>" + woas.css.get() + '<'+'/style>' +
				this.popup_code + "<" + "/head><" + "body class='woas_help' " +
				" onload='woas.init()'><" + "div id='woas_help_top_wrap'><" +
				"div id='woas_help_top'>" + fill.top + "\n<" + "/div><" +
				"/div><" + "div id='woas_help_body_wrap'" +
				// required to allow Chrome to scroll using arrow keys; also
				// allows Opera to scroll using shift-arrows (Opera bug)
				(woas.browser.ie || woas.browser.gecko ? "" : " tabindex=3") +
				"><" + "div id='woas_help_body'>" + fill.body + "<" + "/div><" +
				"/div><" + "/body><\/" + "html>\n");
			w.document.close();
		}
		return w;
	},

	// called by this.popup to allow window to settle for section jump
	popup_finish: function(init, times) {
		var w = this.popup_window, el;
		if (!w || w && w.closed) {
			return;
		}
		// allow layout to settle
		if (!w.ready || w.help_resize() && this.page_sect &&
				w.woas.db.offsetHeight < w.woas.bw.offsetHeight) {
			if (times < 5) {
				setTimeout(this.popup_recall.sprintf(init, ++times), 0);
				woas.log("popup_finish: "+times);
			}
			else {
				woas.log("popup failed");
			}
			return;
		}
		if (init && this.popup_memory) {
			this.popup_w_diff = w.outerWidth - this.width;
			this.popup_h_diff = w.outerHeight - this.height;
			this.popup_l_diff = (w.screenLeft || w.screenX) - this.left;
			this.popup_t_diff = (w.screenTop || w.screenY) - this.top;
		}
		el = this.page_sect && w.d$(this.page_sect);
		w.woas.bw.scrollTop = el ? el.offsetTop - 4 : 0;
		w.focus();
		w.woas.bw.focus();
		return;
	},

	readout: function(more) {
		var h = this.popup_window && this.popup_window.woas;
		if (!h) {
			woas.log("readout: no popup woas");
			return;
		}
		woas.log('bH:' + h.db.offsetHeight + ', bW:' + h.db.offsetWidth +
			', bcwH:' + h.bw.offsetHeight + ', bcH:' + h.b.offsetWidth +
			', tH:' + h.tw.offsetHeight + (more ? ', ' + more : ''));
	}
};

function hdr_dblclick() {
	if (!woas.ui.edit_mode)
		woas.ui.set_header(-1); // toggle
}

function menu_dblclick() {
	var ui = woas.ui;
	if (woas.config.dblclick_edit) {
		ui.edit_menu();
	} else {
		ui.set_menu(-1);
	}
}

function page_dblclick() {
	if (woas.config.dblclick_edit)
		edit();
}

// Used by search boxes
// PVHL: any custom search box sets 'custom' flag
// More than one may be active at a time now.
// 'el' is used by woas.do_search to get the search string
woas.ui.search_focus = function (el, custom) {
	// next two should be optional params to focus_textbox
	if (custom && current === "Special::Search") {
		// trigger focus event
		d$('special_search').select();
		woas.ui.top();
	} else {
		woas.ui._textbox_enter_event = woas.do_search;
		woas.ui._textbox_enter_el = el;
		woas.ui.focus_textbox();
	}
};

// PVHL: method retained for compatibility' sake, but should be in ui
//   or a search namespace; can still be used as before with str.
//   'this' may belong to a key handler
woas.do_search = function(str) {
	// assume keyboard call
	if (!str) {
		// el should have been set by search box
		var el = woas.ui._textbox_enter_el;
		str = el ? el.value : '';
	}
	if (!str) {
		return;
	}
	// clear previous search results
	woas.ui.clear_search(true);
	// cache new search results
	woas._cache_search(str);
	// refresh the search page, or go to it if we are not there
	woas.ui._search_render();
};

// must only be called by Special::Options page
// PVHL: added disable and woas.no_help; no_help is ONLY set by _on_load
function save_options(btn) {
	if (!btn.disable && woas.config.permit_edits) {
		woas.cfg_commit();
		// reloads page without killing forward history
		woas.set_current(current, true, true);
		btn.disable = false;
	}
	else if (!woas.config.permit_edits) {
		// shouldn't ever get here; read-only now disables the controls
		alert(woas.i18n.READ_ONLY);
	}
}

function no_help_woas() {
	// give warning
	if (confirm(woas.i18n.NO_HELP_WARN + woas.i18n.CHOOSE_CANCEL)) {
		woas.config.no_help = true;
		woas.ui.display({no_help: true});
		woas.commit();
		// this causes all browsers to reload file
		window.location = window.location;
	}
}

function ro_woas() {
	if (!woas.config.permit_edits) {
		alert(woas.i18n.WRITE_PROTECTED);
		return false;
	}
	if (confirm(woas.i18n.CONFIRM_READ_ONLY + woas.i18n.CHOOSE_CANCEL)) {
		woas.config.permit_edits = false;
		woas.ui.display({ro:true}); // turn off icons
		woas.cfg_commit();
		// reloads page without killing forward history
		woas.set_current(current, true, true);
	}
}

// Used by Special::Lock
function lock_page(e) {
	// PVHL: see my notes for woas._password_ok for flag use discussion
	var flag = e ? e.keyCode === 13 : true, pw1, pw2;
	if (flag) {
		pw1 = d$("pw1");
		pw2 = d$("pw2");
		if (!woas.currently_locking || !pw1 || !pw2) {
			return;
		}
		if (!pw1.value.length) {
			pw1.focus();
			return;
		}
		if (!pw2.value.length) {
			pw2.focus();
			return;
		}
		if (pw1.value !== pw2.value) {
			alert(woas.i18n.PWD_ERROR);
			pw2.focus();
			return;
		}
		woas.AES.setKey(pw1.value);
		woas._finalize_lock(woas.page_index(woas.currently_locking), true);
	}
	return true;
}

// used in Special::Options
woas.bool2chk = function(b) {
	if (b) return "checked";
	return "";
};

function set_key() {
	woas._set_password();
}

// below function is used by Special::Lock

var _pw_q_lock = false;

function pw_quality() {
	if (_pw_q_lock)
		return;
	_pw_q_lock = true;

	// used to get a red-to-green color tone
	function _hex_col(tone) {
		var s=Math.floor(tone).toString(16);
		if (s.length==1)
			return "0"+s;
		return s;
	}

	// original code from http://lxr.mozilla.org/seamonkey/source/security/manager/pki/resources/content/password.js
	var pw=d$('pw1').value;

	//length of the password
	var pwlength=pw.length;
	
	if (pwlength!==0) {

	//use of numbers in the password
	  var numnumeric = pw.match(/[0-9]/g);
	  var numeric=(numnumeric!==null)?numnumeric.length/pwlength:0;

	//use of symbols in the password
	  var symbols = pw.match(/\W/g);
	  var numsymbols= (symbols!==null)?symbols.length/pwlength:0;

	//use of uppercase in the password
	  var numupper = pw.match(/[^A-Z]/g);
	  var upper=numupper!==null?numupper.length/pwlength:0;
	// end of modified code from Mozilla
	
	var numlower = pw.match(/[^a-z]/g);
	var lower = numlower!==null?numlower.length/pwlength:0;
	
	var u_lo = upper+lower;
	  
	// 80% of security defined by length (at least 16, best 22 chars), 10% by symbols, 5% by numeric presence and 5% by upper case presence
	var pwstrength = ((pwlength/18) * 65) + (numsymbols * 10 + u_lo*20 + numeric*5);
	
	var repco = woas.split_bytes(pw).toUnique().length/pwlength;
	if (repco < 0.8)
		pwstrength *= (repco+0.2);
//		woas.log("pwstrength = "+(pwstrength/100).toFixed(2)+", repco = "+repco);	// log:1
	} else
		pwstrength = 0;
  
	var color;
    if (pwstrength>100)
		color = "#00FF00";
	else
		color = "#" + _hex_col((100-pwstrength)*255/100) + _hex_col((pwstrength*255)/100) + "00";
  
	d$("pw1").style.backgroundColor = color;
	woas.setHTMLDiv(d$("txtBits"), woas.i18n.PWD_KEY_SIZE.sprintf(pwlength*8));

	_pw_q_lock = false;
}

// used by embedded file show page
function show_full_file(pi) {
	var text = woas.get__text(pi);
	if (text===null)
		return;
	// put in the whole file content
	woas.setHTML(d$('_part_display'), woas.parser._raw_preformatted("pre",
		woas.base64.decode(text), 'woas_embedded'));
}

function query_export_file(cr, txt) {
	var fn = cr.substr(cr.indexOf("::")+2);
	if (confirm(woas.i18n.CONFIRM_EXPORT.sprintf(cr)+"\n\n"+woas.ROOT_DIRECTORY+fn))
		woas.export_file(cr, woas.ROOT_DIRECTORY+fn, txt);
}

function query_export_image(cr) {
	var img_name = cr.substr(cr.indexOf("::")+2);
	if (confirm(woas.i18n.CONFIRM_EXPORT.sprintf(img_name)+"\n\n"+woas.ROOT_DIRECTORY+img_name))
		woas.export_image(cr, woas.ROOT_DIRECTORY+img_name);
	return false;
}


function query_delete_file(cr) {
	if (!confirm(woas.i18n.CONFIRM_DELETE.sprintf(cr)))
		return;
	// do not check for plugin deletion here
	woas.delete_page(cr);
	return false;
}

// delayed function called after page loads and runs the script tag
// fail is good img load:undefined, img load error:true, ie6 (no display):-1
function _img_properties_show(mime, tot_len, enc_len, mts, fail) {
	var img ='woas_img_tag', html = '';
	if (fail === true) {
		html = woas.i18n.IMG_LOAD_ERR;
		d$.hide(img);
	}
	else if (fail === undefined) {
		img = d$(img);
	}
	html +=	"\n"+woas.i18n.MIME_TYPE+": "+mime+"\n"+
		woas.i18n.FILE_SIZE+": about "+_convert_bytes(((tot_len-enc_len)*3)/4, 1)+
		woas.i18n.B64_REQ.sprintf(_convert_bytes(tot_len, 1))+
		"\n"+woas.last_modified(mts)+(fail ? ''
		: "\n"+woas.i18n.WIDTH+": "+img.width+"px\n"+
		woas.i18n.HEIGHT+": "+img.height+"px");
	if (fail !== -1) {
		woas.setHTMLDiv(d$('woas_img_desc'), woas.parser.parse(html));
		return false;
	}
	else {
		return html;
	}
}

function query_delete_image(cr) {
	if (!confirm(woas.i18n.CONFIRM_DELETE_IMAGE.sprintf(cr)))
		return;
	// do not check for plugin deletion here
	woas.delete_page(cr);
	return false;
}

// triggered by UI graphic button
// PVHL: print CSS now controlled by CSS (section /* PRINT */) to allow change
//   by those who use the print window for presentations.
//   Could use custom print css read from WoaS::CSS::Print instead
// Have modified so IE doesn't use JS; one less thing to worry about; perhaps
// should remove for everyone because of modern browser paranoia
function page_print() {
	var t = "WoaS Print - " + current;
	if (!woas.popup_window || woas.popup_window.closed) {
		woas.popup_window = woas.popup(
			"woas_print_popup",
			Math.ceil(screen.width*0.75),
			Math.ceil(screen.height*0.75),
			",status=yes,menubar=yes,resizable=yes,scrollbars=yes",
			"<"+"title>" + t + "<"+"/title>" + "<"+"style type=\"text/css\">" +
				woas.css.get() + "<"+"/style>" +(woas.browser.ie ? '' :
				woas.raw_js('woas={};woas.go_to=function(page){alert("' +
					woas.js_encode(woas.i18n.PRINT_MODE_WARN)+'")};' +
				'd$={};d$.toggle=function(id){var d=document.getElementById(id);' +
				'd.style.display=d.offsetWidth?"none":"block"}')),
			'<'+'h1 class="woas_print_title">'+current+'<'+'/h1>'+
				woas.getHTMLDiv(d$("woas_page")),
			' id="woas_page" class="woas_print"');
	} else {
		woas.setHTMLDiv(woas.popup_window.document.body,
			'<'+'h1 class="woas_print_title">'+current+'<'+'/h1>'+
			woas.getHTMLDiv(d$('woas_page')));
		woas.popup_window.document.title = t;
		woas.popup_window.focus();
	}
}

/*
This function is no longer used by the help system; print_popup is hardwired?
Also no longer used by the page_print function (want print to be customizable),
but left here just in case it's used by custom code
*/
woas._customized_popup = function(page_title, page_body, additional_js,
		additional_css, body_extra) {
	if (additional_js.length)
		additional_js = woas.raw_js(additional_js);
	// create the popup
	return woas.popup(
		"woas_popup",
		Math.ceil(screen.width*0.75),
		Math.ceil(screen.height*0.75),
		",status=yes,menubar=yes,resizable=yes,scrollbars=yes",
		// head
		"<"+"title>" + page_title + "<"+"/title>" + "<"+
		"style type=\"text/css\">"+ woas.css.get() + additional_css +
		"<"+"/sty" + "le>" + additional_js, page_body, body_extra
	);
};

// below functions used by Special::Export

// PVHL: blob saving disabled until it works cross-browser
//	WSIF path will always be in correct slash format if from export page
// TODO: rewrite page/code to use full path consistent with other pages
// TODO: use wsif author and woas author, and save both in config
woas.export_wiki_wsif = function () {
	var i = woas.i18n, file, dir, author, single_wsif, all_wsif, done, no_help;
	try {
		// resolve filename as a relative path and warn if empty
		file = d$.file(d$("woas_ep_path").value, -2, true);
		fname = file.name;
		dir = woas.ROOT_DIRECTORY + file.path;
		all_wsif = !!d$("woas_cb_all_wsif").checked; // PVHL: TODO: is !! an old IE issue?
		no_help = !!d$("woas_cb_no_help").checked;
		// if using wsif as a data source bad path could corrupt your data
		//	- same path and not all pages will overwrite content with index
		//	- same path all pages is not harmful but pointless
		//	- same directory is just a bad idea, but probably won't cause harm
		d$("woas_ep_path").value = file.path + file.name;
		// check that save is wanted
		if (dir + file.name === woas.config.wsif_ds) {
			alert((all_wsif ? i.FILE_ENTRY_SAME_PATH1 :
				i.FILE_ENTRY_SAME_PATH2) + FILE_ENTRY_SAME_PATH3);
			return;
		}
		single_wsif = !d$("woas_cb_multi_wsif").checked;
		author = this.trim(d$("woas_ep_author").value);
		if (!confirm(i.FILE_SAVE.sprintf(dir + file.name)))
			return;
		done = this._native_wsif_save(
			dir, file.name, single_wsif, author, all_wsif, no_help);
		if (done)
			this.alert(i.EXPORT_OK.sprintf(done, this.wsif.expected_pages));
		else
			this.alert(i.SAVE_ERROR.sprintf(file.name));
	}
	catch (e) {
		this.crash(e);
		return;
	}
};

// create a centered popup given some options
woas.popup = function(name,fw,fh,extra,head,body, body_extra, html_extra) {
	name += '_'+_random_string(5); // allow multiple Woas files to be active
	body_extra = body_extra || "";
	html_extra = html_extra || "";
	var hpos=Math.ceil((screen.width-fw)/2),
		vpos=Math.ceil((screen.height-fh)/2),
		wnd = window.open("about:blank",name,"width="+fw+",height="+fh+
			",left="+hpos+",top="+vpos+extra);
	wnd.document.write("<"+"!DOCTYPE html><"+"html"+html_extra+"><"+"head>"+head+
		"<"+"/head><"+"body"+body_extra+">"+body+"<"+"/body><\/"+"html>\n");
	wnd.document.close();
	return wnd;
};

woas._hl_marker = _random_string(10)+":%d:";
woas._hl_marker_rx = new RegExp(woas._hl_marker+":(\\d+):", "g");

// display search results
woas._search_load = function() {
//	woas.log("called _search_load()");	//log:0
	var out = [], total = 0, count, i, it, ib, r, a, at, cbs, bm, bma, s, tmp,
		wp = woas.parser,
		hl_marker = _random_string(10)+":%d:",
		hl_marker_rx = new RegExp(hl_marker+":(\\d+):", "g"),
		hd = '<p %sclass="woas_search_head">%s<\/p><ul>\n',
		sstr = '<em>%s <span class="woas_search_highlight">%s<\/span><\/em>',
		hl = '<\/span> <span class="woas_search_highlight">',
		li = '<li><a class="woas_link" title="" onclick="woas.go_to(\'%s\')">'+
			'%s<\/a>%s<\/li>',

		// TODO: add these to i18n if search doesn't become single page
		fnd_t = 'Found in %s title%s',
		fnd_p = 'Found %s time%s in %s page%s',
		fnd_n = ' - found <b>%s<\/b> time%s',
		nres = 'The last search did not find',
		res = 'Last search results for';

	// Load options; names will change once search is a namspace object
	// these should be in a page script, not here.
	d$('woas_search_options', this.search_options);
	d$('woas_search_cb_help').checked = woas.bool2chk(this.search_help);
	d$('woas_search_cb_words').checked = woas.bool2chk(this.search_word);
	d$('woas_search_cb_phrase').checked = !woas.bool2chk(this.search_word);
	d$('woas_search_word', this.search_word);
	d$('woas_search_cb_case').checked = woas.bool2chk(this.search_case);
	d$('woas_search_cb_inline').checked = woas.bool2chk(this.search_inline);
	d$('woas_search_cb_start').checked = woas.bool2chk(this.search_start);
	d$('woas_search_cb_end').checked = woas.bool2chk(this.search_end);
	d$('woas_search_txt_context').value = this._nearby_chars;
	d$('woas_search_txt_length').value = this._match_length;
	d$('woas_search_txt_context').onfocus = d$('woas_search_txt_length').onfocus
		= woas.ui.focus_textbox;
	d$('woas_search_txt_context').onblur = d$('woas_search_txt_length').onblur
		= woas.ui.blur_textbox;

	if (this._last_search) {
		// position cursor back in search box with text selected
		tmp = d$("special_search");
		tmp.value = this._last_search;
		tmp.select();

		// prepare search term
		tmp = woas.xhtml_encode(this._last_search);
		if (this.search_word) {
			tmp = tmp.replace(/\s+/g, hl);
		}
		// proceed to parsing if there are matching pages
		it = this._cached_title_search.length;
		ib = this._cached_body_search.length;
		if (it + ib === 0) {
			out.push(sstr.sprintf(nres, tmp));
		} else {
			out.push(sstr.sprintf(res, tmp));

			// (1) prepare the title results
			if (it > 0) {
				out.push(hd.sprintf('', fnd_t.sprintf(it, it === 1 ? '':'s')));
				for(i = 0; i < it; ++i) {
					tmp = this._cached_title_search[i];
					out.push(li.sprintf(tmp, tmp.replace(woas._reLastSearch,
						function(str) {
							return '<span class="woas_search_highlight">'+str+
								'<\/span>';
						}), '') + '\n');
				}
				out.push('<\/ul>\n');
			}

			// (2) parse the page text snippets
			if (ib > 0) {
				out.push(hd.sprintf('id="woas_search_pages" ', '&nbsp;'));
				for(i = 0; i < ib; ++i) {
					count = 0, r = [], s = [];
					cbs = this._cached_body_search[i], bm = cbs.matches;
					// create pre sections
					for (a = 0, at = bm.length; a < at; ++a) {
						// apply highlighting
						bma = woas.xhtml_encode(
							bm[a].replace(this._reLastSearch, function(str) {
								++count;
								s.push('<span class="woas_search_highlight">'+
									woas.xhtml_encode(str)+'<\/span>');
								return  wp.marker+(s.length-1)+';';
						}));
						if (s.length) {
							bma = bma.replace(wp.reBaseSnippet,
								function (str, $1) {return s[parseInt($1)];});
						}
						r.push('<pre class="woas_search_results">\n'+
							bma+'<\/pre>\n');
					}
					total += count;
					// output page
					out.push(li.sprintf(cbs.title, cbs.title, fnd_n
						.sprintf(count, count > 1 ? 's' : '')) + r.join(''));
				}
			}
		}
	}

	// finally output XHTML content
	woas.setHTMLDiv(d$('woas_search_results'), out.join(''));
	// and update page totals
	if (ib > 0) {
		woas.setHTMLDiv(d$('woas_search_pages'),
			fnd_p.sprintf(total, total === 1 ? '':'s', ib, ib === 1 ? '':'s'));
	}
	out = s = r = null;
};

var _servm_shown = false;

function _servm_alert() {
	if (woas._server_mode) {
		// show the message only once
		if (!_servm_shown) {
			woas.alert(woas.i18n.SERVER_MODE);
			_servm_shown = true;
		}
	}
}

woas.update_view = function() {
	var v = {view: true, edit: false, no_help: false};
	v.no_back = !this.history.has_backstack();
	v.no_fwd = !this.history.has_forstack();
	v.no_home = current === this.config.main_page;
	v.no_tools = current === "Special::Advanced";
	v.no_edit = !this.edit_allowed(current);
	/* turn correct lock/unlock icons on/off then disable/enable them both */
	v.locked = this.is_encrypted(current);
	v.unlocked = !v.locked;
	v.no_lock = !this.config.permit_edits || this.is_reserved(current);
	this.ui.display(v, true);
};

// Creates the woas._resize function; called from woas.dom.init.
// document.documentElement.clientHeight works in all browsers so
// window.height not used; old IEs don't have window.height.
woas._resize = function() {
	// keep pointers so no need to exit scope
	var doc = document.documentElement, dc = woas.dom._cache, body = dc.body,
		hdr = dc.hdr, ui = woas.ui, ss = dc.scroller.style,
		e = dc.ed, old_h = e.offsetHeight, es = e.style;
	return function() {
		var h, fh = ui.display('fix_h');
		// adjust height of edit control
		if (ui.edit_mode) {
			ss.paddingTop = "0px";
			// h - 1 for early IE and Opera; not sure why yet?
			h = e.offsetHeight + doc.clientHeight - body.clientHeight - 1;
			h = h < 90 ? 90 : h; // about 5 lines minimum
			if (h !== old_h) {
				// Opera can't directly set height (offset/client); using style
				es.height = h + 'px';
				old_h = h;
			}
		}
		// adjust scroller top for fixed header in case of two line titles
		else if (fh) {
			h = hdr.clientHeight;
			// PVHL: my old fixed header didn't change the scrollbar
			if (woas.browser.fh_old) {
				if (h !== parseFloat(ss.paddingTop))
					ss.paddingTop = h + 'px';
			}
			else {
				if (h !== parseFloat(ss.top))
					ss.top = h + 'px';
			}
		}
		else if (woas.browser.fh_old) {
			ss.paddingTop = "0px";
		}
	}
};

woas._set_debug = function(status, closed) {
	// private variables
	var logbox = d$('woas_debug_log');
	if (status) {
		var cut = 100, max = 200, // cut > 0, max > cut
			// simple log was used earlier for code being loaded
			lines = this.temp_log ? this.temp_log.length - 1 : -1,
			position = lines < cut ? 0 : logbox.value.length;
		logbox.value = this.temp_log ? this.temp_log.join('\n') : '';
		// PVHL: may have weakness of having to reload file in old Operas
		// if dragonfly console closed; can't easily test & seems OK if so
		if (woas.browser.opera && !(window.console && console.log))
			console = {log: opera.postError};
		if (window.console && logbox.value)
			console.log(logbox.value);
		// logging function - used in development; call without argument to
		// scroll to bottom and see if we are in debug mode
		woas.log = function (msg) {
			if (msg) {
				if (!woas.tweak.integrity_test) {
					// log up to max lines; 'cut' lines removed if too big
					if (++lines === max) { // lines now lines before this post
						logbox.value = logbox.value.substring(position);
						lines = max - cut;
					} else if (lines === cut) {
						position = logbox.value.length;
					}
				}
				logbox.value += '\n' + msg;
				window.console ? console.log(msg) : null;
			}
			// keep the log scrolled down
			logbox.scrollTop = logbox.scrollHeight;
			return true;
		};
	} else {
		logbox.value = '';
		//woas.log = function() { return false; };
		// perhaps a better 'no debug' function; html log slows things down, but
		// writing to console, when present, seems very fast; good for developing
		woas.log=function(msg){if(msg && window.console)console.log(msg);return false};
	}
	delete this.temp_log;
	// set-up debug icon and display
	this.ui.display({no_debug: !status, no_log: status? closed : true});
	window.log = woas.log; // for deprecated function - legacy.js
};

/*
PVHL:
  this function (was refresh_menu_area) now sets the menu using the highest
  namespace menu found for much greater flexibility and better looks.
  If people have problems with this I'll write an update plugin to put
  menu at beginning of sub-menu.

  I've added a hack to allow the menu to be parsed before the page being set,
  but the page/menu set/edit all needs a rewrite.
*/
woas.ui.refresh_menu = function(curr) {
	var pi, menu, ns, tmp;
	curr = curr || current;
	// locate the menu for current namespace, or a previous one if not found
	// (all the way back to ::Menu if need be). Menu is set every time, though
	// I will see if it makes sense not to for ns=''. There are issues with
	// this, though, and I had to disable optional loading in original code.
	// For now no special menus for any core pages - nice to have later.
	if (curr.indexOf('WoaS::') === 0 || curr.indexOf('Special') === 0) {
		tmp = -1;
	} else {
		tmp = curr.lastIndexOf("::");
	}
	ns = tmp > 0 ? curr.substr(0, tmp) : '';
	while (true) {
//		woas.log("menu testing "+ns+"::Menu");	// log:0
		pi = woas.page_index(ns+"::Menu");
		if (pi !== -1 || !ns) { break; }
		tmp = ns.lastIndexOf("::");
		ns = tmp === -1 ? "" : ns.substr(0, tmp);
	}
	// PVHL: changed to set something else display messed up if menu not found
	menu = pi === -1 ? 'ERROR: No menu!' : woas.get__text(pi);
	woas.parser._parsing_menu = true;
	// macro code requires that menu is always parsed before page
	woas.macro.reset(true);
	woas.setHTMLDiv(d$("woas_menu"),
		woas.parser.parse(menu, woas.js_mode(ns+"::Menu")));
	woas.parser._parsing_menu = false;
	if (!ns) {
// PVHL: TODO: why not done for ns; why done every time; change to when needed
		woas.scripting.clear("menu");
		woas.scripting.activate("menu");
	}
};

// adapted by PVHL from: weston.ruter.net/2009/05/07/detecting-support-for-data-uris
woas.ui.img_display = function() {
	function loaded(el, fail){ /*alert(el.width+" "+el.height);*/
		if (fail || el.width !== 1 || el.height !== 1) {
			woas.ui.display({no_img: true});
		}
		img = undefined;
	}
	var img = new Image();
	img.onload = function() {/*alert("onload");*/loaded(this);};
	img.onerror = function() {/*alert("onerror");*/loaded(this, true);};
	img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
};

woas.menu_display = function(id, visible, opaque) {
	// toolbar images now controlled through anchor tag; dim instead of hiding
	i=id; id = d$('woas_' + id);
	opaque = opaque || false;
	var c = opaque ? 'woas_disabled' : 'woas_hide', ic = id.className, p = ic.indexOf(c);
	if (visible && p !== -1) {
		if (p) {
			id.className = ic.substr(0, ic[p - 1] === ' ' ? p - 1 : p) + ic.substr(p + c.length);
		} else {
			id.className = ic.substr(c.length + (ic.length > c.length && ic[c.length + 1] === ' ' ? 1 : 0));
		}
	} else if (!visible && p === -1) {
		id.className += (ic.length ? ' ' : '') + c;
	}
};

woas.refresh_mts = function(mts) {
	// generate the last modified string to append
	if (mts) {
		this.setHTMLDiv(d$("woas_mts"), this.last_modified(mts));
		this.ui.display({"no_mts": false});
	} else
		this.ui.display({"no_mts": true});
};

woas._set_title = function (new_title) {
	this.setHTMLDiv(this.dom._cache.title, this.create_breadcrumb(new_title));
	document.title = new_title;
};

// function which hooks all messages shown by WoaS
// can be fed with multiple messages to show consecutively
woas.alert = function() {
	for(var i=0,l=arguments.length;i < l;++i) {
		alert("WoaS: "+arguments[i]);
		this.log("WoaS: "+arguments[i]);
	}
};

// same as above, but for unhandled errors
woas.crash = function() {
	for(var i=0,l=arguments.length;i < l;++i) {
		alert("WoaS Unhandled error\n----\n"+arguments[i]);
		this.log("WoaS Unhandled error\n----\n"+arguments[i]);
	}
};

// PVHL: have simplified usage (here just to document):
//   set by 'Lock::' in 'set_current', cleared by load_as_current.
woas.currently_locking = '';
// initialize page on loading; called from Special::Lock page
function _lock_page() {
	// do not call if not in a page locking context
	if (woas.currently_locking) {
		d$("btn_lock").value = woas.i18n.LOCK_PAGE.sprintf(woas.currently_locking);
		d$("pw1").focus();
	}
}

function _woas_new_plugin() {
	var title = woas._prompt_title("Please enter plugin name", "Myplugin", true);
	if (title === null)
		return;
	var def_text;
	// provide special include page support
	// --UNSUPPORTED FEATURE--
	if (title.charAt(0) === '@') {
		def_text = "plugins/"+title.substr(1)+".js\n";
	} else {
		def_text = "/* "+title+" plugin */\n";
	}
	woas._create_page_direct("WoaS::Plugins", title, false, def_text);
	// now we will be editing the plugin code
}

/*
woas.css.ff2 (string:valid CSS): css added if browser == ff2 when !raw 
woas.css.set(css, raw)
  css (string:valid CSS): the raw css to be set; replaces old css
  raw (boolean, optional): if true browser fixes will not be applied to css
woas.css.get(): returns currently set CSS (string:valid CSS)
*/
woas.css = {
	// PVHL: these probably aren't needed anymore - check.
	//   need to replace these with browser specific CSS ability in core
	FF2: "\npre { white-space: -moz-pre-wrap !important; }\n",
	IE: "\npre { word-wrap: break-word !important; }\n",
	// current Opera flags this as an error
	OPERA: "\npre { white-space: -o-pre-wrap !important; }\n",

	init: function() {
		// only IE/Trident has cssText
		this.stylesheet = document.styleSheets[0].cssText ?
			document.styleSheets[0] : document.getElementsByTagName("style")[0];
		// save checking for IE every time
		this.cssText = typeof this.stylesheet.cssText === "string";
		this.set(woas.get_text("WoaS::CSS::Core")+"\n"+
			woas.get_text("WoaS::CSS::Custom"));
	},

	// TODO: replace with factory function for just this browser
	set: function(css, raw) {
		// add some browser-specific wrapping fixes
		// PVHL: TODO: replace with classes; e.g. .woas_ie6
		if (!raw) {
			if (woas.browser.firefox2)
				// fixes are added first so they can be overridden
				// (although they have an !important property attribute)
				css = this.FF2 + css;
			else if (woas.browser.trident)
				css = this.IE + css;
			else if (woas.browser.presto)
				css = this.OPERA + css;
		}
		if (this.cssText)
			this.stylesheet.cssText = css;
		else
		// Setting innerText was causing a 13 second delay in Chrome!
		// Recent versions of Chrome/Safari (AppleWebKit Windows) seem to be OK with innerHTML
			this.stylesheet.innerHTML = css;
	},
	
	// Not used/needed in public API; can't see the need to use it either,
	// except to read the CSS, replace, say a colour value, and reset: generally
	// not a good idea, and only good for that session; change the CSS page.
	// cssText and innerHTML have different forms: IE splits out the rules that
	// have commas in them
	get: function() {
		return this.cssText ? this.stylesheet.cssText :
		// on Chrome/Safari innerHTML contains br tags
		// PVHL: Above is no longer true (see css.set) - was this an early WebKit issue?
			this.stylesheet.innerHTML;
	}
};

/*
woas.ui.display() closure
	pfx:(private) defines the prefix that will be added to all CSS classes
	state: (private) used to track current control state
	dsp is either:
	  (1) object passed to display to set new state;
	       - any dsp key that tests true (on:true|toggle:-1) is set in state
		   - any dsp key that tests false is reset in state if it exists
	  (2) a string that will be tested to see if such a key is set.
	      Possibilities are:
	         view, edit, pswd, wait, locked, unlocked, ro, fix_h, fix_m,
	         no_img, no_back, no_fwd, no_home, no_tools, no_edit, no_lock,
			 no_log, no_debug, no_mts
	      Plug-ins can add anything desired; everything controlled through CSS.
*/
// 
woas.ui.display = (function() {
	var pfx = 'woas_', state = {};
	// PVHL: some more changes coming; function not finished
	//	may add ability to use 'on', 'off', 'toggle' strings
	return function(dsp, resize) {
		var clas, s = [], c;
		// dsp can be used to retrieve display info if it is a string
		if (typeof dsp === 'string') {
			if (dsp === 'pfx') {
// this is for later system/plugin use, if needed: e.g. BoaS; changing without
// also changing CSS prefixes (also coming) will wreck display.
				if (resize && typeof resize === 'string') {
					pfx = resize; // new prefix for ALL wiki css
				}
				return pfx;
			}
			return !!state[dsp];
		}
		if (woas.browser.ie6) {
			// ie6 can't do fixed - should rarely get here
			dsp['fix_h'] !== undefined ? delete dsp['fix_h'] : null;
			dsp['fix_m'] !== undefined ? delete dsp['fix_m'] : null;
		}
		for (clas in dsp) {
			if (dsp.hasOwnProperty(clas)) {
				// toggle class
				if (dsp[clas] === -1) {
					dsp[clas] = !state[clas];
				}
				if (dsp[clas] /* add test for 'ok' member here */) {
					state[clas] = true;
				} else if (state[clas] && state.hasOwnProperty(clas)) {
					state[clas] = false;
				}
			}
		}
		// set which element receives scroll positioning if changed
		if (dsp['fix_h'] !== undefined) {
			c = woas.dom._cache;
			c.scroll = dsp['fix_h'] && !state['old_fix_h'] ?
				c.scroller : c.scrollAll;
			this.focus(); // make sure arrow keys work
		}
// Change function to properly add/remove classes? Current method has advantage
// that class change is done atomically; would change allow faster rendering?
		for (clas in state) {
			if (state[clas] && state.hasOwnProperty(clas)) {
				s.push(pfx + clas);
			}
		}
		woas.dom._cache.ui_display.className = s.join(' ');
		if (resize)
			this._resize();
		return dsp; // shows state if toggle used
	}
}());

/*** src/editor.js ***/
// @module ui.editor
// this sub-module shall contain the whole editor code
woas.ui.editor = {
	_insert_ruler: function() {
		TagThis("\n----\n", "");
	}
};

// class for managing textarea selection - by pr0xy
function TextAreaSelectionHelper(obj) {
	this.target=obj;
	this.target.carretHandler=this; // adds itself to textarea object
	this.target.onchange=_textareaSaver;
	this.target.onclick=_textareaSaver;
	this.target.onkeyup=_textareaSaver;
	this.target.onfocus=_textareaSaver;
	//if(!document.selection)
		//this.target.onSelect=_textareaSaver; // not IE
	this.start=-1;
	this.end=-1;
	this.scroll=-1;
	this.iesel=null;
}

TextAreaSelectionHelper.prototype.getSelectedText=function() {
	if (this.iesel)
		return this.iesel.text;
	// Fixes a problem in FF3 where the selection was not being stored in
	// this.start and this.end when selecting multilines
	this.start = woas.dom._cache.ed.selectionStart;
	this.end = woas.dom._cache.ed.selectionEnd;
	return ((this.start>=0)&&(this.end>this.start))? this.target.
		value.substring(this.start,this.end): "";
};

TextAreaSelectionHelper.prototype.setSelectedText=function(text, secondtag) {
	if (this.iesel) {
		if (typeof(secondtag)=="string") {
			var l=this.iesel.text.length;
			this.iesel.text=text+this.iesel.text+secondtag;
			this.iesel.moveEnd("character", -secondtag.length);
			this.iesel.moveStart("character", -l);
		} else {
			this.iesel.text=text;
		}
		this.iesel.select();
	} else if (this.start>=0 && this.end>=this.start) {
		var left=this.target.value.substring(0,this.start);
		var right=this.target.value.substr(this.end);
		var scont=this.target.value.substring(this.start, this.end);
		if (typeof(secondtag)=="string") {
			this.target.value=left+text+scont+secondtag+right;
			this.end=this.target.selectionEnd=this.start+text.length+scont.length;
			this.start=this.target.selectionStart=this.start+text.length;
		} else {
			this.target.value=left+text+right;
			this.end=this.target.selectionEnd=this.start+text.length;
			this.start=this.target.selectionStart=this.start+text.length;
		}
		this.target.scrollTop=this.scroll;
		this.target.focus();
	} else {
		this.target.value += text + ((typeof(secondtag)=="string")? secondtag: "");
		if (this.scroll>=0) this.target.scrollTop=this.scroll;
	}
};

TextAreaSelectionHelper.prototype.getText=function() {
	return this.target.value;
};

TextAreaSelectionHelper.prototype.setText=function(text) {
	this.target.value=text;
};

function _textareaSaver() {
	if (document.selection) {
		this.carretHandler.iesel = document.selection.createRange().duplicate();
	} else if(typeof(this.selectionStart)!="undefined") {
		this.carretHandler.start=this.selectionStart;
		this.carretHandler.end=this.selectionEnd;
		this.carretHandler.scroll=this.scrollTop;
	} else
		this.carretHandler.start=this.carretHandler.end = -1;
}

function TagThis(starttag, endtag){
	var sel = woas._editor.getSelectedText();
	if (sel)
		woas._editor.setSelectedText(starttag+sel+endtag);
	else
		woas._editor.setSelectedText(starttag, endtag);
}

function DivTagThis(align) {
	TagThis('<'+'div align="'+align+'">', '<'+'/div>');
}

function FullTagThis(tag){
	TagThis('<'+tag+'>','<'+'/'+tag+'>');
}

function macroTagThis(tagone, tagtwo) {
	tagtwo = typeof tagtwo === 'undefined' ? '' : '("' + tagtwo + '")';
	TagThis('<<' + tagone + tagtwo + ':\n', '\n>>');
}

function setWikiImage() {
	setImage('[[Include::Image::',']]');
}

function setHTMLImage() {
	setImage('<'+"img src='","' /"+">");
}

function setUrl(starttag,centertag,endtag) {
	var comm, url = prompt('Link:', 'http://');
	if (!url)
		return;
	// assume prompt cancel means 'I don't want link text'
	comm = woas._editor.getSelectedText() || prompt('Link text:', url) || url;
	if (comm === url && centertag === '|')
		comm = centertag = '';
	woas._editor.setSelectedText(starttag+woas.js_encode(url)+
		centertag+comm+endtag);
}

function setWikiUrl() {
	setUrl('[[','|',']]');
}

function setHTMLUrl() {
	setUrl('<'+'a href="','" target="_blank">','<'+'/a>');
}

function setWikiIUrl() {
	var url, comm = woas._editor.getSelectedText();
	url = prompt('Wiki page to link to:', comm);
	if (!url)
		return;
	if (!comm) {
		// assume prompt cancel means 'I don't want link text'
		comm = prompt('Link text:', url) || url;
	}
	// set whole thing so caret at end with no select
	woas._editor.setSelectedText('[['+url+(comm === url ? '':'|'+comm)+']]');
}

function setImage(starttag,endtag) {
	var pic = woas._editor.getSelectedText() || prompt('Image:', '');
	if (pic)
		woas._editor.setSelectedText(starttag+woas.js_encode(pic)+endtag);
}

function setTag() {
	var tag = woas._editor.getSelectedText() || prompt('Set tag:', '');
	if (tag)
		woas._editor.setSelectedText("[[Tag::"+tag+"]]");
}
/* ]]> */
</script></head>
<body style="cursor: auto;" onload="woas._on_load()" onunload="woas._on_unload()"><div id="woas_ui">
<!-- allow saving with TiddlyFox -->
<div id="storeArea" style="display: none;"><script id="versionArea">//TiddlyWiki</script></div>
<div id="loading_overlay"><noscript>WoaS requires JavaScript: you must enable it to use this file.</noscript><div id="woas_wait_text">Loading Wiki on a Stick...</div></div>
<div id="woas_pwd_mask"><div id="woas_pwd_query">
<h2>Enter a password</h2>
<p><input id="woas_password" onkeydown="woas._password_ok(this, event)" type="password" size="40" /></p>
<p id="woas_password_desc">The password you enter here will be used the next time you attempt to access an encrypted page or lock/unlock a page. It will then be stored or discarded depending on the AES key caching option you have chosen in <a title="WoaS::Help::Special::Options#Do not temporarily cache the AES key" class="woas_link" onclick="woas.go_to('WoaS::Help::Special::Options#s59365')">Special::Options</a>.</p>
<p><input class="woas_button" onclick="woas._password_ok(d$('woas_password'))" type="button" value="OK" />&nbsp;<input class="woas_button" onclick="woas._password_cancel()" type="button" value="Cancel" /></p>
</div></div>
<div id="woas_header_wrap" ondblclick="hdr_dblclick()"><div id="woas_header"><div class="woas_nav">
<span class="title">&nbsp; <output id="outputID"><a href="" id="downloadID" style="color: blue;" download="" data-downloadurl="" draggable="true">Download</a></output> &nbsp;</span> <!-- Neu! -->
<span id="woas_view_mode">
<a title="Back" id="woas_back" onclick="woas.ui.back()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAF1ElEQVR4XoWVe4xWRxmHn3fmnPPttxe2LHSX5ba7tCHdcpFULAgtbYEaa6kmWomxkTZgbKVeQtREDZhGQwL1EhMaiSZNJNGoKWptLZsGKlKxXmhauhKrAd0IJWVZ5GPZ73rm8vqxkQ0hNv6SJ+/MH/O8k8mcM/yPCGCumQxaw9bEsNcaft7kmSZ7jLAZGGAqWED4PzGAAAjcbw2HgQagQJyqU2MqxvAcsPq69e8oB+g2wvMiKBCmt0v84O2J374xc9/5ZOZ3PZL5rfcnbsVC47OECEQRVOBpoBUAkHeS32IMI4DO6CD/1ubMjf2oLepQu8ahjhh/3anu2Y5Y3t8az+4rxhe/kcWP3mGcERygIhwDuq9tIv9FgbnWcDRE+u4YNO6nX2lL5vS3SqxajU7FxCquPk7Np9RDgYYLqKiKIEOvBv3qPudKZTIR/qzKWqACYAAFMMLTV+T3LLbu4JMd6Zw5M8irvcS0T5L2HsZjLxe6HiG9YZCirZNlFu+R0oTqPUsNT21Ns842clVuB74LABgLIPAJhS/O7hI3tLOYdt3QoS50S9LWiy3OYOxyC5f7v0bP8m2Y7rtgdAhfv0gkQRW5VEFmz0B7u7CHjmsElgNHgBEDiAifA3jioczM6bXqGgWxhQ5My3TOl2dSHdjBwJL1JO48tq0PU+jCEBCRJpClUCrDnYuNrH2XXD2RzzNZhbujsnygR/TBVYmJZcVagzGesYs5tblb6LtlJcE10GIv5uROuHQc0mkgAmIBgxHEefSBFcYCRGUdcLMxwr0A65bZ2LyS1B1iGGfsQpnq3K30LVxODA2MLZD8ZRuc2EXwnli/RKiXm1QIeQ0RqOfIwCxhfjcB6BDhTgMsA1jab3BBIHrGLkFlwdeZP7iaUC8hJmVi9A1G/11mdNbjXLzxU1zu2UKtdxN+3sOY7jWTTX2AQgp9NwoAAssSVXoAutqR3ItUKzXGFzzBwK3r8JVRxBaJjXFap99Ey+o9EHI05sRQJ/or4zqigZMvfZnS8AFaWjM62wMACLOnPm0foeFjE+gs5sToicFNydCIwSPkCG5SaiQg6kizNpo3DuchRBFVrkYSES6gcK6kmrugOS1i/7abeuc8CnM3EPOLSNqBG32ZvIkmnXjXwIfYJOAj1CbGODO8H6yh4YKWJgAA5XwCnADufWMk0vBK3QloA3f0MTpXfY+Wue8nNC4hxdmUz/yWiTOvE6zQcErdQT1nsuZYohqqNeX0mAKgcMICCfDxSxXlA+8xYgQCiYQYqP7rAGnnzU0WEhGK/R+mUjpBuXQab9txanEkeCz1XEFUT55Vnv+TGqAObDeqvGSEN9+6gHnhWNAkgYmap+Yt1Txw5jefYeL0EGKE6Cboee9OaJ1PpVJuSkMTT+NKdYoCh17XCCDC74ETk51U+T7A3hdC+Oe5KIBOVD01Z6k0AqcObqM08iJpYRo2aSWnjVoD6g4aDsp1pZCix/6u8sqbqgCqPHXtfzsT4Q+q3LZsgfjdm5OkkKD1HEkSg0YPktGzaCPV8bOcO3mIQELulJqDYob+422V3c9EN1ElBZ4DPgSIAAaIwFIj/C4q0xb3i//SgyaZN1O02gAfRGJU8ronAtgEHxQRNLHIa6eUHwxFN14hFWFEldXA24BYQAUMcO7dN5s/Ah9p7qZ4ZBjnvDCzE2ktKNYKNk3FXDES1UfkrQvK/qMaf3ZEQ61BOms6Z4oZ91UbjEw9BdfEHt/Tyl/3ti9aOCcZBhQI01olrBxM3MY11m9+n4RN6yVsWCH+1vm4LCHAJDo4Tw4/uyOZ/fgDBsAYuWo1AHD3Eov7RbtxBzqoHpif7drS+9lZ3dNPXf/QXzePN/XK8PaPJQ+98u1MXn4ylX1fsKathalMNVo1aEhSYnUC0xJK/tGH1+85/tqrS365/ycbtn760T1rVi46vKSP4SX95vhdi+3Bx+5LvvnDbdnaX+0o3LZpnf1x7pHLVZg5TeJAj0zJ/wMzetK8dt32jgAAAABJRU5ErkJggg==" /><span>Back</span></a>
<a title="Forward" id="woas_fwd" onclick="woas.ui.forward()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAF4klEQVR4XoWVfWyWVxnGf/d5Pt72fd+2tGVtKYOCaZYifUdHcCiMhYHMuM8YJ39s0Uw23ezi9sfcsimLS4iZmx8xQWV+xkZNTPYRpAEyP0IydaidGwMyogwqZRMYjH69X89znnNuuyoUsyxeyZX73H+c67rPuU/uw3uBAGYuYVlgGAwNOwLDczN8ZobbjbAFWMocAkD4PzCAAAjcGBj2AQmggL8Y59YVY9gFrP3f/e8vDtBhhGERFHCtRfG3XB1mWzfH9tt3x9nX74yzwRtDu/oKk8UhHvAiqMBPgDwAIO8n3mcMo4C2N5F+c0tsz/6i4HVvUf3eovfDzZrubPblZ/P+raFG/8K22H/qGmONYAEVYQTouNRE/ksFLg8Mf3SenmuWGfurRwvhwiV58dVQNc1ENQVXplpzVH2BJM1QVMUge192+uUha8fLxCL8VZUNQOXSo2CEF7xy/XX9gd3zRDFqyLdqaudJEOUI8KT1M5ycbKOYz9FQGaHq8lTqjnLda2MO/nbMy+D3bDpZIQZ+DHwOMAZA4NPvine3if35Iw1RQ0NBbdYuUWEBNPbMcD4nklXEa55j3qY9hL1fIHBlojAgF4mMl1WWLxZ9dHMQAQ64G1gPeAOICPcDPH5HbBYuCNQmOQlzBTRqg1wPmHbmdSylq/tyQq0SlbaR6xsEW0ZMQBwJ42VY129kwwpRACM8wGwU1ntl1dJO0dvWhMaXlSAArwYwoB5nirS5V2BsCB93gZ2msfRV8n334JMKSIAxiM3Qm1ebAMArG4FeY4RNABsHAt9aFJJURahj3BkkGcXUDxMk/8Bk7xC9fj/h0ccxUSM+naRp4Cs0f/AusloVEUM9RZZ2CYs7cECTCOtCYADgyiUGm4FHmZiY4ny0grDQCRKCKvgFCD0kh/ZR5GraF1+FrY3TvvIREptx4uUhMh+Ti5Sey4SxtxWBgVCVToC2IpI4I/XKFCeaBund+DUik4GJEQlQAPV4ZxE3gbc1QMiScRas+hLlqfMcPzBMQz6mpegAQOgOAQHIPNhMqabQ2d1DS3OBrD6JBIIIoIqqRyLB25C0VgcUdSkSFSh2rcJmw0ReRJULkFCEcyicHldNbKZOIon/+R2m8kKY7wIcYFAFY4RqeYJaQ4n5l3WRJjWCuEB1fJTRkR+hBlLrdHwaAFDeDoHDwKbXRj1JptRsgE6/Q/LnhwkCEAFVEBFqFeWY/wgrblmNz8oEYY5k+hQHhweZPPcmKhFTNcfYWQVA4XAAhMDtExXlhg8ZMQIOI97kyIjINMZJA9V6wnE2svKTT9NS8Dg1pJUzHPz1vUycGyOTGFWvR9+C4b+oAerAVqPK741w5M1zmN0jTsMQpmueWpJRTRzV1FOvTXMy6aN0wxM0R5NYq6Tl07y2855ZcW9y1BKHAr97VT2ACH8CDs86qfIDgB27nTt+2gug0zWllijVVJmqQr6pjbaWAip50vIpXt15L+Nnx8hMjulqRi5GR/6u8tIRVQBVvnvpsItF2K/KyoEPSPbkljCMQzRJkf/0QfDO0rn8doodJY7u/z5Ts5XHVOuOxhx67JTKk894O10lAnYBtwIigAE8cKUR/uCV5v4lkj10mwkXzRetJmAzRBVsmpE5UDGoCUCdhoHIK28oP9zr7WSFSIRRVdYCpy4YIGAU/Kpes/5f53XXDJtai2I/sUbMun4xbU0gCB4jzoPzXuupl5m+6bt3/uIh9Zkj6mrlpPN87OwkR+YKn0NwYHue13cUl1+xMDwIKOCa87gP94ndfK1kW64X95mPirtpdZAt7wlsHOJglrpskezb+VjYfd/NBsAYuaBqAGB9KcA+XzTZniYquxfFT31+8Rd7uhrfeO9HP5cjxvd25w5u3WzueOlbsbz4VCRDDwam0MBFXDRas8wQRvjq1Oyjyx66a972Qz+7qvT8tv6bBm/t3H5tqXFfaUl4sNTDgevWln77wH2f/cauZ3+6Yf9vnl5558dbfplaJ1NVmN8sfmmnXBT/NzSGyVDxz52EAAAAAElFTkSuQmCC" /><span>Fwd</span></a>
<a title="Main Page" id="woas_home" onclick="woas.ui.home()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAFnklEQVR4XoWVfWxdZR3HP7/nOfesvX1bu3UvLaHrRGuhboURJuwl3aYiATRGXEwWF1j8R9S5aIKR4EKCJiMI0dS4LGLMDCQYqZnMrVlsGS8bLi7KxJWBQzr3ztrRde3tveee8zw/78v54/4B8Zd8z+c5JznfzznPH+fwESOAqTnptYaHA8PuEodK+UMpg0bYBnTXFFhA+D9jUgEC91rDYSACFPA1TNfkjOElYE3t/R9bnnKREfaLoIBrbRT/pTuC5LHNYfzMN8Nk14Nh8vC9Qbz6UyYJg6pMBBX4DZBNRfJx5Z82hnFAFzRR/Nm2MJ54rsHrcKP64SavB+Zr/KdmP/ti1l/YW+8PPRH6r621sRFiQEU4DiyqlUgaBW6whiPO07W218Qv/Kgh6FyWFT9nVWNE/AzRXCnOUtAsUawgqIiXg8djfXRvHE/NEorwN1U2AjlqxwiHAN3QZ4v5/S2qo8t8NNyvyctrVEdu1sl9/Xr52E90dvRuvfY79NJvA313EP370+Lf2TPPP/9IRlsaiAAFfl27Mwh8A9CONimef65B9S8dPjp0u+ob92n86j16buQ7euXCaXWqWszP6PSxHXp66Iv63qtP6Lt/3qrHns7om4Oh3/VQ4IEklQykBkSE7QCPbwlN5xKrxWJWwvo6coWAiw1baFvzDO1Ll6GFqwgRdSt2snTDbrru/D5LVz5EmDFcy8G6PpGNK0XTHflelcKAV27vXiz6wF2BcXOGUK4zcb2Oax076LxtC9lQcXEEkgHvETdHJgA3dwVXvF5KhBGVOBG9f7WxAF7ZBNxkjPB5gE0rrW9tshRy03I+WQW3/orOnvVIMotzMaCoOhQFQBXUx4Qtn6Tt1h1458lHXrqXCDe244AmEdYZoB9gxfIMLprhYt1XaFr/PO3ti0jyV1HvwCflsgopS9SDakrP0lXbWb7pKZwKYUbpWiwACPQbVRYDtDWKzBVUGhd00dQ8n2KUqxSoL6KuWBGolkUulZTp8WWpi2jrWodkmvHO0dIgpIYOUwGQuISi1GPOPsu1w5spzHyAAL5aniapSLx3qC8zwQTzmDy9nxNDW8nPfognI6pKOmJEmAS4PKUaOzRfiJn+94vkZy4jomgqqJFUmUqMsVw9c5SJM6fwElJMvE7NUB3ligFOAvxz3BMlSj6GAlnU+8rTex9Xoq5EV2YqUYdqum02g7fgvDKbh7MTmvZz0nhlFOD1MSeltyB2qvkowSXFqqDMJKquq5JUWCyLKonjhEIEIuj7l5Tzk1igoMprRpVRI5wqXTQHjjvNBDBT8GACqqNozRHxKQHAisVrQL4ICoy8qR5AhKPAySA17QF+vvtA4u7osZn5dYlOjx+U5taFuLiAiACgmqrUo95DKdHsJBfPjlFfjx5/x8kbp1QBVPll7Xc7FOGvqtzWv1ySJ7fZIDSqiW2RwBoExVPpwyk4p8SOUoRcrkDAnJ6ZENn1ex/P5MkALwFfBkQAA3hghRFe90pz3zJJHnkgCDoXJDpXqJSJairwkJTpQAQNApET7xv2HHTxdI6MCOOqrAEuAWIBlark8qqbzDHgq/+5pPWv/Evi2BnaW4w01BmsNYgxYozBWKNORS5cNQwdFf/CK97lIzJLWjlXH3LPXMQ4YAClZuyJwSxv7268peeG8C1AAdecFffZXhtvXm+TbXdbt/Vz1t232ia3dNk4DMQB5ejNN5rD+34cdHz7fgNgjJC2mioHPmMp/rHJuOEsk0NLwke3f/273cs/8d5H/Ohrz31vb89bOx/s2HLkSeS1p0LZ+wNrGupIB4JUxF29lkzo/cWJ0CQ9O5Of/uJbgz98/INnR0ZGN46MvvyFsbGxvg+nphaKiF+4oPXKir7eE5sG7hzeMLD2yDx/LvnHvh1m4sLburAl47sXe07+VzEC/wP7TUF4BJAOkAAAAABJRU5ErkJggg==" /><span>Home</span></a>
<a title="Special::Advanced" id="woas_tools" onclick="woas.ui.advanced()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAFMUlEQVR42oVVDUgcVxDe3Ttj9FJrtVdBmzZRQdRGQ5OgVotBTT2ihOanmjalklJETGxKBamWpGqLhdj0VJBqjCmk/mHKcSQqKNJTKFSQaNFoSWvxH1ON8Qev3rm7bzqzfeehIj4Y5t7bmW9mvjdvTthtiaJokCQpTqfTHcDfdCRx2dUFRefa7GEreKF0oADKGMrnGMzLDbRjEbBIiaDd66jjdrOVeLathw8fhgcPHsj5+fmqj48PBXqC345sd+S/CXg/qi9RVnhiZdvLk0ijIe37Tpw4AZOTk8ri4qLa19fnjImJIacJDOLn8iHhdJ5B9bfBYIDs7Gw1NzdXwTOy/5bbbpan55soVPMUZGBgQH327BkMDg46vb29yeki9/Hg+k0UlpaWBs3NzXJ7ezslpCYmJmpVuwJ4o1iIbwwSTwd6vf40Kujs7FQAgE1MTMj+/v7kdInTuJ/rotDQUEBQx/3796Gjo4Pdu3dP8fT0JNt8ypas2sjIZDLR4SJ2DpVcHRgYCGNjY8rz58+Z1WoFzu1RVwWcznbyffz4sWyz2djIyIicmppKdgP4fR/RQnTILS0tqt1ul9PT01UCCggIYEVFRYAOMDQ0pGZkZJDTNFZm4DSSqkR/qKurUyoqKpSSkhKWk5Oj4hnZnhdoYbZEz18FBQWwsLCgjo+Pq93d3TJqZXZ2FkZHR9nMzAxrbGx0lf0Dz7wKBerr6+WqqiqF7oHLHAbnHeTO5LuDBw/C1NSUc2VlBdbW1tjq6ipDrS4tLRH/gIvhfQBeNIH9jn5KTU2NajabNygQ7m9j4FAUw45WxsNXqWuoE4aHh2UUxWKxsMzMTGhoaGAE/ovNBj09NnYq5ZSWbXV1tXLr1i2Fg9egbH94bnxeSSKqp0SDl5cXlepEGff3f1mhwJKolQ86vcjM5u+V8vJyF7h571Hifo2+qEwoZ9DpEF6ojyRKU/i+wc9wUg3adxFSYvOALlOSRC0A+ny6+S72WNKOmKLYSCBHLlxTfvp1gpXkNoBR+AQvOgBiYo+xmzfLVR7kCnfS7x2EDy4EbyXniHevKM0jT9mo3QEfmK0Q4v8ZUhXI4t+O0S6+sLBQqwS78WNXEKJsV6o4eAsH32j+4x82tLDKPmqwMdONuxB5LIMAles3rsPc3BzQrMrLy3PR9f6WoblLgK3g8yssq6mHvVN4B47EnFfQhEk6iT18+FDFVw79/f0wPT2tXr58mehiOE5OBwUFbaPcvalGAIg4d9XZhLRQ5hr4F3UQFXdhA8chdc3PaNdLY6StrU1+9OgRdHV1AWo5ISEBjEbjYFNTkxAcHOzOmr/o11DZX/SIh7tdf7LRdSfRQplvguN3K29pI6phfJz0n7GBww1aW1tZWVkZ2cxjYL/jx49zbHf2dAKhL32ofpPbyN4raWGmr35k0QhO59FHoy34inWUC29p4uFJSEgI1NbWbmDWDswaIiMjfystLXVPCZHfxtmz5/yMr/jNG8Q3IFCX4zz0wlU5MjrDSeDJycmW4uJirbu4vcSrPoRqFDV4eHiAr6/vYmVlZVxYWJj7ovngkrAsAUGu/f86fXEiGrXOiI2NtUxOTumysrK0DsPHJ2gO3BF5P4DUnMMAlyIiIgJwdLvnEM9C0zimRYfDIdTW3k5NNSU3J558y1r6dWk2dogep6mIk1VMSkra4oP/eGJvb6+I899NCQffsSghbD0JAAS7/V9hfd0hLC0tCwguYb+Ly8vLAva8EBUVpdmHh4cLONaFlJQULSaC60VtbcX/D8eJeIH68oHvAAAAAElFTkSuQmCC" /><span>Tools</span></a>
<a title="Unlock page" id="woas_unlock" onclick="woas.ui.unlock()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsSAAALEgHS3X78AAADNUlEQVRIx92UPUwkZRjHf+/MLCzn1ypLQI/CrIlamMtxd9zFGBJjTIgJHZUVsbGB1thZ2NpYGAqLFexM/IgUXnKFaESyCTkhYMhyhARw2dx44ALL7O7M+/FY7B5eVI5dtfKfvMUkM//f83+edx74P+pN4AvgGLgFfAUM/Vfm7+dyub18Pi/lclkKhYLMzMzYbDZbA976t+YfTUxM2IODAymXy7K+vi5bW1tSLBZldnZWRkZGNPDePzV/Y3h4uFapVGR1dTUaHx+/DcR9fX2lycnJeGVlRebm5mR0dLTaamHH+np3d1eKxaIMDQ19DhSAV4CRTCbzw9TUVK1QKMj09HQCfNaxezabPQzDUBYXFyNgE3gV6AEUMDw4OFja2dmRfD4vwFon3gFAb29vdxRFVKtVAWJgFWgAAiyVSiW3v7/P0wMDAH0dAzY2Nj7M5XITAEEQfD82Nhb8NP/NrUxf7+u/hIcE6Uf5cWEBxNHTneoPfE+qtfhM0/7+/tfCMJyn1YL7ehzIABYIAV3ZnMc5hTEOZzXOJdQPf8U5g7Q+ctbgdIyN69hGnaWbn/D2p3sAV4Dl4AHAceucSgnUD7Y5DrexVmPjiDhpIM4h0kQYo7FJDXNSIakd4U7RDJy26Cw5ZxFrWg8gqhlZPA8lrlmEUqA8UAqlfLw/muKfCwBpVirC2trP3Nneo15r4DV5APRcSPP8sxfJdhus1lgnfx3yWVKej+d5KE9x7eXrXLpax8QRxhpwTYTTDWwccRweNpujaB+AsxhrMEnC8u3lhyfoapoHftA+QFD4yscPUly9McyloRfRcYy15nTIktQwOuIkFMQJ6UeeBHbbBDiD0w10ErGyvPnQBBkMzln8rnQnM/AQP4XndXPl+mVeuvwCJo5x4qCVwMYRVtep3vXpSqfRuruDGViLYBGrqR1VSeI6xmjc/asLOB1j4hoqSJG+8ATVg8O2AR98e/PLd567+BjRvRJGaxLdwOoY5Xn4QaqZ0gkOD1FdnBxVWFi6A/BdayOcLR9uAB+3Fl4nZx54F7j2N7f2zwyeAp5p/fapNheoBe4BJeCuOudlv2XcdU4xDyoNaOA3gN8BP+S1qNxUaTQAAAAASUVORK5CYII=" /><span>Unlock</span></a>
<a title="Lock page" id="woas_lock" onclick="woas.ui.lock()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADOklEQVR42p2Ta0hTYRjHrT5klyUJsmmUly9+KFFxZLclShc1JUISP6iooQRmaZSbqaiouWQFlZnXVNSZZTovqJtLl3dN0szNS2mzJhKy7GsU/Hvf0yZ2CHbmgR87O885/9/7POc9Nv87lpaWbNmQy9tMbDfD/OdysIPZ8Pl8ESmDRRhhP2HnlsOdnZ29zYFVVVUwGAxYWVnB6OjoZlHIlgQuLi5eNEAikfxeW1tjwnU6HbRaLRYXFylUykjovVYLeDxeJH3YaDSiurr6F3tECoXiJxXSc3qvVYKhoaFd9EG9Xg+lUsmE2NnZpTg6Op53d3f3IIGx9Nry8vJG3c3Nzcdqwerq6kaAQCAIFolEB6VSKa+oqGgvW0A2gj9nQU1NzR76EDn/Z4VxcXH2tMaumxfASdDa2ro7NDSUzw6gK3R1dfUgosMUVp37iPzdBcx8KTKZDKmpqfScDbvOaUzmA+sf+2Cc1+Cbther00qsTLXjk6YSC72lmDcx2/ME2s4HmG7Jx2RDBsqiD5hF3hYFPxb6YBiuhq4lGx+a0jFVn4yxqqsYrUzASEU8w0BJDDSPwqG+exadGUdREu1kFgRZFHyfU+PrQMVfwYt0TMqTMU4FlGcJDIOlsdA8joC64By6Mo9v7iCEg6AHX/rLoWvOgjzzIrKjhBCHHUEaQWyCXqM1VV4AOiRCPI104i5YX+iFYbASs4psLHTmY0aRganGFEzIkzBRl0ghHV3BSEkElDl+aKeCKGsEpAP9m1IynjuWO8glgjQhymMOcRcw76C/ghnRfEceZprFZKckk5Vfw9vaRIbxylgMl4RDlXMabWIf1CZ6chcYdd1Yfl2E989vWeygM/MEFLe9IE/xtaYDFfSaUmYHzbVnYfpVKt7Jb2CiPol2wTBGO6DvIFtEJMfwUuJnhUDbhc+aYkw3kOC662T/x5NtGYP+4sgNNA8vQ114gdlFvYUhaBSf4iwobJLFk5nfxCD5kDT3L0ElDUJXbgC688+g514Qg7ogEKqCYCjzA9GWfhJJAQ40vM/ih7bDxsaX/JQRYCU0XEwQEiw5bBwInoTztGWOBJnCBTSEi8SWsI9gxxE+wZ4d9Ae1D+3QOv0MAAAAAABJRU5ErkJggg==" /><span>Lock</span></a>
<a title="Set password" id="woas_key" onclick="set_key()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAADAUlEQVR42tXV+UvTYRwH8JylrprMpalJtEglpQlJl4KRlYrRhbSMmkeXFehUWoKSUZkoXYr6g5hJWVqYt5RnP4SoFV3rsvKcmkdWm7MRHfLuzegP+ObxQ2948YzPnj3Pdx+e7/c763+KiGYsClpNzjTt8aPvRw7uHeB4maxp2rKSRguyk1BZnAF+zqe5NC1xp56s9Dh8eXsNHc3n4ehgW8jaYppyFtHrtOQj+PKmALq6fWgo0sDaanYF6y40pdjSw5OaCHxtL0R/Yxi2+bshZIvPR9braQFZ0KRiSU3xx0Khf38LA037EROxHsHBwS2sx9JGkgpZyF8ikXjI5fJQLy+vSAd7u2DWwqkqKnw7DJ0VGGyOQ2jQMrD2kPaSG8mEXH0AQa1Wmy6mxKIgOxF3i1N+HYpQ4lRCFMZ6ajH6IgMFGdFQKpUGzlWRnGyEXLkvjRfnn0P3i0roO8qh/1CCUW0WBrS3Md5/H8beWmjvJcHeTjwoEom0nK8UevZX0HB+djKMugawx1z8NkYen2GvIzHUksDWlEH/7gbq8lWQzLP6yvk7yVlIW0S0KUyl+t75vBqGjjtmY9014KLmjQYfRJs3GX2Vh60bXPH3rl0m9Blk4e7uHqKJi4Khq5KLliLvkho1N0//vpKTAtNQG2vl4L8x9z9yh8cEf3OY5gh+Enp6evpdTEv8OdZzD1cz48Fa37y5NhqOurKbmTCNPKGnbF0xzsYFGljfTGLBG0il0iUZ6SeGjbp6tNblTsikkrOsuzg7yg611ebg22ALtaLrWQkCA/zx9/RYkbDw3HuLxeKJG7nJKLueCpZMrktdjnP8UVWUztNTZ25fV3MqfNZ6g/WD//oOsKZdNJ57SYOawmT0akvRWJULY18TDN3V5v4f2L0OnHOfnMmS/inL6QB9To1Zw7tVjc/tRdA9ykLNrQuIDvMFv3tCPjSfJp1w6lNtkX/y9nT8vWqFk0mhUPSw9pKCyJ6mnPW0h9R0lLbTSpLRtMWWnGghzSdrmpFYmE0ifwCBgXrsTq+HzgAAAABJRU5ErkJggg==" /><span>Key</span></a>
<a title="Open the Print window" id="woas_print" accesskey="p" onclick="page_print()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAACXBIWXMAAB7BAAAewQHDaVRTAAAAY1BMVEX/H+2lpaXGxsaUlJScnJxSUlJaWlqEhIRra2sxMTGtra1CQkJjY2POzs6MjIw5OTkpKSm9vb1zc3O1tbXW1tZKSkp7e3shISH///8ICAj39/cAAADe3t4YGBjv7+/n5+cQEBBvTde5AAAAAXRSTlMAQObYZgAAAR9JREFUeF590TWyxDAQRVF1i5nNA/tf5bcH/ZO5Savq1ItEfiY7PyXaG2DmwinlxCOX4htCmpYMpk1HyxTGD2iwXHFta0P0J5Brh6AUVaNfrtfzwtYei0uy2Gk5g2OC35ZbTdSy6/aFrUNs03K7SaHKdCzaA+yqqfW+YZZi6Jgnuc73TEidZQyxYq7eleIa7sC0I8TMyJWKGTFE0LD5Tc3NigOqujOXbLRAU3RcdF2fYHIZByoZOFpHXgEMvhboaYzd6pRoTqrl6p8gAb03lGVvL7uUZph+wMAQd/KIuzCjs6FPkBTeGa2dBvoB9o1HCeEFQ2D0EwNGZTgA1yjl8C8p5kIIKXMax8vRuHecdNfkqHAnVCnHp+8PNbguyI/+AB1QFvk/nv1+AAAAAElFTkSuQmCC" /><span>Print</span></a>
<a title="Edit" id="woas_edit" accesskey="e" onclick="woas.ui.edit()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAEwUlEQVR4XpVVbUxbVRh+bku/uJRCwJLhmikRXTSED0MyFrPJxAHuC0HGXDMwQeKMMIwbykhEmNt+rMPNiasSMTqGSjDbiCGOBCTxYxpdoss6nTMNcYJCm5aVjgKF9vqeE05Imwbjk7y5977tOc/7nOc950hYgZYin0KmCOP/QVGpVI5wODwFQE0REgOk5VAozut0OqvBYAgpiqLi+RWAcogBnlxaWpICgYCPSF4gkj4AcSwtCCBJkpkmcPb39ycUFxeHfT6fpFarxaSrPXloNBqlq6tLam9vl4ikhkjOAWBFhhkTlj+wZs0a9meQXDDExcWJd1ZErBC/SW1tbWFaAbS0tHxMeYXQA4CPFlARMxYWFqRQKCQlJiZKDOybloDlIoJyLMQ7PB6P+vDhw0wFU3WWSNYKBRFgCmZnZzE4OIiCggJkZGRgZmaGETNF0ZWLkNgykQ+qurq6pY6OjgQak0np8QgCqgbx8fEYGRlBfX090tPTUVFRgaqqKqSlpcHlcoFUciJCBJHFYmG+KXNzc8wHnhZrzyEGMLnZ2dl8csvae2G322G1WnH69NtcgcmUiMXFRWGwMDtCkchzH6MJqALk5uYiLy8PP3x/BY2NDah5zoo3WluxY8dOHDt+HOVlu+CdnubLKVTQe3Q7S9EEnFlUUVm5G+PjY7DZjlLegAsXBjH6VS/27t2PBzMfIn/yyRu/8IUvbyyoEAXW/36/H1u3Pkk9psW1az/RcwFzgbso3FKFMydKUb3Pijt3fGDFB4NBvmQEsTyxCYQC4UMotISsrBz09PQC0EOjT4B74gbKS9dhW5EWlbtrcPeuH7dv3yal43wMmfvfCoiAq5imNS4vfxqf93+B61dsCHqG4bzagavf3oLtSAn8nu/wTmc3kpNNoPaMaXBMDwi8Er3egI0bN6D+QDPK9zRhuLcMeo0Cn1+FsZsufNJdhsdKOlBUtBmP5mULglgKYptsNpvJQA2aDjViy/YG1L42ivssKdDr1Ph7fAZJeg3eOrYBDfWNrBgKXUT1MRUIo4QPDF6vF++9a8PmQgdePzGCN1/dAsfvblz/5R9UPPUwRr8ZQ3XNi+j77EPWSRH7Y9U2nZycFK0Ht9uNs50nUVK6E1nrHdhVvB43nR78/ONfOHW0FJu2n8cH3efwfG01I1ndZAFqPX7+kBLWtnwj2e2daD55Hb/ecsOSngjfzAJ1lh8vv5SLy19eXi4yDMLqCshk6o5kdu6I1uNEhY9vwqkz76P6lVqM9lUg8/4UKIsKBi7cwLpH8pcJVvGA5PGgiTmB8GPFlxBq9j0Lp3MM26pbceRgAQaG/oDjTzPsPQdj3naCQKIIG41GaLXacFJSEr/RoiEMPNLWAvM9Kfh0eBjGlAfw9Uc2pKamgoHGKkx1tIIgE3Dx4kW2MyW6D1TijGFHgZBOn9yL+fl5pJmTsXfPMyBKDAxc4jm9Xq9QQ6jYxiPMUTERl34zXfgHaNKgRGAmh8mweIOBvFAYBT1DCATmYTSyI5sTi40pvFLINz0RXAKwP6L3GYaGhnRTU1PyxMREPL3LOTlZssvllP1+r+yddsuB2d/kkifukw81tciBwKxMZ5BM7SzTGB60Z2SHw2EwmUxiXvwLqylmbjrv+acAAAAASUVORK5CYII=" /><span>Edit</span></a>
</span>
<span id="woas_edit_mode">
<a title="Cancel" id="woas_cancel" onclick="woas.ui.cancel()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAGOElEQVR4Xo2VbYxUVxmAn/fce+fuzOzuzCzDFihQWmWhFBXbpQZpROpiEWtiK1ptKf3SmDRaqf2wCo1JhUb8gojY/jA0NVGpiTSG2tBWoaZVS9IgiqWQkgItLCs7LLvLDDP33nPO607i/jHR+CTP+fk+yTknefkvBAAGCIQqcBPwGPAzYAewGbjdwBwjTGIA4X+DMDlcmP/vYbWcQd/TZfy1U0P/oQn7ugNfCFCgATwnsEz+j4i0FcAI3wayBeVAty4p+kOfqbja7VOysbVVW1szxZ74XE/2p1Vl+4P+ou+fEnhABX4h0M1kCOA/awKRwjM5w00b+wv2vg90EseB8ZmXJHMkVkkcZA6cV8RDPXNu9zsZ33ujGY6k+g+BlQqnAQE0mAwJoPDLUiSrd3+ilK5Z1BO6uBSkURcuyosxIqE6Mah4kAwjTWdoeQkWdBv5cDXK9tfs9NFMBwR2Ai1AAqCtBx4w8PVnb+hOV/SVootBSbIorz5XkDBfhFwe8Q7jUhSBpMXFRl180uSCD6jEYdhfCdK9/8xmNB2zBXYBxgAuEGYDjz6yqMDKK/Jh08Wcj3v07PKvib1lM3bOYjTMocUSYdyBaY0zOPODxA/tpHTHJuJcJPXU6uxiEN3X12GBW4EbAI8AwMZZRaNDt/Wk6Zena/3ey/yx3z6pbdR7dc2GNnbcp8mDC7V1d4/+7eEBrY3UtI2d8J1fbdY/Xie652MV/9LyLntNJVDgdwYwRoiAT3/28pjevAkSpyreSrm7GwCftTAdBTq+8Dh2Wh/HLrmGWd98hkq5h4tjI1ggnt0HRgAFMCum5QCWKcw3XrkK6Fs2PaJpEXVWQpTCq0/hzp3G5PJ4myIdRfTO7cy8/2lKpR6SRh3Jd+Pqowzv2oZKCCAtB32dxhUDigrXmXalMySaWQj8xUyxTvHOEbx7iOyna7HnTiFhDpsmxOUqxUqVpNlA4gKaNTj93VsZe30fxEXUOTKvdIVCb4cBeJ8BpnZGhtig7XrqIEks1ivBib+SPr6K8cHjmCjGZRl2QoIIOz7M0KbVjL32IhNVrHM4BefBCHSGAtAbAt6rklrIQsUrqApelKzV5GSlwqwgh3qP94qqB1G88zRHRsmc4lRwXicEp6CqeFUAb4ChC5kykjixDloWUm+oj41y5NKlzFz/LKXeGe0YBAGEOVzSxJSmMmPjc4Rzr6U5OoIlwLYjCi2njGcKcMYIvNl0tN4ac8Z5T9OKthoN3pmxmPeu30m5VKbVftA4jxuvYYdPIoUubH2UoFDi8sd+Qzz3apKLDawaUKWWeDmbKMBBY4TDwBsvD2U4h2/Xz1+4SOXjdzGlp0pz/DzS/knJBQZ/dCdvf2Ml6ZnjmM4y6egwUeUSLr3tQdI0I/WoQTk87k3iGTXwivEKwK/3DGYcv+C9eiRxqJ44hAOi8pT2cE5s/Dy11/ZSHzzFkYdvpHnqGLneWYRxQOvsu6QOtV6lZXEvD1uAFxROTi6WIy3PmqbV8kemBr5BbJKjr2sydk6y8RrvPvkQ5/bvw+fL2CBHY3iI4T8/D4Ghtv8Fjv58C43UkQ+EvcNW2gp8SeHU5IJxAmsVnn5kQUf2qUvjcCT1Ypp1FVQkyiEdBbxzeK84CciShKTRIlM0jWIKYShv1V26+Wgr1/JsBe4HAgEADOCLoWxpOV23bl5HeuOMXFj3xlhFURW8QwGvYD04FTJEvVfJ4/XwuMu2HmvlUs/vJ1ylkAEEAIACZtdA955qwVS2HG4tPdOwOr+Uc10BeO8lc5D5torzgHoiVDMVt3sw0SeOp9GCUvDihqsKN78ybFuJRwAwAgAfnR5h76kGeu80fjIwbW0U588Z0OUl/IYrY/9Ef6d96touu2Nxp91+dad99MoO/8ke8QVQJEhvmRM/9tL13ebVgW65eWZOAAyTlwRsW9JJeneV0bt6A103m7e3f6X6rU3fXz/9siveALGA5sDH4AU84Lt6qifv+OoD2/7wnS/OPbAix57rS+b5ZV3yw0UFJpHJY9+qMouqIYgS5XJBXCr74J4fazpvIDy4/y8LD/z90PtPnT4z3TlnqtUptYXz+g73L1l6sOf8kcabG1YzdGYkSAldaj31TFl3oMFwqvwLp7pEcWb6RsIAAAAASUVORK5CYII=" /><span>Cancel</span></a>
<a title="Save" id="woas_save" accesskey="s" onclick="woas.save()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAABmJLR0QA/wD/AP+gvaeTAAADLUlEQVR4Xr2VS4scVRTHf+fe6q7qntgzTo2ZHjLJBB8LZ+vOXRaDoOhGEzAbs3DlN/Aj5AsEFNyaBASV4MLXzsfGR54Y4mN8EJiJoBM6M91dde85dncKUtAM9oh64M+5FJz/j3vr3HMFADgEPFNlBYR/FgYkwPfAZ9SM3ve+8UKjkUbV0nnvDgQQEVQVVcw5b8PhnjOzV4G3EpDHwDaefe41ut11W1nZ1TOvPM/eXoGbmSM4Fzl37j2irsZPP3mjefPmly+KuDEAD9B5KCdN53y+mLK8vEyv18d7x9+FmQHQaDg68/MMBh3a7Q6AQyABACTGEtVIWZYyHA4pitl3YAaqQgiBGINFjQCC1QCIMJbU5NxsOxAB5wShqq08ARz/YfwvgIRayPT2/12AAYjUULP/ZDNBRPYB1GQa8F5HsnGewV0wIPGGatwfoKq02y1++HGbs2cvAB7DagBB6r6AAIZiphPznT/h4cUENZsGYCAoabrC1vZdynIHEV+1KqjG6fEQI810gSzroKqkmQCKINOAqoiiGLKU73Hq1AlihH7/HiLQah2amNTP3Xvj4sUvGBRzpKkjxoBNt+n00Gq1WqytHeerr29x/sK3vH3+G65e3WR1dY3FxWWWlrrkeZdud5VWu0UMcd+mcMDUycYYKYoBW1t3gcOoPjJa7xDCkLIsRioJoZiME40RRGZo07oERATvHM4poDgvQL0V5YGvzXCTDdsHRG2+HFyuwkfvE1QNsHEwVlkEBoM4UqAoA2aGqk1yfQ0PvjHOGFTGiYhgZq7X+8PStI1zu6TN1LKszfr6MUL8DTDWn3yUNM1QFe7XQJZ5ms0U5xOSJAEE7xviXQJgIpCY2S3g3Y8+fPPlLJsr8vy4276zxZUr1zhyJB9pHgCRhBs3vpuYA5iBc8qd37cpCkOjEEOUGEPY3d3xQDSDqti5hYXD79ynSgAUsINKRBSIVc0ZAKlkL518vT0YFCdGl8xtbDxNv3+QF03xXrh06XMryzy5dv3jnzd/unxZREhADIxGIx0cPfbUB088XnL69El69/p452YEMKoXfvk1Mhwe5fbt62wy9hf7C6jjltmoo4ucAAAAAElFTkSuQmCC" /><span>Save</span></a>
</span>
<a title="Open the Help window" id="woas_help" accesskey="h" onclick="woas.ui.help()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAG0klEQVR4XoWVe2wU1xnFz3dnZnfsfVC8sGt2g43fxgbXAoIgpuYR0rRNhFInoogAihPEw1SiNFQUIUL+aVqkhlIhkUBllaqKoIGYQixaAgZETI0wLnbK++3HbrCxvWa9a3vZnfv1rgUSQlH7k45Gc+fOOVdn7tXgOyAl8czNZE2gRhf4RF2/UDqotEsQ3gWQ84yBpkT4PwgCtAIlp2G8ke1Mb3mrpCRZu3o1X6it5W+OHOGWgwf55KZNvDUtjcuFiLsFvjKAHygJ+o4Qes6c84CA0LX9C6ZNm/N2zTrkVlZCOJ0YhRksBKi/H7b6eoycO4dTFy7g055uXH2c2D8MrEkCg0op+NkAIQB+ASjPsRvHa/IKxi9Ytw7JRYvARKPGT2FdhwiFWAwOMlgKces2uuvq8CcV9nl08Eo/49UkELIwCgsAJAD4gbxcm3F845Sy8fNXvgerqBAUDiMFaxogBKckpOTUuBgeJkokIfNy4V2zGhurqvDO98aWjiEcA+DSnvkwyAGEoYn6TTm5RRXLloGmTIEWfww8fgw2TY5Ho+i/dy/R09kZi127lrDX1Rn24WHA4QApoOvQs7NQNjSM+909vjvxeCDBfIQBIijSgXdXOp21HyxdCrnwZQhLgpW5aG3lu0Dkumm29nd3Nz8aGOhy9/UZmY2Nk72BwIzcadNKHZWVGvl8sEwTkoCrrW1YuWsX7ofDLzNwSgAgD9GvVvr94KlToLoF1IqpqYlvHDoUOllbu2fPzp2/3nbo0L69Fy+e3X7z5j/WW9bWAx0dW1pPnfp75MSJEWlZbE2ciERZGYpXrMC88nLYNPELpCDC/J/6/fxwyxZ+uPdT7t2xg3s3bJBthYXhHUL8dhYwcVJ29mwA/FTl5eWrnULYq4WYWb948dH7J09anZ2dsuP+fRl68IDrlYfDZosCyIcm8NG+tWs5eP06d7W0cKihQYa2bZNfFhaeeAWYASLx1Njn83mKi4tXAWCbzeZ7NV9L+8OSJW+fr6vr6Orqstrb22V7MMi3Gxs5x+ViIlQLAOVls2ZBjhkD6fHAKihAuKIi/nDBgpZzwC0wy6ysrLyMjIyZ8Xh8gIj8UFiWNXzythW/+O/mK7FI5ColkwARZDKBNK8X/owMkPIWzPClqwEwjypF3LJiw5FIcAiIAqBgMHgvGo22KNmvXbu2zePxVEDKKAHU2fVtny7lQxmPEwEgkNTsdtgcDoDgFwAolc6pdIwCzTCEw+0WAsCT1YrHalclk8lYZmbmkr6+vn9JAAxwumkaZLcbZLPx6HkhAlsWUp4KEkTo7b51CxAC9KRsl8fjyiwszCuy28cKSgH1roYUvb29x4hIbKyuQOrZfJvNbx44kGM7fBh6Wxu0cJgstRMjAwMAo0cAuNxw9ix0lcpEEiMjMO/dExmXLs2uKS+e400zDZ0EVIBrxvTpH7uczlyNiHf8+Rytz5roqPR6KwKDgyX6+fOkgpC2dy9iO3eiPRwGK28hGQ1Hm5qQaG8H3bwh7J99RvY9eyj7m7bvz0xob/28oLB0mt9v6JqmX2xped9ut6frgFhfUOCa4/cvco0ft8L0+RysOmcA1NtLX6sFR5LJODPOEgDTaej/+WTxz/J/NBSD1t4hVacCUmIEGAnZ7Se6s7I+bx6MXLl+906/odv0edOnv1Dids9x37mz1JeWNlnNBwMkraQqII7qM2dwuq/3tMVYQFDowIbZbveO2vx8eFhCGDaGphGYAZsND6uqguGioutqrEcChsk8yTs8PNne0JBOqm9Sc61kAkQCdeo8bW5pob5EogrAYYKCANNt6BdWZU+a+stMH2zR6KixEBrk2LFIqh8MFxczFCQEWEpgaIjE6dPQmpqIU+g6NX8bwtbGc2gNh49J5tcZgEiJiOLRpPXOX4Ndsd3hAcTGjQOIIGMxyX4/WIUQMylzAkCkBNOEVVoKy++XcDioORLBx5dacfXRow6LeRUDjCcBkpmJgEuBCYk3vui9G/swGMKtzExgwgSBkhLA5YIE+CmSCKTr0AIBGikrE0e7uvgD1fvNWCiUnm69BiD4xJvp2Z+2TiQbPkovq9lt7U8OOSb/JC+P31y+nHIXLoSujj6IMIrayoMd7Wj86gQOHD3KzTdukNcT/3rzElq6/PdWypyUJJ4nUecUgoj++Tuv+ZvqCesD3oy7btPkkkCAX3/xRX5z7lyueuklnldcxAG3W9oNQ+ZPEJc3L9aWvfdDTVS/IsRf3tcE/heP/uYS8kuXgOJB1520w4f2v1azdvUfK2eVNkzNRtvUSeLS3Cna8TU/1rfv22Cbd3m3qUNxZrtN1H9oEJ7jv02RDP7etbzFAAAAAElFTkSuQmCC" /><span>Help</span></a>
</div>
<img class="woas_nav" id="woas_logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAI7UlEQVR4Xq2XC4ycVRXHf/d+r3ntzL7a3Xb7pO1CH0tbKLBYihBKBCSoCCCIUSRQI4QkqDGQqIRgxIBRIwpBIBaoAPIqgIKBGlpjUVrSylOBditl2213tzu7szPzPe49LvmS2WwAaRNP8s+d3Jzvnv/877nnnqs4ApPfrfLQai7GzsaqrCgZweoxss6w0lisjA6Wa/W3+ytmzc27OBzThx18wwkdWM5nNP9ravN+asZ7fmlGlt4V981/sPzc2N2VHfXbq7vDH7XlsxefsrRj9ge3Lj6stT9RgYHbj9btTXlHo4+i1vJl3PkXYmYcg+kMeOc9xe5dMDQEIyPIoRFsc4lw/17iWYXItCZ9Xm/L89nZ2TeckvfU7j2D+xZc/86REbAbeteoMJlDrftbzDy9h1f7SvxjO+zcAcPDkCTgOKAUiIDW6egH1OOIsCM3LkcHw/nzun7itbkPDQweKnde+2/7qQTKdy2jkMu06PG2B/B61zJU8nnmKdiyGbROgxqT/nZdiGMQSedFALDGoBwHI4pqqzPknTfjzczJbT+WvLPZuXhr7X8SsPet6lBjzjpKF36PV/YWeOB+GB0l9VYprJ0MmCQIoNTkUnVr8YIARwQbx5QLTuicMf3FprUd1+hvb9/9sQTkod5mYnsK1dlnkj1tnWx8KeDZp1FKgzFgJfUWaZBp/GOl0Dr1Q2lAQKdKiQgGIcyqsj2z897ChV036Uv/PvLRU5DQTChXEZxwGZu2B7LxSYxSkHehxYNZAWQAOyk3SjUWaRDLKGhxJqCg2UFlNQJ4oSpFfxtaF20rX2Yf7G2bQmDXrUcrIjkLs3IRb4228uij6Nl53Ku74LGF8Jcl8FI35u652Iu6UkIfY1GgiH+4CJ47Fl46DjYtQ+5dhNNbwtcObUNJzv6+75Z488ErphDomJZ1MTPPmMj2uWx8AqIYTmuG6zrhVAcW12BODeeCJvRN3bAiD0JqqBQieEuKuOvmw0ofuqtITxlzbhPx+dOQQINS6INRLnljdMXYb5crAKp3Lndl/aovyf037JErrxLRWsT1RE5tFdmyUiQ+W0RWidgJ1NaIbP6MyIktIo4jkgtEzuoU+cIEpmVFOibwSI/I2GdFpDfF0FqR+1aJtBVEPE+s60o4Ozcgvzr+jPI9KzT2nuOycueJP5O7f5HEy5ZJ7Hkivi/SNIE17SLbPgy+TKS6WmR9z8TcNJFCIOK4IrMKItsn5vtPl+TSDqn7rsiyksgfl8sES5H4ZJEbF4p0F0U8V8SdgO9L4moxVy64RR7pzWnrYqm1h7xfdpw9e3AzGVAKqga2jRG/MkhUz8JgAA8MwNYRqBvQChbmYKmCGRX0sUW8fAYORMiBEFAwZuDpIegLAdUoVsoI5s1yj6nYFtdBZcjMmcfgECoMQQSsxQJaK9yWJghaoH4QqhEgqY+rYXEAwTgQokoKJQY8jeooAkBNQcWCAmz6HYDSGru/Plf6a9O0VL155OasYOerjXMrrov2PEChogil9lMbH8MG/mTyFV04MQvUAQUFD7RAVkOzC3ggAVjAWiJj2G8teF7KZzAUf+tg6EqoPEpNjhoYANdFpdUurfVGoKpAcnjtGtUWTxahNh8WZIAxIA9akYghas+Rm+YCZegDDoSkBUqRKRbTGhLHOIpSLZHprjHJPN55q8UbGQFrPwQiglIKawUVFlDkcAsCuVTGxAp6dTO6pwQcBDxwPBytyXS3QasPBCm30AKKxNEUjYFaDUQwvpONSl6LFsyBePv2CsY29igGRCm0o1G1OhgLvg/t6Vm2jobj26BogKZUAd9BOQ7ajYA6iAsD4xAbUJDVGh3HjRgOquYGTll77d6/wnD4XVS6OFrjOw7K80A78EYZRiIiPYQ5xoPAxZ+VQ5+VAR0C8wEfiglkFbRY8GpQM/BaGREQ10OlyQ3GEFtLqBgPWrxhrQJdt00yJNVUmgaMAbGwcxT2VrHKRRZ3QqCIWgVpi9PAZAEFM12Yl4WjfMgY6gfGkL0xSjsosVMuMa00jqerquTXtY2iqr8ks7USaIPrNZyAlEjdgMmQCbK4i4D5PvqcdlShBchBFIJ4MDsHn20iXtAEbg53LI96H9A0AjdGsfgLCs/q7sxuvf/geJybl33czMrtE9cD123c+fIhxizsrQN1aK3CNZ04F5VAlWG4Dk+8D6MRZC18cRruCa1AgjscQ//4ZOBUfhBBKRJ3efNz9SiKddd33qZSqfXrLuepWOKIJEmdgUQpZEzBHf1Q8cEVuHwWtYUO1pbg2Qrc9h/4wIATkPRkqGUPIsTwzzqU04AN+bVGROCo/MvSk3s1d8VrogGar33d6hn++jDPbqw0ktGbgE4MvF6BPgAHiMhlE/SQgU3DMCpQDQCFlRCRmSg7B14eT8s5TPYOIliHUVr9+/WVO+pTGpLC2TPe4/Odm2qeqqPU1GQcMvCnMtSzwCgSxnD7Lnj8AAxEsGUQiPG9hHyuAts/QJ4/gE1so40TEcaNgaXFn+uvzNnw0Y5Im5Gmk9pujhfkX6ybREitkQ88PAAvjMA+D/kz8MQhCAXqAo8MwH4ACyaEv5aJD8XguQ0FrLU4rf4u55zOe9V1O8Y/sSlNvn/MrNGN/TcE746vy2pHq5QAaA2tHrS7qSJD0aRKjoJLpsM32qEfuHUPtZ2jBK5LEsfURCgU3dfU/Px1zo6RFz71XZBcv3jG6B/2Ppzvq57iK60aewggpCYpqcZ8VsNMHyoGhhKSMCGE9CIqun3Np0+/Qq1o2qJufDs+rIeJ+cGSruiFgWsnGH9Nh9LpaK2mtOWTnfHkOEkUYy2RQ9Vp85/xV7ffph7b+8oRvQ11T7Y/8/V5N3NS2zVmafHJUNvIGAPGTC0sjjMl08VaEmOQjmCbf2zpeu+8mVePfK512xG+DaciXL/SdbeOrbFbDp5v99UW60Tmm5rpdEG0o2LAGk9XcdUh5am39MLiFvXVrg3q6h2H+H9Z+a4eZX+zMiff7e6I13b0VpaWvllbUrw8WtF8QbykeK5Z3b5GLpm7WG5aWkruWK45TPsvBVR4Lb047vwAAAAASUVORK5CYII=" />
<div id="woas_title"></div>
</div></div>
<div id="woas_edit_wrap">
<div id="woas_edit_content"><div id="woas_edit_controls">
<div id="woas_edit_page_title"><a title="Toggle wiki mark-up buttons" class="woas_edit_link" onclick="d$(true, 'wiki_format_buttons', -1)">W</a>&nbsp;|&nbsp;<a title="Toggle XHTML mark-up buttons" class="woas_edit_link" onclick="d$(true, 'html_format_buttons', -1)">X</a>&nbsp;|&nbsp;Page title: <input id="wiki_page_title" size="50" value="" /></div>
<div id="wiki_format_buttons">
<a class="woas_edit_link" onclick="d$(true, 'wiki_format_buttons', 0)">Wiki Code:</a>
<input title="Wiki page link" class="woas_button_editor woas_u" onclick="setWikiIUrl()" type="button" value="Wiki URL" />
<input title="External link" class="woas_button_editor woas_u" onclick="setWikiUrl()" type="button" value="URL" />
<input title="Level 1 header" class="woas_button_editor" onclick="TagThis('= ','')" type="button" value=" = " />
<input title="Level 2 header" class="woas_button_editor" onclick="TagThis('== ','')" type="button" value="==" />
<input title="Include wiki image" class="woas_button_editor" onclick="setWikiImage()" type="button" value="Img" />
<input title="Bold text" class="woas_button_editor woas_b" onclick="TagThis('*', '*')" type="button" value="B" />
<input title="Italic text" class="woas_button_editor woas_i" onclick="TagThis('/', '/')" type="button" value="i" />
<input title="Underlined text" class="woas_button_editor woas_u" onclick="TagThis('_', '_')" type="button" value="U" />
<input title="Nowiki inline text" class="woas_button_editor" onclick="TagThis('{{{', '}}}')" type="button" value="{{{x}}}" />
<input title="Nowiki block text" class="woas_button_editor" onclick="TagThis('{{{\n', '\n}}}')" type="button" value="{{{ }}}" />
<input title="Bulleted list item" class="woas_button_editor" onclick="TagThis('* ','')" type="button" value="*" />
<input title="Numbered list item" class="woas_button_editor" onclick="TagThis('# ','')" type="button" value="#" />
<input title="Alphanumeric list item" class="woas_button_editor" onclick="TagThis('@ ','')" type="button" value="@" />
<input title="Ruler (horizontal line)" class="woas_button_editor" onclick="woas.ui.editor._insert_ruler()" type="button" value="Ruler" />
<input title="Wiki tag or tags" class="woas_button_editor" onclick="setTag()" type="button" value="Tag" />
<a title="Open 'Tables' help page" class="woas_edit_link" onclick="woas.ui.tables_help()">Tables</a>
</div>
<div id="html_format_buttons"><a class="woas_edit_link" onclick="d$(true, 'html_format_buttons', 0)">XHTML Code:</a>
<input title="Bold text" class="woas_button_editor woas_b" onclick="FullTagThis('strong')" type="submit" value="B" />
<input title="Italic text" class="woas_button_editor woas_i" onclick="FullTagThis('em')" type="submit" value="i" />
<input title="Underlined text" class="woas_button_editor woas_u" onclick="FullTagThis('u')" type="submit" value="U" />
<input title="Strike-through text" class="woas_button_editor woas_s" onclick="FullTagThis('s')" type="submit" value="S" />
<input title="Superscript text" class="woas_button_editor" onclick="FullTagThis('sup')" type="submit" value="Sup" />
<input title="Subscript text" class="woas_button_editor" onclick="FullTagThis('sub')" type="submit" value="Sub" />
<input title="Align selection left" class="woas_button_editor" onclick="DivTagThis('left')" type="submit" value="Left" />
<input title="Align selection center" class="woas_button_editor" onclick="DivTagThis('center')" type="submit" value="Center" />
<input title="Align selection right" class="woas_button_editor" onclick="DivTagThis('right')" type="submit" value="Right" />
<input title="Justify selection" class="woas_button_editor" onclick="DivTagThis('justify')" type="submit" value="Justify" />
<input title="Unordered list" class="woas_button_editor" onclick="FullTagThis('ul')" type="submit" value="List" />
<input title="Ordered list" class="woas_button_editor" onclick="FullTagThis('ol')" type="submit" value="List=" />
<input title="List item" class="woas_button_editor" onclick="FullTagThis('li')" type="submit" value="li [*]" />
<input title="Blockquote (indented text)" class="woas_button_editor" onclick="FullTagThis('blockquote')" type="submit" value="Blockquote" />
<input title="Image link" class="woas_button_editor" onclick="setHTMLImage()" type="submit" value="Image" />
<input title="External link" class="woas_button_editor" onclick="setHTMLUrl()" type="submit" value="Link" />
</div></div>
<!--[if IE 6]><fieldset style="border:0"><![endif]-->
<div id="woas_editor_container"><textarea id="woas_editor" rows="0" cols="0">&nbsp;</textarea></div>
<!--[if IE 6]></fieldset><![endif]-->
</div></div>
<div id="woas_scroll_wrap">
<div id="woas_content">
<div id="woas_menu_wrap" ondblclick="menu_dblclick()"><div id="woas_menu_jar"><div id="woas_menu"></div>
<a title="Edit menu" id="woas_menu_edit" onclick="woas.ui.edit_menu()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAPFBMVEWlpaX09PSlpaUoKCgNDQ0NDQ0oKCg3NzdKSDxeWkZoZ2CEekWGhoWlpaXFxcXOt1nY2Nfl5eP09PT///+9MP7bAAAABXRSTlMAAAHT4Mm2GCIAAAB5SURBVBgZBcGBYcMwCAAwgSH7/9qtqbEnRScAztyKnzULcPfvKZl/GrD8rdX52e9hzpE5hf4+3i6gkNnWR4NE2/KZHYHErH1H7BkkorxU7EQi13M3NRuJM1GD5zsk7pnsD3IoxKK9j1kUEvq+qo8yB4glv/dGBwC4/7LOOiWq4O4oAAAAAElFTkSuQmCC" /><span>Edit</span></a>
</div></div>
<div id="woas_page_wrap">
<div id="woas_page" ondblclick="page_dblclick()"></div>
<div id="woas_mts"></div></div>
<div id="woas_footer_wrap"><div id="woas_footer"><div id="woas_footer_panel">
<div id="woas_about"><a title="Special::About" onclick="woas.ui.about()"></a></div>
<a title="Toggle debug display" id="woas_debug" onclick="woas.ui.toggle_debug()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAMFBMVEVKYnp9lq7K4/t5aAmpwtv1+f6QqMC70+rn8v6dsshcdY2kvNPY6/7A2fH///8PDw9fznsJAAAAEHRSTlP///////////////////8A4CNdGQAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAABySURBVAjXY/gPBQxA/O4dhPFv5sz3IMa/l6Edfu+BjJebwu+V+P1n+Dc1vPbRi7b3QEZ5nZ76wfdAqfaHEnfkQGr6FN8VARn/Zrx98WTaLaCaHX26nukFQDWvtxyZlsUHMvDZIV2+92ArVq16j2opBAAAW7NklyU6ioMAAAAASUVORK5CYII=" /><span>Debug</span>
</a>
<a title="Go to top of page" id="woas_top" onclick="woas.ui.top()"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAABBklEQVQoz3WRrU4DURCFzy1Jt0FjWsNPUlPRp6mgyCZNFT+CB4AHQIDpS4AAu0ACalUVaQBVMKC2AQHcfLl3EbvbvSlhJhlzzpyZOSNJwtCgyy6XTHngnCEd6hjlwQob7DMhxReZkjCkRU3S3LDOCW84EpUtCY4XjmhixCoHvOO0FNYxY0Akukwq2GY2W+g47miLPX5KcZvluRj0yba4KvtLOKA4xuIRX4mHVcJzK6YlIdyhIDhicRFeEC4p4TgTI74qB0KC9czpiQ7Jv2fGbIoGI17/GgU8s0Okb0OLY2b4JaufOGQNI4kaTQbc84HD43GkXNMv4OLdEW36jLkh5pQeW9Rz7BeMJwQ6+UVq0gAAAABJRU5ErkJggg==" />
<span>Top</span>
</a>
&nbsp;</div>
<div id="woas_debug_console">
<!--[if IE 6]><fieldset style="border:0"><![endif]-->
<div id="woas_debug_log_container">
<textarea id="woas_debug_log" rows="5" readonly="readonly"></textarea></div>
<!--[if IE 6]></fieldset><![endif]-->
<input title="Clear debug log" class="woas_button" id="woas_debug_log_clear" onclick="d$('woas_debug_log').value='';if(window.console)console.clear()" type="button" value="Clear" />
</div></div></div>
</div></div></div>
<script type="text/javascript">
//<![CDATA[
// code here because of Opera/Safari/Chrome restriction on DOM creation from
// external JavaScript (SourceForge development version has external js files).
// woas.tiddlySaver is set to false or called by _on_load if needed, causing it
// to overwrite itself with an applet reference (loaded or not) or false; this
// allows Firefox to use Java if WoasFox/TiddlyFox is not available, and also
// stops an observed Opera error (multiple calls).
woas.tiddlySaver = function() {
	var ts = document.createElement('applet');
	ts.name = 'TiddlySaver';
	ts.archive = 'TiddlySaver.jar';
	ts.code = 'TiddlySaver.class';
	ts.width = 0;
	ts.height = 0;
	ts.style.position = 'absolute';
	document.body.appendChild(ts);
	woas.tiddlySaver = document.TiddlySaver;
}
//]]>
</script>
<div id="woas_custom_accesskeys">&nbsp;</div>
</body></html>